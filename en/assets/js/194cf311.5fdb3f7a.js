"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[4737],{3905:function(e,n,l){l.d(n,{Zo:function(){return k},kt:function(){return c}});var a=l(67294);function t(e,n,l){return n in e?Object.defineProperty(e,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[n]=l,e}function r(e,n){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),l.push.apply(l,a)}return l}function s(e){for(var n=1;n<arguments.length;n++){var l=null!=arguments[n]?arguments[n]:{};n%2?r(Object(l),!0).forEach((function(n){t(e,n,l[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):r(Object(l)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(l,n))}))}return e}function p(e,n){if(null==e)return{};var l,a,t=function(e,n){if(null==e)return{};var l,a,t={},r=Object.keys(e);for(a=0;a<r.length;a++)l=r[a],n.indexOf(l)>=0||(t[l]=e[l]);return t}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)l=r[a],n.indexOf(l)>=0||Object.prototype.propertyIsEnumerable.call(e,l)&&(t[l]=e[l])}return t}var o=a.createContext({}),i=function(e){var n=a.useContext(o),l=n;return e&&(l="function"==typeof e?e(n):s(s({},n),e)),l},k=function(e){var n=i(e.components);return a.createElement(o.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var l=e.components,t=e.mdxType,r=e.originalType,o=e.parentName,k=p(e,["components","mdxType","originalType","parentName"]),m=i(l),c=t,d=m["".concat(o,".").concat(c)]||m[c]||u[c]||r;return l?a.createElement(d,s(s({ref:n},k),{},{components:l})):a.createElement(d,s({ref:n},k))}));function c(e,n){var l=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var r=l.length,s=new Array(r);s[0]=m;var p={};for(var o in n)hasOwnProperty.call(n,o)&&(p[o]=n[o]);p.originalType=e,p.mdxType="string"==typeof e?e:t,s[1]=p;for(var i=2;i<r;i++)s[i]=l[i];return a.createElement.apply(null,s)}return a.createElement.apply(null,l)}m.displayName="MDXCreateElement"},89422:function(e,n,l){l.r(n),l.d(n,{assets:function(){return k},contentTitle:function(){return o},default:function(){return c},frontMatter:function(){return p},metadata:function(){return i},toc:function(){return u}});var a=l(83117),t=l(80102),r=(l(67294),l(3905)),s=["components"],p={id:"linux-cicd-4",slug:"/linux-cicd-4",title:"\u7b2c 4 \u7ae0 Linux Ansible \u5165\u95e8\u77e5\u8bc6",authors:"zhangqf",keywords:["linux","ansible"]},o=void 0,i={unversionedId:"linux/cicd/linux-cicd-4",id:"linux/cicd/linux-cicd-4",title:"\u7b2c 4 \u7ae0 Linux Ansible \u5165\u95e8\u77e5\u8bc6",description:"4.1\u3001Ansible \u7b80\u4ecb",source:"@site/docs/linux/cicd/\u7b2c 4 \u7ae0 Linux Ansible \u5165\u95e8\u77e5\u8bc6.md",sourceDirName:"linux/cicd",slug:"/linux-cicd-4",permalink:"/en/docs/linux-cicd-4",draft:!1,tags:[],version:"current",frontMatter:{id:"linux-cicd-4",slug:"/linux-cicd-4",title:"\u7b2c 4 \u7ae0 Linux Ansible \u5165\u95e8\u77e5\u8bc6",authors:"zhangqf",keywords:["linux","ansible"]},sidebar:"linux",previous:{title:"\u7b2c 3 \u7ae0 Jenkins \u81ea\u52a8\u5316\u7cfb\u7edf",permalink:"/en/docs/linux/cicd/\u7b2c 3 \u7ae0 Jenkins \u81ea\u52a8\u5316\u7cfb\u7edf"},next:{title:"\u7b2c 5 \u7ae0 Linux Ansible \u8fdb\u9636\u77e5\u8bc6",permalink:"/en/docs/linux-cicd-5"}},k={},u=[{value:"4.1\u3001Ansible \u7b80\u4ecb",id:"41ansible-\u7b80\u4ecb",level:2},{value:"4.2\u3001Ansible \u4f53\u9a8c",id:"42ansible-\u4f53\u9a8c",level:2},{value:"4.2.1\u3001Ansible \u73af\u5883\u51c6\u5907",id:"421ansible-\u73af\u5883\u51c6\u5907",level:3},{value:"4.2.2\u3001\u5b89\u88c5 Ansible",id:"422\u5b89\u88c5-ansible",level:3},{value:"4.2.3\u3001Ansible \u547d\u4ee4\u8865\u5168",id:"423ansible-\u547d\u4ee4\u8865\u5168",level:3},{value:"4.2.4\u3001\u914d\u7f6e\u4e3b\u673a\u4e92\u4fe1",id:"424\u914d\u7f6e\u4e3b\u673a\u4e92\u4fe1",level:3},{value:"4.2.5\u3001Ansible \u4f53\u9a8c",id:"425ansible-\u4f53\u9a8c",level:3},{value:"4.3\u3001Ansible \u914d\u7f6e\u6587\u4ef6",id:"43ansible-\u914d\u7f6e\u6587\u4ef6",level:2},{value:"4.4\u3001Inventory",id:"44inventory",level:2},{value:"4.4.1\u3001Inventory \u6587\u4ef6\u8def\u5f84",id:"441inventory-\u6587\u4ef6\u8def\u5f84",level:3},{value:"4.4.2\u3001\u914d\u7f6e Inventory",id:"442\u914d\u7f6e-inventory",level:3},{value:"4.4.2.1\u3001\u4e00\u884c\u4e00\u4e3b\u673a\u7684\u5b9a\u4e49\u65b9\u5f0f",id:"4421\u4e00\u884c\u4e00\u4e3b\u673a\u7684\u5b9a\u4e49\u65b9\u5f0f",level:4},{value:"4.4.2.2\u3001Inventory \u4e2d\u7684\u666e\u901a\u53d8\u91cf",id:"4422inventory-\u4e2d\u7684\u666e\u901a\u53d8\u91cf",level:4},{value:"4.4.2.3\u3001\u4e3b\u673a\u5206\u7ec4",id:"4423\u4e3b\u673a\u5206\u7ec4",level:4},{value:"4.4.2.4\u3001\u4e3b\u673a\u7ec4\u53d8\u91cf",id:"4424\u4e3b\u673a\u7ec4\u53d8\u91cf",level:4},{value:"4.4.2.5\u3001\u7ec4\u5d4c\u5957",id:"4425\u7ec4\u5d4c\u5957",level:4},{value:"4.4.2.6\u3001Multi Inventory \u6587\u4ef6",id:"4426multi-inventory-\u6587\u4ef6",level:4},{value:"4.4.3\u3001\u5b9e\u9a8c Inventory \u6587\u4ef6",id:"443\u5b9e\u9a8c-inventory-\u6587\u4ef6",level:3},{value:"4.5\u3001Playbook",id:"45playbook",level:2},{value:"4.5.1\u3001playbook\u3001play \u548c task \u7684\u5173\u7cfb",id:"451playbookplay-\u548c-task-\u7684\u5173\u7cfb",level:3},{value:"4.5.2\u3001YAML \u8bed\u6cd5",id:"452yaml-\u8bed\u6cd5",level:3},{value:"4.5.2.1\u3001\u5bf9\u8c61",id:"4521\u5bf9\u8c61",level:4},{value:"4.5.2.2\u3001\u6570\u7ec4",id:"4522\u6570\u7ec4",level:4},{value:"4.5.2.3\u3001\u5b57\u5178",id:"4523\u5b57\u5178",level:4},{value:"4.5.2.4\u3001\u590d\u5408\u7ed3\u6784",id:"4524\u590d\u5408\u7ed3\u6784",level:4},{value:"4.5.2.5\u3001\u5b57\u7b26\u4e32\u7eed\u884c",id:"4525\u5b57\u7b26\u4e32\u7eed\u884c",level:4},{value:"4.5.2.6\u3001\u7a7a\u503c",id:"4526\u7a7a\u503c",level:4},{value:"4.5.2.7\u3001\u5355\u53cc\u5f15\u53f7\u548c\u8f6c\u4e49",id:"4527\u5355\u53cc\u5f15\u53f7\u548c\u8f6c\u4e49",level:4},{value:"4.5.3\u3001playbook \u7684\u5199\u6cd5",id:"453playbook-\u7684\u5199\u6cd5",level:3},{value:"4.5.4\u3001playbook \u6a21\u5757\u53c2\u6570\u7684\u4f20\u9012\u65b9\u5f0f",id:"454playbook-\u6a21\u5757\u53c2\u6570\u7684\u4f20\u9012\u65b9\u5f0f",level:3},{value:"4.5.5\u3001play \u7684\u76ee\u6807\u4e3b\u673a",id:"455play-\u7684\u76ee\u6807\u4e3b\u673a",level:3},{value:"4.6\u3001\u9ed8\u8ba4\u7684\u4efb\u52a1\u6267\u884c\u7b56\u7565",id:"46\u9ed8\u8ba4\u7684\u4efb\u52a1\u6267\u884c\u7b56\u7565",level:2},{value:"4.7\u3001\u7efc\u5408\u6848\u4f8b",id:"47\u7efc\u5408\u6848\u4f8b",level:2}],m={toc:u};function c(e){var n=e.components,p=(0,t.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},m,p,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"41ansible-\u7b80\u4ecb"},"4.1\u3001Ansible \u7b80\u4ecb"),(0,r.kt)("p",null,"Ansible \u662f\u4e00\u4e2a\u57fa\u4e8e Python \u5f00\u53d1\u7684\u914d\u7f6e\u7ba1\u7406\u548c\u5e94\u7528\u90e8\u7f72\u5de5\u5177\uff0c\u73b0\u5728\u4e5f\u5728\u81ea\u52a8\u5316\u7ba1\u7406\u9886\u57df\u5927\u653e\u5f02\u5f69\u3002\u5b83\u878d\u5408\u4e86\u4f17\u591a\u8001\u724c\u8fd0\u7ef4\u5de5\u5177\u7684\u4f18\u70b9\uff0cPubbet \u548c Saltstack \u80fd\u5b9e\u73b0\u7684\u529f\u80fd\uff0cAnsible \u57fa\u672c\u4e0a\u90fd\u53ef\u4ee5\u5b9e\u73b0\u3002"),(0,r.kt)("p",null,"Ansible \u80fd\u6279\u91cf\u914d\u7f6e\u3001\u90e8\u7f72\u3001\u7ba1\u7406\u4e00\u5927\u5806\u7684\u4e3b\u673a\u3002\u6bd4\u5982\u4ee5\u524d\u9700\u8981\u5207\u6362\u5230\u6bcf\u4e2a\u4e3b\u673a\u4e0a\u6267\u884c\u7684\u4e00\u6216\u591a\u4e2a\u64cd\u4f5c\uff0c\u4f7f\u7528Ansible \u53ea\u9700\u5728\u56fa\u5b9a\u7684\u4e00\u53f0 Ansible \u63a7\u5236\u8282\u70b9\u4e0a\u53bb\u5b8c\u6210\u6240\u6709\u4e3b\u673a\u7684\u64cd\u4f5c\u3002"),(0,r.kt)("p",null,"Ansible \u662f\u57fa\u4e8e\u6a21\u5757\u5de5\u4f5c\u7684\uff0c\u5b83\u53ea\u662f\u63d0\u4f9b\u4e86\u4e00\u79cd\u8fd0\u884c\u6846\u67b6\uff0c\u5b83\u672c\u8eab\u6ca1\u6709\u5b8c\u6210\u4efb\u52a1\u7684\u80fd\u529b\uff0c\u771f\u6b63\u6267\u884c\u64cd\u4f5c\u7684\u662f Ansible \u7684\u6a21\u5757\uff0c\u6bd4\u5982 copy \u6a21\u5757\u7528\u4e8e\u62f7\u8d1d\u6587\u4ef6\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e0a\uff0cservice \u6a21\u5757\u7528\u4e8e\u7ba1\u7406\u670d\u52a1\u7684\u542f\u52a8\u3001\u505c\u6b62\u3001\u91cd\u542f\u7b49\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ansible_arch",src:l(93617).Z,width:"713",height:"385"})),(0,r.kt)("p",null,"Ansible \u5176\u4e2d\u4e00\u4e2a\u6bd4\u8f83\u9c9c\u660e\u7684\u7279\u6027\u662f Agentless\uff0c\u5373\u65e0 Agent \u7684\u5b58\u5728\uff0c\u5b83\u5c31\u50cf\u666e\u901a\u547d\u4ee4\u4e00\u6837\uff0c\u5e76\u975e C/S \u8f6f\u4ef6\uff0c\u4e5f\u53ea\u9700\u5728\u67d0\u4e2a\u4f5c\u4e3a\u63a7\u5236\u8282\u70b9\u7684\u4e3b\u673a\u4e0a\u5b89\u88c5\u4e00\u6b21 Ansible \u5373\u53ef\uff0c\u901a\u5e38\u5b83\u57fa\u4e8e ssh \u8fde\u63a5\u6765\u63a7\u5236\u8fdc\u7a0b\u4e3b\u673a\uff0c\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u4e0d\u9700\u8981\u5b89\u88c5 Ansible \u6216\u5176\u5b83\u989d\u5916\u7684\u670d\u52a1\u3002"),(0,r.kt)("p",null,"Ansible \u7684\u53e6\u4e00\u4e2a\u6bd4\u8f83\u9c9c\u660e\u7684\u7279\u6027\u662f\u5b83\u7684\u7edd\u5927\u591a\u6570\u6a21\u5757\u90fd\u5177\u5907\u5e42\u7b49\u6027(idempotence)\u3002\u91cd\u590d\u6267\u884c\u67d0\u4e2a\u4efb\u52a1\u7edd\u5927\u591a\u6570\u65f6\u5019\u4e0d\u4f1a\u4ea7\u751f\u4efb\u4f55\u526f\u4f5c\u7528\u3002"),(0,r.kt)("h2",{id:"42ansible-\u4f53\u9a8c"},"4.2\u3001Ansible \u4f53\u9a8c"),(0,r.kt)("h3",{id:"421ansible-\u73af\u5883\u51c6\u5907"},"4.2.1\u3001Ansible \u73af\u5883\u51c6\u5907"),(0,r.kt)("p",null,"Ansible \u7684\u4f5c\u7528\u662f\u6279\u91cf\u63a7\u5236\u5176\u5b83\u8fdc\u7a0b\u4e3b\u673a\uff0c\u5e76\u6307\u6325\u8fdc\u7a0b\u4e3b\u673a\u8282\u70b9\u505a\u4e00\u4e9b\u64cd\u4f5c\u3001\u5b8c\u6210\u4e00\u4e9b\u4efb\u52a1\u3002\u6240\u4ee5\u5728\u8fd9\u4e2a\u7ed3\u6784\u4e2d\uff0c\u5206\u4e3a\u63a7\u5236\u8282\u70b9\u548c\u88ab\u63a7\u5236\u8282\u70b9\u3002Ansible \u662f Agentless \u7684\u8f6f\u4ef6\uff0c\u53ea\u9700\u5728\u63a7\u5236\u8282\u70b9\u5b89\u88c5 Ansible\uff0c\u88ab\u63a7\u5236\u8282\u70b9\u4e00\u822c\u4e0d\u9700\u989d\u5916\u5b89\u88c5\u4efb\u4f55\u7a0b\u5e8f\u3002"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"\u6ce8\u610f\uff1aAnsible \u7684\u6a21\u5757\u662f\u7528 Python \u6765\u6267\u884c\u7684\uff0c\u4e14\u9ed8\u8ba4\u8fdc\u7a0b\u8fde\u63a5\u7684\u65b9\u5f0f\u662f ssh\uff0c\u6240\u4ee5\u63a7\u5236\u7aef\u548c\u88ab\u63a7\u5236\u7aef\u90fd\u9700\u8981\u6709 Python \u73af\u5883\uff0c\u5e76\u4e14\u88ab\u63a7\u5236\u7aef\u9700\u8981\u542f\u52a8 sshd \u670d\u52a1\uff0c\u4f46\u901a\u5e38\u8fd9\u4e24\u4e2a\u6761\u4ef6\u5728\u5b89\u88c5 Linux \u7cfb\u7edf\u65f6\u5c31\u5df2\u7ecf\u5177\u5907\u4e86\u3002\u6240\u4ee5\u4f7f\u7528 Ansible \u7684\u5b89\u88c5\u8fc7\u7a0b\u53ea\u6709\u4e00\u4e2a\uff1a\u5728\u63a7\u5236\u7aef\u5b89\u88c5 Ansible\u3002")),(0,r.kt)("p",null,"\u5728\u672c\u6587\u4e2d\uff0c\u5c06\u914d\u7f6e\u5982\u4e0b\u6d4b\u8bd5\u73af\u5883\uff1a\u5305\u62ec\u4e00\u4e2a Ansible \u63a7\u5236\u8282\u70b9\u548c 7 \u4e2a\u88ab\u63a7\u5236\u8282\u70b9\u3002\u540e\u9762\u7684\u6587\u7ae0\u4e2d\u5982\u679c\u6ca1\u6709\u7279\u522b\u8bf4\u660e\uff0c\u4e5f\u90fd\u4f7f\u7528\u6b64\u5904\u7684\u4e3b\u673a\u73af\u5883\u3002"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"\u6ce8\u610f\uff1a\u8be5 Ansible \u73af\u5883\u662f\u57fa\u4e8e x86 \u67b6\u6784\uff0c\u4e0e ARM64 \u67b6\u6784\u4f7f\u7528\u65b9\u5f0f\u76f8\u540c\u3002")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u4e3b\u673a"),(0,r.kt)("th",{parentName:"tr",align:null},"IP \u5730\u5740"),(0,r.kt)("th",{parentName:"tr",align:null},"\u4e3b\u673a\u540d"),(0,r.kt)("th",{parentName:"tr",align:null},"\u64cd\u4f5c\u7cfb\u7edf"),(0,r.kt)("th",{parentName:"tr",align:null},"Ansible \u7248\u672c"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"controller"),(0,r.kt)("td",{parentName:"tr",align:null},"192.168.95.88"),(0,r.kt)("td",{parentName:"tr",align:null},"controller"),(0,r.kt)("td",{parentName:"tr",align:null},"Centos79"),(0,r.kt)("td",{parentName:"tr",align:null},"v2.9.27")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node1"),(0,r.kt)("td",{parentName:"tr",align:null},"192.168.95.131"),(0,r.kt)("td",{parentName:"tr",align:null},"node1"),(0,r.kt)("td",{parentName:"tr",align:null},"Centos79"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65e0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node2"),(0,r.kt)("td",{parentName:"tr",align:null},"192.168.95.132"),(0,r.kt)("td",{parentName:"tr",align:null},"node2"),(0,r.kt)("td",{parentName:"tr",align:null},"Centos79"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65e0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node3"),(0,r.kt)("td",{parentName:"tr",align:null},"192.168.95.133"),(0,r.kt)("td",{parentName:"tr",align:null},"node3"),(0,r.kt)("td",{parentName:"tr",align:null},"Centos79"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65e0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node4"),(0,r.kt)("td",{parentName:"tr",align:null},"192.168.95.134"),(0,r.kt)("td",{parentName:"tr",align:null},"node4"),(0,r.kt)("td",{parentName:"tr",align:null},"Centos79"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65e0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node5"),(0,r.kt)("td",{parentName:"tr",align:null},"192.168.95.135"),(0,r.kt)("td",{parentName:"tr",align:null},"node5"),(0,r.kt)("td",{parentName:"tr",align:null},"Centos79"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65e0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node6"),(0,r.kt)("td",{parentName:"tr",align:null},"192.168.95.136"),(0,r.kt)("td",{parentName:"tr",align:null},"node6"),(0,r.kt)("td",{parentName:"tr",align:null},"Centos79"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65e0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node7"),(0,r.kt)("td",{parentName:"tr",align:null},"192.168.95.137"),(0,r.kt)("td",{parentName:"tr",align:null},"node7"),(0,r.kt)("td",{parentName:"tr",align:null},"Centos79"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65e0")))),(0,r.kt)("p",null,"\u6240\u6709\u4e3b\u673a\u4e0a\u90fd\u5df2\u542f\u52a8 sshd \u670d\u52a1\u5e76\u76d1\u542c\u5728 22 \u7aef\u53e3\u4e0a\u3002\u56e0\u4e3a\u6709\u65f6\u5019\u4e5f\u4f1a\u4f7f\u7528\u4e3b\u673a\u540d\u53bb\u63a7\u5236\u76ee\u6807\u8282\u70b9\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e5f\u5728 controller \u8282\u70b9\u4e0a\u914d\u7f6e\u4e86\u5176\u4f59 7 \u4e2a\u8282\u70b9\u7684 DNS \u89e3\u6790\uff0c\u53ef\u5728 controller \u8282\u70b9\u7684 /etc/hosts \u6587\u4ef6\u4e2d\u52a0\u5165\u5982\u4e0b\u5185\u5bb9\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@controller ~]# cat >>/etc/hosts<<EOF\n192.168.95.131 node1\n192.168.95.132 node2\n192.168.95.133 node3\n192.168.95.134 node4\n192.168.95.135 node5\n192.168.95.136 node6\n192.168.95.137 node7\nEOF\n")),(0,r.kt)("h3",{id:"422\u5b89\u88c5-ansible"},"4.2.2\u3001\u5b89\u88c5 Ansible"),(0,r.kt)("p",null,"\u5b98\u65b9\u6587\u6863\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://docs.ansible.com/ansible/latest/"},"https://docs.ansible.com/ansible/latest/")),(0,r.kt)("p",null,"\u5bf9\u4e8e RHEL \u7cfb\u5217\u7684\u7cfb\u7edf\u6765\u8bf4\uff0c\u914d\u7f6e\u597d epel \u955c\u50cf\u5373\u53ef\u5b89\u88c5\u6700\u65b0\u7248\u7684 Ansible\u3002\u4f7f\u7528\u963f\u91cc\u4e91\u7684 epel \u6e90\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@controller ~]# wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\n[root@controller ~]# yum info ansible\nLoaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirrors.aliyun.com\n * extras: mirrors.njupt.edu.cn\n * updates: mirrors.aliyun.com\nAvailable Packages\nName        : ansible\nArch        : noarch\nVersion     : 2.9.27\nRelease     : 1.el7\nSize        : 17 M\nRepo        : epel/x86_64\nSummary     : SSH-based configuration management, deployment, and task execution system\nURL         : http://ansible.com\nLicense     : GPLv3+\nDescription : Ansible is a radically simple model-driven configuration management,\n            : multi-node deployment, and remote task execution system. Ansible works\n            : over SSH and does not require any software or daemons to be installed\n            : on remote nodes. Extension modules can be written in any language and\n            : are transferred to managed machines automatically.\n")),(0,r.kt)("p",null,"\u7136\u540e\u5b89\u88c5\u5373\u53ef\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@controller ~]# yum install ansible -y\n")),(0,r.kt)("p",null,"Ansible \u6bcf\u4e2a\u7248\u672c\u91ca\u653e\u51fa\u6765\u4e4b\u540e\uff0c\u90fd\u9996\u5148\u63d0\u4ea4\u5230 Pypi\uff0c\u6240\u4ee5\u4efb\u4f55\u64cd\u4f5c\u7cfb\u7edf\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528 pip \u5de5\u5177\u6765\u5b89\u88c5\u6700\u65b0\u7248\u7684 Ansible\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@controller ~]# pip3 install ansible\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6ce8\u610f\uff1apython2.x \u7684\u73af\u5883\u548c python3.x \u7684\u73af\u5883\u662f\u4e0d\u517c\u5bb9\u7684\uff0c\u9700\u8981\u6ce8\u610f\u533a\u5206\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u6ce8\u610f\uff1a\u4f7f\u7528\u5404\u7cfb\u7edf\u7684\u5305\u7ba1\u7406\u5de5\u5177(\u5982 yum)\u5b89\u88c5 Ansible \u65f6\u4f1a\u81ea\u52a8\u63d0\u4f9b\u4e00\u4e9b\u914d\u7f6e\u6587\u4ef6\uff0c\u5982 /etc/ansible/ansible.cfg\u3002\u800c\u4f7f\u7528 pip \u5b89\u88c5\u7684 Ansible \u9ed8\u8ba4\u4e0d\u63d0\u4f9b\u914d\u7f6e\u6587\u4ef6\u3002")),(0,r.kt)("h3",{id:"423ansible-\u547d\u4ee4\u8865\u5168"},"4.2.3\u3001Ansible \u547d\u4ee4\u8865\u5168"),(0,r.kt)("p",null,"\u4ece Ansible 2.9 \u7248\u672c\u5f00\u59cb\uff0c\u5b83\u652f\u6301\u547d\u4ee4\u7684\u9009\u9879\u8865\u5168\u529f\u80fd\uff0c\u5b83\u4f9d\u8d56\u4e8e python \u7684 argcomplete \u63d2\u4ef6\u3002"),(0,r.kt)("p",null,"\u5b89\u88c5 argcomplete\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# CentOS/RHEL\nyum -y install python-argcomplete\n\n# \u4efb\u4f55\u7cfb\u7edf\u90fd\u53ef\u4ee5\u4f7f\u7528pip\u5de5\u5177\u5b89\u88c5argcomplete\npip3 install argcomplete\n")),(0,r.kt)("p",null,"\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u8fd8\u9700\u6fc0\u6d3b\u8be5\u63d2\u4ef6\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u8981\u6c42bash\u7248\u672c\u5927\u4e8e\u7b49\u4e8e4.2\nsudo activate-global-python-argcomplete\n\n# \u5982\u679cbash\u7248\u672c\u4f4e\u4e8e4.2\uff0c\u5219\u5355\u72ec\u4e3a\u6bcf\u4e2aansible\u547d\u4ee4\u6ce8\u518c\u8865\u5168\u529f\u80fd\neval $(register-python-argcomplete ansible)\neval $(register-python-argcomplete ansible-config)\neval $(register-python-argcomplete ansible-console)\neval $(register-python-argcomplete ansible-doc)\neval $(register-python-argcomplete ansible-galaxy)\neval $(register-python-argcomplete ansible-inventory)\neval $(register-python-argcomplete ansible-playbook)\neval $(register-python-argcomplete ansible-pull)\neval $(register-python-argcomplete ansible-vault)\n")),(0,r.kt)("p",null,"\u6700\u540e\uff0c\u9000\u51fa\u5f53\u524d Shell \u91cd\u65b0\u8fdb\u5165\uff0c\u6216\u8005\u7b80\u5355\u7684\u76f4\u63a5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"exec $SHELL\n")),(0,r.kt)("p",null,"\u7136\u540e\u5c31\u53ef\u4ee5\u6309 tab \u4e00\u6b21\u6216\u4e24\u6b21\u8865\u5168\u53c2\u6570\u6216\u63d0\u793a\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u4e0b\u9762\u9009\u9879\u8f93\u5165\u5230\u4e00\u534a\u7684\u65f6\u5019\uff0c\u6309\u4e00\u4e0b tab \u952e\u5c31\u4f1a\u8865\u5168\u5f97\u5230 ansible --syntax-check\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ansible --syn\n")),(0,r.kt)("h3",{id:"424\u914d\u7f6e\u4e3b\u673a\u4e92\u4fe1"},"4.2.4\u3001\u914d\u7f6e\u4e3b\u673a\u4e92\u4fe1"),(0,r.kt)("p",null,"\u56e0\u4e3a Ansible \u9ed8\u8ba4\u662f\u57fa\u4e8e ssh \u8fde\u63a5\u7684\uff0c\u6240\u4ee5\u8981\u63a7\u5236\u5176\u5b83\u8282\u70b9\u9996\u5148\u9700\u8981\u5efa\u7acb\u597d ssh \u8fde\u63a5\uff0c\u800c\u5efa\u7acb ssh \u8fde\u63a5\u8981\u4e48\u9700\u8981\u63d0\u4f9b\u5bc6\u7801\uff0c\u8981\u4e48\u9700\u8981\u914d\u7f6e\u597d\u8ba4\u8bc1\u65b9\u5f0f\u3002\u4e3a\u4e86\u65b9\u4fbf\u540e\u6587\u7684\u6d4b\u8bd5\uff0c\u8fd9\u91cc\u5148\u914d\u7f6e\u597d controller \u548c\u5176\u5b83\u88ab\u63a7\u8282\u70b9\u4e4b\u95f4\u7684\u4e3b\u673a\u4e92\u4fe1\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u907f\u514d\u914d\u7f6e\u4e3b\u673a\u4e92\u4fe1\u8fc7\u7a0b\u4e2d\u7684\u4ea4\u4e92\u5f0f\u8be2\u95ee\uff0c\u8fd9\u91cc\u4f7f\u7528 ssh-keyscan \u5de5\u5177\u6dfb\u52a0\u4e3b\u673a\u8ba4\u8bc1\u4fe1\u606f\u4ee5\u53ca sshpass \u5de5\u5177(\u5b89\u88c5 Ansible \u65f6\u4f1a\u81ea\u52a8\u5b89\u88c5 sshpass\uff0c\u4e5f\u53ef\u4ee5 yum -y install sshpass \u5b89\u88c5)\u76f4\u63a5\u6307\u5b9a ssh \u8fde\u63a5\u5bc6\u7801\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5728 controller \u8282\u70b9\u4e0a\u751f\u6210\u5bc6\u94a5\u5bf9")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ssh-keygen -t rsa -f ~/.ssh/id_rsa -N ''\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u5c06\u5404\u8282\u70b9\u7684\u4e3b\u673a\u4fe1\u606f(host key)\u5199\u5165 controller \u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"~/.ssh/known_hosts")," \u6587\u4ef6")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"for host in node{1..7};do\n  ssh-keyscan $host >>~/.ssh/known_hosts 2>/dev/null\ndone\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u5c06 controller \u4e0a\u7684 ssh \u516c\u94a5\u5206\u53d1\u7ed9\u5404\u8282\u70b9")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# sshpass -p \u9009\u9879\u6307\u5b9a\u7684\u662f\u5bc6\u7801\nfor host in node{1..7};do\n  sshpass -p'123456' ssh-copy-id root@$host &>/dev/null\ndone\n")),(0,r.kt)("p",null,"\u6ce8\u610f\uff1a\u901a\u8fc7\u4e0a\u9762\u4e09\u6b65\u53ef\u4ee5\u5b8c\u6210 controller \u5230\u5176\u5b83 7 \u4e2a\u4e3b\u673a\u7684\u514d\u5bc6\u8ba4\u8bc1\uff0c\u4f46\u662f\u53cd\u8fc7\u6765\u5176\u5b83\u4e3b\u673a\u5230 controller \u4e0d\u662f\u514d\u5bc6\u8ba4\u8bc1\u3002"),(0,r.kt)("h3",{id:"425ansible-\u4f53\u9a8c"},"4.2.5\u3001Ansible \u4f53\u9a8c"),(0,r.kt)("p",null,"\u524d\u9762\u6211\u4eec\u63d0\u5230\u8fc7\uff0cAnsible \u7684\u529f\u80fd\u4e4b\u6240\u4ee5\u5f3a\u5927\uff0c\u662f\u56e0\u4e3a Ansible \u63d0\u4f9b\u4e86\u6210\u5343\u4e0a\u4e07\u4e2a\u6a21\u5757\uff0c\u6bcf\u4e2a\u6a21\u5757\u90fd\u5bf9\u5e94\u4e00\u4e2a\u529f\u80fd\u3002\u5176\u4e2d 100 \u591a\u4e2a\u6838\u5fc3\u6a21\u5757\u662f Ansible \u56e2\u961f\u81ea\u5df1\u7ef4\u62a4\u7684\uff0c\u5269\u4f59\u7684\u6a21\u5757\u90fd\u662f Ansible \u793e\u533a\u7ef4\u62a4\u3002\u53e6\u5916\uff0cAnsible \u4e5f\u5141\u8bb8\u7528\u6237\u81ea\u5b9a\u4e49\u6a21\u5757\uff0c\u89e3\u51b3\u67d0\u4e9b\u4e2a\u6027\u5316\u7684\u95ee\u9898 \u3002"),(0,r.kt)("p",null,"\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u6267\u884c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'[root@controller ~]# ansible localhost -m copy -a \'src=/etc/passwd dest=/tmp\'\nlocalhost | CHANGED => {\n    "changed": true,\n    "checksum": "f46e74616780e28c950837c16571665b058c3233",\n    "dest": "/tmp/passwd",\n    "gid": 0,\n    "group": "root",\n    "md5sum": "388824fe0e2029fba5ef752f0e0fab2c",\n    "mode": "0644",\n    "owner": "root",\n    "size": 798,\n    "src": "/root/.ansible/tmp/ansible-tmp-1657750978.04-11732-253772452173510/source",\n    "state": "file",\n    "uid": 0\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8be5\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u62f7\u8d1d\u672c\u673a\u7684 /etc/passwd \u6587\u4ef6\u5230\u672c\u673a\u7684 /tmp \u76ee\u5f55\u4e0b\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5176\u4e2d\u7684 ansible \u662f\u4e00\u4e2a\u547d\u4ee4\uff0c\u8fd9\u4e2a\u81ea\u4e0d\u9700\u8981\u591a\u505a\u89e3\u91ca\u3002\u9664 ansible \u547d\u4ee4\u5916\uff0c\u540e\u9762\u8fd8\u4f1a\u7528\u5230 ansible-playbook \u547d\u4ee4\u3002"),(0,r.kt)("li",{parentName:"ul"},"localhost \u53c2\u6570\u8868\u793a ansible \u8981\u63a7\u5236\u7684\u8282\u70b9\uff0c\u5373 ansible \u5c06\u6307\u6325\u672c\u673a\u6267\u884c\u4efb\u52a1\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u6267\u884c\u4efb\u52a1\u4e3b\u8981\u662f\u6267\u884c\u6a21\u5757\uff0c\u6a21\u5757\u7684\u6267\u884c\u8fd8\u53ef\u4ee5\u4f9d\u8d56\u4e00\u4e9b\u6a21\u5757\u53c2\u6570\u3002\u5728 ansible \u547d\u4ee4\u884c\u4e2d\uff0c\u4f7f\u7528 -m Module \u6765\u6307\u5b9a\u8981\u6267\u884c\u54ea\u4e2a\u6a21\u5757\uff0c\u5373\u6267\u884c\u4ec0\u4e48\u4efb\u52a1\uff0c\u4f7f\u7528 -a ARGS \u6765\u6307\u5b9a\u6a21\u5757\u8fd0\u884c\u65f6\u7684\u53c2\u6570\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u672c\u793a\u4f8b\u4e2d\u7684\u6a21\u5757\u4e3a copy \u6a21\u5757\uff0c\u4f20\u9012\u7ed9 copy \u6a21\u5757\u7684\u53c2\u6570\u5305\u542b\u4e24\u9879\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"src=/etc/passwd")," \u6307\u5b9a\u6e90\u6587\u4ef6"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dest=/tmp")," \u6307\u5b9a\u62f7\u8d1d\u7684\u76ee\u6807\u8def\u5f84")))),(0,r.kt)("p",null,"\u521d\u5b66\u4e4b\u65f6\uff0c\u53ea\u9700\u5b66\u4e60\u4e00\u4e9b\u5e38\u7528\u7684\u6a21\u5757\uff0c\u5728\u672c\u6587\u4ee5\u53ca\u540e\u9762\u7684\u6587\u7ae0\u4e2d\u4f1a\u4ecb\u7ecd\u4e00\u4e9b\u5e38\u89c1\u6a21\u5757\u7684\u529f\u80fd\u4ee5\u53ca\u7528\u6cd5\u3002\u719f\u6089\u4e86 Ansible \u4e4b\u540e\uff0c\u518d\u6309\u9700\u6c42\u5230\u5b98\u65b9\u624b\u518c\u4e2d\u53bb\u5bfb\u627e\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://docs.ansible.com/ansible/latest/modules/modules_by_category.html"},"https://docs.ansible.com/ansible/latest/modules/modules","_","by","_","category.html"),"\u3002"),(0,r.kt)("p",null,"\u6709\u65f6\u5019\u4e3a\u4e86\u65b9\u4fbf\u5feb\u901f\u5bfb\u627e\u6a21\u5757\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"ansible-doc -l | grep 'xxx'")," \u547d\u4ee4\u6765\u7b5b\u9009\u6a21\u5757\u3002\u4f8b\u5982\uff0c\u60f3\u8981\u7b5b\u9009\u5177\u6709\u62f7\u8d1d\u529f\u80fd\u7684\u6a21\u5757\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'[root@controller ~]# ansible-doc -l | grep "copy"\nvsphere_copy                                                  Copy a file to a VMware datastore\nwin_copy                                                      Copies files to remote locations on windows ho...\nbigip_file_copy                                               Manage files in datastores on a BIG-IP\nec2_ami_copy                                                  copies AMI between AWS regions, return new ima...\nwin_robocopy                                                  Synchronizes the contents of two directories u...\ncopy                                                          Copy files to remote locations\nna_ontap_lun_copy                                             NetApp ONTAP copy LUNs\nicx_copy                                                      Transfer files from or to remote Ruckus ICX 70...\nunarchive                                                     Unpacks an archive after (optionally) copying ...\nce_file_copy                                                  Copy a file to a remote cloudengine device ove...\npostgresql_copy                                               Copy data between a file/program and a Postgre...\nec2_snapshot_copy                                             copies an EC2 snapshot and returns the new Sna...\nnxos_file_copy                                                Copy a file to a remote NXOS device\nnetapp_e_volume_copy                                          NetApp E-Series create volume copy pairs\n')),(0,r.kt)("p",null,"\u6839\u636e\u63cf\u8ff0\uff0c\u5927\u6982\u627e\u51fa\u662f\u5426\u6709\u60f3\u8981\u7684\u6a21\u5757\u3002\u627e\u5230\u6a21\u5757\u540e\uff0c\u60f3\u8981\u770b\u770b\u5b83\u7684\u529f\u80fd\u63cf\u8ff0\u4ee5\u53ca\u7528\u6cd5\uff0c\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528 ansible-doc \u547d\u4ee4\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u8be6\u7ec6\u7684\u6a21\u5757\u63cf\u8ff0\u624b\u518c\nansible-doc copy\n\n# \u53ea\u5305\u542b\u6a21\u5757\u53c2\u6570\u7528\u6cd5\u7684\u6a21\u5757\u63cf\u8ff0\u624b\u518c\nansible-doc -s copy\n")),(0,r.kt)("p",null,"\u518d\u6765\u4e00\u4e2a\u793a\u4f8b\uff0c\u901a\u8fc7 Ansible \u5220\u9664\u672c\u5730\u6587\u4ef6 /tmp/passwd\u3002\u9700\u8981\u4f7f\u7528\u7684\u6a21\u5757\u662f file \u6a21\u5757\uff0cfile \u6a21\u5757\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u521b\u5efa\u6216\u5220\u9664\u6587\u4ef6/\u76ee\u5f55\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ansible localhost -m file -a 'path=/tmp/passwd state=absent'\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u53c2\u6570 ",(0,r.kt)("inlineCode",{parentName:"li"},"path=")," \u6307\u5b9a\u8981\u64cd\u4f5c\u7684\u6587\u4ef6\u8def\u5f84\uff0c",(0,r.kt)("inlineCode",{parentName:"li"},"state=")," \u53c2\u6570\u6307\u5b9a\u6267\u884c\u4f55\u79cd\u64cd\u4f5c\uff0c\u6b64\u5904\u6307\u5b9a\u4e3a absent \u8868\u793a\u5220\u9664\u64cd\u4f5c\u3002")),(0,r.kt)("p",null,"Ansible \u7684\u5f88\u591a\u6a21\u5757\u90fd\u63d0\u4f9b\u4e86\u4e00\u4e2a state \u53c2\u6570\uff0c\u5b83\u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u53c2\u6570\u3002\u5b83\u7684\u503c\u4e00\u822c\u90fd\u4f1a\u5305\u542b present \u548c absent \u4e24\u79cd\u72b6\u6001\u503c(\u5e76\u975e\u4e00\u5b9a)\uff0c\u4e0d\u540c\u6a21\u5757\u7684 present \u548c absent \u72b6\u6001\u8868\u793a\u7684\u542b\u4e49\u4e0d\u540c\uff0c\u4f46\u901a\u5e38\u6765\u8bf4\uff0cpresent \u72b6\u6001\u8868\u793a\u80af\u5b9a\u3001\u5b58\u5728\u3001\u4f1a\u3001\u6210\u529f\u7b49\u542b\u4e49\uff0cabsent \u5219\u76f8\u53cd\uff0c\u8868\u793a\u5426\u5b9a\u3001\u4e0d\u5b58\u5728\u3001\u4e0d\u4f1a\u3001\u5931\u8d25\u7b49\u542b\u4e49\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\u8fd9\u91cc\u7684 file \u6a21\u5757\uff0cabsent \u72b6\u6001\u8868\u793a\u9012\u5f52\u5220\u9664\u6587\u4ef6 ",(0,r.kt)("inlineCode",{parentName:"p"},"/")," \u76ee\u5f55\uff0c\u7c7b\u4f3c\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"rm -r")," \u547d\u4ee4\uff0ctouch \u72b6\u6001\u548c touch \u547d\u4ee4\u7684\u529f\u80fd\u4e00\u6837\uff0cdirectory \u72b6\u6001\u8868\u793a\u9012\u5f52\u521b\u5efa\u76ee\u5f55\uff0c\u7c7b\u4f3c\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"mkdir -p")," \u547d\u4ee4\u3002"),(0,r.kt)("p",null,"\u6240\u4ee5\uff0c\u5728\u672c\u5730\u521b\u5efa\u6587\u4ef6\u3001\u521b\u5efa\u76ee\u5f55\u7684\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u521b\u5efa\u6587\u4ef6\nansible localhost -m file -a 'path=/tmp/a.log state=touch'\n\n# \u521b\u5efa\u76ee\u5f55\nansible localhost -m file -a 'path=/tmp/dir1/dir2 state=directory'\n")),(0,r.kt)("p",null,"\u518d\u8bf4\u4e00\u4e2a debug \u6a21\u5757\uff0c\u987e\u540d\u601d\u4e49\uff0c\u7528\u4e8e\u8f93\u51fa\u6216\u8c03\u8bd5\u4e00\u4e9b\u6570\u636e\u3002debug \u6a21\u5757\u7684\u7528\u6cd5\u975e\u5e38\u7b80\u5355\uff0c\u5c31\u4e24\u4e2a\u5e38\u7528\u53c2\u6570\uff1amsg \u53c2\u6570\u548c var \u53c2\u6570\u3002\u8fd9\u4e24\u4e2a\u53c2\u6570\u662f\u4e92\u65a5\u7684\uff0c\u6240\u4ee5\u53ea\u80fd\u4f7f\u7528\u5176\u4e2d\u4e00\u4e2a\u3002msg \u53c2\u6570\u53ef\u4ee5\u8f93\u51fa\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u8f93\u51fa\u53d8\u91cf\u7684\u503c\uff1bvar \u53c2\u6570\u53ea\u80fd\u8f93\u51fa\u53d8\u91cf\u7684\u503c\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u8f93\u51fa \u201dhello world\u201d\uff0c\u9700\u8981\u4f7f\u7528 msg \u53c2\u6570\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'[root@controller ~]# ansible localhost -m debug -a \'msg="hello world"\'\nlocalhost | SUCCESS => {\n    "msg": "hello world"\n}\n')),(0,r.kt)("p",null,"Ansible \u4e2d\u4e5f\u652f\u6301\u4f7f\u7528\u53d8\u91cf\uff0c\u8fd9\u91cc\u4ec5\u6f14\u793a\u6700\u7b80\u5355\u7684\u8bbe\u7f6e\u53d8\u91cf\u548c\u5f15\u7528\u53d8\u91cf\u7684\u65b9\u5f0f\u3002ansible \u547d\u4ee4\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"-e")," \u9009\u9879\u6216 ",(0,r.kt)("inlineCode",{parentName:"p"},"--extra-vars")," \u9009\u9879\u53ef\u4ee5\u8bbe\u7f6e\u53d8\u91cf\uff0c\u8bbe\u7f6e\u7684\u65b9\u5f0f\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},'-e \'var1="aaa" var2="bbb"\''),"\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u8bbe\u7f6e\u53d8\u91cf\u540e\u4f7f\u7528 debug \u7684 msg \u53c2\u6570\u8f93\u51fa\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'[root@controller ~]# ansible localhost -e \'str=world\' -m debug -a \'msg="hello {{str}}"\'\nlocalhost | SUCCESS => {\n    "msg": "hello world"\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6ce8\u610f\u4e0a\u9762\u793a\u4f8b\u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},'msg="hello {{str}}"'),"\uff0cAnsible \u7684\u5b57\u7b26\u4e32\u662f\u53ef\u4ee5",(0,r.kt)("strong",{parentName:"li"},"\u4e0d\u7528\u5f15\u53f7"),"\u53bb\u5305\u56f4\u7684\uff0c\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"li"},"msg=hello")," \u662f\u5141\u8bb8\u7684\uff0c\u4f46\u5982\u679c\u5b57\u7b26\u4e32\u4e2d\u5305\u542b\u4e86\u7279\u6b8a\u7b26\u53f7\uff0c\u5219\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u5f15\u53f7\u53bb\u5305\u56f4\uff0c\u4f8b\u5982\u6b64\u5904\u7684\u793a\u4f8b\u51fa\u73b0\u4e86\u4f1a\u4ea7\u751f\u6b67\u4e49\u7684\u7a7a\u683c\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u6b64\u5916\uff0c\u8981\u533a\u5206\u53d8\u91cf\u540d\u548c\u666e\u901a\u7684\u5b57\u7b26\u4e32\uff0c\u9700\u8981\u5728\u53d8\u91cf\u540d\u4e0a\u52a0\u4e00\u70b9\u6807\u6ce8\uff1a\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"{}")," \u5305\u56f4 Ansible \u7684\u53d8\u91cf\uff0c\u8fd9\u5176\u5b9e\u662f Jinja2 \u6a21\u677f\u7684\u8bed\u6cd5\u3002\u5176\u5b9e\u4e0d\u96be\u7406\u89e3\uff0c\u5b83\u7684\u7528\u6cd5\u548c Shell \u4e0b\u5f15\u7528\u53d8\u91cf\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"$")," \u7b26\u53f7\u6216 ",(0,r.kt)("inlineCode",{parentName:"li"},"${}")," \u662f\u4e00\u6837\u7684\uff0c\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"li"},'echo "hello ${var}"'),"\u3002")),(0,r.kt)("p",null,"debug \u6a21\u5757\u9664\u4e86 msg \u53c2\u6570\uff0c\u8fd8\u6709\u4e00\u4e2a var \u53c2\u6570\uff0c\u5b83\u53ea\u80fd\u7528\u6765\u8f93\u51fa\u53d8\u91cf(\u8fd8\u5305\u62ec\u4ee5\u540e\u8981\u4ecb\u7ecd\u7684 Jinja2 \u8868\u8fbe\u5f0f)\uff0c\u800c\u4e14 var \u53c2\u6570\u5f15\u7528\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u4e0d\u80fd\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"{}")," \u5305\u56f4\uff0c\u56e0\u4e3a var \u53c2\u6570\u5df2\u7ecf\u9690\u5f0f\u5730\u5305\u56f4\u4e86\u4e00\u5c42 ",(0,r.kt)("inlineCode",{parentName:"p"},"{}"),"\u3002\u4f8b\u5982\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'[root@controller ~]# ansible localhost -e \'str="hello world"\' -m debug -a \'var=str\'\nlocalhost | SUCCESS => {\n    "str": "hello world"\n}\n')),(0,r.kt)("h2",{id:"43ansible-\u914d\u7f6e\u6587\u4ef6"},"4.3\u3001Ansible \u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("p",null,"\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u81ea\u5e26\u7684\u5305\u7ba1\u7406\u5668(\u6bd4\u5982 yum\u3001dnf\u3001apt)\u5b89\u88c5\u7684 Ansible \u4e00\u822c\u90fd\u4f1a\u63d0\u4f9b\u597d Ansible \u7684\u914d\u7f6e\u6587\u4ef6 /etc/ansible/ansible.cfg\u3002"),(0,r.kt)("p",null,"\u8fd9\u662f Ansible \u9ed8\u8ba4\u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u3002\u5b9e\u9645\u4e0a\uff0cAnsible \u652f\u6301 4 \u79cd\u65b9\u5f0f\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\uff0c\u5b83\u4eec\u7684\u89e3\u6790\u987a\u5e8f\u4ece\u4e0a\u5230\u4e0b\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ANSIBLE_CFG"),"\uff1a\u73af\u5883\u53d8\u91cf\u6307\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ansible.cfg"),"\uff1a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 ansible.cfg\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"~/.ansible.cfg"),"\uff1a\u5bb6\u76ee\u5f55\u4e0b\u7684 ansible.cfg\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/etc/ansible/ansible.cfg"),"\uff1a\u9ed8\u8ba4\u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u3002")),(0,r.kt)("p",null,"Ansible \u914d\u7f6e\u6587\u4ef6\u91c7\u7528 ini \u98ce\u683c\u8fdb\u884c\u914d\u7f6e\uff0c\u6bcf\u4e00\u9879\u914d\u7f6e\u90fd\u4f7f\u7528 key=value \u7684\u65b9\u5f0f\u8fdb\u884c\u914d\u7f6e\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u4e0b\u9762\u662f\u6211\u4ece\u9ed8\u8ba4\u7684 /etc/ansible/ansible.cfg \u4e2d\u622a\u53d6\u7684 ","[","defaults","]"," \u6bb5\u843d\u548c ","[","inventory","]"," \u6bb5\u843d\u7684\u90e8\u5206\u914d\u7f6e\u4fe1\u606f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[defaults]\n# some basic default values...\n#inventory      = /etc/ansible/hosts\n#library        = /usr/share/my_modules/\n#module_utils   = /usr/share/my_module_utils/\n#remote_tmp     = ~/.ansible/tmp\n#local_tmp      = ~/.ansible/tmp\n#plugin_filters_cfg = /etc/ansible/plugin_filters.yml\n#forks          = 5\n\n[inventory]\n#enable_plugins = host_list, virtualbox, yaml, constructed\n#ignore_extensions = .pyc, .pyo, .swp, .bak, ~, .rpm, .md, .txt, ~, .orig, .ini, .cfg, .retry\n#ignore_patterns=\n#unparsed_is_failed=False\n")),(0,r.kt)("h2",{id:"44inventory"},"4.4\u3001Inventory"),(0,r.kt)("p",null,"\u8ba9 Ansible \u53d1\u6325\u5f3a\u5927\u4f5c\u7528\u7684\u7b2c\u4e00\u6b65\u662f\u914d\u7f6e inventory\u3002inventory \u8868\u793a\u6e05\u5355\u7684\u610f\u601d\uff0c\u5728\u8ba1\u7b97\u673a\u9886\u57df\u91cc\u5f80\u5f80\u8868\u793a\u7684\u8d44\u6e90\u6e05\u5355\uff0c\u5728 Ansible \u4e2d\u5b83\u8868\u793a\u4e3b\u673a\u8282\u70b9\u6e05\u5355\uff0c\u4e5f\u662f\u8d44\u6e90\u7684\u4e00\u79cd\u3002\u901a\u8fc7\u914d\u7f6e inventory\uff0c\u5c31\u53ef\u4ee5\u5b9a\u4e49\u54ea\u4e9b\u76ee\u6807\u4e3b\u673a\u662f\u53ef\u4ee5\u88ab\u63a7\u5236\u7684\u3002"),(0,r.kt)("h3",{id:"441inventory-\u6587\u4ef6\u8def\u5f84"},"4.4.1\u3001Inventory \u6587\u4ef6\u8def\u5f84"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u7684 inventory \u6587\u4ef6\u662f /etc/ansible/hosts\uff0c\u53ef\u4ee5\u901a\u8fc7 Ansible \u914d\u7f6e\u6587\u4ef6\u7684 inventory \u914d\u7f6e\u6307\u4ee4\u53bb\u4fee\u6539\u8def\u5f84\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"grep '/etc/ansible/hosts' /etc/ansible/ansible.cfg \n#inventory      = /etc/ansible/hosts\n")),(0,r.kt)("p",null,"\u4f46\u901a\u5e38\u4e0d\u4f1a\u53bb\u4fee\u6539\u8fd9\u4e2a\u914d\u7f6e\u9879\uff0c\u5982\u679c\u5728\u5176\u5b83\u5730\u65b9\u5b9a\u4e49\u4e86 inventory \u6587\u4ef6\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728 ansible \u7684\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528 -i \u9009\u9879\u53bb\u6307\u5b9a\u81ea\u5b9a\u4e49\u7684 inventory \u6587\u4ef6\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ansible -i /tmp/myinv.ini ...\nansible-playbook -i /tmp/myinv.ini ...\n")),(0,r.kt)("h3",{id:"442\u914d\u7f6e-inventory"},"4.4.2\u3001\u914d\u7f6e Inventory"),(0,r.kt)("p",null,"Ansible inventory \u6587\u4ef6\u7684\u4e66\u5199\u683c\u5f0f\u9075\u5faa ini \u914d\u7f6e\u683c\u5f0f\u3002\u4ece Ansible 2.4 \u5f00\u59cb\u652f\u6301\u5176\u5b83\u683c\u5f0f\uff0c\u6bd4\u5982 yaml \u683c\u5f0f\u7684 inventory\u3002\u6b64\u5904\u4ee5 ini \u683c\u5f0f\u4e3a\u4f8b\uff0c\u5faa\u5e8f\u6e10\u8fdb\u5730\u4ecb\u7ecd inventory \u7684\u89c4\u5219\u3002\u5047\u8bbe\u6240\u6709\u7684\u89c4\u5219\u90fd\u5b9a\u4e49\u5728 /etc/ansible/hosts \u6587\u4ef6\u4e2d\u3002"),(0,r.kt)("h4",{id:"4421\u4e00\u884c\u4e00\u4e3b\u673a\u7684\u5b9a\u4e49\u65b9\u5f0f"},"4.4.2.1\u3001\u4e00\u884c\u4e00\u4e3b\u673a\u7684\u5b9a\u4e49\u65b9\u5f0f"),(0,r.kt)("p",null,"Ansible \u9ed8\u8ba4\u662f\u57fa\u4e8e ssh \u8fde\u63a5\u7684\uff0c\u6240\u4ee5\u4e00\u822c\u60c5\u51b5\u4e0b inventory \u4e2d\u7684\u6bcf\u4e2a\u76ee\u6807\u8282\u70b9\u90fd\u914d\u7f6e\u4e3b\u673a\u540d\u6216 IP \u5730\u5740\u3001sshd \u76d1\u542c\u7684\u7aef\u53e3\u53f7\u3001\u8fde\u63a5\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u3001ssh \u8fde\u63a5\u65f6\u7684\u53c2\u6570\u7b49\u7b49\u3002\u5f53\u7136\uff0c\u5f88\u591a\u53c2\u6570\u6709\u9ed8\u8ba4\u503c\uff0c\u6240\u4ee5\u6700\u7b80\u5355\u7684\u662f\u76f4\u63a5\u6307\u5b9a\u4e3b\u673a\u540d\u6216 IP \u5730\u5740\u5373\u53ef\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u5728\u9ed8\u8ba4\u7684 inventory \u6587\u4ef6 /etc/ansible/hosts \u6dfb\u52a0\u51e0\u4e2a\u76ee\u6807\u4e3b\u673a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"node1\nnode2 ansible_host=192.168.95.132\n192.168.95.133\n192.168.95.134:22\n192.168.95.13[5:6] ansible_port=22\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e00\u884c\u901a\u8fc7\u4e3b\u673a\u540d\u5b9a\u4e49\uff0c\u5728 ansible \u8fde\u63a5\u8be5\u8282\u70b9\u65f6\u4f1a\u8fdb\u884c\u4e3b\u673a\u540d DNS \u89e3\u6790\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e8c\u884c\u4e5f\u662f\u901a\u8fc7\u4e3b\u673a\u540d\u5b9a\u4e49\uff0c\u4f46\u662f\u4f7f\u7528\u4e86\u4e00\u4e2a\u4e3b\u673a\u53d8\u91cf ansible","_","host=IP\uff0c\u6b64\u65f6\u8be5 ansible \u53bb\u8fde\u63a5\u8be5\u4e3b\u673a\u65f6\u5c06\u76f4\u63a5\u901a\u8fc7 IP \u5730\u5740\u8fdb\u884c\u8fde\u63a5\uff0c\u800c\u4e0d\u4f1a\u8fdb\u884c DNS \u89e3\u6790\uff0c\u6b64\u65f6 node2 \u76f8\u5f53\u4e8e\u4e3b\u673a\u522b\u540d\u5e76\u4e14\u53ef\u4ee5\u547d\u540d\u4e3a\u4efb\u4f55\u5176\u5b83\u540d\u79f0\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e09\u884c\u901a\u8fc7 IP \u5730\u5740\u5b9a\u4e49\u4e3b\u673a\u8282\u70b9\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u56db\u884c\u901a\u8fc7 IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\u5b9a\u4e49\u4e3b\u673a\u8282\u70b9\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u6700\u540e\u4e00\u884c\u901a\u8fc7\u8303\u56f4\u7684\u65b9\u5f0f\u5c55\u5f00\u6210\u4e86\u4e24\u4e2a\u4e3b\u673a\u8282\u70b9 192.168.95.135 \u548c 192.168.95.136\uff0c\u540c\u65f6\u8fd8\u5b9a\u4e49\u4e86\u8fd9\u4e24\u4e2a\u8282\u70b9\u7684\u4e3b\u673a\u53d8\u91cf ansible","_","port=22 \u8868\u793a\u8fde\u63a5\u8fd9\u4e24\u4e2a\u4e3b\u673a\u65f6\u7684\u7aef\u53e3\u53f7\u4e3a 22\u3002")),(0,r.kt)("p",null,"\u8303\u56f4\u5c55\u5f00\u7684\u65b9\u5f0f\u8fd8\u652f\u6301\u5b57\u6bcd\u8303\u56f4\u3002\u4e0b\u9762\u90fd\u662f\u6709\u6548\u7684\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"\u8303\u56f4\u8868\u793a      \u5c55\u5f00\u7ed3\u679c\n--------------------\na[1:3]  --\x3e  a1,a2,a3\n[08:12] --\x3e  08,09,10,11,12\na[a:c]  --\x3e  aa,ab,ac\n")),(0,r.kt)("p",null,"\u4e0a\u9762\u793a\u4f8b\u4e2d\u4f7f\u7528\u4e86\u4e24\u4e2a\u4e3b\u673a\u53d8\u91cf ansible","_","port \u548c ansible","_","host\uff0c\u5b83\u4eec\u76f4\u63a5\u5b9a\u4e49\u5728\u4e3b\u673a\u7684\u540e\u9762\uff0c\u8fd9\u4e9b\u53d8\u91cf\u90fd\u662f\u8fde\u63a5\u76ee\u6807\u4e3b\u673a\u65f6\u7684\u884c\u4e3a\u63a7\u5236\u53d8\u91cf\uff0c\u901a\u5e38\u5b83\u4eec\u90fd\u80fd\u89c1\u540d\u77e5\u610f\u3002Ansible \u652f\u6301\u5f88\u591a\u4e2a\u8fde\u63a5\u65f6\u7684\u884c\u4e3a\u63a7\u5236\u53d8\u91cf\uff0c\u800c\u4e14\u4e0d\u540c\u7248\u672c\u7684 Ansible \u7684\u884c\u4e3a\u63a7\u5236\u53d8\u91cf\u540d\u79f0\u53ef\u80fd\u8fd8\u4e0d\u540c\uff0c\u6bd4\u5982\u5728\u4ee5\u524d\u7248\u672c\u4e2d\u6307\u5b9a\u7aef\u53e3\u53f7\u7684\u884c\u4e3a\u53d8\u91cf\u662f ansible","_","ssh","_","port\u3002"),(0,r.kt)("p",null,"\u5b8c\u6574\u7684\u8fde\u63a5\u884c\u4e3a\u63a7\u5236\u53d8\u91cf\u53c2\u89c1",(0,r.kt)("a",{parentName:"p",href:"https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#connecting-to-hosts-behavioral-inventory-parameters"},"\u5b98\u65b9\u624b\u518c"),"\u3002"),(0,r.kt)("p",null,"\u8fd9\u6837\u5b9a\u4e49\u4e4b\u540e\uff0cAnsible \u5c31\u53ef\u4ee5\u63a7\u5236\u4efb\u4f55\u4e00\u4e2a\u76ee\u6807\u4e3b\u673a\u4e86\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ansible node1 -m copy -a 'src=/etc/passwd dest=/tmp'\nansible 192.168.95.133 -m copy -a 'src=/etc/passwd dest=/tmp'\n")),(0,r.kt)("h4",{id:"4422inventory-\u4e2d\u7684\u666e\u901a\u53d8\u91cf"},"4.4.2.2\u3001Inventory \u4e2d\u7684\u666e\u901a\u53d8\u91cf"),(0,r.kt)("p",null,"\u5728\u5b9a\u4e49 inventory \u65f6\uff0c\u9664\u4e86\u53ef\u4ee5\u6307\u5b9a\u8fde\u63a5\u7684\u884c\u4e3a\u63a7\u5236\u53d8\u91cf\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a Ansible \u7684\u666e\u901a\u53d8\u91cf\uff0c\u4ee5\u4fbf\u5728 ansible \u6267\u884c\u4efb\u52a1\u65f6\u4f7f\u7528\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'node1 node1_var="hello world"\nnode2 ansible_host=192.168.95.132\n')),(0,r.kt)("p",null,"\u5728 ansible \u6267\u884c\u4efb\u52a1\u65f6\u53ef\u4ee5\u5f15\u7528\u666e\u901a\u53d8\u91cf\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ ansible node1 -m debug -a \'var=node1_var\'\nnode1 | SUCCESS => {\n    "node1_var": "hello world"\n}\n')),(0,r.kt)("h4",{id:"4423\u4e3b\u673a\u5206\u7ec4"},"4.4.2.3\u3001\u4e3b\u673a\u5206\u7ec4"),(0,r.kt)("p",null,"\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\u662f\u6bcf\u884c\u5355\u72ec\u5b9a\u4e49\u4e00\u4e2a\u4e3b\u673a\uff0c\u8fd9\u6837\u7684\u65b9\u5f0f\u867d\u7136\u7b80\u5355\uff0c\u4f46\u662f\u6781\u5176\u4e0d\u65b9\u4fbf\u7ba1\u7406\u591a\u4e2a\u8282\u70b9\u3002\u4e3a\u6b64\uff0cInventory \u652f\u6301\u5bf9\u4e3b\u673a\u8fdb\u884c\u5206\u7ec4\uff0c\u6bcf\u4e2a\u7ec4\u5185\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a\u4e3b\u673a\uff0c\u6bcf\u4e2a\u4e3b\u673a\u90fd\u53ef\u4ee5\u5b9a\u4e49\u5728\u4efb\u4f55\u4e00\u4e2a\u6216\u591a\u4e2a\u4e3b\u673a\u7ec4\u5185\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"node1 node1_var=\"hello world\"\nnode2 ansible_host=192.168.95.132\n192.168.95.133\n192.168.95.134:22\n192.168.95.13[5:6] ansible_port=22\n\n[nginx]\n192.168.95.131\n192.168.95.132 ansible_password='123456'\n192.168.95.133\n\n[apache]\n192.168.95.13[4:7]\n\n[mysql]\n192.168.95.131\n192.168.95.132\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8fd9\u91cc\u5b9a\u4e49\u4e86 3 \u4e2a\u4e3b\u673a\u7ec4\uff1anginx \u4e3b\u673a\u7ec4\u3001apache \u4e3b\u673a\u7ec4\u548c mysql \u4e3b\u673a\u7ec4\u3002nginx \u7ec4\u5305\u542b 3 \u4e2a\u8282\u70b9\uff0capache \u4e3b\u673a\u7ec4\u5305\u542b 4 \u4e2a\u8282\u70b9\uff0cmysql \u4e3b\u673a\u7ec4\u5305\u542b 2 \u4e2a\u8282\u70b9\u3002"),(0,r.kt)("li",{parentName:"ul"},"Ansible \u9ed8\u8ba4\u9884\u5b9a\u4e49\u4e86\u4e24\u4e2a\u4e3b\u673a\u7ec4\uff1aall \u5206\u7ec4\u548c ungrouped \u5206\u7ec4\u3002",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"all")," \u5206\u7ec4\u4e2d\u5305\u542b\u6240\u6709\u5206\u7ec4\u5185\u7684\u8282\u70b9"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ungrouped")," \u5206\u7ec4\u5305\u542b\u6240\u6709\u4e0d\u5728\u5206\u7ec4\u5185\u7684\u8282\u70b9"),(0,r.kt)("li",{parentName:"ul"},"\u8fd9\u4e24\u4e2a\u5206\u7ec4\u90fd\u4e0d\u5305\u542b localhost \u8fd9\u4e2a\u7279\u6b8a\u7684\u8282\u70b9")))),(0,r.kt)("p",null,"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cmysql \u7ec4\u4e2d\u7684\u8282\u70b9\u4e5f\u540c\u65f6\u5b58\u5728\u4e8e nginx \u7ec4\u5185\uff0c\u4e00\u4e2a\u4e3b\u673a\u540c\u65f6\u5b58\u5728\u4e8e\u591a\u4e2a\u7ec4\u5185\u662f\u5141\u8bb8\u4e5f\u662f\u5fc5\u8981\u7684\u529f\u80fd\uff0c\u53ea\u6709\u8fd9\u6837\u624d\u80fd\u66f4\u4e3a\u7075\u6d3b\u7684\u5bf9\u5404\u4e2a\u8282\u70b9\u8fdb\u884c\u5206\u7c7b\u7ba1\u7406\u3002"),(0,r.kt)("p",null,"\u6709\u4e86\u4e3b\u673a\u7ec4\uff0c\u5c31\u53ef\u4ee5\u8ba9 ansible \u63a7\u5236\u4e00\u4e2a\u7ec4\uff0c\u4ece\u800c\u8ba9\u8be5\u7ec4\u5185\u6240\u6709\u4e3b\u673a\u6267\u884c\u4efb\u52a1\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ansible apache -m copy -a 'src=/etc/passwd dest=/tmp'\n")),(0,r.kt)("p",null,"\u5b9a\u4e49\u4e86 inventory \u4e4b\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528 ansible --list \u6216 ansible--playbook --list \u547d\u4ee4\u6765\u67e5\u770b\u4e3b\u673a\u7ec4\u7684\u4fe1\u606f\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u66f4\u4e3a\u4e13\u4e1a\u7684 ansible-inventory \u547d\u4ee4\u6765\u67e5\u770b\u4e3b\u673a\u7ec4\u4fe1\u606f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u4f7f\u7528ansible\u6216ansible-playbook\u5217\u51fa\u6240\u6709\u4e3b\u673a\n[root@controller ~]# ansible -i /etc/ansible/hosts nginx --list\n  hosts (3):\n    192.168.95.131\n    192.168.95.132\n    192.168.95.133\n\n# \u4f7f\u7528ansible-inventory\u5217\u51fanginx\u7ec4\u4e2d\u7684\u4e3b\u673a\n[root@controller ~]# ansible-inventory -i /etc/ansible/hosts nginx --graph\n@nginx:\n  |--192.168.95.131\n  |--192.168.95.132\n  |--192.168.95.133\n\n# \u4f7f\u7528ansible-inventory\u5217\u51fanginx\u7ec4\u4e2d\u7684\u4e3b\u673a\uff0c\u540c\u65f6\u5e26\u4e0a\u53d8\u91cf\n[root@controller ~]# ansible-inventory nginx --graph --vars\n@nginx:\n  |--192.168.95.131\n  |--192.168.95.132\n  |  |--{ansible_password = 123456}\n  |--192.168.95.133\n\n# \u4f7f\u7528ansible-inventory\u5217\u51faall\u7ec4\u5185\u7684\u4e3b\u673a\n[root@controller ~]# ansible-inventory --graph all\n@all:\n  |--@apache:\n  |  |--192.168.95.134\n  |  |--192.168.95.135\n  |  |--192.168.95.136\n  |  |--192.168.95.137\n  |--@mysql:\n  |  |--192.168.95.131\n  |  |--192.168.95.132\n  |--@nginx:\n  |  |--192.168.95.131\n  |  |--192.168.95.132\n  |  |--192.168.95.133\n  |--@ungrouped:\n  |  |--node1\n  |  |--node2\n\n# \u4f7f\u7528ansible-inventory\u4ee5json\u683c\u5f0f\u5217\u51fa\u6240\u6709\u4e3b\u673a\u7684\u4fe1\u606f\n[root@controller ~]# ansible-inventory --list\n")),(0,r.kt)("h4",{id:"4424\u4e3b\u673a\u7ec4\u53d8\u91cf"},"4.4.2.4\u3001\u4e3b\u673a\u7ec4\u53d8\u91cf"),(0,r.kt)("p",null,"\u6709\u4e86\u4e3b\u673a\u7ec4\u4e4b\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u4e3a\u4e3b\u673a\u7ec4\u5b9a\u4e49\u53d8\u91cf\uff0c\u8fd9\u6837\u7ec4\u5185\u7684\u6240\u6709\u4e3b\u673a\u90fd\u5177\u6709\u8be5\u53d8\u91cf\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[nginx]\n192.168.95.131\n192.168.95.132 ansible_password='123456'\n192.168.95.133\n\n[nginx:vars]\nansible_password='123456'\n\n[all:vars]\nansible_port=22\n\n[ungrouped:vars]\nansible_port=22\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e0a\u9762 ",(0,r.kt)("inlineCode",{parentName:"li"},"[nginx:vars]")," \u8868\u793a\u4e3a nginx \u7ec4\u5185\u6240\u6709\u4e3b\u673a\u5b9a\u4e49\u53d8\u91cf ",(0,r.kt)("inlineCode",{parentName:"li"},"ansible_password='123456'"),"\u3002\u800c ",(0,r.kt)("inlineCode",{parentName:"li"},"[all:vars]")," \u548c ",(0,r.kt)("inlineCode",{parentName:"li"},"[ungrouped:vars]")," \u5206\u522b\u8868\u793a\u4e3a all \u548c ungrouped \u8fd9\u4e24\u4e2a\u7279\u6b8a\u7684\u4e3b\u673a\u7ec4\u5185\u7684\u6240\u6709\u4e3b\u673a\u5b9a\u4e49\u53d8\u91cf\u3002")),(0,r.kt)("h4",{id:"4425\u7ec4\u5d4c\u5957"},"4.4.2.5\u3001\u7ec4\u5d4c\u5957"),(0,r.kt)("p",null,"Inventory \u8fd8\u652f\u6301\u4e3b\u673a\u7ec4\u7684\u5206\u7ec4\u5d4c\u5957\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"[GROUP:children]")," \u7684\u65b9\u5f0f\u5b9a\u4e49\u4e00\u4e2a\u4e3b\u673a\u7ec4\uff0c\u5e76\u5728\u5176\u4e2d\u5305\u542b\u5b50\u7ec4\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[nginx]\n192.168.95.131\n192.168.95.132 ansible_password='123456'\n192.168.95.133\n\n[apache]\n192.168.95.13[4:7]\n\n[mysql]\n192.168.95.131\n192.168.95.132\n\n[webservers:children]\nnginx\napache\n\n[centos7:children]\nwebservers  # \u9012\u5f52\u5d4c\u5957\nmysql\n")),(0,r.kt)("h4",{id:"4426multi-inventory-\u6587\u4ef6"},"4.4.2.6\u3001Multi Inventory \u6587\u4ef6"),(0,r.kt)("p",null,"\u5f53 Ansible \u8981\u7ba1\u7406\u7684\u8282\u70b9\u975e\u5e38\u591a\u65f6\uff0c\u4ec5\u9760\u5206\u7ec4\u7684\u903b\u8f91\u53ef\u80fd\u4e5f\u4e0d\u8db3\u591f\u65b9\u4fbf\u7ba1\u7406\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a inventory \u6587\u4ef6\u5e76\u653e\u5728\u4e00\u4e2a\u76ee\u5f55\u4e0b\uff0c\u5e76\u6309\u4e00\u5b9a\u7684\u547d\u540d\u89c4\u5219\u4e3a\u6bcf\u4e2a inventory \u547d\u540d\uff0c\u4ee5\u4fbf\u89c1\u540d\u77e5\u610f\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a /etc/ansible/inventorys \u7684\u76ee\u5f55\uff0c\u5728\u5176\u4e2d\u5b9a\u4e49 web \u548c database \u4e24\u4e2a inventory \u6587\u4ef6\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/etc/ansible/inventorys/\n\u251c\u2500\u2500 web\n\u2514\u2500\u2500 database\n")),(0,r.kt)("p",null,"\u5185\u5bb9\u5206\u522b\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# /etc/ansible/inventorys/web\u7684\u5185\u5bb9\uff1a\n[nginx]\n192.168.95.131\n192.168.95.132 ansible_password='123456'\n192.168.95.133\n\n[apache]\n192.168.95.13[4:7]\n\n[web:children]\napache\nnginx\n\n# /etc/ansible/inventorys/database\u7684\u5185\u5bb9\uff1a\n[mysql]\n192.168.95.131\n192.168.95.132\n")),(0,r.kt)("p",null,"\u73b0\u5728\u8981\u4f7f\u7528\u591a\u4e2a inventory \u7684\u529f\u80fd\uff0c\u9700\u8981\u5c06 inventory \u6307\u5b9a\u4e3a\u76ee\u5f55\u8def\u5f84\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0cAnsible \u914d\u7f6e\u6587\u4ef6\u5c06 inventory \u6307\u4ee4\u8bbe\u7f6e\u4e3a\u5bf9\u5e94\u7684\u76ee\u5f55\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"inventory      = /etc/ansible/inventorys\n")),(0,r.kt)("p",null,"\u6216\u8005\uff0cansible \u6216 ansible-playbook \u547d\u4ee4\u4f7f\u7528 -i INVENTORY \u9009\u9879\u6307\u5b9a\u7684\u8def\u5f84\u5e94\u5f53\u4e3a\u76ee\u5f55\u3002"),(0,r.kt)("p",null,"\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5c06\u5217\u51fa\u6240\u6709\u4e3b\u673a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ansible-inventory -i /etc/ansible/inventorys --graph all\n")),(0,r.kt)("p",null,"inventory \u6307\u5b9a\u4e3a\u76ee\u5f55\u65f6\uff0cinventory \u6587\u4ef6\u6700\u597d\u4e0d\u8981\u5e26\u6709\u540e\u7f00\uff0c\u5c31\u50cf\u793a\u4f8b\u4e2d\u7684 web \u548c database \u6587\u4ef6\u3002\u56e0\u4e3a Ansible \u5f53\u4f7f\u7528\u76ee\u5f55\u4f5c\u4e3a inventory \u65f6\uff0c\u9ed8\u8ba4\u5c06\u5ffd\u7565\u4e00\u4e9b\u540e\u7f00\u7684\u6587\u4ef6\uff0c\u4e0d\u53bb\u89e3\u6790\u3002\u9700\u8981\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 inventory","_","ignore","_","extensions \u9879\u6765\u7981\u6b62\u5ffd\u7565\u6307\u5b9a\u540e\u7f00(\u5982 ini \u540e\u7f00)\u7684\u6587\u4ef6\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#inventory_ignore_extensions = ~, .orig, .bak, .ini, .cfg, .retry, .pyc, .pyo\ninventory_ignore_extensions = ~, .orig, .bak, .cfg, .retry, .pyc, .pyo\n")),(0,r.kt)("h3",{id:"443\u5b9e\u9a8c-inventory-\u6587\u4ef6"},"4.4.3\u3001\u5b9e\u9a8c Inventory \u6587\u4ef6"),(0,r.kt)("p",null,"\u4e0b\u9762\u662f\u672c\u6587\u4f7f\u7528\u7684 inventory \u6587\u4ef6 /etc/ansible/hosts \u7684\u5185\u5bb9\uff0c\u5728\u540e\u9762\u7684\u6587\u7ae0\u4e2d\u5982\u679c\u6ca1\u6709\u7279\u522b\u8bf4\u660e\uff0c\u4e5f\u5c06\u4f7f\u7528\u6b64\u5904\u7684 inventory \u914d\u7f6e\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[nginx]\n192.168.95.131\n192.168.95.132\n192.168.95.133\n\n[apache]\n192.168.95.13[4:7]\n\n[webservers:children]\nnginx\napache\n\n[mysql]\n192.168.95.137\n")),(0,r.kt)("h2",{id:"45playbook"},"4.5\u3001Playbook"),(0,r.kt)("p",null,"ansible \u547d\u4ee4\u6bcf\u6b21\u53ea\u80fd\u6267\u884c\u4e00\u4e2a\u4efb\u52a1\uff0c\u8fd9\u79cd\u8fd0\u884c\u65b9\u5f0f\u79f0\u4e3a Ad-hoc(\u70b9\u5bf9\u70b9\u6a21\u5f0f)\uff1bansible playbook \u53ef\u4ee5\u96c6\u6210\u591a\u4e2a\u4efb\u52a1\uff0c\u7f16\u6392\u597d\u4efb\u52a1\u7684\u6267\u884c\u987a\u5e8f\uff0c\u50cf\u7535\u5f71\u5267\u672c\u4e00\u6837\u4e00\u76f4\u6f14\u4e0b\u53bb\u76f4\u5230\u6740\u9752\u3002"),(0,r.kt)("h3",{id:"451playbookplay-\u548c-task-\u7684\u5173\u7cfb"},"4.5.1\u3001playbook\u3001play \u548c task \u7684\u5173\u7cfb"),(0,r.kt)("p",null,"playbook \u76f8\u5f53\u4e8e\u4e00\u6574\u5957\u7535\u89c6\u5267\u5267\u672c\uff0cplay \u76f8\u5f53\u4e8e\u4e00\u96c6\u7247\u6bb5\uff0ctasks \u76f8\u5f53\u4e8e\u4e00\u96c6\u7247\u6bb5\u5f53\u4e2d\u7684\u67d0\u4e00\u8282\u5267\u60c5\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"playbook \u4e2d\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u6216\u591a\u4e2a play\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u6bcf\u4e2a play \u4e2d\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u6216\u591a\u4e2a task\u3002",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5176\u4e2d\u8fd8\u53ef\u4ee5\u5b9a\u4e49\u4e24\u7c7b\u7279\u6b8a\u7684 task\uff1apre","_","tasks \u548c post","_","tasks\u3002",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"pre","_","tasks \u8868\u793a\u6267\u884c\u6267\u884c\u666e\u901a\u4efb\u52a1\u4e4b\u524d\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868\u3002"),(0,r.kt)("li",{parentName:"ul"},"post","_","tasks \u8868\u793a\u666e\u901a\u4efb\u52a1\u6267\u884c\u5b8c\u4e4b\u540e\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868\u3002"))))),(0,r.kt)("li",{parentName:"ol"},"\u6bcf\u4e2a play \u90fd\u9700\u8981\u901a\u8fc7 hosts \u6307\u4ee4\u6307\u5b9a\u8981\u6267\u884c\u8be5 play \u7684\u76ee\u6807\u4e3b\u673a\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u6bcf\u4e2a play \u90fd\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e9b\u8be5 play \u7684\u73af\u5883\u63a7\u5236\u884c\u4e3a\uff0c\u6bd4\u5982\u5b9a\u4e49 play \u7ea7\u522b\u7684\u53d8\u91cf\u3002")),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a playbook \u793a\u4f8b\uff0c\u6587\u4ef6\u540d\u4e3a first.yml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'---\n- name: play 1\n  hosts: nginx\n  gather_facts: false\n  tasks: \n    - name: task1 in play1\n      debug: \n        msg: "output task1 in play1"\n\n    - name: task2 in play1\n      debug: \n        msg: "output task2 in play1"\n\n- name: play 2\n  hosts: apache\n  gather_facts: false\n  tasks: \n    - name: task1 in play2\n      debug: \n        msg: "output task1 in play2"\n\n    - name: task2 in play2\n      debug: \n        msg: "output task2 in play2"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"playbook \u4e2d\u5305\u542b\u4e24\u4e2a play\uff1a\u201dplay 1\u201d \u548c \u201dplay 2\u201d\uff0c\u6bcf\u4e2a play \u4e2d\u53c8\u5305\u542b\u4e86\u4e24\u4e2a task\u3002\u4e14\u6267\u884c \u201dplay 1\u201d \u7684\u662f nginx \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u8282\u70b9\uff0c\u6267\u884c \u201dplay 2\u201d \u7684\u662f apache \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u8282\u70b9\u3002")),(0,r.kt)("p",null,"\u4f7f\u7528 ansible-playbook \u547d\u4ee4\u6267\u884c\u8fd9\u4e2a playbook\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'[root@controller ~]# ansible-playbook first.yml\n\nPLAY [play 1] ***************************************************************************************************\n\nTASK [task1 in play1] *******************************************************************************************\nok: [192.168.95.131] => {\n    "msg": "output task1 in play1"\n}\nok: [192.168.95.132] => {\n    "msg": "output task1 in play1"\n}\nok: [192.168.95.133] => {\n    "msg": "output task1 in play1"\n}\n......\nPLAY RECAP ******************************************************************************************************\n192.168.95.131             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n192.168.95.132             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n192.168.95.133             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n192.168.95.134             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n192.168.95.135             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n192.168.95.136             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n192.168.95.137             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n')),(0,r.kt)("p",null,"\u5bf9\u7167\u8f93\u51fa\u7ed3\u679c\u548c first.yml \u4e2d\u7684\u5b9a\u4e49\uff0c\u53ef\u4ee5\u5f88\u5bb9\u6613\u5bf9\u5e94\u4e0a\u6267\u884c\u7684\u6d41\u7a0b\u3002"),(0,r.kt)("h3",{id:"452yaml-\u8bed\u6cd5"},"4.5.2\u3001YAML \u8bed\u6cd5"),(0,r.kt)("p",null,"ansible \u7684 playbook \u91c7\u7528 yaml \u8bed\u6cd5\uff0c\u5b83\u4ee5\u975e\u5e38\u7b80\u6d01\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e86 json \u683c\u5f0f\u7684\u4e8b\u4ef6\u63cf\u8ff0\u3002yaml \u4e4b\u4e8e json \u5c31\u50cf markdown \u4e4b\u4e8e html \u4e00\u6837\uff0c\u6781\u5ea6\u7b80\u5316\u4e86 json \u7684\u4e66\u5199\u3002"),(0,r.kt)("p",null,"YAML \u6587\u4ef6\u540e\u7f00\u901a\u5e38\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},".yaml")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"p"},".yml"),"\u3002"),(0,r.kt)("p",null,"YAML \u5728\u4e0d\u5c11\u5de5\u5177\u91cc\u90fd\u4f7f\u7528\uff0c\u5b66\u4e60\u5b83\u662f\u201d\u4e00\u6b21\u5b66\u4e60\u3001\u7ec8\u751f\u53d7\u76ca\u201d\u7684\uff0c\u6240\u4ee5\u5f88\u6709\u5fc5\u8981\u628a yaml \u7684\u8bed\u6cd5\u683c\u5f0f\u505a\u4e2a\u68b3\u7406\uff0c\u7cfb\u7edf\u6027\u5730\u53bb\u5b66\u4e00\u5b66\u3002"),(0,r.kt)("p",null,"YAML \u7684\u57fa\u672c\u8bed\u6cd5\u89c4\u5219\u5982\u4e0b\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u7f29\u8fdb\u8868\u793a\u5c42\u7ea7\u5173\u7cfb\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7f29\u8fdb\u65f6\u4e0d\u5141\u8bb8\u4f7f\u7528 Tab \u952e\uff0c\u53ea\u5141\u8bb8\u4f7f\u7528\u7a7a\u683c\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7f29\u8fdb\u7684\u7a7a\u683c\u6570\u76ee\u4e0d\u91cd\u8981\uff0c\u53ea\u8981\u76f8\u540c\u5c42\u7ea7\u7684\u5143\u7d20\u5de6\u5bf9\u9f50\u5373\u53ef\u3002"),(0,r.kt)("li",{parentName:"ul"},'yaml \u6587\u4ef6\u4ee5 "---" \u4f5c\u4e3a\u6587\u6863\u7684\u5f00\u59cb\uff0c\u4ee5\u8868\u660e\u8fd9\u662f\u4e00\u4e2a yaml \u6587\u4ef6\u3002\u5f53\u7136 "---" \u53ef\u4ee5\u7701\u7565\u3002'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"#")," \u8868\u793a\u6ce8\u91ca\uff0c\u4ece\u8fd9\u4e2a\u5b57\u7b26\u5f00\u59cb\u5230\u7ed3\u5c3e\uff0c\u90fd\u4f1a\u88ab\u89e3\u6790\u5668\u5ffd\u7565\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5b57\u7b26\u4e32\u4e0d\u7528\u52a0\u5f15\u53f7\uff0c\u4f46\u5728\u53ef\u80fd\u4ea7\u751f\u6b67\u4e49\u65f6\uff0c\u52a0\u5f15\u53f7(\u5355\u53cc\u5f15\u53f7\u90fd\u53ef\u4ee5)\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5e03\u5c14\u503c\u975e\u5e38\u7075\u6d3b\uff0c\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684 true/false\u3001yes/no\u3001on/off\u3001y/n\u30010 \u548c 1 \u90fd\u5141\u8bb8\u3002")),(0,r.kt)("p",null,"YAML \u652f\u6301\u4e09\u79cd\u6570\u636e\u7ed3\u6784\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u8c61\uff1akey/value \u683c\u5f0f\uff0c\u4e5f\u79f0\u4e3a\u54c8\u5e0c\u7ed3\u6784\u3001\u5b57\u5178\u7ed3\u6784\u6216\u5173\u8054\u6570\u7ec4\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u6570\u7ec4\uff1a\u4e5f\u79f0\u4e3a\u5217\u8868\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u6807\u91cf(scalars)\uff1a\u5355\u4e2a\u503c\u3002")),(0,r.kt)("p",null,"\u53ef\u4ee5\u53bb\u627e\u4e00\u4e9b\u5728\u7ebf YAML \u8f6c\u6362 JSON \u7f51\u7ad9\uff0c\u6bd4\u5982",(0,r.kt)("a",{parentName:"p",href:"http://yaml-online-parser.appspot.com%EF%BC%8C%E9%80%9A%E8%BF%87%E5%9C%A8%E7%BA%BF%E8%BD%AC%E6%8D%A2%E5%8F%AF%E4%BB%A5%E9%AA%8C%E8%AF%81%E6%88%96%E6%9F%A5%E7%9C%8B%E8%87%AA%E5%B7%B1%E6%89%80%E5%86%99%E7%9A%84"},"http://yaml-online-parser.appspot.com\uff0c\u901a\u8fc7\u5728\u7ebf\u8f6c\u6362\u53ef\u4ee5\u9a8c\u8bc1\u6216\u67e5\u770b\u81ea\u5df1\u6240\u5199\u7684")," YAML \u662f\u5426\u51fa\u9519\u4ee5\u53ca\u54ea\u91cc\u51fa\u9519\u3002\u4e5f\u53ef\u4ee5\u5b89\u88c5 yq(yaml query) \u547d\u4ee4\u5c06 yaml \u6570\u636e\u8f6c\u6362\u6210 json \u683c\u5f0f\u6570\u636e\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum -y install jq\npip3 install yq\ncat a.yml | yq .\n")),(0,r.kt)("h4",{id:"4521\u5bf9\u8c61"},"4.5.2.1\u3001\u5bf9\u8c61"),(0,r.kt)("p",null,"\u4e00\u7ec4\u952e\u503c\u5bf9\uff0c\u4f7f\u7528\u5192\u53f7\u9694\u5f00 key \u548c value\u3002\u6ce8\u610f\uff0c\u5192\u53f7\u540e\u5fc5\u987b\u81f3\u5c11\u4e00\u4e2a\u7a7a\u683c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"name: junmajinlong\n")),(0,r.kt)("p",null,"\u7b49\u4ef7\u4e8e json\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "junmajinlong"\n}\n')),(0,r.kt)("h4",{id:"4522\u6570\u7ec4"},"4.5.2.2\u3001\u6570\u7ec4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- Shell\n- Perl\n- Python\n")),(0,r.kt)("p",null,"\u7b49\u4ef7\u4e8e json\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'["Shell","Perl","Python"]\n')),(0,r.kt)("p",null,"\u4e5f\u53ef\u4ee5\u4f7f\u7528\u884c\u5185\u6570\u7ec4(\u5185\u8054\u8bed\u6cd5)\u7684\u5199\u6cd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n["Shell","Perl","Python"]\n')),(0,r.kt)("p",null,"\u518d\u4f8b\u5982\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- lang1: Shell\n- lang2: Perl\n- lang3: Python\n")),(0,r.kt)("p",null,"\u7b49\u4ef7\u4e8e json\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'[\n  {"lang1": "Shell"}, \n  {"lang2": "Perl"}, \n  {"lang3": "Python"}\n]\n')),(0,r.kt)("p",null,"\u5c06\u5bf9\u8c61\u548c\u6570\u7ec4\u6df7\u5408\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\nlanguages:\n  - Shell\n  - Perl\n  - Python\n")),(0,r.kt)("p",null,"\u7b49\u4ef7\u4e8e json\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "languages": ["Shell","Perl","Python"]\n}\n')),(0,r.kt)("h4",{id:"4523\u5b57\u5178"},"4.5.2.3\u3001\u5b57\u5178"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\nperson1:\n  name: junmajinlong\n  age: 18\n  gender: male\n\nperson2:\n  name: xiaofanggao\n  age: 19\n  gender: female\n")),(0,r.kt)("p",null,"\u7b49\u4ef7\u4e8e json\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "person2": {\n    "gender": "female", \n    "age": 19, \n    "name": "xiaofanggao"\n  }, \n  "person1": {\n    "gender": "male", \n    "age": 18, \n    "name": "junmajinlong"\n  }\n}\n')),(0,r.kt)("p",null,"\u4e5f\u53ef\u4ee5\u4f7f\u7528\u884c\u5185\u5bf9\u8c61\u7684\u5199\u6cd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"---\nperson1: {name: junmajinlong, age: 18, gender: male}\n")),(0,r.kt)("h4",{id:"4524\u590d\u5408\u7ed3\u6784"},"4.5.2.4\u3001\u590d\u5408\u7ed3\u6784"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- person1:\n  name: junmajinlong\n  age: 18\n  langs:\n    - Perl\n    - Ruby\n    - Shell\n\n- person2:\n  name: xiaofanggao\n  age: 19\n  langs:\n    - Python\n    - Javascript\n")),(0,r.kt)("p",null,"\u7b49\u4ef7\u4e8e json\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "langs": [\n      "Perl", \n      "Ruby", \n      "Shell"\n    ], \n    "person1": null, \n    "age": 18, \n    "name": "junmajinlong"\n  }, \n  {\n    "person2": null, \n    "age": 19, \n    "langs": [\n      "Python", \n      "Javascript"\n    ], \n    "name": "xiaofanggao"\n  }\n]\n')),(0,r.kt)("h4",{id:"4525\u5b57\u7b26\u4e32\u7eed\u884c"},"4.5.2.5\u3001\u5b57\u7b26\u4e32\u7eed\u884c"),(0,r.kt)("p",null,"\u5b57\u7b26\u4e32\u53ef\u4ee5\u5199\u6210\u591a\u884c\uff0c\u4ece\u7b2c\u4e8c\u884c\u5f00\u59cb\uff0c\u5fc5\u987b\u81f3\u5c11\u6709\u4e00\u4e2a\u5355\u7a7a\u683c\u7f29\u8fdb\u3002\u6362\u884c\u7b26\u4f1a\u88ab\u8f6c\u4e3a\u7a7a\u683c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"str: hello\n  world\n  hello world\n")),(0,r.kt)("p",null,"\u7b49\u4ef7\u4e8e json\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "str": "hello world hello world"\n}\n')),(0,r.kt)("p",null,"\u4e5f\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},">")," \u6362\u884c\uff0c\u5b83\u7c7b\u4f3c\u4e8e\u4e0a\u9762\u7684\u591a\u5c42\u7f29\u8fdb\u5199\u6cd5\u3002\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"|")," \u5728\u6362\u884c\u65f6\u4fdd\u7559\u6362\u884c\u7b26\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"this: |\n  Foo\n  Bar\nthat: >\n  Foo\n  Bar\n")),(0,r.kt)("p",null,"\u7b49\u4ef7\u4e8e json\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"{'that': 'Foo Bar', 'this': 'Foo\\nBar\\n'}\n")),(0,r.kt)("h4",{id:"4526\u7a7a\u503c"},"4.5.2.6\u3001\u7a7a\u503c"),(0,r.kt)("p",null,"YAML \u4e2d\u67d0\u4e2a key \u6709\u65f6\u5019\u4e0d\u60f3\u4e3a\u5176\u8d4b\u503c\uff0c\u53ef\u4ee5\u76f4\u63a5\u5199 key \u4f46\u4e0d\u5199 value\uff0c\u53e6\u4e00\u79cd\u65b9\u5f0f\u662f\u76f4\u63a5\u5199 null\uff0c\u8fd8\u6709\u4e00\u79cd\u6bd4\u8f83\u5c11\u4e3a\u4eba\u77e5\u7684\u65b9\u5f0f\uff1a\u6ce2\u6d6a\u53f7 ",(0,r.kt)("inlineCode",{parentName:"p"},"~"),"\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u4e0b\u9762\u51e0\u79cd\u65b9\u5f0f\u5168\u662f\u7b49\u4ef7\u7684\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"key1: \nkey2: null\nkey3: Null\nkey4: NULL\nkey5: ~\n")),(0,r.kt)("h4",{id:"4527\u5355\u53cc\u5f15\u53f7\u548c\u8f6c\u4e49"},"4.5.2.7\u3001\u5355\u53cc\u5f15\u53f7\u548c\u8f6c\u4e49"),(0,r.kt)("p",null,"YAML \u4e2d\u7684\u5b57\u7b26\u4e32\u662f\u53ef\u4ee5\u4e0d\u7528\u4f7f\u7528\u5f15\u53f7\u5305\u56f4\u7684\uff0c\u4f46\u662f\u5982\u679c\u5305\u542b\u4e86\u7279\u6b8a\u7b26\u53f7\uff0c\u5219\u9700\u8981\u4f7f\u7528\u5f15\u53f7\u5305\u56f4\u3002"),(0,r.kt)("p",null,"\u5355\u5f15\u53f7\u5305\u56f4\u5b57\u7b26\u4e32\u65f6\uff0c\u4f1a\u5c06\u7279\u6b8a\u7b26\u53f7\u4fdd\u7559\u3002"),(0,r.kt)("p",null,"\u53cc\u5f15\u53f7\u5305\u56f4\u5b57\u7b26\u4e32\u65f6\uff0c\u53cd\u659c\u7ebf\u9700\u8981\u989d\u5916\u8fdb\u884c\u8f6c\u4e49\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u4e0b\u9762\u51e0\u5bf9\u4e66\u5199\u65b9\u5f0f\u662f\u7b49\u4ef7\u7684\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- key1: \"~\"\n- key2: '~'\n\n- key3: '\\.php$'\n- key4: \"\\\\.php$\"\n- key5: \\.php$\n\n- key6: \\n\n- key7: '\\n'\n- key8: \"\\\\n\"\n")),(0,r.kt)("p",null,"\u7b49\u4ef7\u4e8e json\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n  { "key1": "~" },\n  { "key2": "~" },\n  { "key3": "\\\\.php$" },\n  { "key4": "\\\\.php$" },\n  { "key5": "\\\\.php$" },\n  { "key6": "\\\\n" },\n  { "key7": "\\\\n" },\n  { "key8": "\\\\n" }\n]\n')),(0,r.kt)("h3",{id:"453playbook-\u7684\u5199\u6cd5"},"4.5.3\u3001playbook \u7684\u5199\u6cd5"),(0,r.kt)("p",null,"\u4e86\u89e3 YAML \u5199\u6cd5\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u6765\u5199 Ansible \u7684 playbook \u4e86\u3002"),(0,r.kt)("p",null,"\u56de\u987e\u4e00\u4e0b\u524d\u6587\u5bf9 playbook\u3001play \u548c task \u5173\u7cfb\u7684\u63cf\u8ff0\uff0cplaybook \u53ef\u4ee5\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a play\uff0c\u6bcf\u4e2a play \u53ef\u4ee5\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u4efb\u52a1\uff0c\u4e14\u6bcf\u4e2a play \u90fd\u9700\u8981\u6307\u5b9a\u8981\u6267\u884c\u8be5 play \u7684\u76ee\u6807\u4e3b\u673a\u3002"),(0,r.kt)("p",null,"\u4e8e\u662f\uff0c\u5c06\u4e0b\u9762\u8fd9\u4e2a ad-hoc \u6a21\u5f0f\u7684 ansible \u4efb\u52a1\u6539\u6210\u7b49\u4ef7\u7684 playbook \u6a21\u5f0f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ ansible nginx -m copy -a 'src=/etc/passwd dest=/tmp'\n")),(0,r.kt)("p",null,"\u5047\u8bbe\u8fd9\u4e2a playbook \u7684\u6587\u4ef6\u540d\u4e3a copy.yml\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- hosts: nginx\n  gather_facts: false\n\n  tasks: \n    - copy: src=/etc/passwd dest=/tmp\n")),(0,r.kt)("p",null,"\u7136\u540e\u4f7f\u7528 ansible-playbook \u547d\u4ee4\u6267\u884c\u8be5 playbook\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-playbook copy.yml\n")),(0,r.kt)("p",null,"\u518d\u6765\u89e3\u91ca\u4e00\u4e0b\u8fd9\u4e2a playbook \u6587\u4ef6\u7684\u542b\u4e49\u3002"),(0,r.kt)("p",null,"playbook \u4e2d\uff0c\u6bcf\u4e2a play \u90fd\u9700\u8981\u653e\u5728\u6570\u7ec4\u4e2d\uff0c\u6240\u4ee5\u5728 playbook \u7684\u9876\u5c42\u4f7f\u7528\u5217\u8868\u7684\u65b9\u5f0f ",(0,r.kt)("inlineCode",{parentName:"p"},"- xxx:")," \u6765\u8868\u793a\u8fd9\u662f\u4e00\u4e2a play\uff08\u6b64\u5904\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"- hosts:"),"\uff09\u3002"),(0,r.kt)("p",null,"\u6bcf\u4e2a play \u90fd\u5fc5\u987b\u5305\u542b ",(0,r.kt)("inlineCode",{parentName:"p"},"hosts")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"tasks")," \u6307\u4ee4\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"hosts")," \u6307\u4ee4\u7528\u6765\u6307\u5b9a\u8981\u6267\u884c\u8be5 play \u7684\u76ee\u6807\u4e3b\u673a\uff0c\u53ef\u4ee5\u662f\u4e3b\u673a\u540d\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e3b\u673a\u7ec4\uff0c\u8fd8\u652f\u6301\u5176\u5b83\u65b9\u5f0f\u6765\u66f4\u7075\u6d3b\u7684\u6307\u5b9a\u76ee\u6807\u4e3b\u673a\u3002\u5177\u4f53\u7684\u89c4\u5219\u540e\u6587\u518d\u505a\u4ecb\u7ecd\u3002"),(0,r.kt)("p",null,"tasks \u6307\u4ee4\u7528\u6765\u6307\u5b9a\u8fd9\u4e2a play \u4e2d\u5305\u542b\u7684\u4efb\u52a1\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u4efb\u52a1\uff0c\u4efb\u52a1\u4e5f\u9700\u8981\u653e\u5728 play \u7684\u6570\u7ec4\u4e2d\uff0c\u6240\u4ee5 tasks \u6307\u4ee4\u5185\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"- xxx:")," \u7684\u65b9\u5f0f\u6765\u8868\u793a\u6bcf\u4e00\u4e2a\u4efb\u52a1\uff08\u6b64\u5904\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"- copy:"),"\uff09\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"gather_facts")," \u662f\u4e00\u4e2a play \u7ea7\u522b\u7684\u6307\u4ee4\u8bbe\u7f6e\uff0c\u5b83\u662f\u4e00\u4e2a\u8d1f\u8d23\u6536\u96c6\u76ee\u6807\u4e3b\u673a\u4fe1\u606f\u7684\u4efb\u52a1\uff0c\u7531 setup \u6a21\u5757\u63d0\u4f9b\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a play \u90fd\u4f1a\u5148\u6267\u884c\u8fd9\u4e2a\u7279\u6b8a\u7684\u4efb\u52a1\uff0c\u6536\u96c6\u5b8c\u4fe1\u606f\u4e4b\u540e\u624d\u5f00\u59cb\u6267\u884c\u5176\u5b83\u4efb\u52a1\u3002"),(0,r.kt)("p",null,"\u4f46\u662f\uff0c\u6536\u96c6\u76ee\u6807\u4e3b\u673a\u4fe1\u606f\u7684\u6548\u7387\u5f88\u4f4e\uff0c\u5982\u679c\u80fd\u591f\u786e\u4fdd playbook \u4e2d\u4e0d\u4f1a\u4f7f\u7528\u5230\u6240\u6536\u96c6\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u663e\u5f0f\u6307\u5b9a ",(0,r.kt)("inlineCode",{parentName:"p"},"gather_facts: no")," \u6765\u7981\u6b62\u8fd9\u4e2a\u9ed8\u8ba4\u6267\u884c\u7684\u6536\u96c6\u4efb\u52a1\uff0c\u8fd9\u5bf9\u6548\u7387\u7684\u63d0\u5347\u662f\u975e\u5e38\u53ef\u89c2\u7684\u3002"),(0,r.kt)("p",null,"\u6b64\u5916\u6bcf\u4e2a play \u548c\u6bcf\u4e2a task \u90fd\u53ef\u4ee5\u4f7f\u7528 name \u6307\u4ee4\u6765\u547d\u540d\uff0c\u4e5f\u5efa\u8bae\u5c3d\u91cf\u4e3a\u6bcf\u4e2a play \u548c\u6bcf\u4e2a task \u90fd\u547d\u540d\uff0c\u4e14\u540d\u79f0\u5177\u6709\u552f\u4e00\u6027\u3002"),(0,r.kt)("p",null,"\u6240\u4ee5\uff0c\u5c06\u4e0a\u9762\u7684 playbook \u6539\u5199\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- name: first play\n  hosts: nginx\n  gather_facts: false\n\n  tasks: \n    - name: copy /etc/passwd to /tmp\n      copy: src=/etc/passwd dest=/tmp\n")),(0,r.kt)("h3",{id:"454playbook-\u6a21\u5757\u53c2\u6570\u7684\u4f20\u9012\u65b9\u5f0f"},"4.5.4\u3001playbook \u6a21\u5757\u53c2\u6570\u7684\u4f20\u9012\u65b9\u5f0f"),(0,r.kt)("p",null,"\u5728\u521a\u624d\u7684\u793a\u4f8b\u4e2d\uff0ccopy \u6a21\u5757\u7684\u53c2\u6570\u4f20\u9012\u65b9\u5f0f\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"tasks: \n  - name: copy /etc/passwd to /tmp\n    copy: src=/etc/passwd dest=/tmp\n")),(0,r.kt)("p",null,"\u8fd9\u662f\u6807\u51c6\u7684 yaml \u8bed\u6cd5\uff0c\u53c2\u6570\u90e8\u5206 src=/etc/passwd dest=/tmp \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5f53\u4f5c copy \u5bf9\u5e94\u7684\u503c\u3002"),(0,r.kt)("p",null,"\u6839\u636e\u524d\u9762\u4ecb\u7ecd\u7684 yaml \u8bed\u6cd5\uff0c\u8fd8\u53ef\u4ee5\u6362\u884c\u4e66\u5199\u3002\u6709\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- name: first play\n  hosts: nginx\n  gather_facts: false\n  tasks: \n    - copy: \n        src=/etc/passwd dest=/tmp\n\n    - copy: \n        src=/etc/passwd\n        dest=/tmp\n\n    - copy: >\n        src=/etc/passwd\n        dest=/tmp\n\n    - copy: |\n        src=/etc/passwd\n        dest=/tmp\n")),(0,r.kt)("p",null,"\u9664\u6b64\u4e4b\u5916\uff0cAnsible \u8fd8\u63d0\u4f9b\u4e86\u53e6\u5916\u4e24\u79cd\u4f20\u9012\u53c2\u6570\u7684\u65b9\u5f0f\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5c06\u53c2\u6570\u548c\u53c2\u6570\u503c\u5199\u6210 ",(0,r.kt)("inlineCode",{parentName:"li"},"key: value")," \u7684\u65b9\u5f0f"),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"args")," \u53c2\u6570\u58f0\u660e\u63a5\u4e0b\u6765\u7684\u662f\u53c2\u6570")),(0,r.kt)("p",null,"\u901a\u8fc7\u793a\u4f8b\u4fbf\u53ef\u5bf9\u5176\u7528\u6cd5\u4e00\u76ee\u4e86\u7136\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- name: first play\n  hosts: nginx\n  gather_facts: false\n  tasks: \n    - name: copy1\n      copy: \n        src: /etc/passwd\n        dest: /tmp\n\n    - name: copy2\n      copy: \n      args:\n        src: /etc/passwd\n        dest: /tmp\n")),(0,r.kt)("p",null,"\u5927\u591a\u6570\u65f6\u5019\uff0c\u4f7f\u7528\u4f55\u79cd\u65b9\u5f0f\u4f20\u9012\u53c2\u6570\u5e76\u65e0\u5173\u7d27\u8981\uff0c\u53ea\u8981\u4e2a\u4eba\u89c9\u5f97\u53ef\u8bfb\u6027\u9ad8\u3001\u65b9\u4fbf\u3001\u7f8e\u89c2\u5373\u53ef\u3002"),(0,r.kt)("h3",{id:"455play-\u7684\u76ee\u6807\u4e3b\u673a"},"4.5.5\u3001play \u7684\u76ee\u6807\u4e3b\u673a"),(0,r.kt)("p",null,"\u6bcf\u4e00\u4e2a play \u90fd\u5305\u542b hosts \u6307\u4ee4\uff0c\u5b83\u7528\u6765\u6307\u793a\u5728\u89e3\u6790 inventory \u4e4b\u540e\u9009\u62e9\u54ea\u4e9b\u4e3b\u673a\u6267\u884c\u8be5 play \u4e2d\u7684 tasks\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"hosts")," \u6307\u4ee4\u901a\u8fc7 pattern \u7684\u65b9\u5f0f\u6765\u7b5b\u9009\u8282\u70b9\uff0cpattern \u7684\u6307\u5b9a\u65b9\u5f0f\u6709\u4ee5\u4e0b\u51e0\u79cd\u89c4\u5219\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u76f4\u63a5\u6307\u5b9a inventory \u4e2d\u5b9a\u4e49\u7684\u4e3b\u673a\u540d",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hosts: localhost")))),(0,r.kt)("li",{parentName:"ol"},"\u76f4\u63a5\u6307\u5b9a inventory \u4e2d\u7684\u4e3b\u673a\u7ec4\u540d",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hosts: nginx")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hosts: all")))),(0,r.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u7ec4\u540d\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u6570\u503c\u7d22\u5f15\u7684\u65b9\u5f0f\u8868\u793a\u7ec4\u4e2d\u7684\u7b2c\u51e0\u4e2a\u4e3b\u673a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hosts: nginx[1]:mysql[0]")))),(0,r.kt)("li",{parentName:"ol"},"\u53ef\u4f7f\u7528\u5192\u53f7\u6216\u9017\u53f7\u9694\u5f00\u591a\u4e2a pattern",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hosts: nginx:localhost")))),(0,r.kt)("li",{parentName:"ol"},"\u53ef\u4ee5\u4f7f\u7528\u8303\u56f4\u8868\u793a\u6cd5",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hosts: 192.168.200.3[0:3]")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hosts: web[A:D]")))),(0,r.kt)("li",{parentName:"ol"},"\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26 ",(0,r.kt)("inlineCode",{parentName:"li"},"*"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hosts: *.example.com")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hosts: *"),"\uff0c\u8fd9\u7b49\u4ef7\u4e8e ",(0,r.kt)("inlineCode",{parentName:"li"},"hosts: all")))),(0,r.kt)("li",{parentName:"ol"},"\u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u9700\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"~")," \u5f00\u5934",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hosts: ~(web|db)\\.example\\.com"))))),(0,r.kt)("p",null,"\u6b64\u5916\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u6240\u6709 pattern \u9009\u4e2d\u7684\u4e3b\u673a\u90fd\u662f\u5305\u542b\u6027\u7684\uff0c\u7b2c\u4e00\u4e2a pattern \u9009\u4e2d\u7684\u4e3b\u673a\u4f1a\u6dfb\u52a0\u5230\u4e0b\u4e00\u4e2a pattern \u7684\u8303\u56f4\u5185\uff0c\u76f4\u5230\u6700\u540e\u4e00\u4e2a pattern \u7b5b\u9009\u5b8c\uff0c\u4e8e\u662f\u53d6\u5f97\u4e86\u6240\u6709 pattern \u5339\u914d\u7684\u4e3b\u673a\u3002"),(0,r.kt)("li",{parentName:"ol"},"pattern \u524d\u9762\u52a0\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"li"},"&")," \u7b26\u53f7\u8868\u793a\u53d6\u4ea4\u96c6",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"pattern1:&pattern2")," \u8981\u6c42\u540c\u65f6\u5b58\u5728\u4e8e pattern1 \u548c pattern2 \u4e2d\u7684\u4e3b\u673a"))),(0,r.kt)("li",{parentName:"ol"},"pattern \u524d\u9762\u52a0\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"li"},"!")," \u7b26\u53f7\u8868\u793a\u6392\u9664",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"pattern1:!pattern2")," \u8981\u6c42\u51fa\u73b0\u5728 pattern1 \u4e2d\u4f46\u672a\u51fa\u73b0\u5728 pattern2 \u4e2d")))),(0,r.kt)("h2",{id:"46\u9ed8\u8ba4\u7684\u4efb\u52a1\u6267\u884c\u7b56\u7565"},"4.6\u3001\u9ed8\u8ba4\u7684\u4efb\u52a1\u6267\u884c\u7b56\u7565"),(0,r.kt)("p",null,"\u5047\u8bbe\u6709 10 \u4e2a\u76ee\u6807\u8282\u70b9\u8981\u6267\u884c\u67d0\u4e2a play \u4e2d\u7684 3 \u4e2a\u4efb\u52a1\uff1atA\u3001tB\u3001tC\u3002"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f1a\u4ece 10 \u4e2a\u76ee\u6807\u8282\u70b9\u4e2d\u9009\u62e9 5 \u4e2a\u8282\u70b9\u4f5c\u4e3a\u7b2c\u4e00\u6279\u6b21\u7684\u8282\u70b9\u6267\u884c\u4efb\u52a1 tA\uff0c\u7b2c\u4e00\u6279\u6b21\u7684 5 \u4e2a\u8282\u70b9\u90fd\u6267\u884c tA \u5b8c\u6210\u540e\uff0c\u5c06\u9009\u62e9\u5269\u4e0b\u7684 5 \u4e2a\u8282\u70b9\u4f5c\u4e3a\u7b2c\u4e8c\u6279\u6b21\u6267\u884c\u4efb\u52a1 tA\u3002"),(0,r.kt)("p",null,"\u6240\u6709\u8282\u70b9\u90fd\u6267\u884c\u5b8c\u4efb\u52a1 tA \u540e\uff0c\u7b2c\u4e00\u6279\u6b21\u7684 5 \u8282\u70b9\u5f00\u59cb\u6267\u884c\u4efb\u52a1 tB\uff0c\u7136\u540e\u7b2c\u4e8c\u6279\u6b21\u7684 5 \u4e2a\u8282\u70b9\u6267\u884c\u4efb\u52a1 tB\u3002"),(0,r.kt)("p",null,"\u6240\u6709\u8282\u70b9\u90fd\u6267\u884c\u5b8c\u4efb\u52a1 tB \u540e\uff0c\u7b2c\u4e00\u6279\u6b21\u7684 5 \u8282\u70b9\u5f00\u59cb\u6267\u884c\u4efb\u52a1 tC\uff0c\u7136\u540e\u7b2c\u4e8c\u6279\u6b21\u7684 5 \u4e2a\u8282\u70b9\u6267\u884c\u4efb\u52a1 tC\u3002"),(0,r.kt)("p",null,"\u6574\u4e2a\u8fc7\u7a0b\u5982\u4e0b\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ansible_forks",src:l(37395).Z,width:"924",height:"568"})),(0,r.kt)("p",null,"\u8fd9\u4e2a\u6d41\u7a0b\u56fe\u867d\u7136\u7b80\u5355\u5f62\u8c61\uff0c\u4f46\u662f\u4e0d\u4e25\u8c28\uff0c\u7a0d\u540e\u4f1a\u89e3\u91ca\u4e3a\u4f55\u4e0d\u4e25\u8c28\u3002"),(0,r.kt)("p",null,"\u8fd9\u91cc\u63d0\u5230\u7684 5 \u4e2a\u8282\u70b9\u7684\u6570\u91cf 5\uff0c\u662f\u7531\u914d\u7f6e\u6587\u4ef6\u4e2d forks \u6307\u4ee4\u7684\u503c\u51b3\u5b9a\u7684\uff0c\u9ed8\u8ba4\u503c\u4e3a 5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ grep 'fork' /etc/ansible/ansible.cfg\n#forks          = 5\n")),(0,r.kt)("p",null,"forks \u6307\u4ee4\u7528\u6765\u6307\u5b9a Ansible \u6700\u591a\u8981\u521b\u5efa\u51e0\u4e2a\u5b50\u8fdb\u7a0b\u6765\u6267\u884c\u4efb\u52a1\uff0c\u6bcf\u4e2a\u8282\u70b9\u9ed8\u8ba4\u5bf9\u5e94\u4e00\u4e2a ansible-playbook \u8fdb\u7a0b\u548c ssh \u8fdb\u7a0b\uff0c\u4f8b\u5982 forks=5 \u8868\u793a\u6700\u591a\u521b\u5efa 5 \u4e2a ansible-playbook \u5b50\u8fdb\u7a0b\u3002\u6240\u4ee5\uff0cforks \u7684\u503c\u4e5f\u4ee3\u8868\u4e86\u6700\u591a\u6709\u51e0\u4e2a\u8282\u70b9\u540c\u65f6\u6267\u884c\u4efb\u52a1\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u5c06 hosts \u6307\u4ee4\u6307\u5b9a\u4e3a all\uff0c\u5e76\u5c06 gather","_","facts \u6307\u4ee4\u53d6\u6d88\u6ce8\u91ca\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u4efb\u52a1\u6267\u884c\u6bd4\u8f83\u6162\uff0c\u65b9\u4fbf\u89c2\u5bdf\u8fdb\u7a0b\u5217\u8868\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- name: first play\n  hosts: all \n  #gather_facts: false\n")),(0,r.kt)("p",null,"\u6267\u884c\u8be5 playbook\u3002\u7136\u540e\u5728\u53e6\u5916\u4e00\u4e2a\u7ec8\u7aef\u4e0a\u53bb\u67e5\u770b\u8fdb\u7a0b\u5217\u8868\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@controller ~]# ansible-playbook first.yml\n[root@controller ~]# pstree -c | grep 'ansible'\n        |-sshd-+-sshd---bash---ansible-playboo-+-ansible-playboo---ssh\n        |      |                               |-ansible-playboo---ssh\n        |      |                               |-ansible-playboo---ssh\n        |      |                               |-ansible-playboo---ssh\n        |      |                               |-ansible-playboo\n        |      |                               `-{ansible-playboo}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7ed3\u679c\u8868\u660e forks=5 \u65f6\u5171\u6709 6 \u4e2a Ansible \u8fdb\u7a0b\uff0c\u5176\u4e2d\u7236\u8fdb\u7a0b\u662f Ansible \u4e3b\u63a7\u8fdb\u7a0b\uff0c\u8d1f\u8d23\u76d1\u63a7\u8282\u70b9\u6267\u884c\u4efb\u52a1\u7684\u72b6\u6001\u4ee5\u53ca\u521b\u5efa\u5b50\u8fdb\u7a0b\u6765\u6267\u884c\u4efb\u52a1\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u67d0\u4e2a\u8282\u70b9\u8fde\u63a5\u5931\u8d25\u6216\u6267\u884c\u67d0\u4e2a\u4efb\u52a1\u5931\u8d25\uff0c\u5219\u8be5\u8282\u70b9\u5c06\u4e0d\u518d\u6267\u884c\u8be5 play \u4e2d\u7684\u540e\u7eed\u4efb\u52a1(\u4f46\u4f1a\u6267\u884c\u540e\u7eed\u7684 play)\u3002")),(0,r.kt)("p",null,"\u6839\u636e\u4e0a\u9762\u5bf9 forks \u6307\u4ee4\u7684\u6548\u679c\u63cf\u8ff0\uff0c\u524d\u9762\u7684\u6267\u884c\u7b56\u7565\u6d41\u7a0b\u56fe\u5e76\u4e0d\u4e25\u8c28\u3002\u56e0\u4e3a forks \u7684\u6548\u679c\u5e76\u4e0d\u662f\u9009\u4e2d\u4e00\u6279\u8282\u70b9\uff0c\u672c\u6279\u8282\u70b9\u6267\u884c\u5b8c\u4efb\u52a1\u624d\u9009\u4e0b\u4e00\u6279\u8282\u70b9\u3002"),(0,r.kt)("p",null,"forks \u662f\u4fdd\u8bc1\u6700\u591a\u6709 N \u4e2a\u8282\u70b9\u540c\u65f6\u6267\u884c\u4efb\u52a1\uff0c\u4f46\u6709\u7684\u8282\u70b9\u53ef\u80fd\u6267\u884c\u4efb\u52a1\u8f83\u6162\u3002\u6bd4\u5982\u6709 10 \u4e2a\u8282\u70b9\uff0c\u4e14 forks=5 \u65f6\uff0c\u7b2c\u4e00\u6279\u9009\u4e2d 5 \u4e2a\u8282\u70b9\u6267\u884c\u4efb\u52a1\uff0c\u5047\u5982\u7b2c 1 \u4e2a\u8282\u70b9\u5148\u6267\u884c\u5b8c\u4efb\u52a1\uff0cAnsible \u4e3b\u63a7\u8fdb\u7a0b\u4e0d\u4f1a\u7b49\u5f85\u672c\u6279\u4e2d\u5176\u5b83 4 \u4e2a\u8282\u70b9\u6267\u884c\u5b8c\u4efb\u52a1\uff0c\u800c\u662f\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Ansible \u8fdb\u7a0b\uff0c\u8ba9\u7b2c 6 \u4e2a\u8282\u70b9\u6267\u884c\u4efb\u52a1\u3002"),(0,r.kt)("h2",{id:"47\u7efc\u5408\u6848\u4f8b"},"4.7\u3001\u7efc\u5408\u6848\u4f8b"),(0,r.kt)("p",null,"\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u6709\u5927\u91cf\u7684\u96c6\u7fa4\u9700\u8981\u8fdb\u884c\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u8fd9\u91cc\u4f7f\u7528 playbook \u5199\u4e00\u4e2a\u6279\u91cf\u521d\u59cb\u5316\u670d\u52a1\u5668\u7684\u6848\u4f8b\u3002"),(0,r.kt)("p",null,"\u53c2\u89c1",(0,r.kt)("a",{parentName:"p",href:"https://www.brinnatt.com/supplement/%E7%AC%AC-a-%E7%AB%A0-ansible-%E6%89%B9%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96%E6%9C%8D%E5%8A%A1%E5%99%A8/"},"\u6279\u91cf\u521d\u59cb\u5316\u670d\u52a1\u5668")))}c.isMDXComponent=!0},93617:function(e,n,l){n.Z=l.p+"assets/images/ansible_arch-50bde7498f16765b27d215da774dda9c.jpg"},37395:function(e,n,l){n.Z=l.p+"assets/images/ansible_forks-9b8d4c56efca67f1ab56f4a16072a6ba.gif"}}]);