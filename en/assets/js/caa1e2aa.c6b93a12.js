"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[1078],{3905:function(e,n,r){r.d(n,{Zo:function(){return c},kt:function(){return v}});var t=r(67294);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function l(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?l(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function o(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},l=Object.keys(e);for(t=0;t<l.length;t++)r=l[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)r=l[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var p=t.createContext({}),s=function(e){var n=t.useContext(p),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},c=function(e){var n=s(e.components);return t.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var r=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=s(r),v=a,k=u["".concat(p,".").concat(v)]||u[v]||d[v]||l;return r?t.createElement(k,i(i({ref:n},c),{},{components:r})):t.createElement(k,i({ref:n},c))}));function v(e,n){var r=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=r.length,i=new Array(l);i[0]=u;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var s=2;s<l;s++)i[s]=r[s];return t.createElement.apply(null,i)}return t.createElement.apply(null,r)}u.displayName="MDXCreateElement"},23832:function(e,n,r){r.r(n),r.d(n,{assets:function(){return c},contentTitle:function(){return p},default:function(){return v},frontMatter:function(){return o},metadata:function(){return s},toc:function(){return d}});var t=r(87462),a=r(63366),l=(r(67294),r(3905)),i=["components"],o={id:"linux-advanced-16",slug:"/linux-advanced-16",title:"\u7b2c 16 \u7ae0 Linux Keepalived \u670d\u52a1\u914d\u7f6e",authors:"zhangqf",keywords:["linux","keepalived"]},p=void 0,s={unversionedId:"linux/advanced/linux-advanced-16",id:"linux/advanced/linux-advanced-16",title:"\u7b2c 16 \u7ae0 Linux Keepalived \u670d\u52a1\u914d\u7f6e",description:"KeepAlived \u4e3b\u8981\u6709\u4e24\u4e2a\u529f\u80fd\uff1a",source:"@site/docs/linux/advanced/\u7b2c 16 \u7ae0 Linux Keepalived \u670d\u52a1\u914d\u7f6e.md",sourceDirName:"linux/advanced",slug:"/linux-advanced-16",permalink:"/en/docs/linux-advanced-16",draft:!1,tags:[],version:"current",frontMatter:{id:"linux-advanced-16",slug:"/linux-advanced-16",title:"\u7b2c 16 \u7ae0 Linux Keepalived \u670d\u52a1\u914d\u7f6e",authors:"zhangqf",keywords:["linux","keepalived"]},sidebar:"linux",previous:{title:"\u7b2c 15 \u7ae0 Linux LVS \u670d\u52a1\u914d\u7f6e",permalink:"/en/docs/linux-advanced-15"},next:{title:"Linux\u6d4b\u8bd5",permalink:"/en/docs/category/linux\u6d4b\u8bd5"}},c={},d=[{value:"10.1\u3001VRRP \u534f\u8bae",id:"101vrrp-\u534f\u8bae",level:2},{value:"10.2\u3001keepalived \u67b6\u6784\u6a21\u578b",id:"102keepalived-\u67b6\u6784\u6a21\u578b",level:2},{value:"10.3\u3001\u5b89\u88c5 keepalived",id:"103\u5b89\u88c5-keepalived",level:2},{value:"10.4\u3001\u914d\u7f6e keepalived \u65e5\u5fd7",id:"104\u914d\u7f6e-keepalived-\u65e5\u5fd7",level:2},{value:"10.5\u3001keepalived \u914d\u7f6e\u6587\u4ef6\u8be6\u89e3",id:"105keepalived-\u914d\u7f6e\u6587\u4ef6\u8be6\u89e3",level:2},{value:"10.5.1\u3001\u5168\u5c40\u914d\u7f6e\u6a21\u5757",id:"1051\u5168\u5c40\u914d\u7f6e\u6a21\u5757",level:3},{value:"10.5.2\u3001VRRPD \u914d\u7f6e\u6a21\u5757",id:"1052vrrpd-\u914d\u7f6e\u6a21\u5757",level:3},{value:"10.5.3\u3001LVS \u914d\u7f6e",id:"1053lvs-\u914d\u7f6e",level:3},{value:"10.5.4\u3001\u793a\u4f8b",id:"1054\u793a\u4f8b",level:3},{value:"10.6\u3001\u7efc\u5408\u751f\u4ea7\u5b9e\u4f8b",id:"106\u7efc\u5408\u751f\u4ea7\u5b9e\u4f8b",level:2}],u={toc:d};function v(e){var n=e.components,o=(0,a.Z)(e,i);return(0,l.kt)("wrapper",(0,t.Z)({},u,o,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"KeepAlived \u4e3b\u8981\u6709\u4e24\u4e2a\u529f\u80fd\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u80fd\u591f\u5bf9 RealServer \u8fdb\u884c\u5065\u5eb7\u72b6\u51b5\u68c0\u67e5\uff0c\u652f\u6301 4 \u5c42\u30015 \u5c42\u548c 7 \u5c42\u534f\u8bae\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u5bf9\u8d1f\u8f7d\u5747\u8861\u8c03\u5ea6\u5668\u5b9e\u73b0\u9ad8\u53ef\u7528\uff0c\u9632\u6b62 Director \u5355\u70b9\u6545\u969c\u3002")),(0,l.kt)("p",null,"\u5728 keepalived \u8bbe\u8ba1\u4e4b\u521d\uff0c\u5b83\u53ea\u662f LVS \u5468\u8fb9\u7684\u4e00\u4e2a\u8f85\u52a9\u5de5\u5177\uff0c\u7528\u4e8e LVS \u7684\u76d1\u63a7\u72b6\u51b5\u68c0\u67e5\uff0c\u56e0\u6b64\u5b83\u548c LVS \u7684\u517c\u5bb9\u6027\u975e\u5e38\u597d\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u67d0\u4e00\u4e2a realserver \u8282\u70b9\u5b95\u4e86\uff0ckeepalived \u4f1a\u5c06\u6b64\u8282\u70b9\u4ece\u7ba1\u7406\u5217\u8868\u4e2d\u8e22\u51fa\u53bb\uff0c\u5f53\u6b64\u8282\u70b9\u6062\u590d\u540e\u53c8\u5c06\u6b64\u8282\u70b9\u52a0\u56de\u7ba1\u7406\u5217\u8868\uff0c\u8fd9\u6837\u80fd\u591f\u8ba9 realserver \u8d1f\u8f7d\u5747\u8861\u53d8\u7684\u667a\u80fd\u5316\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u4f46\u662f\uff0c\u6b64\u65f6\u7684\u8c03\u5ea6\u5668\u5b58\u5728\u5355\u70b9\u6545\u969c\u7684\u53ef\u80fd\u6027\uff0c\u56e0\u6b64\u6709\u5fc5\u8981\u5bf9\u5176\u5b9e\u73b0\u9ad8\u53ef\u7528\u3002")),(0,l.kt)("p",null,"\u5b9e\u73b0 LVS \u9ad8\u53ef\u7528\u53ef\u4ee5\u4f7f\u7528\u591a\u79cd\u8f6f\u4ef6\u6765\u5b9e\u73b0\uff0c\u5982 heartbeat\uff0c\u4f46\u662f heartbeat \u672c\u8eab\u4e0d\u80fd\u5b9e\u73b0 ipvs \u7684\u5065\u5eb7\u72b6\u51b5\u68c0\u67e5\uff0c\u9700\u8981\u642d\u914d Ldirectord(\u5b89\u88c5\u5b8c heartbeat \u5c31\u6709\u4e86)\u6765\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\u3002"),(0,l.kt)("p",null,"\u6240\u5e78\u7684\u662f keepalived \u540e\u6765\u4e5f\u52a0\u5165\u4e86\u9ad8\u53ef\u7528\u7684\u529f\u80fd\uff0c\u800c\u4e14\u914d\u7f6e\u8d77\u6765\u4e5f\u76f8\u5f53\u7b80\u5355\u3002\u76f8\u6bd4\u4e8e heartbeat+Ldirectord\uff0ckeepalived \u7684\u68c0\u67e5\u901f\u5ea6\u6781\u5feb\uff0c\u6545\u969c\u8f6c\u79fb\u4e5f\u6781\u5feb\uff0c\u5e03\u7f6e\u4e5f\u7b80\u5355\u7684\u591a\u3002\u6240\u4ee5\u4e00\u822c\u6765\u8bf4\uff0c\u8981\u7ba1\u7406 ipvs\uff0c\u90fd\u4f1a\u9009\u62e9\u4f7f\u7528 keepalived\u3002"),(0,l.kt)("p",null,"keepalived \u5b9e\u73b0\u6545\u969c\u8f6c\u79fb\u7684\u529f\u80fd\u662f\u901a\u8fc7 VRRP(virtual router redundancy protocol \u865a\u62df\u8def\u7531\u5668\u5197\u4f59\u534f\u8bae) \u534f\u8bae\u6765\u5b9e\u73b0\u7684\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5728 keepalived \u6b63\u5e38\u5de5\u4f5c\u7684\u65f6\u5019\uff0c\u4e3b\u8282\u70b9(master)\u4f1a\u4e0d\u65ad\u7684\u53d1\u9001\u5fc3\u8df3\u4fe1\u606f\u7ed9\u5907\u8282\u70b9(backup)\uff0c\u5f53\u5907\u8282\u70b9\u4e0d\u80fd\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\u6536\u5230\u4e3b\u8282\u70b9\u7684\u5fc3\u8df3\u4fe1\u606f\u65f6\uff0c\u5907\u8282\u70b9\u4f1a\u8ba4\u4e3a\u4e3b\u8282\u70b9\u5b95\u4e86\uff0c\u7136\u540e\u4f1a\u63a5\u7ba1\u4e3b\u8282\u70b9\u4e0a\u7684\u8d44\u6e90\uff0c\u5e76\u7ee7\u7eed\u5411\u5916\u63d0\u4f9b\u670d\u52a1\u4fdd\u8bc1\u5176\u53ef\u7528\u6027\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u5f53\u4e3b\u8282\u70b9\u6062\u590d\u7684\u65f6\u5019\uff0c\u5907\u8282\u70b9\u4f1a\u81ea\u52a8\u8ba9\u51fa\u8d44\u6e90\u5e76\u518d\u6b21\u81ea\u52a8\u6210\u4e3a\u5907\u8282\u70b9\u3002")),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u6ce8\u610f\uff1a\u4f7f\u7528 keepalived \u76d1\u63a7\u3001\u9ad8\u53ef\u7528 LVS \u96c6\u7fa4\u65f6(\u5373\u5e38\u8bf4\u7684 keepalived+lvs)\uff0c\u5e76\u4e0d\u9700\u8981\u5728 Director \u4e0a\u4f7f\u7528 ipvsadm \u7b49\u7ba1\u7406\u5de5\u5177\u989d\u5916\u914d\u7f6e ipvs \u89c4\u5219\u3002\u56e0\u4e3a keepalived \u4e2d\u96c6\u5408\u4e86\u7ba1\u7406 ipvs \u89c4\u5219\u7684\u7ec4\u4ef6(\u5373\u7a0d\u540e\u6a21\u578b\u56fe\u4e2d\u7684 ipvs wrapper)\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728 keepalived \u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e ipvs \u76f8\u5173\u89c4\u5219\uff0c\u5728\u89e3\u6790\u914d\u7f6e\u6587\u4ef6\u65f6\u4f1a\u901a\u8fc7\u7279\u5b9a\u7684\u7ec4\u4ef6\u5c06\u89c4\u5219\u53d1\u9001\u5230\u5185\u6838\u4e2d\u7684 ipvs \u6a21\u5757\u3002")),(0,l.kt)("h2",{id:"101vrrp-\u534f\u8bae"},"10.1\u3001VRRP \u534f\u8bae"),(0,l.kt)("p",null,"VRRP \u534f\u8bae\u7684\u51fa\u73b0\u662f\u4e3a\u4e86\u89e3\u51b3",(0,l.kt)("strong",{parentName:"p"},"\u9759\u6001\u8def\u7531"),"\u7684\u5355\u70b9\u6545\u969c\uff0c\u5b83\u662f\u901a\u8fc7\u4e00\u79cd\u7ade\u9009\u673a\u5236\u6765\u5c06\u8def\u7531\u4efb\u52a1\u4ea4\u7ed9\u67d0\u4e2a vrrp \u8def\u7531\u5668\u7684\u3002"),(0,l.kt)("p",null,'\u5728 VRRP \u7269\u7406\u7ed3\u6784\u4e2d\uff0c\u6709\u591a\u4e2a\u7269\u7406\u7684 VRRP \u8def\u7531\u5668\uff0c\u5176\u4e2d\u6709\u4e00\u53f0\u79f0\u4e3a "master" \u5373\u4e3b\u8282\u70b9\u8def\u7531\u5668\uff0c\u5176\u4ed6\u7684\u90fd\u662f "backup" \u5907\u8282\u70b9\u8def\u7531\u5668\uff0c\u8c01\u662f master \u8c01\u662f backup\uff0c\u8fd9\u662f\u901a\u8fc7\u4ed6\u4eec\u7684\u4f18\u5148\u7ea7\u6765\u5b9a\u4e49\u7ade\u9009\u7684\u3002'),(0,l.kt)("p",null,'\u5728 VRRP \u865a\u62df\u7ed3\u6784\u4e2d\uff0c\u865a\u62df\u8def\u7531\u5668\u662f\u901a\u8fc7 "MAC+VRID" \u7684\u5f62\u5f0f\u6765\u6807\u8bc6\u7684\uff0c\u5982 "00-00-5E-00-01-{VRID}"\u3002\u5728 VRRP \u865a\u62df\u7ed3\u6784\u4e2d\uff0c\u4e0d\u7ba1\u662f master \u8fd8\u662f backup\uff0cVRID \u5fc5\u987b\u4e00\u81f4\u3002\u5b83\u4eec\u5bf9\u5916\u90fd\u662f\u76f8\u540c\u7684 VIP\uff0c\u5ba2\u6237\u7aef\u5e76\u4e0d\u9700\u8981\u56e0\u4e3a master \u7684\u5207\u6362\u800c\u4fee\u6539\u81ea\u5df1\u7684\u8def\u7531\u914d\u7f6e\u3002'),(0,l.kt)("p",null,"VRRP \u7ed3\u6784\u4e2d\u8def\u7531\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u662f\u901a\u8fc7 IP \u591a\u64ad\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684(\u4e5f\u53ef\u4ee5\u914d\u7f6e\u4e3a\u5176\u5b83\u901a\u4fe1\u65b9\u5f0f)\u3002\u4f46\u662f\uff0c\u53ea\u6709 master \u8282\u70b9\u624d\u4f1a\u53d1\u9001 VRRP \u5e7f\u544a\u5305(vrrp advertisement message)\u3002\u5f53 master \u8282\u70b9\u5b95\u6389\u7684\u65f6\u5019\uff0cbackup \u4e2d\u4f18\u5148\u7ea7\u6700\u9ad8\u7684 VRRP \u8bbe\u5907\u4f1a\u62a2\u5360\u5e76\u5347\u7ea7\u4e3a master\u3002"),(0,l.kt)("h2",{id:"102keepalived-\u67b6\u6784\u6a21\u578b"},"10.2\u3001keepalived \u67b6\u6784\u6a21\u578b"),(0,l.kt)("p",null,"Keepalived \u670d\u52a1\u542f\u52a8\u7684\u65f6\u5019\uff0c\u5c06\u4ea7\u751f\u4e09\u4e2a\u76f8\u5173\u8fdb\u7a0b\uff0c\u4e00\u4e2a\u7236\u8fdb\u7a0b\u548c\u4e24\u4e2a\u5b50\u8fdb\u7a0b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"PID    111     Keepalived  <-- Parent process fork and monitor children\n       112     \\_ Keepalived   <-- VRRP child\n       113     \\_ Keepalived   <-- Healthchecking child\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u7236\u8fdb\u7a0b\u8d1f\u8d23 fork \u548c\u76d1\u63a7\u5b50\u8fdb\u7a0b\uff0c\u56e0\u6b64\u7236\u8fdb\u7a0b\u4e5f\u79f0\u4e3a WatchDog\u3002\u4e24\u4e2a\u5b50\u8fdb\u7a0b\u90fd\u4f1a\u5f00\u542f\u672c\u5730\u5957\u63a5\u5b57 Unix Domain Socket\u3002"),(0,l.kt)("li",{parentName:"ul"},'\u5f53 keepalived \u670d\u52a1\u542f\u52a8\u540e\uff0c\u7236\u8fdb\u7a0b\u4f1a\u901a\u8fc7 unxi domain socket \u6bcf\u9694 5 \u79d2\u53d1\u9001\u4e00\u4e2a "Hello" \u6d88\u606f\u7ed9\u5b50\u8fdb\u7a0b\uff0c\u5982\u679c\u7236\u8fdb\u7a0b\u65e0\u6cd5\u53d1\u9001\u6d88\u606f\u7ed9\u5b50\u8fdb\u7a0b\uff0c\u5c06\u8ba4\u4e3a\u5b50\u8fdb\u7a0b\u51fa\u73b0\u95ee\u9898\uff0c\u4e8e\u662f\u4f1a\u91cd\u542f\u5b50\u8fdb\u7a0b\u3002')),(0,l.kt)("p",null,"\u4e0b\u56fe\u662f keepalived \u8bbe\u8ba1\u67b6\u6784\u56fe\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"keepalived",src:r(58560).Z,width:"1001",height:"709"})),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Checkers \u7ec4\u4ef6"),"\uff1a\u8d1f\u8d23 RealServer \u7684\u5065\u5eb7\u72b6\u51b5\u68c0\u67e5\uff0c\u5e76\u5728 LVS \u7684\u62d3\u6251\u4e2d\u79fb\u9664\u3001\u6dfb\u52a0 RealServer\u3002\u5b83\u652f\u6301 layer4/5/7 \u5c42\u7684\u534f\u8bae\u68c0\u67e5\u3002\u8be5\u7ec4\u4ef6\u4f7f\u7528\u72ec\u7acb\u7684\u5b50\u8fdb\u7a0b\u8d1f\u8d23\uff0c\u4f46\u88ab\u7236\u8fdb\u7a0b\u76d1\u63a7\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"VRRP \u7ec4\u4ef6"),"\uff1a\u63d0\u4f9b Director \u7684\u6545\u969c\u8f6c\u79fb\u529f\u80fd\u4ece\u800c\u5b9e\u73b0 Director \u7684\u9ad8\u53ef\u7528\u3002\u8be5\u7ec4\u4ef6\u53ef\u72ec\u7acb\u63d0\u4f9b\u529f\u80fd\uff0c\u65e0\u9700 LVS \u7684\u652f\u6301\u3002\u8be5\u7ec4\u4ef6\u4f7f\u7528\u72ec\u7acb\u7684\u5b50\u8fdb\u7a0b\u8d1f\u8d23\uff0c\u4f46\u88ab\u7236\u8fdb\u7a0b\u76d1\u63a7\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"System Call \u7ec4\u4ef6"),"\uff1a\u63d0\u4f9b\u8bfb\u53d6\u81ea\u5b9a\u4e49\u811a\u672c\u7684\u529f\u80fd\u3002\u8be5\u7ec4\u4ef6\u5728\u4f7f\u7528\u65f6\uff0c\u5c06\u4e34\u65f6\u4ea7\u751f\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u6267\u884c\u4efb\u52a1\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"IPVS wrapper \u7ec4\u4ef6"),"\uff1a\u8d1f\u8d23\u5c06\u914d\u7f6e\u6587\u4ef6\u4e2d IPVS \u76f8\u5173\u89c4\u5219\u53d1\u9001\u5230\u5185\u6838\u7684 ipvs \u6a21\u5757\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Netlink Reflector"),"\uff1a\u7528\u6765\u8bbe\u5b9a\u3001\u76d1\u63a7 vrrp \u7684 vip \u5730\u5740\u3002")),(0,l.kt)("h2",{id:"103\u5b89\u88c5-keepalived"},"10.3\u3001\u5b89\u88c5 keepalived"),(0,l.kt)("p",null,"\u4f7f\u7528 keepalived\uff0c\u5b8c\u5168\u53ef\u4ee5 yum \u5b89\u88c5\u3002\u672c\u6587\u4ec5\u7ed9\u51fa\u7f16\u8bd1\u5b89\u88c5\u7684\u65b9\u6cd5\uff0c\u540e\u6587\u7684\u6240\u6709\u914d\u7f6e\u90fd\u4f7f\u7528 yum \u5b89\u88c5\u7684 keepalived\u3002"),(0,l.kt)("p",null,"\u5b98\u65b9\u5404\u7248\u672c\u6e90\u7801\u4e0b\u8f7d\u5730\u5740\uff1a",(0,l.kt)("a",{parentName:"p",href:"http://www.keepalived.org/download.html%E3%80%82%E4%BB%A5%E4%B8%8B%E6%98%AF%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"},"http://www.keepalived.org/download.html\u3002\u4ee5\u4e0b\u662f\u7f16\u8bd1\u5b89\u88c5")," keepalived-2.2.4 \u7248\u672c\u7684\u8fc7\u7a0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[root@director ~]# wget --no-check-certificate https://www.keepalived.org/software/keepalived-2.2.4.tar.gz\n[root@director ~]# yum install gcc libnl3-devel openssl-devel -y\n[root@director ~]# tar xf keepalived-2.2.4.tar.gz \n[root@director ~]# cd keepalived-2.2.4/\n[root@director keepalived-2.2.4]# ./configure --prefix=/usr/local/keepalived-2.2.4\n[root@director keepalived-2.2.4]# make && make install\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5176\u4e2d ",(0,l.kt)("inlineCode",{parentName:"li"},"./configure")," \u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"--with-kernel-dir")," \u662f\u5728\u7ba1\u7406 LVS \u65f6\u9700\u8981\u4f7f\u7528\u7684\uff0c\u5982\u679c\u4e0d\u7528\u914d\u5408 LVS\uff0c\u5219\u53ef\u4ee5\u4e0d\u7528\u6b64\u9009\u9879\u3002")),(0,l.kt)("p",null,"\u518d\u505a\u4e00\u4e0b\u7f16\u8bd1\u5b89\u88c5\u7684\u89c4\u8303\u884c\u4e3a\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'[root@director ~]# ln -sv /usr/local/keepalived-2.2.4/ /usr/local/keepalived\n\u2018/usr/local/keepalived\u2019 -> \u2018/usr/local/keepalived-2.2.4/\u2019\n[root@director ~]# echo "MANPATH /usr/local/keepalived/share/man" >>/etc/man.config\n[root@director ~]# echo "export PATH=/usr/local/keepalived/sbin:$PATH" > /etc/profile.d/keepalived.sh\n[root@director ~]# chmod +x /etc/profile.d/keepalived.sh\n[root@director ~]# . /etc/profile.d/keepalived.sh\n[root@director ~]#\n')),(0,l.kt)("p",null,"\u7f16\u8bd1\u5b89\u88c5\u540e\uff0c\u5728\u5b89\u88c5\u76ee\u5f55\u4e0b\u751f\u6210\u4ee5\u4e0b\u4e00\u4e9b\u76ee\u5f55\uff0c\u5176\u4e2d keepalived \u7a0b\u5e8f\u5728 sbin \u76ee\u5f55\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[root@director ~]# tree /usr/local/keepalived -d\n/usr/local/keepalived\n\u251c\u2500\u2500 bin\n\u251c\u2500\u2500 etc\n\u2502   \u251c\u2500\u2500 keepalived\n\u2502   \u2502   \u2514\u2500\u2500 samples\n\u2502   \u2514\u2500\u2500 sysconfig\n\u251c\u2500\u2500 sbin\n\u2514\u2500\u2500 share\n    \u251c\u2500\u2500 doc\n    \u2502   \u2514\u2500\u2500 keepalived\n    \u251c\u2500\u2500 man\n    \u2502   \u251c\u2500\u2500 man1\n    \u2502   \u251c\u2500\u2500 man5\n    \u2502   \u2514\u2500\u2500 man8\n    \u2514\u2500\u2500 snmp\n        \u2514\u2500\u2500 mibs\n\n15 directories\n[root@director ~]#\n")),(0,l.kt)("p",null,"\u5728 etc \u76ee\u5f55\u4e0b\uff0c\u6709\u914d\u7f6e\u6587\u4ef6\u548c\u5927\u91cf\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\uff0c\u800c\u4e14\u81ea\u52a8\u751f\u6210\u4e86 keepalived systemd \u670d\u52a1\u6587\u4ef6\uff0c\u53ef\u4ee5\u76f4\u63a5\u542f\u52a8 keepalived \u670d\u52a1\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[root@director ~]# mkdir /etc/keepalived\n[root@director ~]# cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived\n[root@director ~]# systemctl start keepalived\n[root@director ~]# systemctl status keepalived\n\u25cf keepalived.service - LVS and VRRP High Availability Monitor\n   Loaded: loaded (/usr/lib/systemd/system/keepalived.service; disabled; vendor preset: disabled)\n   Active: active (running) since Thu 2022-01-06 16:31:19 CST; 5s ago\n     Docs: man:keepalived(8)\n           man:keepalived.conf(5)\n           man:genhash(1)\n           https://keepalived.org\n  Process: 13858 ExecStart=/usr/local/keepalived-2.2.4/sbin/keepalived $KEEPALIVED_OPTIONS (code=exited, status=0/SUCCESS)\n Main PID: 13859 (keepalived)\n   CGroup: /system.slice/keepalived.service\n           \u251c\u250013859 /usr/local/keepalived-2.2.4/sbin/keepalived -D\n           \u251c\u250013860 /usr/local/keepalived-2.2.4/sbin/keepalived -D\n           \u2514\u250013861 /usr/local/keepalived-2.2.4/sbin/keepalived -D\n\nJan 06 16:31:23 director Keepalived_vrrp[13861]: Sending gratuitous ARP on eth0 for 192.168.200.16\nJan 06 16:31:23 director Keepalived_vrrp[13861]: Sending gratuitous ARP on eth0 for 192.168.200.17\nJan 06 16:31:23 director Keepalived_vrrp[13861]: Sending gratuitous ARP on eth0 for 192.168.200.18\nJan 06 16:31:24 director Keepalived_healthcheckers[13860]: HTTP_CHECK on service [192.168.200.4]:t...s.\nJan 06 16:31:24 director Keepalived_healthcheckers[13860]: Removing service [192.168.200.4]:tcp:13...58\nJan 06 16:31:24 director Keepalived_healthcheckers[13860]: Remote SMTP server [192.168.200.1]:25 c...d.\nJan 06 16:31:25 director Keepalived_healthcheckers[13860]: HTTP_CHECK on service [192.168.201.100]...s.\nJan 06 16:31:25 director Keepalived_healthcheckers[13860]: Removing service [192.168.201.100]:tcp:...43\nJan 06 16:31:25 director Keepalived_healthcheckers[13860]: Lost quorum 1-0=1 > 0 for VS [192.168.2...43\nJan 06 16:31:25 director Keepalived_healthcheckers[13860]: Remote SMTP server [192.168.200.1]:25 c...d.\nHint: Some lines were ellipsized, use -l to show in full.\n[root@director ~]#\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6ce8\u610f\uff0c\u542f\u52a8 keepalived \u670d\u52a1\u9700\u8981 keepalived.conf \u914d\u7f6e\u6587\u4ef6\uff0c\u624b\u52a8\u62f7\u8d1d\u8fc7\u53bb\u5373\u53ef\u3002")),(0,l.kt)("h2",{id:"104\u914d\u7f6e-keepalived-\u65e5\u5fd7"},"10.4\u3001\u914d\u7f6e keepalived \u65e5\u5fd7"),(0,l.kt)("p",null,"\u9ed8\u8ba4 keeepalived \u7684\u65e5\u5fd7\u4f1a\u8bb0\u5f55\u5230 /var/log/messages \u4e2d\u3002\u53ef\u4ee5\u914d\u7f6e keepalived \u4f7f\u5176\u8bb0\u5f55\u5230\u5176\u5b83\u6587\u4ef6\u4e2d\u3002"),(0,l.kt)("p",null,"\u5148\u5c06\u7f16\u8bd1\u5b89\u88c5\u751f\u6210\u7684 /usr/local/keepalived-2.2.4/etc/sysconfig/keepalived \u4fee\u6539\u4e00\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'# \u8fd9\u662f\u539f\u5185\u5bb9\n[root@director ~]# cat /usr/local/keepalived-2.2.4/etc/sysconfig/keepalived\n# Options for keepalived. See `keepalived --help\' output and keepalived(8) and\n# keepalived.conf(5) man pages for a list of all options. Here are the most\n# common ones :\n#\n# --vrrp               -P    Only run with VRRP subsystem.\n# --check              -C    Only run with Health-checker subsystem.\n# --dont-release-vrrp  -V    Dont remove VRRP VIPs & VROUTEs on daemon stop.\n# --dont-release-ipvs  -I    Dont remove IPVS topology on daemon stop.\n# --dump-conf          -d    Dump the configuration data.\n# --log-detail         -D    Detailed log messages.\n# --log-facility       -S    0-7 Set local syslog facility (default=LOG_DAEMON)\n#\n\nKEEPALIVED_OPTIONS="-D"\n\n# \u4fee\u6539\u540e\u7684\u5185\u5bb9\n[root@director ~]# cat /usr/local/keepalived-2.2.4/etc/sysconfig/keepalived | grep -v "^#"\n\nKEEPALIVED_OPTIONS="-D -S 0"\n')),(0,l.kt)("p",null,"\u4e0a\u9762\u914d\u7f6e\u4f7f\u7528 local0 \u8fd9\u4e2a\u8bbe\u5907\u6765\u8bb0\u5f55\u65e5\u5fd7\uff0c\u56e0\u6b64\u53bb\u4fee\u6539 rsyslog \u7684\u914d\u7f6e\u6587\u4ef6 /etc/rsyslog.conf\uff0c\u6dfb\u52a0\u8be5\u8bbe\u5907\u8bb0\u5f55\u65e5\u5fd7\u7684\u7ea7\u522b\u548c\u8def\u5f84\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# Keepalived log config\nlocal0.*                           /var/log/keepalived.log\n")),(0,l.kt)("p",null,"\u518d\u91cd\u542f rsyslog\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[root@director ~]# systemctl restart rsyslog\n")),(0,l.kt)("h2",{id:"105keepalived-\u914d\u7f6e\u6587\u4ef6\u8be6\u89e3"},"10.5\u3001keepalived \u914d\u7f6e\u6587\u4ef6\u8be6\u89e3"),(0,l.kt)("p",null,"keepalived \u914d\u7f6e\u6587\u4ef6\u6309",(0,l.kt)("strong",{parentName:"p"},"\u5c42\u7ea7"),"\u548c",(0,l.kt)("strong",{parentName:"p"},"\u6a21\u5757"),'\u5212\u5206\u7684\uff0c\u6bcf\u5c42\u7531 "{ }" \u6765\u754c\u5b9a\u3002 \u5728\u4e3b\u914d\u7f6e\u6587\u4ef6\u4e2d\u53ef\u4ee5\u901a\u8fc7 ',(0,l.kt)("strong",{parentName:"p"},"include")," \u6765\u6db5\u76d6\u591a\u4e2a\u5b50\u914d\u7f6e\u6587\u4ef6\u3002\u914d\u7f6e\u6587\u4ef6\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u6a21\u5757\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"GLOBAL CONFIGURATION")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"VRRPD CONFIGURATION")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"LVS CONFIGURATION")),(0,l.kt)("li",{parentName:"ul"},"BFD CONFIGURATION(\u4ece\u672a\u7528\u8fc7)")),(0,l.kt)("h3",{id:"1051\u5168\u5c40\u914d\u7f6e\u6a21\u5757"},"10.5.1\u3001\u5168\u5c40\u914d\u7f6e\u6a21\u5757"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"! Configuration File for keepalived\nglobal_defs {                                   # \u5168\u5c40\u5b9a\u4e49\u90e8\u5206\n    notification_email {                        # \u8bbe\u7f6e\u62a5\u8b66\u90ae\u4ef6\u5730\u5740\uff0c\u53ef\u8bbe\u7f6e\u591a\u4e2a\n        acassen@firewall.loc                    # \u63a5\u6536\u901a\u77e5\u7684\u90ae\u4ef6\u5730\u5740\n        failover@firewall.loc\n    }                      \n    notification_email_from test0@163.com       # \u8bbe\u7f6e \u53d1\u9001\u90ae\u4ef6\u901a\u77e5\u7684\u5730\u5740\n    smtp_server smtp.163.com                    # \u8bbe\u7f6e smtp server \u5730\u5740\uff0c\u53ef\u662fip\u6216\u57df\u540d.\u53ef\u9009\u7aef\u53e3\u53f7\uff08\u9ed8\u8ba425\uff09\n    smtp_connect_timeout 30                     # \u8bbe\u7f6e \u8fde\u63a5 smtp server\u7684\u8d85\u65f6\u65f6\u95f4\n    router_id LVS_DEVEL                         # \u4e3b\u673a\u6807\u8bc6\uff0c\u7528\u4e8e\u90ae\u4ef6\u901a\u77e5\n    vrrp_strict                                 # \u4e25\u683c\u6267\u884cVRRP\u534f\u8bae\u89c4\u8303\uff0c\u6b64\u6a21\u5f0f\u4e0d\u652f\u6301\u8282\u70b9\u5355\u64ad\n    script_user keepalived_script               # \u6307\u5b9a\u8fd0\u884c\u811a\u672c\u7684\u7528\u6237\u540d\u548c\u7ec4\u3002\u9ed8\u8ba4\u4f7f\u7528\u7528\u6237\u7684\u9ed8\u8ba4\u7ec4\u3002\n                                                # \u5982\u672a\u6307\u5b9a\uff0c\u9ed8\u8ba4\u4e3akeepalived_script \u7528\u6237\uff0c\u5982\u65e0\u6b64\u7528\u6237\uff0c\u5219\u4f7f\u7528root\n    enable_script_security                      # \u5982\u8fc7\u8def\u5f84\u4e3a\u975eroot\u53ef\u5199\uff0c\u4e0d\u8981\u914d\u7f6e\u811a\u672c\u4e3aroot\u7528\u6237\u6267\u884c\u3002\n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u53ef\u7528\u53c2\u6570\u8bf4\u660e"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"default_interface eth0:   \u8bbe\u7f6e\u9759\u6001\u5730\u5740\u9ed8\u8ba4\u7ed1\u5b9a\u7684\u7aef\u53e3\u3002\u9ed8\u8ba4\u662feth0\u3002\n\n# \u8bbe\u7f6eLVS\u540c\u6b65\u670d\u52a1\u7684\u76f8\u5173\u5185\u5bb9\u3002\u53ef\u4ee5\u540c\u6b65LVS\u7684\u72b6\u6001\u4fe1\u606f\u3002\nlvs_sync_daemon   [id ] [maxlen ] [port ] [ttl ] [group ]\nINTERFACE:          \u6307\u5b9a\u540c\u6b65\u670d\u52a1\u7ed1\u5b9a\u7684\u63a5\u53e3\u3002\n  VRRP_INSTANCE:    \u6307\u5b9a\u540c\u6b65\u670d\u52a1\u7ed1\u5b9a\u7684VRRP\u5b9e\u4f8b\u3002\n  id :     \u6307\u5b9a\u540c\u6b65\u670d\u52a1\u6240\u4f7f\u7528\u7684SYNCID\uff0c\u53ea\u6709\u76f8\u540c\u7684SYNCID\u624d\u4f1a\u540c\u6b65\u3002\u8303\u56f4\u662f0-255.\n  maxlen:           \u6307\u5b9a\u6570\u636e\u5305\u7684\u6700\u5927\u957f\u5ea6\u3002\u8303\u56f4\u662f1-65507\n  port:             \u6307\u5b9a\u540c\u6b65\u6240\u4f7f\u7528\u7684UDP\u7aef\u53e3\u3002\n  group:            \u6307\u5b9a\u7ec4\u64adIP\u5730\u5740\u3002\n\nlvs_flush:                                \u5728keepalived\u542f\u52a8\u65f6\uff0c\u5237\u65b0\u6240\u6709\u5df2\u7ecf\u5b58\u5728\u7684LVS\u914d\u7f6e\u3002\nvrrp_garp_master_delay 10:                \u5f53\u8f6c\u6362\u4e3aMASTER\u72b6\u6001\u65f6\uff0c\u5ef6\u8fdf\u591a\u5c11\u79d2\u53d1\u9001\u7b2c\u4e8c\u7ec4\u7684\u514d\u8d39ARP\u3002\u9ed8\u8ba4\u4e3a5s\uff0c0\u8868\u793a\u4e0d\u53d1\u9001\u7b2c\u4e8c\u7ec4\u514d\u7684\u514d\u8d39ARP\u3002\nvrrp_garp_master_repeat 1:                \u5f53\u8f6c\u6362\u4e3aMASTER\u72b6\u6001\u65f6\uff0c\u5728\u4e00\u7ec4\u4e2d\u4e00\u6b21\u53d1\u9001\u7684\u514d\u8d39ARP\u6570\u91cf\u3002\u9ed8\u8ba4\u662f5.\nvrrp_garp_lower_prio_delay 10:            \u5f53MASTER\u6536\u5230\u66f4\u4f4e\u4f18\u5148\u7ea7\u7684\u901a\u544a\u65f6\uff0c\u5ef6\u8fdf\u591a\u5c11\u79d2\u53d1\u9001\u7b2c\u4e8c\u7ec4\u7684\u514d\u8d39ARP\u3002\nvrrp_garp_lower_prio_repeat 1:            \u5f53MASTER\u6536\u5230\u66f4\u4f4e\u4f18\u5148\u7ea7\u7684\u901a\u544a\u65f6\uff0c\u5728\u4e00\u7ec4\u4e2d\u4e00\u6b21\u53d1\u9001\u7684\u514d\u8d39ARP\u6570\u91cf\u3002\nvrrp_garp_master_refresh 60:              \u5f53keepalived\u6210\u4e3aMASTER\u4ee5\u540e\uff0c\u5237\u65b0\u514d\u8d39ARP\u7684\u6700\u5c0f\u65f6\u95f4\u95f4\u9694(\u4f1a\u518d\u6b21\u53d1\u9001\u514d\u8d39ARP)\u3002\u9ed8\u8ba4\u662f0\uff0c\u8868\u793a\u4e0d\u4f1a\u5237\u65b0\u3002\nvrrp_garp_master_refresh_repeat 2:        \u5f53keepalived\u6210\u4e3aMASTER\u4ee5\u540e\uff0c\u6bcf\u6b21\u5237\u65b0\u4f1a\u53d1\u9001\u591a\u5c11\u4e2a\u514d\u8d39ARP\u3002\u9ed8\u8ba4\u662f1.\nvrrp_garp_interval 0.001:                 \u5728\u4e00\u4e2a\u63a5\u53e3\u53d1\u9001\u7684\u4e24\u4e2a\u514d\u8d39ARP\u4e4b\u95f4\u7684\u5ef6\u8fdf\u3002\u53ef\u4ee5\u7cbe\u786e\u5230\u6beb\u79d2\u7ea7\u3002\u9ed8\u8ba4\u662f0.\nvrrp_lower_prio_no_advert true|false:     \u9ed8\u8ba4\u662ffalse\u3002\u5982\u679c\u6536\u5230\u4f4e\u4f18\u5148\u7ea7\u7684\u901a\u544a\uff0c\u4e0d\u53d1\u9001\u4efb\u4f55\u901a\u544a\u3002\nvrrp_version 2|3:                         \u8bbe\u7f6e\u9ed8\u8ba4\u7684VRRP\u7248\u672c\u3002\u9ed8\u8ba4\u662f2.\nvrrp_check_unicast_src:                   \u5728\u5355\u64ad\u6a21\u5f0f\u4e2d\uff0c\u5f00\u542f\u5bf9VRRP\u6570\u636e\u5305\u7684\u6e90\u5730\u5740\u505a\u68c0\u67e5\uff0c\u6e90\u5730\u5740\u5fc5\u987b\u662f\u5355\u64ad\u90bb\u5c45\u4e4b\u4e00\u3002\nvrrp_skip_check_adv_addr:                 \u9ed8\u8ba4\u662f\u4e0d\u8df3\u8fc7\u68c0\u67e5\u3002\u68c0\u67e5\u6536\u5230\u7684VRRP\u901a\u544a\u4e2d\u7684\u6240\u6709\u5730\u5740\u53ef\u80fd\u4f1a\u6bd4\u8f83\u8017\u65f6\u3002\n                                        \u8bbe\u7f6e\u6b64\u547d\u4ee4\u7684\u610f\u601d\u662f\uff0c\u5982\u679c\u901a\u544a\u4e0e\u63a5\u6536\u7684\u4e0a\u4e00\u4e2a\u901a\u544a\u6765\u81ea\u76f8\u540c\u7684master\u8def\u7531\u5668\uff0c\u5219\u4e0d\u6267\u884c\u68c0\u67e5(\u8df3\u8fc7\u68c0\u67e5)\u3002\n\nvrrp_strict:                              \u4e25\u683c\u9075\u5b88VRRP\u534f\u8bae\u3002\n                                        \u4e0b\u5217\u60c5\u51b5\u5c06\u4f1a\u963b\u6b62\u542f\u52a8Keepalived\uff1a1. \u6ca1\u6709VIP\u5730\u5740\u30022. \u5355\u64ad\u90bb\u5c45\u30023. \u5728VRRP\u7248\u672c2\u4e2d\u6709IPv6\u5730\u5740\u3002\n\nvrrp_iptables:                            \u4e0d\u6dfb\u52a0\u4efb\u4f55iptables\u89c4\u5219\u3002\u9ed8\u8ba4\u662f\u6dfb\u52a0iptables\u89c4\u5219\u7684\u3002\n\n# \u5982\u679cvrrp\u8fdb\u7a0b\u6216check\u8fdb\u7a0b\u8d85\u65f6\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u76844\u4e2a\u9009\u9879\u3002\n# \u53ef\u4ee5\u4f7f\u5904\u4e8eBACKUP\u72b6\u6001\u7684VRRP\u5b9e\u4f8b\u53d8\u6210MASTER\u72b6\u6001\uff0c\u5373\u4f7fMASTER\u5b9e\u4f8b\u4f9d\u7136\u5728\u8fd0\u884c\u3002\n# \u56e0\u4e3aMASTER\u6216BACKUP\u7cfb\u7edf\u6bd4\u8f83\u6162\uff0c\u4e0d\u80fd\u53ca\u65f6\u5904\u7406VRRP\u6570\u636e\u5305\u3002\nvrrp_priority <-20 -- 19>:                \u8bbe\u7f6eVRRP\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u3002\nchecker_priority <-20 -- 19>:             \u8bbe\u7f6echecker\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u3002\nvrrp_no_swap:                             vrrp\u8fdb\u7a0b\u4e0d\u80fd\u591f\u88ab\u4ea4\u6362\u3002\nchecker_no_swap:                          checker\u8fdb\u7a0b\u4e0d\u80fd\u591f\u88ab\u4ea4\u6362\u3002\n\nscript_user  [groupname]:       \u8bbe\u7f6e\u8fd0\u884c\u811a\u672c\u9ed8\u8ba4\u7528\u6237\u548c\u7ec4\u3002\n                                        \u5982\u679c\u6ca1\u6709\u6307\u5b9a\uff0c\u5219\u9ed8\u8ba4\u7528\u6237\u4e3akeepalived_script(\u9700\u8981\u8be5\u7528\u6237\u5b58\u5728)\uff0c\u5426\u5219\u4e3aroot\u7528\u6237\u3002\n                                        \u9ed8\u8ba4groupname\u540cusername\u3002\n\nenable_script_security:                   \u5982\u679c\u811a\u672c\u8def\u5f84\u7684\u4efb\u4e00\u90e8\u5206\u5bf9\u4e8e\u975eroot\u7528\u6237\u6765\u8bf4\uff0c\u90fd\u5177\u6709\u53ef\u5199\u6743\u9650\uff0c\u5219\u4e0d\u4f1a\u4ee5root\u8eab\u4efd\u8fd0\u884c\u811a\u672c\u3002\nnopreempt:                                \u9ed8\u8ba4\u662f\u62a2\u5360\u6a21\u5f0f \u8981\u662f\u7528\u975e\u62a2\u5360\u5f0f\u7684\u5c31\u52a0\u4e0anopreempt\n")))),(0,l.kt)("h3",{id:"1052vrrpd-\u914d\u7f6e\u6a21\u5757"},"10.5.2\u3001VRRPD \u914d\u7f6e\u6a21\u5757"),(0,l.kt)("p",null,"VRRPD \u7684\u914d\u7f6e\u5305\u62ec\u5982\u4e0b\u5b50\u5757\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"vrrp","_","script"),(0,l.kt)("li",{parentName:"ol"},"vrrp","_","sync","_","group"),(0,l.kt)("li",{parentName:"ol"},"garp","_","group"),(0,l.kt)("li",{parentName:"ol"},"vrrp","_","instance")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"vrrp","_","script \u914d\u7f6e")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'# \u6dfb\u52a0\u4e00\u4e2a\u5468\u671f\u6027\u6267\u884c\u7684\u811a\u672c\u3002\u811a\u672c\u7684\u9000\u51fa\u72b6\u6001\u7801\u4f1a\u88ab\u8c03\u7528\u5b83\u7684\u6240\u6709\u7684VRRP Instance\u8bb0\u5f55\u3002\n# \u81f3\u5c11\u6709\u4e00\u4e2aVRRP\u5b9e\u4f8b\u8c03\u7528\u5b83\u5e76\u4e14\u4f18\u5148\u7ea7\u4e0d\u80fd\u4e3a0.\u4f18\u5148\u7ea7\u8303\u56f4\u662f1-254.\nvrrp_script <SCRIPT_NAME> {\n          ...\n    }\n\n\u9009\u9879\u8bf4\u660e\uff1a\nscript "/path/to/somewhere":  \u6307\u5b9a\u8981\u6267\u884c\u7684\u811a\u672c\u7684\u8def\u5f84\u3002\ninterval <INTEGER>:               \u6307\u5b9a\u811a\u672c\u6267\u884c\u7684\u95f4\u9694\u3002\u5355\u4f4d\u662f\u79d2\u3002\u9ed8\u8ba4\u4e3a1s\u3002\ntimeout <INTEGER>:                \u6307\u5b9a\u5728\u591a\u5c11\u79d2\u540e\uff0c\u811a\u672c\u88ab\u8ba4\u4e3a\u6267\u884c\u5931\u8d25\u3002\nweight <-254 --- 254>:            \u8c03\u6574\u4f18\u5148\u7ea7\u3002\u9ed8\u8ba4\u4e3a2.\nrise <INTEGER>:                   \u6267\u884c\u6210\u529f\u591a\u5c11\u6b21\u624d\u8ba4\u4e3a\u662f\u6210\u529f\u3002\nfall <INTEGER>:                   \u6267\u884c\u5931\u8d25\u591a\u5c11\u6b21\u624d\u8ba4\u4e3a\u5931\u8d25\u3002\nuser <USERNAME> [GROUPNAME]:  \u8fd0\u884c\u811a\u672c\u7684\u7528\u6237\u548c\u7ec4\u3002\ninit_fail:                      \u5047\u8bbe\u811a\u672c\u521d\u59cb\u72b6\u6001\u662f\u5931\u8d25\u72b6\u6001\u3002\n\n\u89e3\u91ca weight\uff1a \n1. \u5982\u679c\u811a\u672c\u6267\u884c\u6210\u529f(\u9000\u51fa\u72b6\u6001\u7801\u4e3a0)\uff0cweight\u5927\u4e8e0\uff0c\u5219priority\u589e\u52a0\u3002\n2. \u5982\u679c\u811a\u672c\u6267\u884c\u5931\u8d25(\u9000\u51fa\u72b6\u6001\u7801\u4e3a\u975e0)\uff0cweight\u5c0f\u4e8e0\uff0c\u5219priority\u51cf\u5c11\u3002\n3. \u5176\u4ed6\u60c5\u51b5\u4e0b\uff0cpriority\u4e0d\u53d8\u3002\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"vrrp","_","instance")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"\u547d\u4ee4\u8bf4\u660e\uff1a\nstate MASTER|BACKUP:            \u6307\u5b9a\u8be5keepalived\u8282\u70b9\u7684\u521d\u59cb\u72b6\u6001\u3002\ninterface eth0:                 vrrp\u5b9e\u4f8b\u7ed1\u5b9a\u7684\u63a5\u53e3\uff0c\u7528\u4e8e\u53d1\u9001VRRP\u5305\u3002\nuse_vmac [<VMAC_INTERFACE>]:  \u5728\u6307\u5b9a\u7684\u63a5\u53e3\u4ea7\u751f\u4e00\u4e2a\u5b50\u63a5\u53e3\uff0c\u5982vrrp.51\uff0c\u8be5\u63a5\u53e3\u7684MAC\u5730\u5740\u4e3a\u7ec4\u64ad\u5730\u5740\uff0c\u901a\u8fc7\u8be5\u63a5\u53e3\u5411\u5916\u53d1\u9001\u548c\u63a5\u6536VRRP\u5305\u3002\nvmac_xmit_base:                 \u901a\u8fc7\u57fa\u672c\u63a5\u53e3\u5411\u5916\u53d1\u9001\u548c\u63a5\u6536VRRP\u6570\u636e\u5305\uff0c\u800c\u4e0d\u662f\u901a\u8fc7VMAC\u63a5\u53e3\u3002\nnative_ipv6:                    \u5f3a\u5236VRRP\u5b9e\u4f8b\u4f7f\u7528IPV6.(\u5f53\u540c\u65f6\u914d\u7f6e\u4e86IPV4\u548cIPV6\u7684\u65f6\u5019)\ndont_track_primary:             \u5ffd\u7565VRRP\u63a5\u53e3\u7684\u9519\u8bef\uff0c\u9ed8\u8ba4\u662f\u6ca1\u6709\u914d\u7f6e\u7684\u3002\n\n# \u5982\u679ctrack\u7684\u63a5\u53e3\u6709\u4efb\u4f55\u4e00\u4e2a\u51fa\u73b0\u6545\u969c\uff0c\u90fd\u4f1a\u8fdb\u5165FAULT\u72b6\u6001\u3002\ntrack_interface {\n  eth0\n  eth1 weight <-254-254>\n  ...\n}\n\n# \u6dfb\u52a0\u4e00\u4e2atrack\u811a\u672c(vrrp_script\u914d\u7f6e\u7684\u811a\u672c\u3002)\ntrack_script {\n  <SCRIPT_NAME>\n  <SCRIPT_NAME> weight <-254-254>\n}\n\nmcast_src_ip <IPADDR>:            \u6307\u5b9a\u53d1\u9001\u7ec4\u64ad\u6570\u636e\u5305\u7684\u6e90IP\u5730\u5740\u3002\u9ed8\u8ba4\u662f\u7ed1\u5b9aVRRP\u5b9e\u4f8b\u7684\u63a5\u53e3\u7684\u4e3bIP\u5730\u5740\u3002\nunicast_src_ip <IPADDR>:      \u6307\u5b9a\u53d1\u9001\u5355\u8584\u6570\u636e\u5305\u7684\u6e90IP\u5730\u5740\u3002\u9ed8\u8ba4\u662f\u7ed1\u5b9aVRRP\u5b9e\u4f8b\u7684\u63a5\u53e3\u7684\u4e3bIP\u5730\u5740\u3002\nversion 2|3:                    \u6307\u5b9a\u8be5\u5b9e\u4f8b\u6240\u4f7f\u7528\u7684VRRP\u7248\u672c\u3002\n\n# \u91c7\u7528\u5355\u64ad\u7684\u65b9\u5f0f\u53d1\u9001VRRP\u901a\u544a\uff0c\u6307\u5b9a\u5355\u64ad\u90bb\u5c45\u7684IP\u5730\u5740\u3002\nunicast_peer {\n   <IPADDR>\n   ...\n}\n\nvirtual_router_id 51:           \u6307\u5b9aVRRP\u5b9e\u4f8bID\uff0c\u8303\u56f4\u662f0-255.\npriority 100:                   \u6307\u5b9a\u4f18\u5148\u7ea7\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684\u5c06\u6210\u4e3aMASTER\u3002\nadvert_int 1:                   \u6307\u5b9a\u53d1\u9001VRRP\u901a\u544a\u7684\u95f4\u9694\u3002\u5355\u4f4d\u662f\u79d2\u3002\nauthentication {\n  auth_type PASS|AH:            \u6307\u5b9a\u8ba4\u8bc1\u65b9\u5f0f\u3002PASS\u7b80\u5355\u5bc6\u7801\u8ba4\u8bc1(\u63a8\u8350),AH:IPSEC\u8ba4\u8bc1(\u4e0d\u63a8\u8350)\u3002\n  auth_pass 1234:               \u6307\u5b9a\u8ba4\u8bc1\u6240\u4f7f\u7528\u7684\u5bc6\u7801\u3002\u6700\u591a8\u4f4d\u3002\n}\n\n# \u6307\u5b9aVIP\u5730\u5740\u3002\nvirtual_ipaddress {\n   <IPADDR>/<MASK> brd <IPADDR> dev <STRING> scope <SCOPE> label <LABEL>\n   192.168.200.17/24 dev eth1\n   192.168.200.18/24 dev eth2 label eth2:1\n}\n\nnopreempt:      \u8bbe\u7f6e\u4e3a\u4e0d\u62a2\u5360\u3002\u9ed8\u8ba4\u662f\u62a2\u5360\u7684\uff0c\u5f53\u9ad8\u4f18\u5148\u7ea7\u7684\u673a\u5668\u6062\u590d\u540e\uff0c\u4f1a\u62a2\u5360\u4f4e\u4f18\u5148\u7ea7\u7684\u673a\u5668\u6210\u4e3aMASTER\u3002\n                \u800c\u4e0d\u62a2\u5360\uff0c\u5219\u5141\u8bb8\u4f4e\u4f18\u5148\u7ea7\u7684\u673a\u5668\u7ee7\u7eed\u6210\u4e3aMASTER\uff0c\u5373\u4f7f\u9ad8\u4f18\u5148\u7ea7\u7684\u673a\u5668\u5df2\u7ecf\u4e0a\u7ebf\u3002\n                \u5982\u679c\u8981\u4f7f\u7528\u8fd9\u4e2a\u529f\u80fd\uff0c\u5219\u521d\u59cb\u5316\u72b6\u6001\u5fc5\u987b\u4e3aBACKUP\u3002\n\npreempt_delay:  \u8bbe\u7f6e\u62a2\u5360\u5ef6\u8fdf\u3002\u5355\u4f4d\u662f\u79d2\uff0c\u8303\u56f4\u662f0---1000\uff0c\u9ed8\u8ba4\u662f0.\u53d1\u73b0\u4f4e\u4f18\u5148\u7ea7\u7684MASTER\u540e\u591a\u5c11\u79d2\u5f00\u59cb\u62a2\u5360\u3002\n\n\u901a\u77e5\u811a\u672c\uff1a\nnotify_master <STRING>|<QUOTED-STRING> [username [groupname]]\nnotify_backup <STRING>|<QUOTED-STRING> [username [groupname]]\nnotify_fault <STRING>|<QUOTED-STRING> [username [groupname]]\nnotify <STRING>|<QUOTED-STRING> [username [groupname]]\n\n# \u5f53\u505c\u6b62VRRP\u65f6\u6267\u884c\u7684\u811a\u672c\u3002\nnotify_stop <STRING>|<QUOTED-STRING> [username [groupname]]\nsmtp_alert\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"vrrp","_","sync","_","group")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'# \u4f5c\u7528\uff1a\u5c06\u6240\u6709\u76f8\u5173\u7684VRRP\u5b9e\u4f8b\u5b9a\u4e49\u5728\u4e00\u8d77\uff0c\u4f5c\u4e3a\u4e00\u4e2aVRRP Group\uff0c\u5982\u679c\u7ec4\u5185\u7684\u4efb\u610f\u4e00\u4e2a\u5b9e\u4f8b\u51fa\u73b0\u95ee\u9898\uff0c\u90fd\u53ef\u4ee5\u5b9e\u73b0Failover\u3002\n vrrp_sync_group VG_1 {\n    group {\n     inside_network     # vrrp instance name\n     outside_network    # vrrp instance name\n     ...\n    }\n    ...\n}\n\n# \u6ce8\u610f\uff1a\u811a\u672c\u6587\u4ef6\u8981\u52a0\u4e0ax\u6743\u9650\uff0c\u540c\u65f6\u6307\u4ee4\u6700\u597d\u5199\u7edd\u5bf9\u8def\u5f84\u3002\n# \u8bf4\u660e\uff1a\u5982\u679cusername\u548cgroupname\u6ca1\u6709\u6307\u5b9a\uff0c\u5219\u4ee5\u9ed8\u8ba4\u7684script_user\u6240\u6307\u5b9a\u7684\u7528\u6237\u548c\u7ec4\u3002\n\n# \u4f5c\u7528\uff1a\u5f53\u6210\u4e3aMASTER\u65f6\uff0c\u4ee5\u6307\u5b9a\u7684\u7528\u6237\u548c\u7ec4\u6267\u884c\u811a\u672c\u3002\n1. notify_master /path/to_master.sh [username [groupname]]\n\n# \u4f5c\u7528\uff1a\u5f53\u6210\u4e3aBACKUP\u65f6\uff0c\u4ee5\u6307\u5b9a\u7684\u7528\u6237\u548c\u7ec4\u6267\u884c\u811a\u672c\u3002\n2. notify_backup /path/to_backup.sh [username [groupname]]\n\n# \u4f5c\u7528\uff1a\u5f53\u8be5\u540c\u6b65\u7ec4Fault\u65f6\uff0c\u4ee5\u6307\u5b9a\u7684\u7528\u6237\u548c\u7ec4\u6267\u884c\u811a\u672c\u3002\n3. notify_fault "/path/fault.sh VG_1" [username [groupname]]\n\n# \u4f5c\u7528\uff1a\u5728\u4efb\u4f55\u72b6\u6001\u90fd\u4f1a\u4ee5\u6307\u5b9a\u7684\u7528\u6237\u548c\u7ec4\u6267\u884c\u811a\u672c\u3002\n# \u8bf4\u660e\uff1a\u8be5\u811a\u672c\u4f1a\u5728notify_*\u811a\u672c\u540e\u6267\u884c\u3002\n4. notify /path/notify.sh [username [groupname]]\n    notify \u53ef\u4ee5\u4f7f\u75283\u4e2a\u53c2\u6570\uff0c\u5982\u4e0b\uff1a\n    $1\uff1a\u53ef\u4ee5\u662fGROUP\u6216INTANCE\uff0c\u8868\u660e\u540e\u9762\u662f\u7ec4\u8fd8\u662f\u5b9e\u4f8b\u3002\n    $2\uff1a\u7ec4\u540d\u6216\u5b9e\u4f8b\u540d\u3002\n    $3\uff1a\u8f6c\u6362\u540e\u7684\u76ee\u6807\u72b6\u6001\u3002\u6709\uff1aMASTER\u3001BACKUP\u3001FAULT\u3002\n\n5. smtp_alert:          \u5f53\u72b6\u6001\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u53d1\u9001\u90ae\u4ef6\u3002\n6. global_tracking:     \u6240\u6709\u7684VRRP\u5b9e\u4f8b\u5171\u4eab\u76f8\u540c\u7684tracking\u914d\u7f6e\u3002\n')),(0,l.kt)("h3",{id:"1053lvs-\u914d\u7f6e"},"10.5.3\u3001LVS \u914d\u7f6e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"LVS\u6a21\u5757\u7ed3\u6784\uff1a\n\nvirtual_server{\n    \u2026 ...\n    real_server{\n        \u2026 ...\n    }\n}\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"virtual","_","server")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"virtual_server IP Port | virtual_server fwmark int | virtual_server group string {\n  delay_loop <INT>:                   \u5065\u5eb7\u68c0\u67e5\u7684\u65f6\u95f4\u95f4\u9694\u3002\n  lb_argo rr|wrr|lc|wlc|lblc|sh|dh: LVS\u8c03\u5ea6\u7b97\u6cd5\u3002\n  lb_kind NAT|DR|TUN:               LVS\u6a21\u5f0f\u3002\n  persistence_timeout 360:          \u6301\u4e45\u5316\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2\u3002\u9ed8\u8ba4\u662f6\u5206\u949f\u3002\n  persistence_granularity:          \u6301\u4e45\u5316\u8fde\u63a5\u7684\u9897\u7c92\u5ea6\u3002\n  protocol TCP|UDP|SCTP:            4\u5c42\u534f\u8bae\u3002\n  ha_suspend:                       \u5982\u679cvirtual server\u7684IP\u5730\u5740\u6ca1\u6709\u8bbe\u7f6e\uff0c\u5219\u4e0d\u8fdb\u884c\u540e\u7aef\u670d\u52a1\u5668\u7684\u5065\u5eb7\u68c0\u67e5\u3002\n  virtualhost <STRING>:               \u4e3aHTTP_GET\u548cSSL_GET\u6267\u884c\u8981\u68c0\u67e5\u7684\u865a\u62df\u4e3b\u673a\u3002\u5982virtualhost www.felix.com\n  sorry_server <IPADDR> <PORT>:     \u6dfb\u52a0\u4e00\u4e2a\u5907\u7528\u670d\u52a1\u5668\u3002\u5f53\u6240\u6709\u7684RS\u90fd\u6545\u969c\u65f6\u3002\n  sorry_server_inhibit:             \u5c06inhibit_on_failure\u6307\u4ee4\u5e94\u7528\u4e8esorry_server\u6307\u4ee4\u3002\n\n  alpha:                            \u5728keepalived\u542f\u52a8\u65f6\uff0c\u5047\u8bbe\u6240\u6709\u7684RS\u90fd\u662fdown\uff0c\u4ee5\u53ca\u5065\u5eb7\u68c0\u67e5\u662f\u5931\u8d25\u7684\u3002\n                                    \u6709\u52a9\u4e8e\u9632\u6b62\u542f\u52a8\u65f6\u7684\u8bef\u62a5\u3002\u9ed8\u8ba4\u662f\u7981\u7528\u7684\u3002\n\n  omega:                            \u5728keepalived\u7ec8\u6b62\u65f6\uff0c\u4f1a\u6267\u884cquorum_down\u6307\u4ee4\u6240\u5b9a\u4e49\u7684\u811a\u672c\u3002\n\n  quorum <INT>:                       \u9ed8\u8ba4\u503c1. \u6240\u6709\u7684\u5b58\u6d3b\u7684\u670d\u52a1\u5668\u7684\u603b\u7684\u6700\u5c0f\u6743\u91cd\u3002\n  quorum_up <STRING>:             \u5f53quorum\u589e\u957f\u5230\u6ee1\u8db3quorum\u6240\u5b9a\u4e49\u7684\u503c\u65f6\uff0c\u6267\u884c\u8be5\u811a\u672c\u3002\n  quorum_down <STRING>:               \u5f53quorum\u51cf\u5c11\u5230\u4e0d\u6ee1\u8db3quorum\u6240\u5b9a\u4e49\u7684\u503c\u65f6\uff0c\u6267\u884c\u8be5\u811a\u672c\u3002\n}\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"real","_","server")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"real_server IP Port {\n  weight <INT>:           \u7ed9\u670d\u52a1\u5668\u6307\u5b9a\u6743\u91cd\u3002\u9ed8\u8ba4\u662f1.\n  inhibit_on_failure:   \u5f53\u670d\u52a1\u5668\u5065\u5eb7\u68c0\u67e5\u5931\u8d25\u65f6\uff0c\u5c06\u5176weight\u8bbe\u7f6e\u4e3a0\uff0c\u800c\u4e0d\u662f\u4eceVirtual Server\u4e2d\u79fb\u9664\u3002\n  notify_up <STRING>: \u5f53\u670d\u52a1\u5668\u5065\u5eb7\u68c0\u67e5\u6210\u529f\u65f6\uff0c\u6267\u884c\u7684\u811a\u672c\u3002\n  notify_down <STRING>:   \u5f53\u670d\u52a1\u5668\u5065\u5eb7\u68c0\u67e5\u5931\u8d25\u65f6\uff0c\u6267\u884c\u7684\u811a\u672c\u3002\n  uthreshold <INT>:       \u5230\u8fd9\u53f0\u670d\u52a1\u5668\u7684\u6700\u5927\u8fde\u63a5\u6570\u3002\n  lthreshold <INT>:       \u5230\u8fd9\u53f0\u670d\u52a1\u5668\u7684\u6700\u5c0f\u8fde\u63a5\u6570\u3002\n}\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"real","_","server \u76d1\u63a7\u68c0\u67e5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"HTTP_GET | SSL_GET {\nurl {\n  path <STRING>:          \u6307\u5b9a\u8981\u68c0\u67e5\u7684URL\u7684\u8def\u5f84\u3002\u5982path / or path /mrtg2\n  digest <STRING>:            \u6458\u8981\u3002\u8ba1\u7b97\u65b9\u5f0f\uff1agenhash -s 172.17.100.1 -p 80 -u /index.html\n  status_code <INT>:      \u72b6\u6001\u7801\u3002\n}\nnb_get_retry <INT>:           get\u5c1d\u8bd5\u6b21\u6570\u3002\ndelay_before_retry <INT>: \u5728\u5c1d\u8bd5\u4e4b\u524d\u5ef6\u8fdf\u591a\u957f\u65f6\u95f4\u3002\n\nconnect_ip <IP ADDRESS>:  \u8fde\u63a5\u7684IP\u5730\u5740\u3002\u9ed8\u8ba4\u662freal server\u7684ip\u5730\u5740\u3002\nconnect_port <PORT>:      \u8fde\u63a5\u7684\u7aef\u53e3\u3002\u9ed8\u8ba4\u662freal server\u7684\u7aef\u53e3\u3002\nbindto <IP ADDRESS>:      \u53d1\u8d77\u8fde\u63a5\u7684\u63a5\u53e3\u7684\u5730\u5740\u3002\nbind_port <PORT>:         \u53d1\u8d77\u8fde\u63a5\u7684\u6e90\u7aef\u53e3\u3002\nconnect_timeout <INT>:        \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u3002\u9ed8\u8ba4\u662f5s\u3002\nfwmark <INTEGER>:         \u4f7f\u7528fwmark\u5bf9\u6240\u6709\u51fa\u53bb\u7684\u68c0\u67e5\u6570\u636e\u5305\u8fdb\u884c\u6807\u8bb0\u3002\nwarmup <INT>:             \u6307\u5b9a\u4e00\u4e2a\u968f\u673a\u5ef6\u8fdf\uff0c\u6700\u5927\u4e3aN\u79d2\u3002\u53ef\u9632\u6b62\u7f51\u7edc\u963b\u585e\u3002\u5982\u679c\u4e3a0\uff0c\u5219\u5173\u95ed\u8be5\u529f\u80fd\u3002\n} \n\nTCP_CHECK {\nconnect_ip <IP ADDRESS>:  \u8fde\u63a5\u7684IP\u5730\u5740\u3002\u9ed8\u8ba4\u662freal server\u7684ip\u5730\u5740\u3002\nconnect_port <PORT>:      \u8fde\u63a5\u7684\u7aef\u53e3\u3002\u9ed8\u8ba4\u662freal server\u7684\u7aef\u53e3\u3002\nbindto <IP ADDRESS>:      \u53d1\u8d77\u8fde\u63a5\u7684\u63a5\u53e3\u7684\u5730\u5740\u3002\nbind_port <PORT>:         \u53d1\u8d77\u8fde\u63a5\u7684\u6e90\u7aef\u53e3\u3002\nconnect_timeout <INT>:        \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u3002\u9ed8\u8ba4\u662f5s\u3002\nfwmark <INTEGER>:         \u4f7f\u7528fwmark\u5bf9\u6240\u6709\u51fa\u53bb\u7684\u68c0\u67e5\u6570\u636e\u5305\u8fdb\u884c\u6807\u8bb0\u3002\nwarmup <INT>:             \u6307\u5b9a\u4e00\u4e2a\u968f\u673a\u5ef6\u8fdf\uff0c\u6700\u5927\u4e3aN\u79d2\u3002\u53ef\u9632\u6b62\u7f51\u7edc\u963b\u585e\u3002\u5982\u679c\u4e3a0\uff0c\u5219\u5173\u95ed\u8be5\u529f\u80fd\u3002\nretry <INIT>:             \u91cd\u8bd5\u6b21\u6570\u3002\u9ed8\u8ba4\u662f1\u6b21\u3002\ndelay_before_retry <INT>: \u9ed8\u8ba4\u662f1\u79d2\u3002\u5728\u91cd\u8bd5\u4e4b\u524d\u5ef6\u8fdf\u591a\u5c11\u79d2\u3002\n}\n\nSMTP_CHECK {\nconnect_ip <IP ADDRESS>:  \u8fde\u63a5\u7684IP\u5730\u5740\u3002\u9ed8\u8ba4\u662freal server\u7684ip\u5730\u5740\u3002\nconnect_port <PORT>:      \u8fde\u63a5\u7684\u7aef\u53e3\u3002\u9ed8\u8ba4\u662freal server\u7684\u7aef\u53e3\u3002 \u9ed8\u8ba4\u662f25\u7aef\u53e3\nbindto <IP ADDRESS>:      \u53d1\u8d77\u8fde\u63a5\u7684\u63a5\u53e3\u7684\u5730\u5740\u3002\nbind_port <PORT>:         \u53d1\u8d77\u8fde\u63a5\u7684\u6e90\u7aef\u53e3\u3002\nconnect_timeout <INT>:        \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u3002\u9ed8\u8ba4\u662f5s\u3002\nfwmark <INTEGER>:         \u4f7f\u7528fwmark\u5bf9\u6240\u6709\u51fa\u53bb\u7684\u68c0\u67e5\u6570\u636e\u5305\u8fdb\u884c\u6807\u8bb0\u3002\nwarmup <INT>:             \u6307\u5b9a\u4e00\u4e2a\u968f\u673a\u5ef6\u8fdf\uff0c\u6700\u5927\u4e3aN\u79d2\u3002\u53ef\u9632\u6b62\u7f51\u7edc\u963b\u585e\u3002\u5982\u679c\u4e3a0\uff0c\u5219\u5173\u95ed\u8be5\u529f\u80fd\u3002\n\nretry <INT>:              \u91cd\u8bd5\u6b21\u6570\u3002\ndelay_before_retry <INT>: \u5728\u91cd\u8bd5\u4e4b\u524d\u5ef6\u8fdf\u591a\u5c11\u79d2\u3002\nhelo_name <STRING>:           \u7528\u4e8eSMTP HELO\u8bf7\u6c42\u7684\u5b57\u7b26\u4e32\u3002\n}\n\nDNS_CHECK {\nconnect_ip <IP ADDRESS>:  \u8fde\u63a5\u7684IP\u5730\u5740\u3002\u9ed8\u8ba4\u662freal server\u7684ip\u5730\u5740\u3002\nconnect_port <PORT>:      \u8fde\u63a5\u7684\u7aef\u53e3\u3002\u9ed8\u8ba4\u662freal server\u7684\u7aef\u53e3\u3002 \u9ed8\u8ba4\u662f25\u7aef\u53e3\nbindto <IP ADDRESS>:      \u53d1\u8d77\u8fde\u63a5\u7684\u63a5\u53e3\u7684\u5730\u5740\u3002\nbind_port <PORT>:         \u53d1\u8d77\u8fde\u63a5\u7684\u6e90\u7aef\u53e3\u3002\nconnect_timeout <INT>:        \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u3002\u9ed8\u8ba4\u662f5s\u3002\nfwmark <INTEGER>:         \u4f7f\u7528fwmark\u5bf9\u6240\u6709\u51fa\u53bb\u7684\u68c0\u67e5\u6570\u636e\u5305\u8fdb\u884c\u6807\u8bb0\u3002\nwarmup <INT>:             \u6307\u5b9a\u4e00\u4e2a\u968f\u673a\u5ef6\u8fdf\uff0c\u6700\u5927\u4e3aN\u79d2\u3002\u53ef\u9632\u6b62\u7f51\u7edc\u963b\u585e\u3002\u5982\u679c\u4e3a0\uff0c\u5219\u5173\u95ed\u8be5\u529f\u80fd\u3002\n\nretry <INT>:              \u91cd\u8bd5\u6b21\u6570\u3002\u9ed8\u8ba4\u662f3\u6b21\u3002\ntype <STRING>:                DNS query type\u3002A/NS/CNAME/SOA/MX/TXT/AAAA\nname <STRING>:                DNS\u67e5\u8be2\u7684\u57df\u540d\u3002\u9ed8\u8ba4\u662f(.)\n}\n\nMISC_CHECK {\n misc_path <STRING>:      \u5916\u90e8\u7684\u811a\u672c\u6216\u7a0b\u5e8f\u8def\u5f84\u3002\n misc_timeout <INT>:      \u811a\u672c\u6267\u884c\u8d85\u65f6\u65f6\u95f4\u3002\n user USERNAME [GROUPNAME]: \u6307\u5b9a\u8fd0\u884c\u8be5\u811a\u672c\u7684\u7528\u6237\u548c\u7ec4\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9aGROUPNAME\uff0c\u5219GROUPNAME\u540cUSERNAME\u3002\n misc_dynamic:              \u6839\u636e\u9000\u51fa\u72b6\u6001\u7801\u52a8\u6001\u8c03\u6574\u6743\u91cd\u3002\n                                0\uff0c\u5065\u5eb7\u68c0\u67e5\u6210\u529f\uff0c\u6743\u91cd\u4e0d\u53d8\u3002\n                                1\uff0c\u5065\u5eb7\u68c0\u67e5\u5931\u8d25\u3002\n                                2-255\uff0c\u5065\u5eb7\u68c0\u67e5\u6210\u529f\u3002\u6743\u91cd\u8bbe\u7f6e\u4e3a\u9000\u51fa\u72b6\u6001\u7801\u51cf\u53bb2.\u5982\u9000\u51fa\u72b6\u6001\u7801\u662f250\uff0c\u5219\u6743\u91cd\u8c03\u6574\u4e3a248\n   warmup <INT>:          \u6307\u5b9a\u4e00\u4e2a\u968f\u673a\u5ef6\u8fdf\uff0c\u6700\u5927\u4e3aN\u79d2\u3002\u53ef\u9632\u6b62\u7f51\u7edc\u963b\u585e\u3002\u5982\u679c\u4e3a0\uff0c\u5219\u5173\u95ed\u8be5\u529f\u80fd\u3002\n}\n")),(0,l.kt)("h3",{id:"1054\u793a\u4f8b"},"10.5.4\u3001\u793a\u4f8b"),(0,l.kt)("p",null,"\u7f51\u4e0a\u6284\u7684\u793a\u4f8b\uff0c\u4ec5\u4f9b\u53c2\u8003\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'! Configuration File for keepalived\nglobal_defs {                                     # \u5168\u5c40\u5b9a\u4e49\u90e8\u5206\n    notification_email {                          # \u8bbe\u7f6e\u62a5\u8b66\u90ae\u4ef6\u5730\u5740\uff0c\u53ef\u8bbe\u7f6e\u591a\u4e2a\n        acassen@firewall.loc                      # \u63a5\u6536\u901a\u77e5\u7684\u90ae\u4ef6\u5730\u5740\n    }                      \n    notification_email_from test0@163.com         # \u8bbe\u7f6e \u53d1\u9001\u90ae\u4ef6\u901a\u77e5\u7684\u5730\u5740\n    smtp_server smtp.163.com                      # \u8bbe\u7f6e smtp server \u5730\u5740\uff0c\u53ef\u662fip\u6216\u57df\u540d.\u53ef\u9009\u7aef\u53e3\u53f7\uff08\u9ed8\u8ba425\uff09\n    smtp_connect_timeout 30                       # \u8bbe\u7f6e \u8fde\u63a5 smtp server\u7684\u8d85\u65f6\u65f6\u95f4\n    router_id LVS_DEVEL                           # \u4e3b\u673a\u6807\u8bc6\uff0c\u7528\u4e8e\u90ae\u4ef6\u901a\u77e5\n    vrrp_skip_check_adv_addr                 \n    vrrp_strict                                   # \u4e25\u683c\u6267\u884cVRRP\u534f\u8bae\u89c4\u8303\uff0c\u6b64\u6a21\u5f0f\u4e0d\u652f\u6301\u8282\u70b9\u5355\u64ad\n    vrrp_garp_interval 0                     \n    vrrp_gna_interval 0   \n    script_user keepalived_script                 # \u6307\u5b9a\u8fd0\u884c\u811a\u672c\u7684\u7528\u6237\u540d\u548c\u7ec4\u3002\u9ed8\u8ba4\u4f7f\u7528\u7528\u6237\u7684\u9ed8\u8ba4\u7ec4\u3002\n                                                  # \u5982\u672a\u6307\u5b9a\uff0c\u9ed8\u8ba4\u4e3akeepalived_script \u7528\u6237\uff0c\u5982\u65e0\u6b64\u7528\u6237\uff0c\u5219\u4f7f\u7528root\n    enable_script_security                        # \u5982\u8fc7\u8def\u5f84\u4e3a\u975eroot\u53ef\u5199\uff0c\u4e0d\u8981\u914d\u7f6e\u811a\u672c\u4e3aroot\u7528\u6237\u6267\u884c\u3002\n}     \n\nvrrp_script chk_nginx_service {                   # VRRP \u811a\u672c\u58f0\u660e\n    script "/etc/keepalived/chk_nginx.sh"         # \u5468\u671f\u6027\u6267\u884c\u7684\u811a\u672c\n    interval 3                                    # \u8fd0\u884c\u811a\u672c\u7684\u95f4\u9694\u65f6\u95f4\uff0c\u79d2\n    weight -20                                    # \u6743\u91cd\uff0cpriority\u503c\u51cf\u53bb\u6b64\u503c\u8981\u5c0f\u4e8e\u5907\u670d\u52a1\u7684priority\u503c\n    fall 3                                        # \u68c0\u6d4b\u51e0\u6b21\u5931\u8d25\u624d\u4e3a\u5931\u8d25\uff0c\u6574\u6570\n    rise 2                                        # \u68c0\u6d4b\u51e0\u6b21\u72b6\u6001\u4e3a\u6b63\u5e38\u7684\uff0c\u624d\u786e\u8ba4\u6b63\u5e38\uff0c\u6574\u6570\n    user keepalived_script                        # \u6267\u884c\u811a\u672c\u7684\u7528\u6237\u6216\u7ec4\n}                                           \n\nvrrp_instance VI_1 {                              # vrrp \u5b9e\u4f8b\u90e8\u5206\u5b9a\u4e49\uff0cVI_1\u81ea\u5b9a\u4e49\u540d\u79f0\n    state MASTER                                  # \u6307\u5b9a keepalived \u7684\u89d2\u8272\uff0c\u5fc5\u987b\u5927\u5199 \u53ef\u9009\u503c\uff1aMASTER|BACKUP\n    interface ens33                               # \u7f51\u5361\u8bbe\u7f6e\uff0clvs\u9700\u8981\u7ed1\u5b9a\u5728\u7f51\u5361\u4e0a\uff0crealserver\u7ed1\u5b9a\u5728\u56de\u73af\u53e3\u3002\n                                                  # \u533a\u522b\uff1alvs\u5bf9\u8bbf\u95ee\u4e3a\u5916\uff0crealserver\u4e3a\u5185\u4e0d\u6613\u66b4\u9732\u672c\u673a\u4fe1\u606f\n\n    virtual_router_id 51                          # \u865a\u62df\u8def\u7531\u6807\u8bc6\uff0c\u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u540c\u4e00\u4e2avrrp \u5b9e\u4f8b\u4f7f\u7528\u552f\u4e00\u7684\u6807\u8bc6\uff0c\n                                                  # MASTER\u548cBACKUP \u7684\u540c\u4e00\u4e2a vrrp_instance \u4e0b \u8fd9\u4e2a\u6807\u8bc6\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\n\n    priority 100                                  # \u5b9a\u4e49\u4f18\u5148\u7ea7\uff0c\u6570\u5b57\u8d8a\u5927\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\u3002\n    advert_int 1                                  # \u8bbe\u5b9a MASTER \u4e0e BACKUP \u8d1f\u8f7d\u5747\u8861\u4e4b\u95f4\u540c\u6b65\u68c0\u67e5\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\u4e3a\u79d2\uff0c\u4e24\u4e2a\u8282\u70b9\u8bbe\u7f6e\u5fc5\u987b\u4e00\u6837\n    authentication {                              # \u8bbe\u7f6e\u9a8c\u8bc1\u7c7b\u578b\u548c\u5bc6\u7801\uff0c\u4e24\u4e2a\u8282\u70b9\u5fc5\u987b\u4e00\u81f4\n        auth_type PASS                      \n        auth_pass 1111                      \n    }                                       \n    virtual_ipaddress {                           # \u8bbe\u7f6e\u865a\u62dfIP\u5730\u5740\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u865a\u62dfIP\u5730\u5740\uff0c\u6bcf\u884c\u4e00\u4e2a\n        192.168.119.130                     \n    }\n    track_script {                                # \u811a\u672c\u76d1\u63a7\u72b6\u6001\n        chk_nginx_service                         # \u53ef\u52a0\u6743\u91cd\uff0c\u4f46\u4f1a\u8986\u76d6\u58f0\u660e\u7684\u811a\u672c\u6743\u91cd\u503c\u3002chk_nginx_service weight -20\n    }\n        notify_master "/etc/keepalived/start_haproxy.sh start"  # \u5f53\u524d\u8282\u70b9\u6210\u4e3amaster\u65f6\uff0c\u901a\u77e5\u811a\u672c\u6267\u884c\u4efb\u52a1\n        notify_backup "/etc/keepalived/start_haproxy.sh stop"   # \u5f53\u524d\u8282\u70b9\u6210\u4e3abackup\u65f6\uff0c\u901a\u77e5\u811a\u672c\u6267\u884c\u4efb\u52a1\n        notify_fault  "/etc/keepalived/start_haproxy.sh stop"   # \u5f53\u5f53\u524d\u8282\u70b9\u51fa\u73b0\u6545\u969c\uff0c\u6267\u884c\u7684\u4efb\u52a1; \n}                                           \n\nvirtual_server 192.168.119.130 80  {          # \u5b9a\u4e49RealServer\u5bf9\u5e94\u7684VIP\u53ca\u670d\u52a1\u7aef\u53e3\uff0cIP\u548c\u7aef\u53e3\u4e4b\u95f4\u7528\u7a7a\u683c\u9694\u5f00\n    delay_loop 6                              # \u6bcf\u96946\u79d2\u67e5\u8be2realserver\u72b6\u6001\n    lb_algo rr                                # \u540e\u7aef\u8c03\u8bd5\u7b97\u6cd5\uff08load balancing algorithm\uff09\n    lb_kind DR                                # LVS\u8c03\u5ea6\u7c7b\u578bNAT/DR/TUN\n    # persistence_timeout 60                  # \u540c\u4e00IP\u7684\u8fde\u63a560\u79d2\u5185\u88ab\u5206\u914d\u5230\u540c\u4e00\u53f0realserver\n    protocol TCP                              # \u7528TCP\u534f\u8bae\u68c0\u67e5realserver\u72b6\u6001\n    real_server 192.168.119.120 80 {        \n        weight 1                              # \u6743\u91cd\uff0c\u6700\u5927\u8d8a\u9ad8\uff0clvs\u5c31\u8d8a\u4f18\u5148\u8bbf\u95ee\n        TCP_CHECK {                           # keepalived\u7684\u5065\u5eb7\u68c0\u67e5\u65b9\u5f0fHTTP_GET | SSL_GET | TCP_CHECK | SMTP_CHECK | MISC\n            connect_timeout 10                # 10\u79d2\u65e0\u54cd\u5e94\u8d85\u65f6\n            retry 3                           # \u91cd\u8fde\u6b21\u65703\u6b21\n            delay_before_retry 3              # \u91cd\u8fde\u95f4\u9694\u65f6\u95f4\n            connect_port 80                   # \u5065\u5eb7\u68c0\u67e5realserver\u7684\u7aef\u53e3\n        }                                   \n    }                                       \n    real_server 192.168.119.121 80 {        \n        weight 1                              # \u6743\u91cd\uff0c\u6700\u5927\u8d8a\u9ad8\uff0clvs\u5c31\u8d8a\u4f18\u5148\u8bbf\u95ee\n        TCP_CHECK {                           # keepalived\u7684\u5065\u5eb7\u68c0\u67e5\u65b9\u5f0fHTTP_GET | SSL_GET | TCP_CHECK | SMTP_CHECK | MISC\n            connect_timeout 10                # 10\u79d2\u65e0\u54cd\u5e94\u8d85\u65f6\n            retry 3                           # \u91cd\u8fde\u6b21\u65703\u6b21\n            delay_before_retry 3              # \u91cd\u8fde\u95f4\u9694\u65f6\u95f4\n            connect_port 80                   # \u5065\u5eb7\u68c0\u67e5realserver\u7684\u7aef\u53e3\n        }                                   \n    }                                       \n}\n')),(0,l.kt)("h2",{id:"106\u7efc\u5408\u751f\u4ea7\u5b9e\u4f8b"},"10.6\u3001\u7efc\u5408\u751f\u4ea7\u5b9e\u4f8b"),(0,l.kt)("p",null,"\u5b9e\u9a8c\u73af\u5883\u5982\u4e0b\u62d3\u6251\uff0c\u4e00\u5f20\u56fe\u80dc\u8fc7\u5343\u8a00\u4e07\u8bed\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"keepalived_lvs",src:r(62313).Z,width:"988",height:"608"})),(0,l.kt)("p",null,"\u8fd9\u5f20\u56fe\u662f\u6211\u751f\u4ea7\u73af\u5883\u7684\u67b6\u6784\u8bbe\u8ba1\uff0c\u6211\u5f53\u65f6\u5efa\u8bbe\u7684\u662f\u4e91\u5e73\u53f0\u73af\u5883\uff0c\u6bd4\u8fd9\u4e2a\u8981\u590d\u6742\u5f97\u591a\uff0c\u6bcf\u4e2a\u73af\u8282\u90fd\u4f7f\u7528\u9ad8\u53ef\u7528\u90e8\u7f72\uff0c\u53ef\u4f9b\u751f\u4ea7\u501f\u9274\u3002"),(0,l.kt)("p",null,"\u4e0b\u9762\u6211\u4eec\u8981\u5b9e\u73b0\u7684\u662f keepalived \u53cc\u4e3b\u591a\u5b9e\u4f8b\u9ad8\u53ef\u7528\u6a21\u578b\uff0c\u4e5f\u5c31\u662f\u4e24\u4e2a Director \u4e92\u4e3a\u4e3b\u5907\uff1b\u53e6\u5916 VIP(192.168.122.9) \u5bf9\u5e94 172.16.4.203/204 \u8fd9\u4e24\u4e2a\u4e3b\u673a\uff0cVIP(192.168.122.10) \u5bf9\u5e94 172.16.4.205/206 \u8fd9\u4e24\u4e2a\u4e3b\u673a\u3002"),(0,l.kt)("p",null,"\u4e24\u53f0 Directors \u914d\u7f6e\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# director1 \u4e0a\u7684 keepalived \u914d\u7f6e                   |# director2 \u4e0a\u7684 keepalived \u914d\u7f6e\n! Configuration File for keepalived                |! Configuration File for keepalived\n                                                   |\nglobal_defs {                                      |global_defs {\n   router_id LVS_1                                 |   router_id LVS_2         \n}                                                  |}\n                                                   |\nvrrp_instance VI_1 {                               |vrrp_instance VI_1 {       \n    state MASTER                                   |    state BACKUP           \n    interface eth0                                 |    interface eth0\n    virtual_router_id 51                           |    virtual_router_id 51   \n    priority 100                                   |    priority 50            \n    advert_int 1                                   |    advert_int 1\n    authentication {                               |    authentication {\n        auth_type PASS                             |        auth_type PASS     \n        auth_pass 12345678                         |        auth_pass 12345678   \n    }                                              |    }\n    virtual_ipaddress {                            |    virtual_ipaddress {\n        192.168.122.9/32 dev eth0 label eth0:0     |        192.168.122.9/32 dev eth0 label eth0:0\n    }                                              |    }\n}                                                  |}\n# \u4e0d\u540cvrrp\u5b9e\u4f8b\u7ed1\u5b9a\u5728\u540c\u4e00\u63a5\u53e3\u4e0a\uff0cvrid\u5fc5\u987b\u4e0d\u80fd\u76f8\u540c    |# \u4e0d\u540cvrrp\u5b9e\u4f8b\u7ed1\u5b9a\u5728\u540c\u4e00\u63a5\u53e3\u4e0a\uff0cvrid\u5fc5\u987b\u4e0d\u80fd\u76f8\u540c\nvrrp_instance VI_2 {                               |vrrp_instance VI_2 {       \n    state BACKUP                                   |    state MASTER           \n    interface eth0                                 |    interface eth0\n    virtual_router_id 55                           |    virtual_router_id 55   \n    priority 50                                    |    priority 100            \n    advert_int 1                                   |    advert_int 1\n    authentication {                               |    authentication {\n        auth_type PASS                             |        auth_type PASS     \n        auth_pass 12345678                         |        auth_pass 12345678   \n    }                                              |    }\n    virtual_ipaddress {                            |    virtual_ipaddress {\n        192.168.122.10/32 dev eth0 label eth0:1    |        192.168.122.10/32 dev eth0 label eth0:1\n    }                                              |    }\n}                                                  |}\n\n#########################################################################################\n# \u4ee5\u4e0b\u662f\u4e24\u53f0 Director \u4e0a\u76f8\u540c\u90e8\u5206\u7684\u5185\u5bb9\nvirtual_server 192.168.122.9 80 {\n        delay_loop 6\n        lb_algo wrr\n        lb_kind DR\n        protocol TCP\n\n        real_server 172.16.4.203 80 {\n                weight 2\n                TCP_CHECK {\n                        connect_port 80\n                        connect_timeout 1\n                        nb_get_retry 2\n                        delay_before_retry 1\n                }\n        }\n\n        real_server 172.16.4.204 80 {\n                weight 1\n                TCP_CHECK {\n                        connect_port 80\n                        connect_timeout 1\n                        nb_get_retry 2\n                        delay_before_retry 1\n                }\n        }\n}\n\nvirtual_server 192.168.122.10 80 {\n        delay_loop 6\n        lb_algo wrr\n        lb_kind DR\n        protocol TCP\n\n        real_server 172.16.4.205 80 {\n                weight 2\n                TCP_CHECK {\n                        connect_port 80\n                        connect_timeout 1\n                        nb_get_retry 2\n                        delay_before_retry 1\n                }\n        }\n\n        real_server 172.16.4.206 80 {\n                weight 1\n                TCP_CHECK {\n                        connect_port 80\n                        connect_timeout 1\n                        nb_get_retry 2\n                        delay_before_retry 1\n                }\n        }\n}\n")),(0,l.kt)("p",null,"\u56db\u53f0 RealServers \u7684\u914d\u7f6e\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'# 1.\u63d0\u4f9bweb\u670d\u52a1\u548c\u6d4b\u8bd5\u9875\u9762\nyum -y install httpd\necho "VIP(192.168.122.9): This is page from RS1:172.16.4.203" > /var/www/html/index.html   # \u5728RS1\u4e0a\u64cd\u4f5c\necho "VIP(192.168.122.9): This is page from RS2:172.16.4.204" > /var/www/html/index.html   # \u5728RS2\u4e0a\u64cd\u4f5c\necho "VIP(192.168.122.10): This is page from RS3:172.16.4.205" > /var/www/html/index.html      # \u5728RS3\u4e0a\u64cd\u4f5c\necho "VIP(192.168.122.10): This is page from RS4:172.16.4.206" > /var/www/html/index.html      # \u5728RS4\u4e0a\u64cd\u4f5c\nservice httpd start\n\n# 2.\u8bbe\u7f6earp\u53c2\u6570\necho 1 >/proc/sys/net/ipv4/conf/all/arp_ignore\necho 2 >/proc/sys/net/ipv4/conf/all/arp_announce\n\n# 3.\u8bbe\u7f6eVIP\n# RS1\u548cRS2\u8bbe\u7f6e\nifconfig lo:0 192.168.122.9 netmask 255.255.255.255 up\nroute add -host 192.168.122.9 dev lo:0\n# RS3\u548cRS4\u8bbe\u7f6e\nifconfig lo:0 192.168.122.10 netmask 255.255.255.255 up\nroute add -host 192.168.122.10 dev lo:0\n\n# 4.\u4e00\u5b9a\u8981\u6ce8\u610f\uff0c\u7f51\u5173\u4e0d\u80fd\u6307\u5411director\uff0c\u800c\u662f\u8981\u6307\u5411router\uff0c\u6211\u5728\u7f51\u7edc\u914d\u7f6e\u6587\u4ef6\u4e2d\u5199\u597d\u4e86\uff0c\u6309\u7167\u4e0a\u9762\u62d3\u6251\u53bb\u8bbe\u7f6e\n')),(0,l.kt)("p",null,"\u4e24\u53f0 Routers \u8bbe\u7f6e\uff0c\u6211\u5b9e\u9a8c\u4e2d\u7528\u7684\u662f\u4e00\u53f0 linux \u4e3b\u673a\uff0c\u751f\u4ea7\u73af\u5883\u4e0a\u6211\u4f1a\u4f7f\u7528\u4e24\u53f0\u534e\u4e3a S6857 \u8fdb\u884c\u5806\u53e0\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a linux \u4e3b\u673a\u3002\u53ea\u4e0d\u8fc7\u8def\u7531\u5668\u4e0d\u7528\u8bbe\u7f6e rp","_","filter\uff0c\u4f46\u662f\u8fd9\u91cc\u7684 linux \u4e3b\u673a\u5fc5\u987b\u8bbe\u7f6e\uff0c\u5426\u5219\u65e0\u6cd5\u5b9e\u73b0\u8be5\u73af\u5883\u3002\u5173\u4e8e rp","_","filter \u53ef\u4ee5\u53c2\u89c1 ",(0,l.kt)("a",{parentName:"p",href:"https://www.brinnatt.com/high/%e7%ac%ac-10-%e7%ab%a0-linux-lvs-%e6%9c%8d%e5%8a%a1%e9%85%8d%e7%bd%ae/"},"Linux LVS Service"),"\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[root@router ~]# echo 1 > /proc/sys/net/ipv4/ip_forward\n[root@router ~]# echo 2 > /proc/sys/net/ipv4/conf/all/rp_filter\n")),(0,l.kt)("p",null,"\u4ee5\u4e0a\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u62d3\u6251\u4e2d\u7684\u73af\u5883\uff0c\u4e0b\u9762\u627e\u4e00\u4e2a\u5ba2\u6237\u7aef\u6d4b\u8bd5\u4e00\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"[root@yidam ~]# curl 192.168.122.9\n<h1>VIP(192.168.122.9): This is page from RS1:172.16.4.203</h1>\n[root@yidam ~]# curl 192.168.122.9\n<h1>VIP(192.168.122.9): This is page from RS2:172.16.4.204</h1>\n[root@yidam ~]# curl 192.168.122.9\n<h1>VIP(192.168.122.9): This is page from RS1:172.16.4.203</h1>\n[root@yidam ~]# curl 192.168.122.10\n<h1>VIP(192.168.122.10): This is page from RS3:172.16.4.205</h1>\n[root@yidam ~]# curl 192.168.122.10\n<h1>VIP(192.168.122.10): This is page from RS3:172.16.4.205</h1>\n[root@yidam ~]# curl 192.168.122.10\n<h1>VIP(192.168.122.10): This is page from RS4:172.16.4.206</h1>\n[root@yidam ~]#\n")))}v.isMDXComponent=!0},58560:function(e,n,r){n.Z=r.p+"assets/images/keepalived-db3b76d1070d54376c7a50e4f5db19d7.png"},62313:function(e,n,r){n.Z=r.p+"assets/images/keepalived_lvs-a9fa57dd614425060608bc1be54a4b80.png"}}]);