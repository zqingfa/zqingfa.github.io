"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[3279],{3905:function(t,e,a){a.d(e,{Zo:function(){return m},kt:function(){return N}});var n=a(67294);function p(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function r(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(Object(a),!0).forEach((function(e){p(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function i(t,e){if(null==t)return{};var a,n,p=function(t,e){if(null==t)return{};var a,n,p={},r=Object.keys(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||(p[a]=t[a]);return p}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(p[a]=t[a])}return p}var s=n.createContext({}),o=function(t){var e=n.useContext(s),a=e;return t&&(a="function"==typeof t?t(e):l(l({},e),t)),a},m=function(t){var e=o(t.components);return n.createElement(s.Provider,{value:e},t.children)},c={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},k=n.forwardRef((function(t,e){var a=t.components,p=t.mdxType,r=t.originalType,s=t.parentName,m=i(t,["components","mdxType","originalType","parentName"]),k=o(a),N=p,u=k["".concat(s,".").concat(N)]||k[N]||c[N]||r;return a?n.createElement(u,l(l({ref:e},m),{},{components:a})):n.createElement(u,l({ref:e},m))}));function N(t,e){var a=arguments,p=e&&e.mdxType;if("string"==typeof t||p){var r=a.length,l=new Array(r);l[0]=k;var i={};for(var s in e)hasOwnProperty.call(e,s)&&(i[s]=e[s]);i.originalType=t,i.mdxType="string"==typeof t?t:p,l[1]=i;for(var o=2;o<r;o++)l[o]=a[o];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},96982:function(t,e,a){a.r(e),a.d(e,{assets:function(){return m},contentTitle:function(){return s},default:function(){return N},frontMatter:function(){return i},metadata:function(){return o},toc:function(){return c}});var n=a(83117),p=a(80102),r=(a(67294),a(3905)),l=["components"],i={id:"linux-advanced-2",slug:"/linux-advanced-2",title:"\u7b2c 2 \u7ae0 Linux \u9632\u706b\u5899",authors:"zhangqf",keywords:["linux","Firewall"]},s=void 0,o={unversionedId:"linux/advanced/linux-advanced-2",id:"linux/advanced/linux-advanced-2",title:"\u7b2c 2 \u7ae0 Linux \u9632\u706b\u5899",description:'\u6240\u8c13\u9632\u706b\u5899\u5c31\u662f "\u9632\u706b\u7684\u5899"\uff0c\u5982\u679c\u8fc7\u6765\u7684\u662f "\u706b" \u5c31\u5f97\u6321\u4f4f\uff0c\u5982\u679c\u8fc7\u6765\u7684\u4e0d\u662f "\u706b" \u5c31\u653e\u884c\uff0c\u4f46\u4ec0\u4e48\u662f "\u706b"\uff0c\u8fd9\u7531\u4eba\u4e3a\u81ea\u884c\u5b9a\u4e49\u3002',source:"@site/docs/linux/advanced/\u7b2c 2 \u7ae0 Linux \u9632\u706b\u5899.md",sourceDirName:"linux/advanced",slug:"/linux-advanced-2",permalink:"/en/docs/linux-advanced-2",draft:!1,tags:[],version:"current",frontMatter:{id:"linux-advanced-2",slug:"/linux-advanced-2",title:"\u7b2c 2 \u7ae0 Linux \u9632\u706b\u5899",authors:"zhangqf",keywords:["linux","Firewall"]},sidebar:"linux",previous:{title:"\u7b2c 1 \u7ae0 Linux \u8fdb\u9636\u547d\u4ee4",permalink:"/en/docs/linux-advanced-1"},next:{title:"\u7b2c 3 \u7ae0 Linux NFS \u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf",permalink:"/en/docs/linux-advanced-3"}},m={},c=[{value:"2.1\u3001\u6570\u636e\u4f20\u8f93\u6d41\u7a0b",id:"21\u6570\u636e\u4f20\u8f93\u6d41\u7a0b",level:2},{value:"2.1.1\u3001\u7f51\u7edc\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b",id:"211\u7f51\u7edc\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b",level:3},{value:"2.1.2\u3001\u672c\u673a\u6570\u636e\u8def\u7531\u51b3\u7b56",id:"212\u672c\u673a\u6570\u636e\u8def\u7531\u51b3\u7b56",level:3},{value:"2.2\u3001TCP \u91cd\u8981\u6982\u5ff5",id:"22tcp-\u91cd\u8981\u6982\u5ff5",level:2},{value:"2.2.1\u3001TCP \u4e09\u6b21\u63e1\u624b",id:"221tcp-\u4e09\u6b21\u63e1\u624b",level:3},{value:"2.2.2\u3001TCP \u56db\u6b21\u6325\u624b",id:"222tcp-\u56db\u6b21\u6325\u624b",level:3},{value:"2.2.3\u3001syn flood \u653b\u51fb",id:"223syn-flood-\u653b\u51fb",level:3},{value:"2.3\u3001\u9632\u706b\u5899\u7684\u5e94\u7528",id:"23\u9632\u706b\u5899\u7684\u5e94\u7528",level:2},{value:"2.4\u3001Linux \u9632\u706b\u5899",id:"24linux-\u9632\u706b\u5899",level:2},{value:"2.4.1\u3001netfilter \u4e0e\u5176\u6a21\u5757",id:"241netfilter-\u4e0e\u5176\u6a21\u5757",level:3},{value:"2.4.2\u3001iptables \u548c netfilter \u7684\u5173\u7cfb",id:"242iptables-\u548c-netfilter-\u7684\u5173\u7cfb",level:3},{value:"2.4.3\u3001netfilter \u7684\u7ed3\u6784",id:"243netfilter-\u7684\u7ed3\u6784",level:3},{value:"2.5\u3001iptables \u547d\u4ee4",id:"25iptables-\u547d\u4ee4",level:2},{value:"2.5.1\u3001iptables \u8bed\u6cd5",id:"251iptables-\u8bed\u6cd5",level:3},{value:"2.5.2\u3001ip_conntrack \u529f\u80fd\u548c iptstate \u547d\u4ee4",id:"252ip_conntrack-\u529f\u80fd\u548c-iptstate-\u547d\u4ee4",level:3},{value:"2.5.3\u3001-m state \u7684\u72b6\u6001\u89e3\u91ca",id:"253-m-state-\u7684\u72b6\u6001\u89e3\u91ca",level:3},{value:"2.5.4\u3001filter \u8868\u793a\u4f8b",id:"254filter-\u8868\u793a\u4f8b",level:3},{value:"2.5.5\u3001\u4f18\u5316\u89c4\u5219",id:"255\u4f18\u5316\u89c4\u5219",level:3},{value:"2.5.6\u3001\u4fdd\u5b58\u89c4\u5219",id:"256\u4fdd\u5b58\u89c4\u5219",level:3},{value:"2.5.7\u3001\u81ea\u5b9a\u4e49\u94fe",id:"257\u81ea\u5b9a\u4e49\u94fe",level:3},{value:"2.5.7.1\u3001\u81ea\u5b9a\u4e49\u94fe\u793a\u4f8b",id:"2571\u81ea\u5b9a\u4e49\u94fe\u793a\u4f8b",level:4},{value:"2.5.8\u3001NAT \u8868",id:"258nat-\u8868",level:3},{value:"2.5.8.1\u3001\u914d\u7f6e\u7f51\u5173\u4ee5\u53ca\u8f6c\u53d1",id:"2581\u914d\u7f6e\u7f51\u5173\u4ee5\u53ca\u8f6c\u53d1",level:4},{value:"2.5.8.2\u3001\u914d\u7f6e\u7f51\u5173\u9632\u706b\u5899",id:"2582\u914d\u7f6e\u7f51\u5173\u9632\u706b\u5899",level:4},{value:"2.5.8.3\u3001SNAT",id:"2583snat",level:4},{value:"2.5.8.4\u3001DNAT",id:"2584dnat",level:4},{value:"2.5.9\u3001mangle \u8868",id:"259mangle-\u8868",level:3},{value:"2.5.10\u3001raw \u8868",id:"2510raw-\u8868",level:3},{value:"2.5.11\u3001\u9632\u706b\u5899\u6700\u4f73\u5b9e\u8df5",id:"2511\u9632\u706b\u5899\u6700\u4f73\u5b9e\u8df5",level:3},{value:"2.6\u3001tcp_wrapper \u8fc7\u6ee4",id:"26tcp_wrapper-\u8fc7\u6ee4",level:2},{value:"2.6.1\u3001\u67e5\u770b\u662f\u5426\u652f\u6301 wrapper",id:"261\u67e5\u770b\u662f\u5426\u652f\u6301-wrapper",level:3},{value:"2.6.2\u3001\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f",id:"262\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f",level:3}],k={toc:c};function N(t){var e=t.components,i=(0,p.Z)(t,l);return(0,r.kt)("wrapper",(0,n.Z)({},k,i,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("p",null,'\u6240\u8c13\u9632\u706b\u5899\u5c31\u662f "\u9632\u706b\u7684\u5899"\uff0c\u5982\u679c\u8fc7\u6765\u7684\u662f "\u706b" \u5c31\u5f97\u6321\u4f4f\uff0c\u5982\u679c\u8fc7\u6765\u7684\u4e0d\u662f "\u706b" \u5c31\u653e\u884c\uff0c\u4f46\u4ec0\u4e48\u662f "\u706b"\uff0c\u8fd9\u7531\u4eba\u4e3a\u81ea\u884c\u5b9a\u4e49\u3002'),(0,r.kt)("p",null,'\u4f46\u65e0\u8bba\u5982\u4f55\uff0c\u6240\u8c13\u7684 "\u706b" \u90fd\u662f\u57fa\u4e8e OSI \u4e03\u5c42\u6a21\u578b\u7684\uff0c\u7b80\u5355\u7684\u5212\u5206\u4e3a\u56db\u5c42\uff1a\u6700\u9ad8\u7684\u5e94\u7528\u5c42(HTTP/FTP/SMTP)\uff0c\u5f80\u4e0b\u4e00\u5c42\u662f\u4f20\u8f93\u5c42(TCP/UDP)\uff0c\u518d\u5f80\u4e0b\u4e00\u5c42\u662f\u7f51\u7edc\u5c42\uff0c\u6700\u540e\u662f\u94fe\u8def\u5c42\u3002\u53ef\u4ee5\u57fa\u4e8e\u6574\u4e2a 7 \u5c42\u6a21\u578b\u7684\u6bcf\u4e00\u5c42\u6765\u5b9a\u5236\u9632\u706b\u5899\uff0c\u4f46\u662f\u9ed8\u8ba4\u9632\u706b\u5899\uff08\u6ca1\u6709\u7f16\u8bd1\u5185\u6838\u6e90\u7801\u5b9a\u5236\u4e03\u5c42\u9632\u706b\u5899\uff09\u4e00\u822c\u8ba4\u4e3a\u5de5\u4f5c\u5728\u4ee5\u4e0a\u7684 4 \u5c42\u4e2d\u3002'),(0,r.kt)("h2",{id:"21\u6570\u636e\u4f20\u8f93\u6d41\u7a0b"},"2.1\u3001\u6570\u636e\u4f20\u8f93\u6d41\u7a0b"),(0,r.kt)("h3",{id:"211\u7f51\u7edc\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b"},"2.1.1\u3001\u7f51\u7edc\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b"),(0,r.kt)("p",null,"\u9996\u5148\u770b\u770b\u7f51\u7edc\u6570\u636e\u4f20\u8f93\u7684\u57fa\u672c\u6d41\u7a0b\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"network package flow encapsulated",src:a(93033).Z,width:"1070",height:"557"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u56fd\u9645\u901a\u7528\u7684 OSI \u6807\u51c6\u7f51\u7edc\u4e03\u5c42\u6a21\u578b\u5305\u62ec\uff1a\u5e94\u7528\u5c42\u3001\u8868\u793a\u5c42\u3001\u4f1a\u8bdd\u5c42\u3001\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\u3001\u6570\u636e\u94fe\u8def\u5c42\u3001\u7269\u7406\u5c42\uff0c\u5f88\u591a\u65f6\u5019\u4eba\u4eec\u4e3a\u4e86\u9488\u5bf9\u67d0\u4e2a\u573a\u666f\u60f3\u8981\u8bf4\u900f\u4e00\u4e2a\u95ee\u9898\uff0c\u4f1a\u7b80\u5316\u8fd9\u4e03\u5c42\u6a21\u578b\uff0c\u6bd4\u5982\u5c06\u5e94\u7528\u5c42\u3001\u8868\u793a\u5c42\u3001\u4f1a\u8bdd\u5c42\u5408\u5e76\u6210\u5e94\u7528\u5c42\u3002\u6b64\u56fe\u4e3a\u4e86\u8fc7\u6e21\u5230\u9632\u706b\u5899\u7684\u4e13\u4e1a\u77e5\u8bc6\uff0c\u4e0d\u6df1\u5165\u5e94\u7528\u5c42\uff0c\u6240\u4ee5\u5408\u5e76\u4e0a\u4e09\u5c42\uff0c\u53e6\u5916\u7269\u7406\u5c42\u6307\u7684\u5c31\u662f\u7269\u7406\u8bbe\u5907\uff0c\u7701\u7565\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5e94\u7528\u5c42\u901a\u8fc7\u901a\u7528\u7684\u534f\u8bae(\u6bd4\u5982 http\uff0cftp \u7b49)\u5c01\u88c5\u597d\u6570\u636e\uff0c\u8fdb\u5165\u4f20\u8f93\u5c42\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u4f20\u8f93\u5c42\u57fa\u4e8e tcp \u6216 udp \u534f\u8bae\u5c06\u6e90\u7aef\u53e3\u548c\u76ee\u6807\u7aef\u53e3\u7ee7\u7eed\u5c01\u88c5\uff0c\u7136\u540e\u8fc7\u6e21\u5230\u7f51\u7edc\u5c42\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u7f51\u7edc\u5c42\u52a0\u4e0a\u6e90 IP \u548c\u76ee\u6807 IP \u6210\u4e3a\u6570\u636e\u5305\uff0c\u518d\u8fdb\u5165\u94fe\u8def\u5c42\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u94fe\u8def\u5c42\u52a0\u4e0a\u6e90 MAC \u5730\u5740\u548c\u76ee\u6807 MAC \u5730\u5740\u6210\u4e3a\u6570\u636e\u5e27\u3002"),(0,r.kt)("li",{parentName:"ol"},'\u4ee5\u4e0a\u6574\u4e2a\u8fc7\u7a0b\u662f\u4e00\u79cd "\u52a0\u5934" \u5c01\u88c5\u6570\u636e\u7684\u8fc7\u7a0b\u3002\u6570\u636e\u7ecf\u8fc7\u7f51\u7edc\u4f20\u8f93\u5230\u8fbe\u76ee\u6807\u4e3b\u673a\u540e\uff0c\u9010\u5c42 "\u5243\u5934" \u89e3\u5305\uff0c\u6700\u7ec8\u5f97\u5230 data \u7eaf\u6570\u636e\u5185\u5bb9\u3002')),(0,r.kt)("h3",{id:"212\u672c\u673a\u6570\u636e\u8def\u7531\u51b3\u7b56"},"2.1.2\u3001\u672c\u673a\u6570\u636e\u8def\u7531\u51b3\u7b56"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"networking",src:a(53330).Z,width:"869",height:"619"})),(0,r.kt)("p",null,"\u6570\u636e\u5305\u7684\u6d41\u8f6c\u662f\u4e2a\u5f88\u590d\u6742\u7684\u8fc7\u7a0b\uff0c\u671f\u95f4\u4e3b\u8981\u7531\u591a\u79cd hook \u51fd\u6570\u548c\u8def\u7531\u7b56\u7565\u51b3\u5b9a\u6570\u636e\u5305\u4ece\u54ea\u91cc\u6765\u5230\u54ea\u91cc\u53bb\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u6570\u636e\u5305\u4ece\u7f51\u5361\u6d41\u5165\u540e\u9700\u8981\u5bf9\u5b83\u505a\u8def\u7531\u51b3\u7b56\uff0c\u6839\u636e\u5176\u76ee\u6807\u51b3\u5b9a\u662f\u6d41\u5165\u672c\u673a\u6570\u636e\u8fd8\u662f\u8f6c\u53d1\u7ed9\u5176\u4ed6\u4e3b\u673a\uff0c\u5982\u679c\u662f\u6d41\u5165\u672c\u673a\u7684\u6570\u636e\uff0c\u5219\u6570\u636e\u4f1a\u4ece\u5185\u6838\u7a7a\u95f4\u8fdb\u5165\u7528\u6237\u7a7a\u95f4(\u88ab\u5e94\u7528\u7a0b\u5e8f\u63a5\u6536\u3001\u5904\u7406)\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5f53\u7528\u6237\u7a7a\u95f4\u54cd\u5e94(\u5e94\u7528\u7a0b\u5e8f\u751f\u6210\u65b0\u7684\u6570\u636e\u5305)\u65f6\uff0c\u54cd\u5e94\u6570\u636e\u5305\u662f\u672c\u673a\u4ea7\u751f\u7684\u65b0\u6570\u636e\u5305\uff0c\u5728\u54cd\u5e94\u5305\u6d41\u51fa\u4e4b\u524d\uff0c\u9700\u8981\u505a\u8def\u7531\u51b3\u7b56\uff0c\u6839\u636e\u76ee\u6807\u51b3\u5b9a\u4ece\u54ea\u4e2a\u7f51\u5361\u6d41\u51fa\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c\u4e0d\u662f\u6d41\u5165\u672c\u673a\u7684\uff0c\u800c\u662f\u8981\u8f6c\u53d1\u7ed9\u5176\u4ed6\u4e3b\u673a\u7684\uff0c\u5219\u5fc5\u7136\u6d89\u53ca\u5230\u53e6\u4e00\u4e2a\u6d41\u51fa\u7f51\u5361\uff0c\u6b64\u65f6\u6570\u636e\u5305\u5fc5\u987b\u4ece\u6d41\u5165\u7f51\u5361\u5b8c\u6574\u5730\u8f6c\u53d1\u7ed9\u6d41\u51fa\u7f51\u5361\uff0c\u8fd9\u8981\u6c42 Linux \u4e3b\u673a\u80fd\u591f\u5b8c\u6210\u8fd9\u6837\u7684\u8f6c\u53d1\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u4f46 Linux \u4e3b\u673a\u9ed8\u8ba4\u672a\u5f00\u542f ip","_","forward \u529f\u80fd\uff0c\u8fd9\u4f7f\u5f97\u6570\u636e\u5305\u65e0\u6cd5\u8f6c\u53d1\u800c\u88ab\u4e22\u5f03\u3002",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Linux \u4e3b\u673a\u548c\u8def\u7531\u5668\u4e0d\u540c\uff0c\u8def\u7531\u5668\u672c\u8eab\u5c31\u662f\u4e3a\u4e86\u8f6c\u53d1\u6570\u636e\u5305\uff0c\u6240\u4ee5\u8def\u7531\u5668\u5185\u90e8\u9ed8\u8ba4\u5c31\u80fd\u5728\u4e0d\u540c\u7f51\u5361\u95f4\u8f6c\u53d1\u6570\u636e\u5305\uff0c\u800c Linux \u4e3b\u673a\u9ed8\u8ba4\u5219\u4e0d\u80fd\u8f6c\u53d1\u3002")))),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"\u6ce8\u610f\uff1aIP \u5730\u5740\u662f\u5c5e\u4e8e\u5185\u6838\u7684\uff0c\u4e0d\u5c3d\u5982\u6b64\uff0c\u6574\u4e2a tcp/ip \u534f\u8bae\u6808\u90fd\u5c5e\u4e8e\u5185\u6838\uff0c\u5305\u62ec\u7aef\u53e3\u53f7\uff1b\u8fd9\u4e2a\u6982\u5ff5\u5728\u4f7f\u7528 iptables \u65f6\u5c24\u5176\u8981\u6ce8\u610f\uff0c\u53ef\u80fd\u4f1a\u7591\u60d1\uff0c\u4e3a\u4ec0\u4e48 ip","_","forward \u6ca1\u6709\u6253\u5f00\uff0c\u4e24\u4e2a\u4e0d\u540c\u7684 ip \u5730\u5740\u6bb5\u4e4b\u95f4\u53ef\u4ee5\u901a\u4fe1\uff0c\u56e0\u4e3a IP \u5730\u5740\u662f\u5c5e\u4e8e\u5185\u6838\u7684\uff0c\u4e0d\u662f\u5c5e\u4e8e\u7f51\u5361\u7684\u3002")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"\u4e3e\u4f8b\uff1a\u67d0 Linux \u4e3b\u673a\u6709\u4e24\u7f51\u5361 eth0:172.16.10.5 \u548c eth1:192.168.100.20\uff0c\u67d0 192.168.100.22 \u4e3b\u673a\u7f51\u5173\u6307\u5411 192.168.100.20\uff0c\u82e5\u5b83 ping 172.16.10.5\uff0c\u7ed3\u679c\u5c06\u662f\u901a\u7684\uff0c\u56e0\u4e3a\u5730\u5740\u5c5e\u4e8e\u5185\u6838\uff0c\u4ece eth1 \u8fdb\u6765\u7684\u6570\u636e\u5305\u88ab\u5185\u6838\u5206\u6790\u65f6\uff0c\u53d1\u73b0\u76ee\u6807\u5730\u5740\u4e3a\u672c\u673a\u5730\u5740\uff0c\u76f4\u63a5\u5c31\u56de\u5e94 192.168.100.22\uff0c\u56de\u5e94\u6570\u636e\u5305\u7ee7\u7eed\u4ece eth1 \u51fa\u53bb\u3002"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"\u4e3e\u4f8b\uff1aLinux \u4e3b\u673a A \u6709\u4e24\u7f51\u5361 eth0:172.16.10.5 \u548c eth1:192.168.100.20\uff0c\u67d0 192.168.100.22 \u4e3b\u673a\u7f51\u5173\u6307\u5411 192.168.100.20\uff0c\u67d0 172.16.10.7 \u4e3b\u673a\u7f51\u5173\u6307\u5411 172.16.10.5\uff1b\u82e5 192.168.100.22 \u76f4\u63a5 ping 172.16.10.7 \u662f\u4e0d\u901a\u7684\uff0c\u5fc5\u987b\u5f00\u542f Linux \u4e3b\u673a A \u7684 ip","_","forward \u529f\u80fd\u624d\u80fd\u901a\u8d77\u6765\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"\u65b9\u6cd51\uff1a # echo 1 > /proc/sys/net/ipv4/ip_forward\n\u65b9\u6cd52\uff1a # sysctl -w net.ipv4.ip_forward=1\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"\u4ee5\u4e0a\u4e24\u79cd\u65b9\u6cd5\u662f\u4e34\u65f6\u751f\u6548\u7684\uff0c\u82e5\u8981\u6c38\u4e45\u751f\u6548\uff0c\u5219\u5e94\u8be5\u5199\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u5efa\u8bae\u5199\u5728 /etc/sysctl.d/","*",".conf \u4e2d\uff0c\u8fd9\u662f systemd \u63d0\u4f9b\u81ea\u5b9a\u4e49\u5185\u6838\u4fee\u6539\u9879\u7684\u76ee\u5f55\u3002"))),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# echo "net.ipv4.ip_forward=1" > /etc/sysctl.d/ip_forward.conf\n')),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\u67e5\u770b\u662f\u5426\u5f00\u542f\u4e86\u8f6c\u53d1\u529f\u80fd\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# sysctl net.ipv4.ip_forward\nnet.ipv4.ip_forward = 0\n[root@arm64v8 ~]# \n[root@arm64v8 ~]# cat /proc/sys/net/ipv4/ip_forward\n0\n[root@arm64v8 ~]# \n[root@arm64v8 ~]# sysctl -a | grep ip_forward\nnet.ipv4.ip_forward = 0\nnet.ipv4.ip_forward_use_pmtu = 0\n")))),(0,r.kt)("h2",{id:"22tcp-\u91cd\u8981\u6982\u5ff5"},"2.2\u3001TCP \u91cd\u8981\u6982\u5ff5"),(0,r.kt)("h3",{id:"221tcp-\u4e09\u6b21\u63e1\u624b"},"2.2.1\u3001TCP \u4e09\u6b21\u63e1\u624b"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"tcp establish",src:a(58171).Z,width:"1148",height:"1382"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u5904\u4e8e CLOSED \u72b6\u6001\uff0c\u53d1\u8d77 TCP \u8bf7\u6c42\u7684\u79f0\u4e3a\u5ba2\u6237\u7aef\uff0c\u63a5\u53d7\u8bf7\u6c42\u7684\u79f0\u4e3a\u670d\u52a1\u7aef\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u670d\u52a1\u7aef\u6253\u5f00\u670d\u52a1\u7aef\u53e3\uff0c\u5904\u4e8e listen \u72b6\u6001\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u62a5\u6587\u6bb5 1\uff0c\u5176\u4e2d\u7684 SYN \u6807\u5fd7\u4f4d\u7684\u503c\u4e3a 1\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u7528\u4e8e\u8bf7\u6c42\u53d1\u8d77\u8fde\u63a5\u7684\u62a5\u6587\u6bb5\uff0c\u5176\u4e2d\u7684\u5e8f\u53f7\u5b57\u6bb5 (Sequence Number\uff0c\u56fe\u4e2d\u7b80\u5199\u4e3a seq)\u88ab\u8bbe\u7f6e\u4e3a\u521d\u59cb\u5e8f\u53f7 x (Initial Sequence Number\uff0cISN)\uff0cTCP \u8fde\u63a5\u53cc\u65b9\u5747\u53ef\u968f\u673a\u9009\u62e9\u521d\u59cb\u5e8f\u53f7\u3002\u53d1\u9001\u5b8c\u62a5\u6587\u6bb5 1 \u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u8fdb\u5165 SYN-SENT \u72b6\u6001\uff0c\u7b49\u5f85\u670d\u52a1\u5668\u7684\u786e\u8ba4\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u670d\u52a1\u5668\u5728\u6536\u5230\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\u540e\uff0c\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u62a5\u6587\u6bb5 2 \u4f5c\u4e3a\u5e94\u7b54\uff0c\u5176\u4e2d ACK \u6807\u5fd7\u4f4d\u8bbe\u7f6e\u4e3a 1\uff0c\u8868\u793a\u5bf9\u5ba2\u6237\u7aef\u505a\u51fa\u5e94\u7b54\uff0c\u5176\u786e\u8ba4\u5e8f\u53f7\u5b57\u6bb5 (Acknowledgment Number\uff0c\u56fe\u4e2d\u7b80\u5199\u4e3a\u5c0f\u5199 ack) \u751f\u6548\uff0c\u8be5\u5b57\u6bb5\u503c\u4e3a x + 1\uff0c\u4e5f\u5c31\u662f\u4ece\u5ba2\u6237\u7aef\u6536\u5230\u7684\u62a5\u6587\u6bb5\u7684\u5e8f\u53f7\u52a0\u4e00\uff0c\u4ee3\u8868\u670d\u52a1\u5668\u671f\u671b\u4e0b\u6b21\u6536\u5230\u5ba2\u6237\u7aef\u7684\u6570\u636e\u7684\u5e8f\u53f7\u3002\u6b64\u5916\uff0c\u62a5\u6587\u6bb5 2 \u7684 SYN \u6807\u5fd7\u4f4d\u4e5f\u8bbe\u7f6e\u4e3a 1\uff0c\u4ee3\u8868\u8fd9\u540c\u65f6\u4e5f\u662f\u4e00\u4e2a\u7528\u4e8e\u53d1\u8d77\u8fde\u63a5\u7684\u62a5\u6587\u6bb5\uff0c\u5e8f\u53f7 seq \u8bbe\u7f6e\u4e3a\u670d\u52a1\u5668\u521d\u59cb\u5e8f\u53f7 y\u3002\u53d1\u9001\u5b8c\u62a5\u6587\u6bb5 2 \u540e\uff0c\u670d\u52a1\u5668\u8fdb\u5165 SYN-RECEIVED \u72b6\u6001\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5ba2\u6237\u7aef\u5728\u6536\u5230\u62a5\u6587\u6bb5 2 \u540e\uff0c\u5411\u670d\u52a1\u5668\u53d1\u9001\u62a5\u6587\u6bb5 3\uff0c\u5176 ACK \u6807\u5fd7\u4f4d\u4e3a 1\uff0c\u4ee3\u8868\u5bf9\u670d\u52a1\u5668\u505a\u51fa\u5e94\u7b54\uff0c\u786e\u8ba4\u5e8f\u53f7\u5b57\u6bb5 ack \u4e3a y + 1\uff0c\u5e8f\u53f7\u5b57\u6bb5 seq \u4e3a x + 1\u3002\u6b64\u62a5\u6587\u6bb5\u53d1\u9001\u5b8c\u6bd5\u540e\uff0c\u53cc\u65b9\u90fd\u8fdb\u5165 ESTABLISHED \u72b6\u6001\uff0c\u8868\u793a\u8fde\u63a5\u5df2\u5efa\u7acb\u3002")),(0,r.kt)("h3",{id:"222tcp-\u56db\u6b21\u6325\u624b"},"2.2.2\u3001TCP \u56db\u6b21\u6325\u624b"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"tcp break",src:a(75742).Z,width:"1304",height:"1470"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5f53\u524d\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u5904\u4e8e established \u5df2\u8fde\u63a5\u72b6\u6001\uff0c\u800c\u4e14\u53ef\u4ee5\u6b63\u5e38\u76f8\u4e92\u4f20\u8f93\u6587\u4ef6\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5ba2\u6237\u7aef\u53d1\u9001\u5173\u95ed\u8fde\u63a5\u7684\u62a5\u6587\u6bb5\uff0cFIN \u6807\u5fd7\u4f4d 1\uff0c\u8bf7\u6c42\u5173\u95ed\u8fde\u63a5\uff0c\u5e76\u505c\u6b62\u53d1\u9001\u6570\u636e\u3002\u5e8f\u53f7\u5b57\u6bb5 seq = x (\u7b49\u4e8e\u4e4b\u524d\u53d1\u9001\u7684\u6240\u6709\u6570\u636e\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u8282\u7684\u5e8f\u53f7\u52a0\u4e00)\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u4f1a\u8fdb\u5165 FIN-WAIT-1 \u72b6\u6001\uff0c\u7b49\u5f85\u6765\u81ea\u670d\u52a1\u5668\u7684\u786e\u8ba4\u62a5\u6587\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u670d\u52a1\u5668\u6536\u5230 FIN \u62a5\u6587\u540e\uff0c\u53d1\u56de\u786e\u8ba4\u62a5\u6587\uff0cACK = 1\uff0c ack = x + 1\uff0c\u5e76\u5e26\u4e0a\u81ea\u5df1\u7684\u5e8f\u53f7 seq = y\uff0c\u7136\u540e\u670d\u52a1\u5668\u5c31\u8fdb\u5165 CLOSE-WAIT \u72b6\u6001\u3002\u670d\u52a1\u5668\u8fd8\u4f1a\u901a\u77e5\u4e0a\u5c42\u7684\u5e94\u7528\u7a0b\u5e8f\u5bf9\u65b9\u5df2\u7ecf\u91ca\u653e\u8fde\u63a5\uff0c\u6b64\u65f6 TCP \u5904\u4e8e\u534a\u5173\u95ed\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u8bf4\u5ba2\u6237\u7aef\u5df2\u7ecf\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u4e86\uff0c\u4f46\u662f\u670d\u52a1\u5668\u8fd8\u53ef\u4ee5\u53d1\u9001\u6570\u636e\uff0c\u5ba2\u6237\u7aef\u4e5f\u8fd8\u80fd\u591f\u63a5\u6536\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u5668\u7684 ACK \u62a5\u6587\u6bb5\u540e\u968f\u5373\u8fdb\u5165 FIN-WAIT-2 \u72b6\u6001\uff0c\u6b64\u65f6\u8fd8\u80fd\u6536\u5230\u6765\u81ea\u670d\u52a1\u5668\u7684\u6570\u636e\uff0c\u76f4\u5230\u6536\u5230 FIN \u62a5\u6587\u6bb5\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u670d\u52a1\u5668\u53d1\u9001\u5b8c\u6240\u6709\u6570\u636e\u540e\uff0c\u4f1a\u5411\u5ba2\u6237\u7aef\u53d1\u9001 FIN \u62a5\u6587\u6bb5\uff0c\u5404\u5b57\u6bb5\u503c\u5982\u56fe\u6240\u793a\uff0c\u968f\u540e\u670d\u52a1\u5668\u8fdb\u5165 LAST-ACK \u72b6\u6001\uff0c\u7b49\u5f85\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u786e\u8ba4\u62a5\u6587\u6bb5\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5ba2\u6237\u7aef\u6536\u5230\u6765\u81ea\u670d\u52a1\u5668\u7684 FIN \u62a5\u6587\u6bb5\u540e\uff0c\u5411\u670d\u52a1\u5668\u53d1\u9001 ACK \u62a5\u6587\uff0c\u968f\u540e\u8fdb\u5165 TIME-WAIT \u72b6\u6001\uff0c\u7b49\u5f85 2MSL(2 ","*"," Maximum Segment Lifetime\uff0c\u4e24\u500d\u7684\u62a5\u6587\u6bb5\u6700\u5927\u5b58\u6d3b\u65f6\u95f4) \uff0c\u8fd9\u662f\u4efb\u4f55\u62a5\u6587\u6bb5\u5728\u88ab\u4e22\u5f03\u524d\u80fd\u5728\u7f51\u7edc\u4e2d\u5b58\u5728\u7684\u6700\u957f\u65f6\u95f4\uff0c\u5e38\u7528\u503c\u6709 30 \u79d2\u30011 \u5206\u949f\u548c 2 \u5206\u949f\u3002\u5982\u65e0\u7279\u6b8a\u60c5\u51b5\uff0c\u5ba2\u6237\u7aef\u4f1a\u8fdb\u5165 CLOSED \u72b6\u6001\u3002",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u6309\u7167\u5e38\u7406\uff0c\u5728\u7f51\u7edc\u6b63\u5e38\u7684\u60c5\u51b5\u4e0b\uff0c\u56db\u4e2a\u62a5\u6587\u6bb5\u53d1\u9001\u5b8c\u540e\uff0c\u53cc\u65b9\u5c31\u53ef\u4ee5\u5173\u95ed\u8fde\u63a5\u8fdb\u5165 CLOSED \u72b6\u6001\u4e86\uff0c\u4f46\u662f\u7f51\u7edc\u5e76\u4e0d\u603b\u662f\u53ef\u9760\u7684\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001\u7684 ACK \u62a5\u6587\u6bb5\u4e22\u5931\uff0c\u670d\u52a1\u5668\u5728\u63a5\u6536\u4e0d\u5230 ACK \u7684\u60c5\u51b5\u4e0b\u4f1a\u4e00\u76f4\u91cd\u53d1 FIN \u62a5\u6587\u6bb5\uff0c\u8fd9\u663e\u7136\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u56e0\u6b64\u5ba2\u6237\u7aef\u4e3a\u4e86\u786e\u4fdd\u670d\u52a1\u5668\u6536\u5230\u4e86 ACK\uff0c\u4f1a\u8bbe\u7f6e\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5e76\u5728 TIME-WAIT \u72b6\u6001\u7b49\u5f85 2MSL \u7684\u65f6\u95f4\uff0c\u5982\u679c\u5728\u6b64\u671f\u95f4\u53c8\u6536\u5230\u4e86\u6765\u81ea\u670d\u52a1\u5668\u7684 FIN \u62a5\u6587\u6bb5\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u4f1a\u91cd\u65b0\u8bbe\u7f6e\u8ba1\u65f6\u5668\u5e76\u518d\u6b21\u7b49\u5f85 2MSL \u7684\u65f6\u95f4\uff0c\u5982\u679c\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\u6ca1\u6709\u6536\u5230\u6765\u81ea\u670d\u52a1\u5668\u7684 FIN \u62a5\u6587\uff0c\u90a3\u5c31\u8bf4\u660e\u670d\u52a1\u5668\u5df2\u7ecf\u6210\u529f\u6536\u5230\u4e86 ACK \u62a5\u6587\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u8fdb\u5165 CLOSED \u72b6\u6001\u4e86\u3002"))),(0,r.kt)("li",{parentName:"ol"},"\u670d\u52a1\u5668\u5728\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u7684 ACK \u62a5\u6587\u540e\u4f1a\u968f\u5373\u8fdb\u5165 CLOSED \u72b6\u6001\uff0c\u7531\u4e8e\u6ca1\u6709\u7b49\u5f85\u65f6\u95f4\uff0c\u4e00\u822c\u800c\u8a00\uff0c\u670d\u52a1\u5668\u6bd4\u5ba2\u6237\u7aef\u66f4\u65e9\u8fdb\u5165 CLOSED \u72b6\u6001\u3002")),(0,r.kt)("h3",{id:"223syn-flood-\u653b\u51fb"},"2.2.3\u3001syn flood \u653b\u51fb"),(0,r.kt)("p",null,"syn \u6d2a\u6c34\u653b\u51fb\u662f\u4e00\u79cd\u5e38\u89c1\u7684 DDos \u653b\u51fb\u624b\u6bb5\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u5de5\u5177\u5728\u6781\u77ed\u65f6\u95f4\u5185\u4f2a\u9020\u5927\u91cf\u968f\u673a\u4e0d\u5b58\u5728\u7684 ip \u5411\u670d\u52a1\u5668\u6307\u5b9a\u7aef\u53e3\u53d1\u9001 tcp \u8fde\u63a5\u8bf7\u6c42\uff0c\u4e5f\u5c31\u662f\u53d1\u9001\u4e86\u5927\u91cf syn=1 ack=0 \u7684\u6570\u636e\u5305\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u670d\u52a1\u5668\u6536\u5230\u4e86\u8be5\u6570\u636e\u5305\u540e\u4f1a\u56de\u590d\u5e76\u540c\u6837\u53d1\u9001 syn \u8bf7\u6c42 tcp \u8fde\u63a5\uff0c\u4e5f\u5c31\u662f\u53d1\u9001 ack=1 syn=1 \u7684\u6570\u636e\u5305\uff0c\u6b64\u540e\u670d\u52a1\u5668\u8fdb\u5165 SYN-RECV \u72b6\u6001\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u5668\u671f\u5f85\u6536\u5230\u5ba2\u6237\u7aef\u7684 ACK \u56de\u590d\u3002\u4f46\u95ee\u9898\u662f\u670d\u52a1\u5668\u56de\u590d\u7684\u76ee\u6807 ip \u662f\u4e0d\u5b58\u5728\u7684\uff0c\u6240\u4ee5\u56de\u590d\u7684\u6570\u636e\u5305\u603b\u88ab\u4e22\u5f03\uff0c\u4e5f\u4e00\u76f4\u65e0\u6cd5\u6536\u5230 ACK \u56de\u590d\uff0c\u4e8e\u662f\u4e0d\u65ad\u91cd\u53d1 ack=1 syn=1 \u7684\u56de\u590d\u5305\u76f4\u81f3\u8d85\u65f6\u3002")),(0,r.kt)("p",null,"\u5728\u670d\u52a1\u5668\u88ab syn flood \u653b\u51fb\u65f6\uff0c\u7531\u4e8e\u4e0d\u65ad\u6536\u5230\u5927\u91cf\u4f2a\u9020\u7684 syn=1 ack=0 \u8bf7\u6c42\u5305\uff0c\u5b83\u4eec\u5c06\u957f\u65f6\u95f4\u5360\u7528\u8d44\u6e90\u961f\u5217\uff0c\u4f7f\u5f97\u6b63\u5e38\u7684 SYN \u8bf7\u6c42\u65e0\u6cd5\u5f97\u5230\u6b63\u786e\u5904\u7406\uff0c\u800c\u4e14\u670d\u52a1\u5668\u4e00\u76f4\u5904\u4e8e\u91cd\u4f20\u54cd\u5e94\u5305\u7684\u72b6\u6001\uff0c\u4f7f\u5f97 cpu \u8d44\u6e90\u4e5f\u88ab\u6d88\u8017\u3002"),(0,r.kt)("p",null,"\u56e0\u6b64\uff0c\u9632\u8303 syn flood \u653b\u51fb\u975e\u5e38\u91cd\u8981\u3002\u5f53\u7136\uff0c\u9996\u5148\u9700\u8981\u5224\u65ad\u51fa\u662f\u5426\u53d7\u5230\u4e86 syn flood \u653b\u51fb\u3002\u53ef\u4ee5\u901a\u8fc7\u6293\u5305\u5de5\u5177\u6216\u8005 netstat \u7b49\u5de5\u5177\u83b7\u53d6\u5904\u4e8e SYN","_","RECV \u72b6\u6001\u7684\u534a\u8fde\u63a5\uff0c\u5982\u679c\u6709\u5927\u91cf\u5904\u4e8e SYN","_","RECV \u4e14\u6e90\u5730\u5740\u90fd\u662f\u4e71\u4e03\u516b\u7cdf\u7684\uff0c\u8bf4\u660e\u53d7\u5230\u4e86 syn \u6d2a\u6c34\u653b\u51fb\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\u4f7f\u7528 netstat \u5de5\u5177\u5224\u65ad\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# netstat -tnlpa | grep tcp | awk '{print $6}' | sort | uniq -c\n")),(0,r.kt)("h2",{id:"23\u9632\u706b\u5899\u7684\u5e94\u7528"},"2.3\u3001\u9632\u706b\u5899\u7684\u5e94\u7528"),(0,r.kt)("p",null,"\u4ece\u8bbe\u5907\u4e0a\u5206\u7c7b\uff0c\u9632\u706b\u5899\u5206\u4e3a\u8f6f\u4ef6\u9632\u706b\u5899\u3001\u786c\u4ef6\u9632\u706b\u5899\u3001\u82af\u7247\u7ea7\u9632\u706b\u5899\u3002\u540e\u6587\u6240\u8bf4\u7684\u53ef\u80fd\u662f\u8f6f\u4ef6\u9632\u706b\u5899\u3001\u4e5f\u53ef\u80fd\u662f\u786c\u4ef6\u9632\u706b\u5899\uff0c\u5728\u7406\u89e3\u4e0a\u5b83\u4eec\u6ca1\u4ec0\u4e48\u533a\u522b\uff0c\u53ea\u662f\u5c06\u9632\u706b\u5899\u5265\u79bb\u6210\u4e86\u72ec\u81ea\u7684\u670d\u52a1\u5668\u800c\u5df2\u3002"),(0,r.kt)("p",null,"\u4ece\u6280\u672f\u4e0a\u5206\u7c7b\uff0c\u9632\u706b\u5899\u5206\u4e3a\u6570\u636e\u5305\u8fc7\u6ee4\u578b\u9632\u706b\u5899\u3001\u5e94\u7528\u4ee3\u7406\u578b\u9632\u706b\u5899\u3002\u8fd9\u662f\u56e0\u4e3a\u56db\u5c42\u6a21\u578b\u7684\u6bcf\u4e00\u5c42\u90fd\u53ef\u4ee5\u5e94\u7528\u9632\u706b\u5899\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u4ece\u94fe\u8def\u5c42\u5224\u65ad\u662f\u5426\u5904\u7406")),(0,r.kt)("p",null,"\u57fa\u4e8e\u94fe\u8def\u5c42\u7684\u9632\u706b\u5899\u662f\u63a7\u5236 MAC \u7684\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u5c06\u516c\u53f8\u5185\u7f51\u5458\u5de5\u7535\u8111\u7684 MAC \u5730\u5740\u5168\u90e8\u8bb0\u5f55\u5230\u9632\u706b\u5899\u4e0a\uff0c\u4ece\u800c\u9650\u5236\u4ed6\u4eec\u4e0a\u5916\u7f51\u3002\u518d\u4f8b\u5982\uff0c\u53ef\u4ee5\u5c06\u516c\u53f8\u7535\u8111\u7684 MAC \u5730\u5740\u5168\u90e8\u8bb0\u5f55\u5230\u9632\u706b\u5899\u4f7f\u4ed6\u4eec\u80fd\u591f\u4e0a\u7f51\uff0c\u4f46\u662f\u975e\u672c\u516c\u53f8\u7684\u7535\u8111\u5c31\u65e0\u6cd5\u4ece\u672c\u516c\u53f8\u4e0a\u7f51\u3002"),(0,r.kt)("p",null,"\u4f46\u662f\uff0c\u57fa\u672c\u4e0a\u4e0d\u4f1a\u6709\u516c\u53f8\u8fd9\u6837\u505a\uff0c\u8fd9\u6837\u7684\u884c\u4e3a\u592a\u6b7b\u677f\uff0c\u800c\u4e14\u8bb0\u5f55 MAC \u5730\u5740\u672c\u8eab\u5c31\u662f\u4e00\u4ef6\u5f88\u9ebb\u70e6\u7684\u4e8b\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u4ece\u7f51\u7edc\u5c42\u5224\u65ad\u662f\u5426\u5904\u7406")),(0,r.kt)("p",null,"\u7f51\u7edc\u5c42\u7684\u6838\u5fc3\u662f IP\uff08\u4e5f\u5305\u62ec icmp \u7b49\uff09\u3002\u6240\u4ee5\u4ece\u7f51\u7edc\u5c42\u6765\u5224\u65ad\uff0c\u53ef\u4ee5\u57fa\u4e8e\u6e90 IP\u3001\u76ee\u6807 IP \u6765\u6307\u5b9a\u9632\u706b\u5899\u7684\u89c4\u5219\u3002\u4f8b\u5982\uff0c\u6765\u81ea 38.68.100.61 \u7684\u4e3b\u673a\u4e0d\u80fd\u7a7f\u8fc7\u9632\u706b\u5899\uff1b\u8bbf\u95ee\u76ee\u6807\u662f 192.168.109.19 \u7684\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u4e0d\u80fd\u8ba9\u5176\u7a7f\u8fc7\u9632\u706b\u5899\uff1b\u8fd8\u53ef\u4ee5\u8bbe\u7f6e icmp \u534f\u8bae\u4f5c\u4e3a\u5224\u65ad\u4f9d\u636e\uff0c\u4f7f\u5f97\u5916\u7f51\u4eba\u5458\u7684 ping \u5305\u88ab\u6321\u4f4f\u3002"),(0,r.kt)("p",null,"\u5728\u7f51\u7edc\u5c42\u53ef\u4ee5\u7528\u6765\u5236\u5b9a\u9632\u706b\u5899\u89c4\u5219\u7684\u5185\u5bb9\u6709\u5f88\u591a\u3002\u5982\u4e0b\u8868\u3002\u6700\u5e38\u7528\u7684\u4e5f\u5c31\u662f\u540e\u4e09\u4e2a\u800c\u5df2\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ip package",src:a(39711).Z,width:"556",height:"167"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u4ece\u4f20\u8f93\u5c42\u5224\u65ad\u662f\u5426\u5904\u7406")),(0,r.kt)("p",null,"\u53ef\u4ee5\u4ece TCP \u6216\u8005 UDP \u6765\u5224\u65ad\u3002\u4ee5 TCP \u4e3a\u4f8b\uff0c\u4f8b\u5982\u9650\u5236\u76ee\u6807\u7aef\u53e3\u662f 22 \u7aef\u53e3\u7684\u8bf7\u6c42\uff0c\u8fd9\u6837 SSH \u5c31\u65e0\u6cd5\u8fde\u63a5\u4e0a\u670d\u52a1\u5668\u4e86\u3002"),(0,r.kt)("p",null,"\u4e0b\u8868\u662f TCP \u6570\u636e\u5305\u4e2d\u53ef\u4ee5\u7528\u6765\u5236\u5b9a\u9632\u706b\u5899\u89c4\u5219\u7684\u5b57\u6bb5\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"tcp package",src:a(75381).Z,width:"537",height:"115"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u4ece\u5e94\u7528\u5c42\u5224\u65ad\u662f\u5426\u5904\u7406")),(0,r.kt)("p",null,"\u5230\u4e86\u8fd9\u4e00\u5c42\u7684\u5904\u7406\u5c31\u5c5e\u4e8e\u5e94\u7528\u4ee3\u7406\u578b\u7684\u9632\u706b\u5899\u4e86\u3002\u4ed6\u9700\u8981\u89e3\u5f00\u6570\u636e\u5305\u5e76\u8fd8\u539f\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b83\u53ef\u4ee5\u83b7\u53d6\u5230\u6570\u636e\u5305\u4e2d\u7684\u6240\u6709\u5185\u5bb9\uff0c\u4f46\u4e5f\u56e0\u6b64\u8d1f\u62c5\u5f88\u91cd\uff0c\u6240\u9700 CPU \u548c\u5185\u5b58\u8f83\u5927\u3002\u8fd9\u79cd\u9632\u706b\u5899\u5728\u4f01\u4e1a\u5f53\u4e2d\u5f88\u5e38\u89c1\uff0c\u4fbf\u4e8e\u7ba1\u7406\u4f01\u4e1a\u5458\u5de5\u4e0a\u7f51\u884c\u4e3a\uff0c\u4f01\u4e1a\u7ea7\u5e94\u7528\u9632\u706b\u5899\u975e\u5e38\u6602\u8d35\uff0c\u7531\u4f01\u4e1a\u5b9e\u529b\u51b3\u5b9a\u3002"),(0,r.kt)("h2",{id:"24linux-\u9632\u706b\u5899"},"2.4\u3001Linux \u9632\u706b\u5899"),(0,r.kt)("h3",{id:"241netfilter-\u4e0e\u5176\u6a21\u5757"},"2.4.1\u3001netfilter \u4e0e\u5176\u6a21\u5757"),(0,r.kt)("p",null,"Linux \u662f\u4e00\u4e2a\u6781\u5176\u6a21\u5757\u5316\u7684\u5185\u6838\u3002netfilter \u4e5f\u662f\u4ee5\u6a21\u5757\u5316\u7684\u5f62\u5f0f\u5b58\u5728\u4e8e Linux \u4e2d\uff0c\u6240\u4ee5\u6bcf\u6dfb\u52a0\u4e00\u4e2a\u548c netfilter \u76f8\u5173\u7684\u6a21\u5757\uff0c\u4ee3\u8868\u7740 netfilter \u5c31\u591a\u4e00\u4e2a\u529f\u80fd\u3002"),(0,r.kt)("p",null,"\u4f46\u662f\u6709\u4e9b\u6a21\u5757\u662f\u4f7f\u7528 netfilter \u6240\u5fc5\u987b\u7684\uff0c\u6240\u4ee5\u8fd9\u4e9b\u6a21\u5757\u5df2\u7ecf\u9ed8\u8ba4\u7f16\u8bd1\u5230\u5185\u6838\u4e2d\u800c\u975e\u9700\u8981\u65f6\u52a0\u8f7d\u3002"),(0,r.kt)("p",null,"\u5b58\u653e netfilter \u6a21\u5757\u7684\u76ee\u5f55\u6709\u4e09\u4e2a\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"/lib/modules/$kernel_ver/net/{netfilter,ipv4/netfilter,ipv6/netfilter}"),"\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"$kernel_ver")," \u4ee3\u8868\u5185\u6838\u7248\u672c\u53f7\u3002"),(0,r.kt)("p",null,"\u5176\u4e2d ipv4/netfilter/ \u5b58\u653e\u7684 ipv4 \u7684 netfilter\uff0cipv6/netfilter/ \u5b58\u653e\u7684 ipv6 \u7684 netfilter\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"/lib/modules/$kernel_net/kernel/netnetfilter/")," \u5b58\u653e\u7684\u662f\u540c\u65f6\u6ee1\u8db3 ipv4 \u548c ipv6 \u7684 netfilter\u3002\u5728\u6700\u540e\u4e00\u4e2a\u76ee\u5f55\u4e2d\u653e\u5165\u66f4\u591a\u7684\u6a21\u5757\uff0c\u662f netfilter \u56e2\u961f\u53d1\u5c55\u7684\u76ee\u6807\uff0c\u56e0\u4e3a\u8981\u7ef4\u62a4 ipv4 \u548c ipv6 \u4e24\u4e2a\u7248\u672c\u633a\u7d2f\u7684\u3002"),(0,r.kt)("h3",{id:"242iptables-\u548c-netfilter-\u7684\u5173\u7cfb"},"2.4.2\u3001iptables \u548c netfilter \u7684\u5173\u7cfb"),(0,r.kt)("p",null,"Linux \u4e2d\u6700\u5e38\u7528\u7684\u57fa\u672c\u9632\u706b\u5899\u8f6f\u4ef6\u53eb\u505a iptables\u3002iptables \u9632\u706b\u5899\u901a\u8fc7\u4e0e Linux \u5185\u6838\u7f51\u7edc\u5806\u6808\u4e2d\u7684\u5305\u8fc7\u6ee4\u94a9\u5b50\u4ea4\u4e92\u6765\u5de5\u4f5c\u3002\u8fd9\u4e9b\u5185\u6838\u94a9\u5b50\u88ab\u79f0\u4e3a netfilter \u6846\u67b6\u3002"),(0,r.kt)("p",null,"\u9632\u706b\u5899\u8d77\u4f5c\u7528\u7684\u662f Netfilter\uff0c\u800c ",(0,r.kt)("strong",{parentName:"p"},"iptables \u53ea\u662f\u7ba1\u7406\u63a7\u5236 netfilter \u7684\u5de5\u5177"),"\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u5de5\u5177\u8fdb\u884c\u76f8\u5173\u89c4\u5219\u7684\u5236\u5b9a\u4ee5\u53ca\u5176\u4ed6\u7684\u52a8\u4f5c\u3002iptables \u662f\u7528\u6237\u5c42\u7684\u7a0b\u5e8f\uff0cnetfilter \u662f\u5185\u6838\u7a7a\u95f4\u7684\uff0c\u5728 netfilter \u521a\u52a0\u5165\u5230 Linux \u4e2d\u65f6\uff0cnetfilter \u662f\u4e00\u4e2a Linux \u7684\u4e00\u4e2a\u5185\u6838\u6a21\u5757\uff0c\u8981\u5b9e\u73b0\u5176\u4ed6\u7684\u9632\u706b\u5899\u884c\u4e3a\u8fd8\u9700\u8981\u52a0\u8f7d\u5176\u4ed6\u5bf9\u5e94\u7684\u6a21\u5757\uff0c\u5230\u4e86\u540e\u6765 netfilter \u4e00\u90e8\u5206\u5fc5\u987b\u7684\u6a21\u5757\u5df2\u7ecf\u52a0\u5165\u5230\u5185\u6838\u4e2d\u4e86\u3002"),(0,r.kt)("h3",{id:"243netfilter-\u7684\u7ed3\u6784"},"2.4.3\u3001netfilter \u7684\u7ed3\u6784"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"iptables",src:a(21164).Z,width:"1772",height:"2255"})),(0,r.kt)("p",null,"\u60f3\u8981\u5b8c\u5168\u7406\u89e3\u8fd9\u4e2a\u56fe\uff0c\u5f97\u6709\u4e00\u5b9a\u7684\u57fa\u7840\u77e5\u8bc6\uff0c\u4e0b\u9762\u6211\u4eec\u9700\u8981\u7406\u89e3\u51e0\u4e2a\u6982\u5ff5\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Netfilter Hooks\uff1a\u6709\u4e94\u4e2a netfilter \u94a9\u5b50\u7a0b\u5e8f\u53ef\u4ee5\u6ce8\u518c\u3002\u5f53\u5305\u901a\u8fc7\u5806\u6808\u65f6\uff0c\u5b83\u4eec\u5c06\u89e6\u53d1\u5df2\u7ecf\u6ce8\u518c\u4e86\u8fd9\u4e9b\u94a9\u5b50\u7684\u5185\u6838\u6a21\u5757\u3002\u6570\u636e\u5305\u89e6\u53d1\u7684\u94a9\u5b50\u53d6\u51b3\u4e8e\u6570\u636e\u5305\u662f\u4f20\u5165\u8fd8\u662f\u4f20\u51fa\u3001\u6570\u636e\u5305\u7684\u76ee\u7684\u5730\u4ee5\u53ca\u6570\u636e\u5305\u662f\u5426\u5728\u524d\u4e00\u4e2a\u70b9\u88ab\u4e22\u5f03\u6216\u62d2\u7edd\u3002"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"NF","_","IP","_","PRE","_","ROUTING\uff1a\u5728\u8fdb\u5165\u7f51\u7edc\u5806\u6808\u540e\u4e0d\u4e45\uff0c\u4efb\u4f55\u4f20\u5165\u7684\u6d41\u91cf\u90fd\u4f1a\u89e6\u53d1\u8fd9\u4e2a\u94a9\u5b50\u3002\u8fd9\u4e2a\u94a9\u5b50\u5728\u51b3\u5b9a\u5c06\u5305\u53d1\u9001\u5230\u54ea\u91cc\u4e4b\u524d\u88ab\u5904\u7406\u3002"),(0,r.kt)("li",{parentName:"ul"},"NF","_","IP","_","LOCAL","_","IN\uff1a\u5982\u679c\u4f20\u5165\u7684\u6570\u636e\u5305\u7684\u76ee\u7684\u5730\u662f\u672c\u5730\u7cfb\u7edf\uff0c\u5219\u5728\u8be5\u6570\u636e\u5305\u88ab\u8def\u7531\u540e\u89e6\u53d1\u8be5\u94a9\u5b50\u3002"),(0,r.kt)("li",{parentName:"ul"},"NF","_","IP","_","FORWARD\uff1a\u5982\u679c\u4f20\u5165\u7684\u6570\u636e\u5305\u8981\u8f6c\u53d1\u5230\u53e6\u4e00\u4e2a\u4e3b\u673a\uff0c\u5219\u5728\u8def\u7531\u5b8c\u6210\u540e\u89e6\u53d1\u8be5\u94a9\u5b50\u3002"),(0,r.kt)("li",{parentName:"ul"},"NF","_","IP","_","LOCAL","_","OUT\uff1a\u4efb\u4f55\u672c\u5730\u521b\u5efa\u7684\u51fa\u7ad9\u6d41\u91cf\u4e00\u65e6\u5230\u8fbe\u7f51\u7edc\u5806\u6808\u5c31\u4f1a\u89e6\u53d1\u8fd9\u4e2a\u94a9\u5b50\u3002"),(0,r.kt)("li",{parentName:"ul"},"NF","_","IP","_","POST","_","ROUTING\uff1a\u8def\u7531\u53d1\u751f\u540e\u548c\u5728\u7ebf\u8def\u4e0a\u53d1\u51fa\u4e4b\u524d\u7684\u4efb\u4f55\u4f20\u51fa\u6216\u8f6c\u53d1\u7684\u6d41\u91cf\u4f1a\u89e6\u53d1\u8be5\u94a9\u5b50\u3002"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"IPTables Chains\uff1a\u6b63\u5982\u4f60\u6240\u770b\u5230\u7684\uff0c\u5185\u7f6e\u94fe\u7684\u540d\u79f0\u53cd\u6620\u4e86\u5b83\u4eec\u5173\u8054\u7684 netfilter \u94a9\u5b50\u7684\u540d\u79f0\uff1a"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"PREROUTING\uff1a\u7531 NF","_","IP","_","PRE","_","ROUTING \u94a9\u5b50\u89e6\u53d1\u3002"),(0,r.kt)("li",{parentName:"ul"},"INPUT\uff1a\u7531 NF","_","IP","_","LOCAL","_","IN \u94a9\u5b50\u89e6\u53d1\u3002"),(0,r.kt)("li",{parentName:"ul"},"FORWARD\uff1a\u7531 NF","_","IP","_","FORWARD \u94a9\u5b50\u89e6\u53d1\u3002"),(0,r.kt)("li",{parentName:"ul"},"OUTPUT\uff1a\u7531 NF","_","IP","_","LOCAL","_","OUT \u94a9\u5b50\u89e6\u53d1\u3002"),(0,r.kt)("li",{parentName:"ul"},"POSTROUTING\uff1a\u7531 NF","_","IP","_","POST","_","ROUTING \u94a9\u5b50\u89e6\u53d1\u3002"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"IPTables Tables\uff1aiptables \u9632\u706b\u5899\u4f7f\u7528\u8868\u6765\u7ec4\u7ec7\u5176\u89c4\u5219\u3002\u8fd9\u4e9b\u8868\u6839\u636e\u89c4\u5219\u6240\u4f7f\u7528\u7684\u51b3\u7b56\u7c7b\u578b\u5bf9\u89c4\u5219\u8fdb\u884c\u5206\u7c7b\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e00\u4e2a\u89c4\u5219\u5904\u7406\u7f51\u7edc\u5730\u5740\u8f6c\u6362\uff0c\u5b83\u5c06\u88ab\u653e\u5165 nat \u8868\u4e2d\u3002\u5982\u679c\u4f7f\u7528\u8be5\u89c4\u5219\u6765\u51b3\u5b9a\u662f\u5426\u5141\u8bb8\u6570\u636e\u5305\u7ee7\u7eed\u5230\u8fbe\u5b83\u7684\u76ee\u7684\u5730\uff0c\u5b83\u53ef\u80fd\u4f1a\u88ab\u6dfb\u52a0\u5230 filter \u8868\u4e2d\u3002"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},'Filter Table\uff1afilter \u8868\u662f iptables \u4e2d\u4f7f\u7528\u6700\u5e7f\u6cdb\u7684\u8868\u4e4b\u4e00\u3002filter \u8868\u7528\u4e8e\u51b3\u5b9a\u662f\u8ba9\u6570\u636e\u5305\u7ee7\u7eed\u5230\u8fbe\u9884\u671f\u76ee\u7684\u5730\u8fd8\u662f\u62d2\u7edd\u5b83\u7684\u8bf7\u6c42\u3002\u7528\u9632\u706b\u5899\u7684\u8bf4\u6cd5\uff0c\u8fd9\u88ab\u79f0\u4e3a "\u8fc7\u6ee4" \u5305\u3002\u8be5\u8868\u63d0\u4f9b\u4e86\u4eba\u4eec\u5728\u8ba8\u8bba\u9632\u706b\u5899\u65f6\u60f3\u5230\u7684\u5927\u90e8\u5206\u529f\u80fd\u3002'),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b\u8868\u4e2d\u7684\u94fe\u548c\u89c4\u5219\n[root@arm64v8 ~]# iptables -t filter -L\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination       \n[root@arm64v8 ~]#\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"NAT Table\uff1anat \u8868\u7528\u4e8e\u5b9e\u73b0\u7f51\u7edc\u5730\u5740\u8f6c\u6362\u89c4\u5219\u3002\u53ef\u4ee5\u8f6c\u6362\u6e90\u5730\u5740\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u6807\u5730\u5740\u3001\u76ee\u6807\u7aef\u53e3\u7b49\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b\u8868\u4e2d\u7684\u94fe\u548c\u89c4\u5219\n[root@arm64v8 ~]# iptables -t nat -L\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination       \n[root@arm64v8 ~]#\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Mangle Table\uff1amangle \u8868\u7528\u4e8e\u4ee5\u5404\u79cd\u65b9\u5f0f\u6539\u53d8\u6570\u636e\u5305\u7684 IP \u5934\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u8c03\u6574\u6570\u636e\u5305\u7684 TTL(\u751f\u5b58\u65f6\u95f4)\u503c\uff0c\u53ef\u4ee5\u5ef6\u957f\u6216\u7f29\u77ed\u6570\u636e\u5305\u7ef4\u6301\u7684\u6709\u6548\u7f51\u7edc\u8df3\u6570\u3002\u5176\u4ed6 IP \u62a5\u5934\u53ef\u4ee5\u7528\u7c7b\u4f3c\u7684\u65b9\u5f0f\u66f4\u6539\u3002"),(0,r.kt)("p",{parentName:"li"},'\u8be5\u8868\u8fd8\u53ef\u4ee5\u5728\u5305\u4e0a\u653e\u7f6e\u4e00\u4e2a\u5185\u90e8\u5185\u6838 "\u6807\u8bb0"\uff0c\u4ee5\u4fbf\u5728\u5176\u4ed6\u8868\u548c\u5176\u4ed6\u7f51\u7edc\u5de5\u5177\u4e2d\u8fdb\u884c\u8fdb\u4e00\u6b65\u5904\u7406\u3002\u8fd9\u4e2a\u6807\u8bb0\u4e0d\u63a5\u89e6\u5b9e\u9645\u7684\u5305\uff0c\u800c\u662f\u5c06\u6807\u8bb0\u6dfb\u52a0\u5230\u5185\u6838\u5bf9\u5305\u7684\u8868\u793a\u4e2d\u3002'),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b\u8868\u4e2d\u7684\u94fe\u548c\u89c4\u5219\n[root@arm64v8 ~]# iptables -t mangle -L\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination       \n[root@arm64v8 ~]#\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Raw Table\uff1aiptables \u9632\u706b\u5899\u662f\u6709\u72b6\u6001\u7684\uff0c\u8fd9\u610f\u5473\u7740\u6570\u636e\u5305\u6839\u636e\u5b83\u4eec\u4e0e\u524d\u4e00\u4e2a\u6570\u636e\u5305\u7684\u5173\u7cfb\u8fdb\u884c\u8bc4\u4f30\u3002\u5efa\u7acb\u5728 netfilter \u6846\u67b6\u4e4b\u4e0a\u7684\u8fde\u63a5\u8ddf\u8e2a\u7279\u6027\uff0c\u5141\u8bb8 iptables \u5c06\u6570\u636e\u5305\u89c6\u4e3a\u6b63\u5728\u8fdb\u884c\u7684\u8fde\u63a5\u6216\u4f1a\u8bdd\u7684\u4e00\u90e8\u5206\uff0c\u800c\u4e0d\u662f\u4f5c\u4e3a\u79bb\u6563\u7684\u3001\u4e0d\u76f8\u5173\u7684\u6570\u636e\u5305\u6d41\u3002\u901a\u5e38\u5728\u6570\u636e\u5305\u5230\u8fbe\u7f51\u7edc\u63a5\u53e3\u540e\u5f88\u5feb\u8fdb\u884c\u8fde\u63a5\u8ddf\u8e2a\u3002"),(0,r.kt)("p",{parentName:"li"},"raw \u8868\u6709\u4e00\u4e2a\u5b9a\u4e49\u975e\u5e38\u72ed\u7a84\u7684\u51fd\u6570\u3002\u5b83\u7684\u552f\u4e00\u76ee\u7684\u662f\u63d0\u4f9b\u4e00\u79cd\u673a\u5236\u6765\u6807\u8bb0\u6570\u636e\u5305\uff0c\u4ee5\u4fbf\u9009\u62e9\u9000\u51fa\u8fde\u63a5\u8ddf\u8e2a\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b\u8868\u4e2d\u7684\u94fe\u548c\u89c4\u5219\n[root@arm64v8 ~]# iptables -t raw -L\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination       \n[root@arm64v8 ~]#\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Security Table\uff1asecurity \u8868\u7528\u4e8e\u5728\u6570\u636e\u5305\u4e0a\u8bbe\u7f6e\u5185\u90e8 SELinux \u5b89\u5168\u4e0a\u4e0b\u6587\u6807\u8bb0\uff0c\u8fd9\u5c06\u5f71\u54cd SELinux \u6216\u5176\u4ed6\u53ef\u4ee5\u89e3\u91ca SELinux \u5b89\u5168\u4e0a\u4e0b\u6587\u7684\u7cfb\u7edf\u5904\u7406\u5305\u7684\u65b9\u5f0f\u3002\u8fd9\u4e9b\u6807\u8bb0\u53ef\u4ee5\u5e94\u7528\u5728\u6bcf\u4e2a\u5305\u6216\u6bcf\u4e2a\u8fde\u63a5\u7684\u57fa\u7840\u4e0a\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b\u8868\u4e2d\u7684\u94fe\u548c\u89c4\u5219\n[root@arm64v8 ~]# iptables -t security -L\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination       \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination       \n[root@arm64v8 ~]#\n")))))),(0,r.kt)("p",null,"\u5230\u8fd9\u91cc\uff0c\u518d\u770b\u4e0a\u9762\u8fd9\u4e2a\u56fe\uff0c\u53ef\u4ee5\u975e\u5e38\u6e05\u6670\u5730\u770b\u51fa 5 \u79cd\u5f69\u8272\u5bf9\u5e94\u7684 5 \u4e2a\u8868\uff1b\u6bcf\u4e00\u79cd\u5f69\u8272\u90fd\u6709\u8be5\u8868\u5bf9\u5e94\u7684\u81ea\u5df1\u7684\u591a\u4e2a\u94fe\uff0c\u4e5f\u5c31\u662f hook \u51fd\u6570\uff1b\u53e6\u5916\uff0c\u6b64\u56fe\u4ece incoming package \u548c locally generated package \u4e24\u4e2a\u89d2\u5ea6\u5206\u6790\u4e86\u6570\u636e\u5305\u7684\u6d41\u8f6c\u8fc7\u7a0b\uff0c\u5e76\u4e14\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u7ecf\u5386\u4e86\u54ea\u4e9b hook \u51fd\u6570\u5173\u5361\uff0c\u6839\u636e\u7528\u6237\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u5728\u8fd9\u4e9b\u5173\u5361\u8bbe\u7f6e\u89c4\u5219\u3002"),(0,r.kt)("h2",{id:"25iptables-\u547d\u4ee4"},"2.5\u3001iptables \u547d\u4ee4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Usage: iptables [-t TABLE] COMMAND CHAIN [ expressions -j target ]\n")),(0,r.kt)("p",null,"\u8fd9\u8868\u793a\u8981\u64cd\u4f5c TABLE \u8868\u4e2d\u7684\u94fe\uff0c\u64cd\u4f5c\u52a8\u4f5c\u7531 COMMAND \u51b3\u5b9a\uff0c\u4f8b\u5982\u6dfb\u52a0\u4e00\u6761\u89c4\u5219\u3001\u5220\u9664\u4e00\u6761\u89c4\u5219\u3001\u5217\u51fa\u89c4\u5219\u5217\u8868\u7b49\u3002"),(0,r.kt)("p",null,'\u5982\u679c\u662f\u5411\u94fe\u4e2d\u589e\u52a0\u89c4\u5219\uff0c\u5219\u9700\u8981\u5199\u51fa\u89c4\u5219\u8868\u8fbe\u5f0f\u7528\u6765\u68c0\u67e5\u6570\u636e\u5305\uff0c\u5e76\u6307\u660e\u6570\u636e\u5305\u88ab\u89c4\u5219\u5339\u914d\u4e0a\u65f6\u5e94\u8be5\u505a\u4ec0\u4e48\u64cd\u4f5c\uff0c\u4f8b\u5982\u5141\u8bb8\u8be5\u6570\u636e\u5305 ACCEPT\u3001\u62d2\u7edd\u8be5\u6570\u636e\u5305 REJECT\u3001\u4e22\u5f03\u8be5\u6570\u636e\u5305 DROP\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u79f0\u4e3a target\uff0c\u7531 "-j" \u9009\u9879\u6765\u6307\u5b9a\u3002'),(0,r.kt)("h3",{id:"251iptables-\u8bed\u6cd5"},"2.5.1\u3001iptables \u8bed\u6cd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'Commands:\nEither long or short options are allowed.\n  --append  -A chain                       \u94fe\u5c3e\u90e8\u8ffd\u52a0\u4e00\u6761\u89c4\u5219\n  --delete  -D chain                       \u4ece\u94fe\u4e2d\u5220\u9664\u80fd\u5339\u914d\u5230\u7684\u89c4\u5219\n  --delete  -D chain rulenum               \u4ece\u94fe\u4e2d\u5220\u9664\u7b2c\u51e0\u6761\u94fe\uff0c\u4ece1\u5f00\u59cb\u8ba1\u7b97\n  --insert  -I chain [rulenum]             \u5411\u94fe\u4e2d\u63d2\u5165\u4e00\u6761\u89c4\u5219\u4f7f\u5176\u6210\u4e3a\u7b2crulenum\u6761\u89c4\u5219\uff0c\u4ece1\u5f00\u59cb\u8ba1\u7b97\n  --replace -R chain rulenum               \u66ff\u6362\u94fe\u4e2d\u7684\u5730rulenum\u6761\u89c4\u5219\uff0c\u4ece1\u5f00\u59cb\u8ba1\u7b97\n  --list    -L [chain [rulenum]]           \u5217\u51fa\u67d0\u6761\u94fe\u6216\u6240\u6709\u94fe\u4e2d\u7684\u89c4\u5219\n  --list-rules -S [chain [rulenum]]        \u6253\u5370\u51fa\u94fe\u4e2d\u6216\u6240\u6709\u94fe\u4e2d\u7684\u89c4\u5219\n  --flush   -F [chain]                     \u5220\u9664\u6307\u5b9a\u94fe\u6216\u6240\u6709\u94fe\u4e2d\u7684\u6240\u6709\u89c4\u5219\n  --zero    -Z [chain [rulenum]]           \u7f6e\u96f6\u6307\u5b9a\u94fe\u6216\u6240\u6709\u94fe\u7684\u89c4\u5219\u8ba1\u6570\u5668\n  --new     -N chain                       \u521b\u5efa\u4e00\u6761\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u94fe\n  --delete-chain  -X [chain]               \u5220\u9664\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u94fe\n  --policy  -P chain target                \u8bbe\u7f6e\u6307\u5b9a\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565(policy)\u4e3a\u6307\u5b9a\u7684target\n  --rename-chain  -E old new               \u91cd\u547d\u540d\u94fe\u540d\u79f0\uff0c\u4eceold\u5230new\n\nOptions:\n[!] --proto  -p proto                      \u6307\u5b9a\u8981\u68c0\u67e5\u54ea\u4e2a\u534f\u8bae\u7684\u6570\u636e\u5305\uff1a\u53ef\u4ee5\u662f\u534f\u8bae\u4ee3\u7801\u4e5f\u53ef\u4ee5\u662f\u534f\u8bae\u540d\u79f0\uff0c\n                                           \u5982tcp,udp,icmp\u7b49\u3002\u534f\u8bae\u540d\u548c\u4ee3\u7801\u5bf9\u5e94\u5173\u7cfb\u5b58\u653e\u5728/etc/protocols\u4e2d\n                                           \u7701\u7565\u8be5\u9009\u9879\u65f6\u9ed8\u8ba4\u68c0\u67e5\u6240\u6709\u534f\u8bae\u7684\u6570\u636e\u5305\uff0c\u7b49\u4ef7\u4e8eall\u548c\u534f\u8bae\u4ee3\u78010\n[!] --source -s address[/mask][...]        \u6307\u5b9a\u68c0\u67e5\u6570\u636e\u5305\u7684\u6e90\u5730\u5740\uff0c\u6216\u8005\u4f7f\u7528"--src"\n[!] --destination -d address[/mask][...]   \u6307\u5b9a\u68c0\u67e5\u6570\u636e\u5305\u7684\u76ee\u6807\u5730\u5740\uff0c\u6216\u8005\u4f7f\u7528"--dst"\n[!] --in-interface  -i input name[+]       \u6307\u5b9a\u6570\u636e\u5305\u6d41\u5165\u63a5\u53e3\uff0c\u82e5\u63a5\u53e3\u540d\u540e\u52a0"+"\uff0c\u8868\u793a\u5339\u914d\u8be5\u63a5\u53e3\u5f00\u5934\u7684\u6240\u6709\u63a5\u53e3\n[!] --out-interface -o output name[+]      \u6307\u5b9a\u6570\u636e\u5305\u6d41\u51fa\u63a5\u53e3\uff0c\u82e5\u63a5\u53e3\u540d\u540e\u52a0"+"\uff0c\u8868\u793a\u5339\u914d\u8be5\u63a5\u53e3\u5f00\u5934\u7684\u6240\u6709\u63a5\u53e3\n  --jump        -j target                  \u4e3a\u89c4\u5219\u6307\u5b9a\u8981\u505a\u7684target\u52a8\u4f5c\uff0c\u4f8b\u5982\u6570\u636e\u5305\u5339\u914d\u4e0a\u89c4\u5219\u65f6\u5c06\u8981\u5982\u4f55\u5904\u7406\n  --goto        -g chain                   \u76f4\u63a5\u8df3\u8f6c\u5230\u81ea\u5b9a\u4e49\u94fe\u4e0a\n  --match       -m match                   \u6307\u5b9a\u6269\u5c55\u6a21\u5757\n  --numeric     -n                         \u8f93\u51fa\u6570\u503c\u683c\u5f0f\u7684ip\u5730\u5740\u548c\u7aef\u53e3\u53f7\u3002\u9ed8\u8ba4\u4f1a\u5c1d\u8bd5\u53cd\u89e3\u4e3a\u4e3b\u673a\u540d\u548c\u7aef\u53e3\u53f7\u5bf9\u5e94\u7684\u670d\u52a1\u540d\n  --table       -t table                   \u6307\u5b9a\u8981\u64cd\u4f5c\u7684table\uff0c\u9ed8\u8ba4table\u4e3afilter\n  --verbose     -v                         \u8f93\u51fa\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f\n  --line-numbers                           \u5f53list\u89c4\u5219\u65f6\uff0c\u540c\u65f6\u8f93\u51fa\u884c\u53f7\n  --exact       -x                         \u9ed8\u8ba4\u7edf\u8ba1\u6d41\u91cf\u65f6\u662f\u4ee51000\u4e3a\u5355\u4f4d\u7684\uff0c\u4f7f\u7528\u6b64\u9009\u9879\u5219\u4f7f\u75281024\u4e3a\u5355\u4f4d\n')),(0,r.kt)("p",null,'iptables \u652f\u6301 extension \u5339\u914d\u3002\u652f\u6301\u4e24\u79cd\u6269\u5c55\u5339\u914d\uff1a\u4f7f\u7528 "-p" \u65f6\u7684\u9690\u5f0f\u6269\u5c55\u548c\u4f7f\u7528 "-m" \u65f6\u7684\u663e\u5f0f\u6269\u5c55\u3002\u6839\u636e\u6307\u5b9a\u7684\u6269\u5c55\uff0c\u968f\u540e\u53ef\u4f7f\u7528\u4e0d\u540c\u7684\u9009\u9879\u3002\u5728\u6307\u5b9a\u6269\u5c55\u9879\u7684\u540e\u9762\u53ef\u4f7f\u7528 "-h" \u6765\u83b7\u53d6\u8be5\u6269\u5c55\u9879\u7684\u8bed\u6cd5\u5e2e\u52a9\u3002'),(0,r.kt)("p",null,'"-p" \u9009\u9879\u6307\u5b9a\u7684\u662f\u9690\u5f0f\u6269\u5c55\uff0c\u7528\u4e8e\u6307\u5b9a\u534f\u8bae\u7c7b\u578b\uff0c\u6bcf\u79cd\u534f\u8bae\u7c7b\u578b\u90fd\u6709\u4e00\u4e9b\u5b50\u9009\u9879\u3002\u5e38\u89c1\u534f\u8bae\u548c\u5b50\u9009\u9879\u5982\u4e0b\u8bf4\u660e\uff1a'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'-p tcp \u5b50\u9009\u9879\n    \u5b50\u9009\u9879\uff1a\n    [!] --source-port,--sport port[:port]\n            \u6307\u5b9a\u6e90\u7aef\u53e3\u53f7\u6216\u6e90\u7aef\u53e3\u8303\u56f4\u3002\u6307\u5b9a\u7aef\u53e3\u8303\u56f4\u65f6\u683c\u5f0f\u4e3a"range_start:range_end"\uff0c\u6700\u5927\u8303\u56f4\u4e3a0:65535\u3002\n    [!] --destination-port,--dport port[:port]\n            \u6307\u5b9a\u76ee\u6807\u7aef\u53e3\u53f7\u6216\u76ee\u6807\u7aef\u53e3\u53f7\u8303\u56f4\u3002\n    [!] --tcp-flags mask comp\n            \u5339\u914d\u5df2\u6307\u5b9a\u7684tcp flags\u3002mask\u6307\u5b9a\u7684\u662f\u9700\u8981\u68c0\u67e5\u7684flag\u5217\u8868\uff0ccomp\u6307\u5b9a\u7684\u662f\u5fc5\u987b\u8bbe\u7f6e\u7684flag\u3002\n            mask\u5217\u8868\u548ccomp\u5217\u8868\u4e4b\u95f4\u7528\u7a7a\u683c\u9694\u5f00\uff0c\u5404\u81ea\u5217\u8868\u7528\u9017\u53f7\u9694\u5f00\uff0cmask\u662f\u5217\u8868\u8303\u56f4\uff0ccomp\u6307\u5b9amask\u91cc\u9762\u76f8\u540c\u7684\u6807\u8bb0\u90fd\u4e3a1\u5176\u4f59\u4e3a0\n            \u6709\u6548\u7684flag\u503c\u4e3a\uff1aSYN ACK FIN RST URG PSH ALL NONE\u3002\n            \u4f8b\u5982\uff1aiptables -A FORWARD -p tcp --tcp-flags SYN,ACK,FIN,RST SYN\n            \u8868\u793a\u53ea\u5339\u914d\u8bbe\u7f6e\u4e86SYN=1\u800cACK\u3001FIN\u548cRST\u90fd\u4e3a0\u6570\u636e\u5305\uff0c\u4e5f\u5373\u53ea\u5339\u914dTCP\u4e09\u6b21\u63e1\u624b\u7684\u7b2c\u4e00\u6b21\u63e1\u624b\u3002\n    [!] --syn\n            \u662f"--tcp-flags SYN,ACK,FIN,RST SYN"\u7684\u7b80\u5199\u683c\u5f0f\u3002\n\n-p udp \u5b50\u9009\u9879\n    \u5b50\u9009\u9879\uff1a\n    [!] --source-port,--sport port[:port]\n            \u6307\u5b9a\u6e90\u7aef\u53e3\u53f7\u6216\u6e90\u7aef\u53e3\u8303\u56f4\u3002\u6307\u5b9a\u7aef\u53e3\u8303\u56f4\u65f6\u683c\u5f0f\u4e3a"range_start:range_end"\uff0c\u6700\u5927\u8303\u56f4\u4e3a0:65535\u3002\n    [!] --destination-port,--dport port[:port]\n            \u6307\u5b9a\u76ee\u6807\u7aef\u53e3\u53f7\u6216\u76ee\u6807\u7aef\u53e3\u53f7\u8303\u56f4\u3002\n\n-p icmp \u5b50\u9009\u9879\n            \u5b50\u9009\u9879\uff1a\n    [!] --icmp-type {type[/code]|typename}\n            \u7528\u4e8e\u6307\u5b9aICMP\u7c7b\u578b\uff0c\u53ef\u4ee5\u662fICMP\u7c7b\u578b\u7684\u6570\u503c\u4ee3\u7801\u6216\u7c7b\u578b\u540d\u79f0\u3002\u6709\u6548\u7684ICMP\u7c7b\u578b\n            \u53ef\u7531iptables -p icmp -h\u83b7\u53d6\u3002\u5e38\u7528\u7684\u662f"echo-request"\u548c"echo-reply"\uff0c\u5206\u522b\n            \u8868\u793aping\u548cpong\uff0c\u6570\u503c\u4ee3\u53f7\u5206\u522b\u662f8\u548c0\n            ping\u65f6\u5148\u8bf7\u6c42\u540e\u54cd\u5e94\uff1aping\u522b\u4eba\u5148\u51fa\u53bb8\u540e\u8fdb\u67650\uff1b\u522b\u4ebaping\u81ea\u5df1\uff0c\u5148\u8fdb\u67658\u540e\u51fa\u53bb0\n')),(0,r.kt)("p",null,'"-m" \u9009\u9879\u6307\u5b9a\u7684\u662f\u663e\u5f0f\u6269\u5c55\u3002\u5176\u5b9e\u9690\u5f0f\u6269\u5c55\u4e5f\u662f\u8981\u6307\u5b9a\u6269\u5c55\u540d\u7684\uff0c\u53ea\u4e0d\u8fc7\u9ed8\u8ba4\u5df2\u7ecf\u77e5\u9053\u6240\u4f7f\u7528\u7684\u6269\u5c55\uff0c\u4e8e\u662f\u53ef\u4ee5\u7701\u7565\u3002\u4f8b\u5982\uff1a',(0,r.kt)("inlineCode",{parentName:"p"},"-p tcp --dport")," = ",(0,r.kt)("inlineCode",{parentName:"p"},"-p tcp -m tcp --dport"),"\u3002"),(0,r.kt)("p",null,"\u5e38\u7528\u7684\u6269\u5c55\u548c\u5b83\u4eec\u5e38\u7528\u7684\u9009\u9879\u5982\u4e0b\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"iprange\uff1a\u5339\u914d\u7ed9\u5b9a\u7684 IP \u5730\u5740\u8303\u56f4\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[!] --src-range from[-to]\uff1a\u5339\u914d\u7ed9\u5b9a\u7684\u6e90\u5730\u5740\u8303\u56f4\n[!] --dst-range from[-to]\uff1a\u5339\u914d\u7ed9\u5b9a\u7684\u76ee\u6807\u5730\u5740\u8303\u56f4\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"multiport\uff1a\u79bb\u6563\u7684\u591a\u7aef\u53e3\u5339\u914d\u6a21\u5757\uff0c\u5982\u5c06 21\u300122\u300180 \u4e09\u4e2a\u7aef\u53e3\u7684\u89c4\u5219\u5408\u5e76\u6210\u4e00\u6761\u3002")),(0,r.kt)("p",{parentName:"li"},'\u6700\u591a\u652f\u6301\u5199 15 \u4e2a\u7aef\u53e3\uff0c\u5176\u4e2d "555:999" \u7b97 2 \u4e2a\u7aef\u53e3\u3002\u53ea\u6709\u6307\u5b9a\u4e86 -p tcp \u6216 -p udp \u65f6\u8be5\u9009\u9879\u624d\u751f\u6548\u3002'),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[!] --source-ports,--sports port[,port|,port:port]...\n[!] --destination-ports,--dports port[,port|,port:port]...\n[!] --ports port[,port|,port:port]... \uff1a\u4e0d\u533a\u5206\u6e90\u548c\u76ee\u6807\uff0c\u53ea\u8981\u662f\u7aef\u53e3\u5c31\u884c\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"state\uff1a\u72b6\u6001\u6269\u5c55\u3002\u7ed3\u5408 ip","_","conntrack \u8ffd\u8e2a\u4f1a\u8bdd\u7684\u72b6\u6001\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[!] --state state\n")),(0,r.kt)("p",{parentName:"li"},"\u5176\u4e2d state \u6709\u5982\u4e0b 4 \u79cd\uff1a"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"INVALID\uff1a\u975e\u6cd5\u8fde\u63a5\uff08\u5982 syn=1 fin=1 \uff09"),(0,r.kt)("li",{parentName:"ol"},"ESTABLISHED\uff1a\u6570\u636e\u5305\u5904\u4e8e\u5df2\u5efa\u7acb\u7684\u8fde\u63a5\u4e2d\uff0c\u5b83\u548c\u8fde\u63a5\u7684\u4e24\u7aef\u90fd\u76f8\u5173\u8054"),(0,r.kt)("li",{parentName:"ol"},"NEW\uff1a\u65b0\u5efa\u8fde\u63a5\u8bf7\u6c42\u7684\u6570\u636e\u5305\uff0c\u4e14\u8be5\u6570\u636e\u5305\u6ca1\u6709\u548c\u4efb\u4f55\u5df2\u6709\u8fde\u63a5\u76f8\u5173\u8054"),(0,r.kt)("li",{parentName:"ol"},"RELATED\uff1a\u8868\u793a\u6570\u636e\u5305\u6b63\u5728\u65b0\u5efa\u8fde\u63a5\uff0c \u4f46\u5b83\u548c\u5df2\u6709\u8fde\u63a5\u662f\u76f8\u5173\u8054\u7684(\u5982\u88ab\u52a8\u6a21\u5f0f\u7684 ftp \u7684\u547d\u4ee4\u8fde\u63a5\u548c\u6570\u636e\u8fde\u63a5)")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"-m state --state NEW,ESTABLISHED -j ACCEPT\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"string\uff1a\u5339\u914d\u62a5\u6587\u4e2d\u7684\u5b57\u7b26\u4e32\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'--algo {kmp|bm}\uff1a\u4e24\u79cd\u7b97\u6cd5\uff0c\u968f\u4fbf\u6307\u5b9a\u4e00\u79cd\n--string "string_pattern"\n')),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'iptables -A OUTPUT -m string --algo bm --sting "taobao.com" -j DROP\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"mac\uff1a\u5339\u914d MAC \u5730\u5740\uff0c\u683c\u5f0f\u5fc5\u987b\u4e3a XX:XX:XX:XX:XX:XX\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[!] --mac-source address\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"limit\uff1a\u4f7f\u7528\u4ee4\u724c\u6876(token bucket)\u6765\u9650\u5236\u8fc7\u6ee4\u8fde\u63a5\u8bf7\u6c42\u6570\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"--limit RATE[/second/minute/hour/day]\uff1a\u5141\u8bb8\u7684\u5e73\u5747\u6570\u91cf\u3002\u5982\u6bcf\u5206\u949f\u5141\u8bb810\u6b21ping\uff0c\u53736\u79d2\u4e00\u6b21ping\u3002\u9ed8\u8ba4\u4e3a3/hour\u3002\n--limit-burst\uff1a\u5141\u8bb8\u7b2c\u4e00\u6b21\u6d8c\u8fdb\u7684\u5e76\u53d1\u6570\u91cf\u3002\u7b2c\u4e00\u6b21\u6d8c\u8fdb\u8d85\u51fa\u540e\u5c31\u6309RATE\u6307\u5b9a\u6570\u6765\u7ed9\u51fa\u54cd\u5e94\u3002\u9ed8\u8ba4\u503c\u4e3a5\u3002\n")),(0,r.kt)("p",{parentName:"li"},"\u4f8b\u5982\uff1a\u5141\u8bb8\u6bcf\u5206\u949f 6 \u6b21 ping\uff0c\u4f46\u7b2c\u4e00\u6b21\u53ef\u4ee5 ping 10 \u6b21\u300210 \u6b21\u4e4b\u540e\u6309\u7167 RATE \u8ba1\u7b97\u3002\u6240\u4ee5\uff0c\u524d 10 \u4e2a ping \u5305\u6bcf\u79d2\u80fd\u6b63\u5e38\u8fd4\u56de\uff0c\u4ece\u7b2c 11 \u4e2a ping \u5305\u5f00\u59cb\uff0c\u6bcf 10 \u79d2\u5141\u8bb8\u4e00\u6b21 ping"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -d ServerIP -p icmp --icmp-type 8 -m limit --limit 6/minute --limit-burst 10 -j ACCEPT\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"connlimit\uff1a\u9650\u5236\u6bcf\u4e2a\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u4e0a\u9650\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"--connlimit-above n\uff1a\u8fde\u63a5\u6570\u91cf\u9ad8\u4e8e\u4e0a\u9650n\u4e2a\u65f6\u5c31\u6267\u884cTARGET\n")),(0,r.kt)("p",{parentName:"li"},"\u5982\u6700\u591a\u53ea\u5141\u8bb8\u67d0 ssh \u5ba2\u6237\u7aef\u5efa\u7acb 3 \u4e2a ssh \u8fde\u63a5\uff0c\u8d85\u51fa\u5c31\u62d2\u7edd\u3002\u4e24\u79cd\u5199\u6cd5\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -d ServerIP -p tcp --dport 22 -m connlimit --connlimit-above 3 -j DROP\niptables -A INPUT -d ServerIP -p tcp --dport 22 -m connlimit ! --connlimit-above 3 -j  ACCEPT\n")),(0,r.kt)("p",{parentName:"li"},"\u8fd9\u4e2a\u6a21\u5757\u867d\u7136\u9650\u5236\u80fd\u529b\u4e0d\u9519\uff0c\u4f46\u8981\u6839\u636e\u73af\u5883\u8ba1\u7b97\u51fa\u7f51\u9875\u6b63\u5e38\u8bbf\u95ee\u65f6\u9700\u8981\u5efa\u7acb\u7684\u8fde\u63a5\u6570\uff0c\u53e6\u5916\u8fd8\u8981\u8003\u8651\u4f7f\u7528 NAT \u8f6c\u6362\u5730\u5740\u65f6\u8fde\u63a5\u6570\u4f1a\u7ffb\u500d\u7684\u95ee\u9898\u3002"),(0,r.kt)("p",{parentName:"li"},'\u6700\u540e\u5269\u4e0b "-j" \u6307\u5b9a\u7684 target \u8fd8\u672a\u8bf4\u660e\uff0ctarget \u8868\u793a\u5bf9\u5339\u914d\u5230\u7684\u6570\u636e\u5305\u8981\u505a\u4ec0\u4e48\u5904\u7406\uff0c\u6bd4\u5982\u4e22\u5f03 DROP\u3001\u62d2\u7edd REJECT\u3001\u63a5\u53d7 ACCEPT \u7b49\uff0c\u9664\u8fd9 3 \u4e2a target \u5916\uff0c\u8fd8\u652f\u6301\u5f88\u591a\u79cd target\u3002\u4ee5\u4e0b\u662f\u5176\u4e2d\u51e0\u79cd\uff1a'),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"DNAT\uff1a\u76ee\u6807\u5730\u5740\u8f6c\u6362\nSNAT:\u6e90\u5730\u5740\u8f6c\u6362\nREDIRECT\uff1a\u7aef\u53e3\u91cd\u5b9a\u5411\nMASQUERADE\uff1a\u5730\u5740\u4f2a\u88c5(\u5176\u5b9e\u4e5f\u662f\u6e90\u5730\u5740\u8f6c\u6362)\nRETURN\uff1a\u7528\u4e8e\u81ea\u5b9a\u4e49\u94fe\uff0c\u81ea\u5b9a\u4e49\u94fe\u4e2d\u5339\u914d\u5b8c\u6bd5\u540e\u8fd4\u56de\u5230\u81ea\u5b9a\u4e49\u7684\u524d\u4e00\u4e2a\u94fe\u4e2d\u7ee7\u7eed\u5411\u4e0b\u5339\u914d\n")))),(0,r.kt)("h3",{id:"252ip_conntrack-\u529f\u80fd\u548c-iptstate-\u547d\u4ee4"},"2.5.2\u3001ip","_","conntrack \u529f\u80fd\u548c iptstate \u547d\u4ee4"),(0,r.kt)("p",null,"ip","_","conntrack \u63d0\u4f9b\u8ffd\u8e2a\u529f\u80fd\uff0c\u540e\u6765\u6539\u79f0\u4e3a nf","_","conntrack\uff0c\u7531 nf","_","conntrack \u6a21\u5757\u63d0\u4f9b\u3002"),(0,r.kt)("p",null,"\u53ea\u8981\u4e00\u52a0\u8f7d\u8be5\u6a21\u5757\uff0c/proc/net/nf","_","conntrack \u6587\u4ef6\u4e2d\u5c31\u4f1a\u8bb0\u5f55\u4e0b\u8ffd\u8e2a\u7684\u8fde\u63a5\u72b6\u6001\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# yum install iptables-services\n[root@arm64v8 ~]# systemctl start iptables.service \n[root@arm64v8 ~]# modprobe nf_conntrack\n[root@arm64v8 ~]# cat /proc/net/nf_conntrack\nipv4     2 tcp      6 299 ESTABLISHED src=192.168.0.181 dst=192.168.0.188 sport=22 dport=5464 src=192.168.0.188 dst=192.168.0.181 sport=5464 dport=22 [ASSURED] mark=0 zone=0 use=3\nipv4     2 tcp      6 431999 ESTABLISHED src=192.168.0.188 dst=192.168.0.181 sport=5798 dport=22 src=192.168.0.181 dst=192.168.0.188 sport=22 dport=5798 [ASSURED] mark=0 zone=0 use=2\n[root@arm64v8 ~]#\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8fd9\u4e24\u6761\u90fd\u662f ESTABLISH \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u5206\u522b\u662f 192.168.0.181:22 <-> 192.168.0.188:5464 \u901a\u4fe1\uff0c192.168.0.188:5798 <-> 192.168.0.181:22 \u901a\u4fe1\u3002")),(0,r.kt)("p",null,"\u4e5f\u53ef\u4ee5\u4f7f\u7528 iptstate \u547d\u4ee4\u5b9e\u65f6\u663e\u793a\u8fde\u63a5\u72b6\u6001\uff0c\u5b83\u662f\u50cf top \u5de5\u5177\u4e00\u6837\u7684\u663e\u793a\u3002\u8be5\u547d\u4ee4\u5de5\u5177\u5728 iptstate \u5305\u4e2d\uff0c\u53ef\u80fd\u9700\u8981\u624b\u52a8\u5b89\u88c5\u3002\u5982\u56fe\u4e3a iptstate \u7684\u4e00\u6b21\u7ed3\u679c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"                                         IPTState - IPTables State Top\nVersion: 2.2.5        Sort: SrcIP           b: change sorting   h: help\nSource                                      Destination                                 Prt State       TTL\n192.168.0.181:22                            192.168.0.188:5464                          tcp ESTABLISHED   0:04:05\n192.168.0.188:6117                          192.168.0.181:22                            tcp ESTABLISHED 119:59:59\n192.168.0.188:6126                          192.168.0.181:22                            tcp ESTABLISHED 119:49:52\n192.168.0.188:5798                          192.168.0.181:22                            tcp ESTABLISHED 119:59:59\n")),(0,r.kt)("p",null,"\u5728 /proc/sys/net/netfilter/ \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4e2d\u5b9a\u4e49\u4e86\u5f88\u591a\u8ddf\u8e2a\u8fde\u63a5\u72b6\u6001\u7684\u89c4\u8303\uff0c\u6bd4\u5982 nf","_","conntrack","_","tcp","_","timeout","_","time","_","wait \u5b9a\u4e49\u4e86 TCP \u8fde\u63a5 4 \u6b21\u6325\u624b\u4e3b\u52a8\u65ad\u5f00\u65b9\u7684\u5012\u6570\u7b2c\u4e8c\u4e2a\u9636\u6bb5 TIME","_","WAIT \u7684\u503c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# ls /proc/sys/net/netfilter/\nnf_conntrack_acct                        nf_conntrack_sctp_timeout_cookie_wait\nnf_conntrack_buckets                     nf_conntrack_sctp_timeout_established\nnf_conntrack_checksum                    nf_conntrack_sctp_timeout_heartbeat_acked\nnf_conntrack_count                       nf_conntrack_sctp_timeout_heartbeat_sent\nnf_conntrack_dccp_loose                  nf_conntrack_sctp_timeout_shutdown_ack_sent\nnf_conntrack_dccp_timeout_closereq       nf_conntrack_sctp_timeout_shutdown_recd\nnf_conntrack_dccp_timeout_closing        nf_conntrack_sctp_timeout_shutdown_sent\nnf_conntrack_dccp_timeout_open           nf_conntrack_tcp_be_liberal\nnf_conntrack_dccp_timeout_partopen       nf_conntrack_tcp_loose\nnf_conntrack_dccp_timeout_request        nf_conntrack_tcp_max_retrans\nnf_conntrack_dccp_timeout_respond        nf_conntrack_tcp_timeout_close\nnf_conntrack_dccp_timeout_timewait       nf_conntrack_tcp_timeout_close_wait\nnf_conntrack_events                      nf_conntrack_tcp_timeout_established\nnf_conntrack_expect_max                  nf_conntrack_tcp_timeout_fin_wait\nnf_conntrack_frag6_high_thresh           nf_conntrack_tcp_timeout_last_ack\nnf_conntrack_frag6_low_thresh            nf_conntrack_tcp_timeout_max_retrans\nnf_conntrack_frag6_timeout               nf_conntrack_tcp_timeout_syn_recv\nnf_conntrack_generic_timeout             nf_conntrack_tcp_timeout_syn_sent\nnf_conntrack_helper                      nf_conntrack_tcp_timeout_time_wait\nnf_conntrack_icmp_timeout                nf_conntrack_tcp_timeout_unacknowledged\nnf_conntrack_icmpv6_timeout              nf_conntrack_timestamp\nnf_conntrack_log_invalid                 nf_conntrack_udp_timeout\nnf_conntrack_max                         nf_conntrack_udp_timeout_stream\nnf_conntrack_sctp_timeout_closed         nf_log\nnf_conntrack_sctp_timeout_cookie_echoed  nf_log_all_netns\n[root@arm64v8 ~]#\n[root@arm64v8 ~]# cat /proc/sys/net/netfilter/nf_conntrack_tcp_timeout_time_wait\n120\n[root@arm64v8 ~]#\n")),(0,r.kt)("p",null,"nf","_","conntrack \u5728\u589e\u52a0\u4fbf\u5229\u7684\u540c\u65f6\u4f1a\u5e26\u6765\u6027\u80fd\u95ee\u9898\uff0cnf","_","conntrack \u4f1a\u6d88\u8017\u4e00\u5b9a\u7684\u8d44\u6e90\uff0c\u6240\u4ee5\u5728\u8bbe\u8ba1\u7684\u65f6\u5019\u9ed8\u8ba4\u7ed9\u51fa\u4e86\u5176\u6700\u5927\u7684\u8ffd\u8e2a\u6570\u91cf\uff0c\u6700\u5927\u8ffd\u8e2a\u6570\u91cf\u503c\u7531 /proc/sys/net/netfilter/nf","_","conntrack","_","max \u6587\u4ef6\u51b3\u5b9a\u3002\u9ed8\u8ba4\u662f 262144 \u4e2a\u3002"),(0,r.kt)("p",null,"\u8fd9\u4e2a\u503c\u53ef\u80fd\u65e0\u6cd5\u6ee1\u8db3\u8f83\u9ad8\u5e76\u53d1\u91cf\u7684\u670d\u52a1\u5668\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c06\u5176\u589e\u5927\u4e00\u4e9b\uff0c\u5426\u5219\u8ffd\u8e2a\u6570\u8fbe\u5230\u4e86\u6700\u5927\u503c\u540e\uff0c\u540e\u7eed\u7684\u6240\u6709\u8fde\u63a5\u90fd\u5c06\u6392\u961f\u88ab\u963b\u585e\uff0c\u53ef\u80fd\u4f1a\u56e0\u6b64\u7ed9\u51fa\u8b66\u544a\u3002\u4f46\u662f\u65e0\u8bba\u5982\u4f55\u8981\u660e\u767d\u7684\u662f\u8ffd\u8e2a\u662f\u4f1a\u6d88\u8017\u6027\u80fd\u7684\uff0c\u6240\u4ee5\u8be5\u503c\u5e94\u8be5\u914c\u60c5\u8003\u8651\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# cat /proc/sys/net/netfilter/nf_conntrack_max\n262144\n[root@arm64v8 ~]#\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"\u6ce8\u610f\uff1anf","_","conntrack \u6a21\u5757\u4e0d\u662f\u4e00\u5b9a\u9700\u8981\u663e\u5f0f\u88c5\u8f7d\u624d\u4f1a\u88ab\u88c5\u8f7d\u7684\uff0c\u6709\u4e9b\u4f9d\u8d56\u5b83\u7684\u6a21\u5757\u88ab\u88c5\u8f7d\u65f6\u8be5\u6a21\u5757\u4e5f\u4f1a\u88ab\u88c5\u8f7d\u3002\u4f8b\u5982 iptables \u547d\u4ee4\u4e2d\u5305\u542b iptables -t nat \u65f6\uff0c\u5c31\u4f1a\u88c5\u8f7d\u8be5\u6a21\u5757\u81ea\u52a8\u5f00\u542f\u8ffd\u8e2a\uff0c\u8fdb\u800c\u53ef\u80fd\u5bfc\u81f4\u8fbe\u5230\u8ffd\u8e2a max \u503c\u800c\u51fa\u9519\u3002"))),(0,r.kt)("h3",{id:"253-m-state-\u7684\u72b6\u6001\u89e3\u91ca"},"2.5.3\u3001-m state \u7684\u72b6\u6001\u89e3\u91ca"),(0,r.kt)("p",null,'\u4f7f\u7528 -m state \u8868\u793a\u4f7f\u7528\u7b80\u79f0\u4e3a "state" \u7684\u6a21\u5757\u3002\u8be5\u6a21\u5757\u63d0\u4f9b 4 \u79cd\u72b6\u6001\uff1aNEW\u3001ESTABLISHED\u3001RELATED \u548c INVALID\u3002\u4f46\u662f\u8fd9\u4e9b\u72b6\u6001\u548c TCP \u4e09\u6b21\u63e1\u624b\u56db\u6b21\u6325\u624b\u7684\u5341\u51e0\u79cd\u72b6\u6001\u6ca1\u4efb\u4f55\u5173\u7cfb\u3002\u800c\u4e14 state \u63d0\u4f9b\u7684 4 \u79cd\u72b6\u6001\u5bf9\u4e8e tcp/udp/icmp \u7c7b\u578b\u7684\u6570\u636e\u5305\u90fd\u662f\u901a\u7528\u7684\u3002'),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"\u6ce8\u610f\uff1a\u8fd9\u56db\u79cd\u72b6\u6001\u662f\u6570\u636e\u5305\u7684\u72b6\u6001\uff0c\u4e0d\u662f\u5ba2\u6237\u7aef\u6216\u8005\u670d\u52a1\u5668\u5f53\u65f6\u6240\u5904\u7684\u72b6\u6001\u3002\u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u662f\u9632\u706b\u5899 state \u6a21\u5757\u7684\u72b6\u6001\uff0c\u56e0\u4e3a state \u6a21\u5757\u5728\u6536\u5230\u5bf9\u5e94\u72b6\u6001\u7684\u5305\u65f6\u4f1a\u8bbe\u7f6e\u4e3a\u76f8\u540c\u7684\u72b6\u6001\u3002")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"NEW \u72b6\u6001\u4e0e TCP/UDP/ICMP \u6570\u636e\u5305\u7684\u5173\u7cfb")),(0,r.kt)("p",{parentName:"li"},"\u4e3a\u4e86\u5efa\u7acb\u4e00\u6761\u8fde\u63a5\uff0c\u53d1\u9001\u7684\u7b2c\u4e00\u4e2a\u6570\u636e\u5305(\u5982 tcp \u4e09\u6b21\u63e1\u624b\u7684\u7b2c\u4e00\u6b21 SYN \u6570\u636e\u5305)\u7684\u72b6\u6001\u4e3a NEW\u3002\u5982\u679c\u7b2c\u4e00\u6b21\u8fde\u63a5\u6ca1\u5efa\u7acb\u6210\u529f\uff0c\u5219\u7b2c\u4e8c\u4e2a\u7ee7\u7eed\u8bf7\u6c42\u7684\u6570\u636e\u5305\u5df2\u7ecf\u4e0d\u662f NEW \u6570\u636e\u5305\u4e86\u3002"),(0,r.kt)("p",{parentName:"li"},"\u6240\u4ee5\uff0c\u5982\u679c\u4e0d\u5141\u8bb8 NEW \u72b6\u6001\u7684\u6570\u636e\u5305\u8868\u793a\u4e0d\u5141\u8bb8\u4e3b\u52a8\u548c\u5bf9\u65b9\u5efa\u7acb\u8fde\u63a5\uff0c\u4e5f\u4e0d\u5141\u8bb8\u5916\u754c\u548c\u672c\u673a\u5efa\u7acb\u8fde\u63a5\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"ESTABLISHED \u72b6\u6001\u4e0e tcp/udp/icmp \u6570\u636e\u5305\u7684\u5173\u7cfb")),(0,r.kt)("p",{parentName:"li"},"\u65e0\u8bba\u662f tcp \u6570\u636e\u5305\u3001udp \u6570\u636e\u5305\u8fd8\u662f icmp \u6570\u636e\u5305\uff0c\u53ea\u8981\u53d1\u9001\u7684\u8bf7\u6c42\u6570\u636e\u5305\u7a7f\u8fc7\u4e86\u9632\u706b\u5899\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u53cc\u65b9\u4f20\u8f93\u7684\u6570\u636e\u5305\u72b6\u6001\u90fd\u662f ESTABLISHED\uff0c\u4e5f\u5c31\u662f\u8bf4\u53d1\u8fc7\u53bb\u7684\u548c\u8fd4\u56de\u56de\u6765\u7684\u90fd\u662f ESTABLISHED \u72b6\u6001\u6570\u636e\u5305\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"RELATED \u6570\u636e\u5305\u7684\u89e3\u91ca")),(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8e RELATED \u6570\u636e\u5305\u7684\u89e3\u91ca\u662f\uff1a\u4e0e\u5f53\u524d\u4efb\u4f55\u8fde\u63a5\u90fd\u65e0\u5173\uff0c\u5b8c\u5168\u662f\u88ab\u52a8\u6216\u4e34\u65f6\u5efa\u7acb\u7684\u8fde\u63a5\u4e4b\u95f4\u4f20\u8f93\u7684\u6570\u636e\u5305\u3002"),(0,r.kt)("p",{parentName:"li"},"\u4f8b\u5982\uff0c\u56fe\u4e2d\u5ba2\u6237\u7aef\u4e3a\u4e86\u63a2\u6d4b\u670d\u52a1\u5668\u7684\u5730\u5740\u53d1\u9001\u4e86 tracert \u547d\u4ee4\u3002"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"conntrack related",src:a(29071).Z,width:"802",height:"381"})),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"\u8fd9\u4e2a\u547d\u4ee4\u9996\u5148\u4f1a\u6807\u8bb0\u4e00\u4e2a tcp \u6570\u636e\u5305\u7684 TTL \u503c\u4e3a 1\uff0c\u5f53\u6570\u636e\u5305\u5230\u8fbe\u7b2c\u4e00\u4e2a\u8def\u7531\u5668\u8be5\u503c\u5c31\u51cf 1\uff0c\u6240\u4ee5 TTL \u53d8\u4e3a 0 \u8868\u793a\u8be5\u6570\u636e\u5305\u5230\u4e86\u5bff\u7ec8\u6b63\u5bdd\u8be5 DROP \u6389\u7684\u65f6\u5019\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u7136\u540e\u8be5\u8def\u7531\u5668\u5c31\u4f1a\u53d1\u9001\u4e00\u4e2a icmp \u6570\u636e\u5305\uff08icmp-type=11\uff09\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u8fd9\u6837\u5ba2\u6237\u7aef\u5c31\u77e5\u9053\u4e86\u7b2c\u4e00\u4e2a\u8def\u7531\u5668\u7684\u5730\u5740\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u63a5\u7740\u5ba2\u6237\u7aef\u7684 tracert \u547d\u4ee4\u7ee7\u7eed\u6807\u8bb0\u4e00\u4e2a TTL \u4e3a 2 \u7684\u6570\u636e\u5305\u5411\u5916\u53d1\u9001\uff0c\u76f4\u5230\u7b2c\u4e8c\u4e2a\u8def\u7531\u5668\u624d\u88ab\u4e22\u5f03\uff0c\u7b2c\u4e8c\u4e2a\u8def\u7531\u5668\u53c8\u53d1\u9001\u4e00\u4e2a icmp \u5305\u7ed9\u5ba2\u6237\u7aef\uff0c\u8fd9\u6837\u5ba2\u6237\u7aef\u5c31\u77e5\u9053\u4e86\u7b2c\u4e8c\u4e2a\u8def\u7531\u5668\u7684\u5730\u5740\u3002\u540c\u7406\u7b2c\u4e09\u6b21\u4e5f\u4e00\u6837\u3002")),(0,r.kt)("p",{parentName:"li"},"\u5728 tracert \u63a2\u6d4b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7531\u8def\u7531\u5668\u8fd4\u56de\u7684 icmp \u5305\u90fd\u662f RELATED \u72b6\u6001\u7684\u6570\u636e\u5305\u3002\u56e0\u4e3a\u53ef\u4ee5\u80af\u5b9a\u7684\u8bf4\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u7ed9\u8def\u7531\u5668\u7684 tcp \u6570\u636e\u5305\u662f\u8d70\u7684\u4e00\u6761\u8fde\u63a5\uff0c\u6570\u636e\u5305\u88ab\u8def\u7531\u5668\u4e22\u5f03\u540e\u8def\u7531\u5668\u53d1\u9001\u7684 icmp \u6570\u636e\u5305\u4e0e\u539f\u6765\u7684\u8fde\u63a5\u5df2\u7ecf\u65e0\u5173\u4e86\uff0c\u8fd9\u662f\u53e6\u5916\u4e00\u6761\u8fd4\u56de\u7684\u8fde\u63a5\u3002\u4f46\u662f\u4e4b\u6240\u4ee5\u6709\u8fd9\u4e2a\u6570\u636e\u5305\uff0c\u5b8c\u5168\u662f\u56e0\u4e3a\u524d\u9762\u7684\u8fde\u63a5\u7ed3\u675f\u800c\u4ea7\u751f\u7684\u5e94\u7b54\u6570\u636e\u5305\u3002"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u8fc7 RELATED \u72b6\u6001\u548c\u534f\u8bae\u65e0\u5173\uff0c\u53ea\u8981\u6570\u636e\u5305\u662f\u56e0\u4e3a\u672c\u673a\u5148\u9001\u51fa\u4e00\u4e2a\u6570\u636e\u5305\u800c\u5bfc\u81f4\u53e6\u4e00\u6761\u8fde\u63a5\u7684\u4ea7\u751f\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65b0\u8fde\u63a5\u7684\u6240\u6709\u6570\u636e\u5305\u90fd\u5c5e\u4e8e RELATED \u72b6\u6001\u7684\u6570\u636e\u5305\u3002")),(0,r.kt)("p",{parentName:"li"},"\u8fd9\u6837\u5c31\u5bb9\u6613\u7406\u89e3 ftp \u88ab\u52a8\u6a21\u5f0f\u8bbe\u7f6e\u7684 related \u72b6\u6001\u4e86\u3002\u5728 ftp \u670d\u52a1\u5668\u4e0a\u7684 21 \u53f7\u7aef\u53e3\u4e0a\u5f00\u542f\u4e86\u547d\u4ee4\u901a\u9053\uff08\u4e5f\u5c31\u662f\u547d\u4ee4\u8fde\u63a5\uff09\u540e\uff0c\u4ee5\u540e\u65e0\u8bba\u662f\u88ab\u52a8\u6a21\u5f0f\u7684\u968f\u673a\u6570\u636e\u7aef\u53e3\u8fd8\u662f\u4e3b\u52a8\u6a21\u5f0f\u7684\u56fa\u5b9a 20 \u6570\u636e\u7aef\u53e3\uff0c\u53ef\u4ee5\u80af\u5b9a\u7684\u662f\u6570\u636e\u901a\u9053\u7684\u5efa\u7acb\u662f\u7531\u547d\u4ee4\u901a\u9053\u6307\u5b9a\u8981\u5f00\u542f\u7684\uff0c\u6240\u4ee5\u8fd9\u4e2a\u6570\u636e\u901a\u9053\u4e2d\u4f20\u8f93\u7684\u6570\u636e\u5305\u90fd\u662f RELATED \u72b6\u6001\u7684\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"INVALID \u72b6\u6001\u7684\u6570\u636e\u5305")),(0,r.kt)("p",{parentName:"li"},"\u6240\u8c13\u7684 INVALID \u72b6\u6001\uff0c\u5c31\u662f\u6076\u610f\u7684\u6570\u636e\u5305\u3002\u53ea\u8981\u4e0d\u662f ESTABLISHED\u3001NEW\u3001RELATED \u72b6\u6001\u7684\u6570\u636e\u5305\uff0c\u90a3\u4e48\u5c31\u4e00\u5b9a\u662f INVALID \u72b6\u6001\u3002\u5bf9\u4e8e INVALID \u6570\u636e\u5305\u6700\u5e94\u8be5\u653e\u5728\u94fe\u4e2d\u7684\u7b2c\u4e00\u6761\uff0c\u4ee5\u9632\u6b62\u6076\u610f\u7684\u5faa\u73af\u653b\u51fb\u3002"))),(0,r.kt)("h3",{id:"254filter-\u8868\u793a\u4f8b"},"2.5.4\u3001filter \u8868\u793a\u4f8b"),(0,r.kt)("p",null,"\u5b9e\u9a8c\u4e3b\u673a\uff1aip \u5730\u5740 192.168.0.181\uff0c\u5b89\u88c5 iptables-services \u8f6f\u4ef6\u5305\uff0c\u542f\u52a8 iptables \u670d\u52a1\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# yum install iptables-services -y\n[root@arm64v8 ~]# systemctl start iptables.service \n[root@arm64v8 ~]# systemctl enable iptables.service\n")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u6e05\u7a7a\u81ea\u5b9a\u4e49\u94fe\u3001\u6e05\u7a7a\u89c4\u5219\u3001\u6e05\u7a7a\u89c4\u5219\u8ba1\u6570\u5668\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -X\n[root@arm64v8 ~]# iptables -F\n[root@arm64v8 ~]# iptables -Z\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u5141\u8bb8 192.168.0.0/24 \u7f51\u6bb5\u8fde\u63a5 ssh(\u7aef\u53e322)\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -A INPUT -s 192.168.0.0/24 -d 192.168.0.181 -p tcp --dport 22 -j ACCEPT\n[root@arm64v8 ~]# iptables -A OUTPUT -s 192.168.0.181 -p tcp --sport 22 -j ACCEPT\n[root@arm64v8 ~]#\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u8bbe\u7f6e filter \u8868\u9ed8\u8ba4\u89c4\u5219\u4e3a DROP\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -P INPUT DROP\n[root@arm64v8 ~]# iptables -P FORWARD DROP\n[root@arm64v8 ~]# iptables -P OUTPUT DROP\n")),(0,r.kt)("p",{parentName:"li"},"\u4e00\u822c\u9632\u706b\u5899\u5bf9\u5916\u662f ACCEPT \u7684\uff0c\u6240\u4ee5 OUTPUT \u94fe\u91c7\u7528\u9ed8\u8ba4\u7684 ACCEPT\u3002"),(0,r.kt)("p",{parentName:"li"},"\u7531\u4e8e\u5c06 INPUT \u94fe\u8bbe\u7f6e\u4e3a\u5168\u90e8 DROP\uff0c\u56e0\u6b64\u9664\u4e86\u524d\u9762\u8bbe\u7f6e\u7684\u76ee\u6807\u4e3a 22 \u7aef\u53e3\u7684\u6570\u636e\u5305\u5141\u8bb8\u901a\u8fc7\uff0c\u5176\u4f59\u5168\u90e8\u4e22\u5f03\uff0c\u5373\u4f7f\u662f ping \u73af\u56de\u5730\u5740\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# ping -c 4 127.0.0.1\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n\n--- 127.0.0.1 ping statistics ---\n4 packets transmitted, 0 received, 100% packet loss, time 3156ms\n\n[root@arm64v8 ~]#\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u67e5\u770b\u89c4\u5219\u5217\u8868\u548c\u7edf\u8ba1\u6570\u636e\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -L -n\nChain INPUT (policy DROP)\ntarget     prot opt source               destination       \nACCEPT     tcp  --  192.168.0.0/24       192.168.0.181        tcp dpt:22\n\nChain FORWARD (policy DROP)\ntarget     prot opt source               destination       \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination       \nACCEPT     tcp  --  192.168.0.181        0.0.0.0/0            tcp spt:22\n[root@arm64v8 ~]#\n")),(0,r.kt)("p",{parentName:"li"},'\u5982\u679c\u52a0\u4e0a "-v" \u9009\u9879\uff0c\u5219\u4f1a\u663e\u793a\u6bcf\u6761\u89c4\u5219\u4e0a\u7684\u6d41\u91cf\u7edf\u8ba1\u6570\u636e\u3002'),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -L -n -v\nChain INPUT (policy DROP 4 packets, 336 bytes)\npkts bytes target     prot opt in     out     source               destination       \n 269 19900 ACCEPT     tcp  --  *      *       192.168.0.0/24       192.168.0.181        tcp dpt:22\n\nChain FORWARD (policy DROP 0 packets, 0 bytes)\npkts bytes target     prot opt in     out     source               destination       \n\nChain OUTPUT (policy ACCEPT 4 packets, 336 bytes)\npkts bytes target     prot opt in     out     source               destination       \n  92 10904 ACCEPT     tcp  --  *      *       192.168.0.181        0.0.0.0/0            tcp spt:22\n[root@arm64v8 ~]#\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u653e\u884c\u73af\u56de\u8bbe\u5907\u7684\u8fdb\u51fa\u6570\u636e\u5305(\u73af\u56de\u5730\u5740\u7684\u653e\u884c\u5f88\u91cd\u8981)\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -A INPUT -i lo -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT\n[root@arm64v8 ~]# iptables -A OUTPUT -o lo -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT\n[root@arm64v8 ~]# \n[root@arm64v8 ~]# ping 127.0.0.1\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.041 ms\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.015 ms\n^C\n--- 127.0.0.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1044ms\nrtt min/avg/max/mdev = 0.015/0.028/0.041/0.013 ms\n[root@arm64v8 ~]#\n")),(0,r.kt)("p",{parentName:"li"},"\u4f46\u662f\u4e0d\u5efa\u8bae\u76f4\u63a5\u5199 127.0.0.1\uff0c\u800c\u662f\u7701\u7565\u76ee\u6807\u5730\u5740\u548c\u6e90\u5730\u5740\uff0c\u56e0\u4e3a ping \u672c\u673a ip \u5730\u5740\u6700\u540e\u4ea4\u7ed9\u73af\u56de\u8bbe\u5907\u4f46\u662f\u4e0d\u662f\u4ea4\u7ed9 127.0.0.1 \u7684\uff0c\u800c\u662f\u4ea4\u7ed9 127.0.0 \u7f51\u6bb5\u7684\u5176\u4ed6\u5730\u5740\u3002\u6240\u4ee5\u5e94\u8be5\u8fd9\u4e48\u5199\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -A INPUT -i lo -j ACCEPT\n[root@arm64v8 ~]# iptables -A OUTPUT -o lo -j ACCEPT\n")),(0,r.kt)("p",{parentName:"li"},"\u6240\u4ee5\u53ef\u4ee5\u5c06\u524d\u9762\u591a\u4f59\u7684\u89c4\u5219\u5220\u9664\u6389\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -D INPUT 2\n[root@arm64v8 ~]# iptables -D OUTPUT 2\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u80fd\u81ea\u5df1 ping \u81ea\u5df1\u7684 IP\uff0c\u4e5f\u80fd ping \u522b\u4eba\u7684 IP\uff0c\u4f46\u662f\u522b\u4eba\u4e0d\u80fd ping \u81ea\u5df1\u3002")),(0,r.kt)("p",{parentName:"li"},"ping \u7684\u8fc7\u7a0b\u5b9e\u9645\u4e0a\u662f ping \u8bf7\u6c42\u5bf9\u65b9\uff0c\u7136\u540e\u5bf9\u65b9 pong \u56de\u5e94\uff0c\u534f\u8bae\u7c7b\u578b\u4e3a icmp\u3002\u5176\u4e2d ping \u8bf7\u6c42\u65f6\uff0cicmp \u7c7b\u578b\u4e3a echo-request\uff0c\u6570\u503c\u4ee3\u53f7\u4e3a 8\uff0cpong \u56de\u5e94\u65f6\u7684 icmp \u7c7b\u578b\u4e3a echo-reply\uff0c\u6570\u503c\u4ee3\u53f7\u4e3a 0\u3002"),(0,r.kt)("p",{parentName:"li"},"\u6240\u4ee5\u672c\u673a\u5411\u5916 ping \u65f6\uff0c\u6d41\u51fa\u7684\u662f echo-request \u6570\u636e\u5305\uff0c\u6d41\u5165\u7684\u662f echo-reply \u6570\u636e\u5305\u3002\u800c\u5916\u754c ping \u672c\u673a\u65f6\uff0c\u5219\u662f\u6d41\u5165 echo-request \u6570\u636e\u5305\uff0c\u6d41\u51fa echo-reply \u6570\u636e\u5305\u3002\u56e0\u6b64\uff0c\u8981\u5141\u8bb8\u672c\u673a\u5411\u5916 ping\uff0c\u53ea\u9700\u5141\u8bb8 icmp-type=8 \u7684\u6d41\u51fa\u5305\u3001icmp-type=0 \u7684\u6d41\u5165\u5305\u5373\u53ef\uff0c\u53c8\u7531\u4e8e\u524d\u9762\u7684\u8bd5\u9a8c\u4e2d\u8bbe\u7f6e\u4e86 INPUT \u548c OUTPUT \u94fe\u7684\u9ed8\u8ba4\u89c4\u5219\u4e3a DROP\uff0c\u6240\u4ee5\u5916\u754c\u4e3b\u673a\u65e0\u6cd5 ping \u672c\u673a\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -A OUTPUT -p icmp --icmp-type=8 -j ACCEPT\n[root@arm64v8 ~]# iptables -A INPUT -p icmp --icmp-type=0 -j ACCEPT\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u5b89\u88c5 httpd\uff0c\u8ba9\u5916\u754c\u80fd\u591f\u8bbf\u95ee web \u9875\u9762(\u7aef\u53e3\u4e3a80)\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -A INPUT -d 192.168.0.181 -p tcp --dport 80 -j ACCEPT \n[root@arm64v8 ~]# iptables -A OUTPUT -s 192.168.0.181 -p tcp --sport 80 -j ACCEPT\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u66ff\u6362 ssh \u670d\u52a1\u548c web \u670d\u52a1\u7684\u89c4\u5219\uff0c\u5e76\u5199\u51fa\u57fa\u4e8e ip","_","conntrack \u653e\u884c ssh \u548c web \u7684\u89c4\u5219(\u8fdb\u5165\u7684\u6570\u636e\u5305\u7684\u72b6\u6001\u53ea\u53ef\u80fd\u4f1a\u662f NEW \u548c ESTABLISHED\uff0c\u51fa\u53bb\u7684\u72b6\u6001\u53ea\u53ef\u80fd\u662f ESTABLISHED)")),(0,r.kt)("p",{parentName:"li"},"\u653e\u884c ssh\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -R INPUT 1 -s 192.168.0.0/24 -d 192.168.0.181 -p tcp --dport 22 -m state --state=NEW,ESTABLISHED -j ACCEPT \n[root@arm64v8 ~]# iptables -R OUTPUT 1 -s 192.168.0.181 -p tcp --sport 22 -m state --state=ESTABLISHED -j ACCEPT \n[root@arm64v8 ~]#\n")),(0,r.kt)("p",{parentName:"li"},"\u653e\u884c web\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -R INPUT 4 -d 192.168.0.181 -p tcp --dport 80 -m state --state=NEW,ESTABLISHED -j ACCEPT \n[root@arm64v8 ~]# iptables -R OUTPUT 4 -s 192.168.0.181 -p tcp --sport 80 -m state --state=ESTABLISHED -j ACCEPT \n[root@arm64v8 ~]#\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -L -n --line-number\nChain INPUT (policy DROP)\nnum  target     prot opt source               destination       \n1    ACCEPT     tcp  --  192.168.0.0/24       192.168.0.181        tcp dpt:22 state NEW,ESTABLISHED\n2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0         \n3    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0            icmptype 0\n4    ACCEPT     tcp  --  0.0.0.0/0            192.168.0.181        tcp dpt:80 state NEW,ESTABLISHED\n\nChain FORWARD (policy DROP)\nnum  target     prot opt source               destination       \n\nChain OUTPUT (policy DROP)\nnum  target     prot opt source               destination       \n1    ACCEPT     tcp  --  192.168.0.181        0.0.0.0/0            tcp spt:22 state ESTABLISHED\n2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0         \n3    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0            icmptype 8\n4    ACCEPT     tcp  --  192.168.0.181        0.0.0.0/0            tcp spt:80 state ESTABLISHED\n[root@arm64v8 ~]#\n")),(0,r.kt)("p",{parentName:"li"},"\u8fd9\u6837\u7684\u8bbe\u7f6e\u4f7f\u5f97\u5916\u754c\u53ef\u4ee5\u548c\u4e3b\u673a\u5efa\u7acb\u4f1a\u8bdd\uff0c\u4f46\u662f\u7531\u4e3b\u673a\u51fa\u53bb\u7684\u6570\u636e\u5305\u5219\u4e00\u5b9a\u53ea\u80fd\u662f ESTABLISHED \u72b6\u6001\u7684\u670d\u52a1\u53d1\u51fa\u7684\uff0c\u8fd9\u6837\u672c\u673a\u60f3\u4e3b\u52a8\u548c\u5916\u754c\u5efa\u7acb\u4f1a\u8bdd\u662f\u4e0d\u53ef\u80fd\u7684\u3002\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u72b6\u6001\u76d1\u6d4b\u7684\u529f\u80fd\uff0c\u9632\u6b62\u9ed1\u5ba2\u901a\u8fc7\u5f00\u653e\u7684 22 \u7aef\u53e3\u6216 80 \u7aef\u53e3\u690d\u5165\u6728\u9a6c\u5e76\u4e3b\u52a8\u8054\u7cfb\u9ed1\u5ba2\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u653e\u884c\u5916\u754c ping \u81ea\u5df1\uff0c\u4f46\u662f\u8981\u57fa\u4e8e ip","_","conntrack \u6765\u653e\u884c\u3002")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -A INPUT -d 192.168.0.181 -p icmp --icmp-type=8 -m state --state=NEW,ESTABLISHED -j ACCEPT \n[root@arm64v8 ~]# iptables -A OUTPUT -s 192.168.0.181 -p icmp --icmp-type=0 -m state --state=ESTABLISHED -j ACCEPT \n[root@arm64v8 ~]#\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u5b89\u88c5 vsftpd\uff0c\u5e76\u8bbe\u7f6e\u5176\u9632\u706b\u5899\u3002")),(0,r.kt)("p",{parentName:"li"},"\u7531\u4e8e ftp \u6709\u4e3b\u52a8\u6a21\u5f0f\u548c\u88ab\u52a8\u6a21\u5f0f\uff0c\u88ab\u52a8\u6a21\u5f0f\u7684\u6570\u636e\u7aef\u53e3\u4e0d\u5b9a\uff0c\u4e14\u4f7f\u7528\u54ea\u79cd\u6a21\u5f0f\u662f\u7531\u5ba2\u6237\u7aef\u51b3\u5b9a\u7684\uff0c\u8fd9\u4f7f\u5f97 ftp\u7684\u9632\u706b\u5899\u8bbe\u7f6e\u6bd4\u8f83\u590d\u6742\uff0c\u4f46\u662f\u501f\u52a9 netfilter \u7684 state \u6a21\u5757\uff0c\u8bbe\u7f6e\u5c31\u7b80\u5355\u7684\u591a\u4e86\u3002"),(0,r.kt)("p",{parentName:"li"},"\u9996\u5148\u88c5\u8f7d\u5176\u4e13\u95e8\u7684\u6a21\u5757 nf","_","conntrack","_","ftp\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# modprobe nf_conntrack_ftp\n")),(0,r.kt)("p",{parentName:"li"},'\u4e5f\u53ef\u4ee5\u5199\u5165 /etc/sysconfig/iptables-config \u7684 "IPTABLES',"_",'MODULES="nf',"_","conntrack","_",'ftp"\u3002'),(0,r.kt)("p",{parentName:"li"},"\u7136\u540e\u7f16\u5199\u89c4\u5219\uff1a\u653e\u884c 21 \u7aef\u53e3\u7684\u8fdb\u5165\u6570\u636e\u5305\uff0c\u653e\u884c related \u5173\u8054\u6570\u636e\u5305\uff0c\u653e\u884c\u51fa\u53bb\u7684\u5305\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -A INPUT -d 192.168.0.181 -p tcp --dport 21 -m state --state=NEW,ESTABLISHED -j ACCEPT \n[root@arm64v8 ~]# iptables -A INPUT -d 192.168.0.181 -m state --state=RELATED,ESTABLISHED -j ACCEPT \n[root@arm64v8 ~]# iptables -A OUTPUT -s 192.168.0.181 -m state --state=ESTABLISHED -j ACCEPT \n[root@arm64v8 ~]#\n")))),(0,r.kt)("p",null,"\u4ee5\u4e0a\u793a\u4f8b\u5b8c\u6210\u540e\uff0c\u5f97\u5230\u7684\u603b\u89c4\u5219\u96c6\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -L -n --line-numbers \nChain INPUT (policy DROP)\nnum  target     prot opt source               destination       \n1    ACCEPT     tcp  --  192.168.0.0/24       192.168.0.181        tcp dpt:22 state NEW,ESTABLISHED\n2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0         \n3    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0            icmptype 0\n4    ACCEPT     tcp  --  0.0.0.0/0            192.168.0.181        tcp dpt:80 state NEW,ESTABLISHED\n5    ACCEPT     icmp --  0.0.0.0/0            192.168.0.181        icmptype 8 state NEW,ESTABLISHED\n6    ACCEPT     tcp  --  0.0.0.0/0            192.168.0.181        tcp dpt:21 state NEW,ESTABLISHED\n7    ACCEPT     all  --  0.0.0.0/0            192.168.0.181        state RELATED,ESTABLISHED\n\nChain FORWARD (policy DROP)\nnum  target     prot opt source               destination       \n\nChain OUTPUT (policy DROP)\nnum  target     prot opt source               destination       \n1    ACCEPT     tcp  --  192.168.0.181        0.0.0.0/0            tcp spt:22 state ESTABLISHED\n2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0         \n3    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0            icmptype 8\n4    ACCEPT     tcp  --  192.168.0.181        0.0.0.0/0            tcp spt:80 state ESTABLISHED\n5    ACCEPT     icmp --  192.168.0.181        0.0.0.0/0            icmptype 0 state ESTABLISHED\n6    ACCEPT     all  --  192.168.0.181        0.0.0.0/0            state ESTABLISHED\n[root@arm64v8 ~]#\n")),(0,r.kt)("p",null,"\u73b0\u5728 iptables \u5df2\u7ecf\u6709\u5f88\u591a\u89c4\u5219\uff0c\u4f46\u662f\u4e5f\u8db3\u591f\u4e71\u7684\u3002\u4e0d\u4ec5\u60f3\u770b\u61c2\u633a\u590d\u6742\uff0c\u5728\u6570\u636e\u5305\u68c0\u67e5\u7684\u65f6\u5019\u6027\u80fd\u4e5f\u66f4\u5dee\uff0c\u6240\u4ee5\u6709\u5fc5\u8981\u5c06\u5b83\u4eec\u5408\u5e76\u6210\u7b80\u5355\u6613\u61c2\u7684\u89c4\u5219\u3002"),(0,r.kt)("h3",{id:"255\u4f18\u5316\u89c4\u5219"},"2.5.5\u3001\u4f18\u5316\u89c4\u5219"),(0,r.kt)("p",null,"\u6267\u884c iptables-save \u547d\u4ee4\uff0c\u53ef\u4ee5 dump \u51fa\u5f53\u524d\u5185\u6838\u7ef4\u62a4\u7684 netfilter \u6307\u5b9a\u8868\u4e2d\u7684\u89c4\u5219\uff0c\u9ed8\u8ba4\u5bfc\u51fa filter \u8868\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables-save -t filter\n# Generated by iptables-save v1.4.21 on Wed Sep 29 06:17:54 2021\n*filter\n:INPUT DROP [3:885]\n:FORWARD DROP [0:0]\n:OUTPUT DROP [66:21100]\n-A INPUT -s 192.168.0.0/24 -d 192.168.0.181/32 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -p icmp -m icmp --icmp-type 0 -j ACCEPT\n-A INPUT -d 192.168.0.181/32 -p tcp -m tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT\n-A INPUT -d 192.168.0.181/32 -p icmp -m icmp --icmp-type 8 -m state --state NEW,ESTABLISHED -j ACCEPT\n-A INPUT -d 192.168.0.181/32 -p tcp -m tcp --dport 21 -m state --state NEW,ESTABLISHED -j ACCEPT\n-A INPUT -d 192.168.0.181/32 -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A OUTPUT -s 192.168.0.181/32 -p tcp -m tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n-A OUTPUT -o lo -j ACCEPT\n-A OUTPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT\n-A OUTPUT -s 192.168.0.181/32 -p tcp -m tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT\n-A OUTPUT -s 192.168.0.181/32 -p icmp -m icmp --icmp-type 0 -m state --state ESTABLISHED -j ACCEPT\n-A OUTPUT -s 192.168.0.181/32 -m state --state ESTABLISHED -j ACCEPT\nCOMMIT\n# Completed on Wed Sep 29 06:17:54 2021\n[root@arm64v8 ~]#\n")),(0,r.kt)("p",null,"\u4ece\u5bfc\u51fa\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230\uff0cinput \u94fe\u4e2d\u6709\u597d\u51e0\u6761\u89c4\u5219\u90fd\u662f\u9488\u5bf9 state=NEW,ESTABLISHED \u800c\u5efa\u7acb\u7684\uff0c\u540c\u7406 OUTPUT \u94fe\u4e2d\u7684 state=ESTABLISHED\uff0c\u4e14\u4ed6\u4eec\u7684 target \u90fd\u662f\u4e00\u6837\u7684\uff0c\u8fd9\u6837\u7684\u89c4\u5219\u53ef\u4ee5\u8003\u8651\u662f\u5426\u80fd\u591f\u5408\u5e76\u3002"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"\u6ce8\u610f\uff1a\u73af\u56de\u63a5\u53e3 lo \u4e00\u5b9a\u8981\u663e\u5f0f\u6307\u5b9a\u6240\u6709\u7c7b\u578b\u7684\u6570\u636e\u90fd\u901a\u8fc7\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# INPUT:\n-A INPUT -s 192.168.0.0/24 -d 192.168.0.181/32 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -p icmp -m icmp --icmp-type 0 -j ACCEPT\n-A INPUT -d 192.168.0.181/32 -p tcp -m tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT\n-A INPUT -d 192.168.0.181/32 -p icmp -m icmp --icmp-type 8 -m state --state NEW,ESTABLISHED -j ACCEPT\n-A INPUT -d 192.168.0.181/32 -p tcp -m tcp --dport 21 -m state --state NEW,ESTABLISHED -j ACCEPT\n-A INPUT -d 192.168.0.181/32 -m state --state RELATED,ESTABLISHED -j ACCEPT\n\n# \u53ef\u4ee5\u8003\u8651\u5408\u5e76\u5982\u4e0b\uff1a\n\n# INPUT:\n-A INPUT -d 192.168.0.181/32 -p tcp -m multiport --destination-ports 21,22,80 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT\n-A INPUT -d 192.168.0.181/32 -p icmp -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# OUTPUT\n-A OUTPUT -s 192.168.0.181/32 -p tcp -m tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n-A OUTPUT -o lo -j ACCEPT\n-A OUTPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT\n-A OUTPUT -s 192.168.0.181/32 -p tcp -m tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT\n-A OUTPUT -s 192.168.0.181/32 -p icmp -m icmp --icmp-type 0 -m state --state ESTABLISHED -j ACCEPT\n-A OUTPUT -s 192.168.0.181/32 -m state --state ESTABLISHED -j ACCEPT\n\n# \u53ef\u4ee5\u8003\u8651\u5408\u5e76\u5982\u4e0b\uff1a\n\n# OUTPUT:\n-A OUTPUT -s 192.168.0.181/32 -m state --state ESTABLISHED -j ACCEPT\n-A OUTPUT -s 192.168.0.181/32 -p icmp -j ACCEPT\n-A OUTPUT -o lo -j ACCEPT\n")),(0,r.kt)("p",null,"\u901a\u8fc7\u4e0a\u8ff0\u601d\u8def\u7684\u51c0\u5316\uff0c\u6700\u7ec8\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u7684\u89c4\u5219\u96c6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -L -n --line-numbers\nChain INPUT (policy DROP)\nnum  target     prot opt source               destination       \n1    ACCEPT     tcp  --  0.0.0.0/0            192.168.0.181        multiport dports 21,22,80 state NEW,RELATED,ESTABLISHED\n2    ACCEPT     icmp --  0.0.0.0/0            192.168.0.181     \n3    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0         \n\nChain FORWARD (policy DROP)\nnum  target     prot opt source               destination       \n\nChain OUTPUT (policy DROP)\nnum  target     prot opt source               destination       \n1    ACCEPT     all  --  192.168.0.181        0.0.0.0/0            state ESTABLISHED\n2    ACCEPT     icmp --  192.168.0.181        0.0.0.0/0         \n3    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0         \n[root@arm64v8 ~]#\n")),(0,r.kt)("p",null,"\u5176\u5b9e\u5b66\u5230\u8fd9\u91cc\uff0c\u53ef\u4ee5\u7b97\u662f\u5df2\u7ecf\u89e6\u53ca\u5230 iptables filter \u8868\u7684\u6838\u5fc3\u4e86\uff0c\u9488\u5bf9\u7528\u6237\u4e0d\u540c\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u7075\u6d3b\u5b9a\u5236\u4e86\uff0c\u540e\u9762\u4f1a\u7ed9\u51fa\u6700\u4f73\u5b9e\u8df5\u3002"),(0,r.kt)("h3",{id:"256\u4fdd\u5b58\u89c4\u5219"},"2.5.6\u3001\u4fdd\u5b58\u89c4\u5219"),(0,r.kt)("p",null,'\u4f7f\u7528 iptables \u5199\u7684\u89c4\u5219\u90fd\u5b58\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u5185\u6838\u4f1a\u7ef4\u62a4 netfilter \u7684\u6bcf\u5f20\u8868\u4e2d\u7684\u89c4\u5219\uff0c\u6240\u4ee5\u91cd\u542f iptables "\u670d\u52a1" \u4f1a\u4f7f\u5185\u5b58\u4e2d\u7684\u89c4\u5219\u5217\u8868\u5168\u90e8\u88ab\u6e05\u7a7a\u3002'),(0,r.kt)("p",null,'\u8981\u60f3\u624b\u52a8\u5199\u7684\u89c4\u5219\u957f\u671f\u6709\u6548\uff0c\u9700\u8981\u5c06\u89c4\u5219\u4fdd\u5b58\u5230\u6301\u4e45\u5b58\u50a8\u6587\u4ef6\u4e2d\uff0c\u4f8b\u5982 iptables "\u670d\u52a1" \u542f\u52a8\u65f6\u9ed8\u8ba4\u52a0\u8f7d\u7684\u811a\u672c\u914d\u7f6e\u6587\u4ef6 /etc/sysconfig/iptables\u3002'),(0,r.kt)("p",null,"\u6709\u4e24\u79cd\u65b9\u6cd5\u4fdd\u5b58\u89c4\u5219\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u76f4\u63a5\u4fdd\u5b58\u5230 /etc/sysconfig/iptables \u4e2d"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"service iptables save\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u53ef\u81ea\u5b9a\u4e49\u4fdd\u5b58\u4f4d\u7f6e"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables-save > /etc/sysconfig/iptables\niptables-save > /etc/sysconfig/iptables.20211005\n")))),(0,r.kt)("p",null,"\u6062\u590d\u89c4\u5219\u7684\u65b9\u6cd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables-restore < /etc/sysconfig/iptables\niptables-restore < /etc/sysconfig/iptables.20211005\n")),(0,r.kt)("h3",{id:"257\u81ea\u5b9a\u4e49\u94fe"},"2.5.7\u3001\u81ea\u5b9a\u4e49\u94fe"),(0,r.kt)("p",null,'\u81ea\u5b9a\u4e49\u94fe\u662f\u88ab\u4e3b\u94fe\u5f15\u7528\u7684\u3002\u5f15\u7528\u4f4d\u7f6e\u7531 "-j" \u6307\u5b9a\u81ea\u5b9a\u4e49\u94fe\u540d\u79f0\uff0c\u8868\u793a\u8df3\u8f6c\u5230\u81ea\u5b9a\u4e49\u94fe\u5e76\u5339\u914d\u5176\u5185\u90e8\u89c4\u5219\u5217\u8868\u3002'),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c\u5728 INPUT \u94fe\u4e2d\u7684\u7b2c\u4e09\u6761\u89c4\u5219\u4e3a\u81ea\u5b9a\u4e49\u94fe\u7684\u5f15\u7528\u89c4\u5219\uff0c\u5219\u6570\u636e\u5305\u5339\u914d\u5230\u4e86\u7b2c\u4e09\u6761\u65f6\u8fdb\u5165\u81ea\u5b9a\u4e49\u94fe\u5339\u914d\uff0c\u5339\u914d\u5b8c\u81ea\u5b9a\u4e49\u94fe\u540e\u5982\u679c\u5b9a\u4e49\u4e86\u8fd4\u56de\u4e3b\u94fe\u7684 RETURN \u52a8\u4f5c\uff0c\u5219\u8fd4\u56de\u4e3b\u94fe\u7ee7\u7eed\u5411\u4e0b\u5339\u914d\uff0c\u5982\u679c\u6ca1\u6709\u5b9a\u4e49 RETURN \u52a8\u4f5c\uff0c\u5219\u5339\u914d\u7ed3\u675f\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"self defined chains",src:a(78935).Z,width:"551",height:"545"})),(0,r.kt)("p",null,"\u521b\u5efa\u4e00\u6761\u81ea\u5b9a\u4e49\u94fe\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -N mychain\n")),(0,r.kt)("p",null,"\u5411\u5176\u4e2d\u52a0\u5165\u4e00\u4e9b\u57fa\u4e8e\u5b89\u5168\u7684\u653b\u9632\u89c4\u5219\uff0c\u8ba9\u6bcf\u6b21\u6570\u636e\u5305\u8fdb\u5165\u90fd\u5339\u914d\u4e00\u6b21\u653b\u9632\u94fe\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -A mychain -d 255.255.255.255 -p icmp -j DROP\n[root@arm64v8 ~]# iptables -A mychain -d 192.168.255.255 -p icmp -j DROP\n[root@arm64v8 ~]# iptables -A mychain -p tcp ! --syn -m state --state NEW -j DROP \n[root@arm64v8 ~]# iptables -A mychain -p tcp --tcp-flags ALL ALL -j DROP \n[root@arm64v8 ~]# iptables -A mychain -p tcp --tcp-flags ALL NONE -j DROP \n[root@arm64v8 ~]#\n")),(0,r.kt)("p",null,"\u5728\u81ea\u5b9a\u4e49\u94fe\u4e2d\u7684\u6700\u540e\u4e00\u6761\u52a0\u4e0a\u4e00\u6761\u8fd4\u56de\u4e3b\u94fe\u7684\u89c4\u5219\uff0c\u8868\u793a\u5339\u914d\u5b8c\u81ea\u5b9a\u4e49\u540e\u7ee7\u7eed\u56de\u5230\u4e3b\u94fe\u8fdb\u884c\u5339\u914d\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -A mychain -d 192.168.0.181/32 -j RETURN\n")),(0,r.kt)("p",null,"\u5728\u4e3b\u94fe\u7684\u9002\u5f53\u4f4d\u7f6e\u52a0\u4e0a\u4e00\u6761\u5f15\u7528\u4e3b\u94fe\u7684\u89c4\u5219\u3002\u8868\u793a\u6570\u636e\u5305\u5339\u914d\u5230\u4e86\u8fd9\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u8fdb\u5165\u81ea\u5b9a\u4e49\u94fe\u5339\u914d\uff0c\u5982\u679c\u81ea\u5b9a\u4e49\u94fe\u90fd\u6ca1\u88ab\u5339\u914d\u800c\u662f\u88ab\u6700\u540e\u7684 RETURN \u89c4\u5219\u5339\u914d\uff0c\u5219\u56de\u5230\u4e3b\u94fe\u518d\u6b21\u5339\u914d\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -I INPUT -d 192.168.0.181/32 -j mychain \n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u4e0d\u6307\u5b9a\u63d2\u5165\u5230\u7b2c\u51e0\u6761\u89c4\u5219\uff0c\u9ed8\u8ba4\u63d2\u5165\u7b2c\u4e00\u6761\u3002")),(0,r.kt)("p",null,"\u5220\u9664\u81ea\u5b9a\u4e49\u94fe\uff1a\u9700\u8981\u5148\u6e05\u7a7a\u81ea\u5b9a\u4e49\u94fe\uff0c\u53bb\u9664\u88ab\u5f15\u7528\u8bb0\u5f55\uff0c\u7136\u540e\u4f7f\u7528 -X \u5220\u9664\u7a7a\u7684\u81ea\u5b9a\u4e49\u94fe\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -F mychain \n[root@arm64v8 ~]# iptables -D INPUT 1\n[root@arm64v8 ~]# iptables -X mychain\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528 -E \u547d\u4ee4\u91cd\u547d\u540d\u81ea\u5b9a\u4e49\u94fe\u3002"),(0,r.kt)("h4",{id:"2571\u81ea\u5b9a\u4e49\u94fe\u793a\u4f8b"},"2.5.7.1\u3001\u81ea\u5b9a\u4e49\u94fe\u793a\u4f8b"),(0,r.kt)("p",null,"\u5982\u679c\u6211\u4eec\u5728\u4e91\u670d\u52a1\u5382\u5546\u90a3\u91cc\u4e70\u4e86\u4e00\u53f0\u4e91\u670d\u52a1\u5668\uff0c\u7ecf\u5e38\u4f1a\u9047\u5230\u522b\u4eba\u66b4\u529b\u7834\u89e3\u6211\u4eec\u7684 sshd \u670d\u52a1\uff0c\u4e3a\u4e86\u6291\u5236\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u6211\u4eec\u901a\u8fc7\u4e0b\u9762\u51e0\u4e2a\u6b65\u9aa4\u5b9e\u73b0\u3002\n\u7b2c\u4e00\u6b65\uff1a\u7f16\u5199\u68c0\u6d4b\u6076\u610f IP \u7684\u811a\u672c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@brinnatt ~]# cat /security/deny_sshcrack.sh \n#! /bin/bash\n# \u63d0\u53d6\u6240\u6709\u7684IP\u5230black.list\u6587\u4ef6\u4e2d\ncat /var/log/secure|awk '/Failed/{print $(NF-3)}'|sort|uniq -c|awk '{print $2\"=\"$1;}' > /usr/local/bin/black.list\n\n# \u8bbe\u5b9a\u6b21\u6570\ndefine=\"3\"\nfor i in `cat  /usr/local/bin/black.list`\ndo\n  IP=`echo $i |awk -F= '{print $1}'`\n  NUM=`echo $i|awk -F= '{print $2}'`\n\n  if [ $NUM -gt $define ]; then\n    /usr/sbin/iptables -C DENY_SSHCRACK -s $IP -j DROP &> /dev/null\n    if [ $? -gt 0 ];then\n        /usr/sbin/iptables -I DENY_SSHCRACK 1 -s $IP -j DROP\n    fi\n  fi\ndone\n[root@brinnatt ~]# chmod +x /security/deny_sshcrack.sh\n")),(0,r.kt)("p",null,"\u7b2c\u4e8c\u6b65\uff1a\u521b\u5efa\u81ea\u5b9a\u4e49\u94fe\u4e13\u95e8\u7528\u6765\u8fc7\u6ee4\u6076\u610f IP"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@brinnatt ~]# iptables -N DENY_SSHCRACK\n[root@brinnatt ~]# iptables -A DENY_SSHCRACK -i eth0 -j RETURN\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u811a\u672c\u4f1a\u81ea\u52a8\u5411\u8be5\u81ea\u5b9a\u4e49\u94fe\u4e2d\u63d2\u5165\u8fc7\u6ee4\u89c4\u5219")),(0,r.kt)("p",null,"\u7b2c\u4e09\u6b65\uff1a\u521b\u5efa\u4efb\u52a1\u8ba1\u5212"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@brinnatt ~]# crontab -l\n*/3 * * * * /security/deny_sshcrack.sh\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6ce8\u610f\uff0c\u5148\u8981\u719f\u7ec3\u6491\u63e1\u4efb\u52a1\u8ba1\u5212\u5e94\u7528\uff0c\u4e0d\u7136\u5f88\u6709\u53ef\u80fd\u4efb\u52a1\u4e0d\u751f\u6548\uff0c\u7279\u522b\u662f\u8981\u6ce8\u610f crontab \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u91cc\u9762\u7684 PATH \u5982\u679c\u6ca1\u6709\u5305\u542b\u811a\u672c\u4e2d\u7684\u547d\u4ee4\uff0c\u4f1a\u51fa\u73b0 command not found\uff0c\u4ece\u800c\u4efb\u52a1\u8ba1\u5212\u5931\u8d25\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u672c\u6765\u901a\u8fc7 tcp","_","wrapper \u53ef\u4ee5\u66f4\u7b80\u5355\u5b9e\u73b0\uff0c\u53ef\u60dc\u7531\u4e8e\u5b89\u5168\u539f\u56e0 openssh v6.7 \u4ee5\u540e\u4e0d\u652f\u6301 tcp","_","wrapper\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u8fd9\u79cd\u811a\u672c\u5b9e\u73b0\u7684\u65b9\u5f0f\u56fa\u7136\u53ef\u4ee5\uff0c\u4f46\u662f\u6709\u4e9b\u7e41\u7410\uff0c\u6709\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee fail2ban\uff0c\u5b9e\u73b0\u8d77\u6765\u7b80\u5355\u800c\u4e14\u529f\u80fd\u5f3a\u5927\u3002")),(0,r.kt)("h3",{id:"258nat-\u8868"},"2.5.8\u3001NAT \u8868"),(0,r.kt)("p",null,"NAT \u4f9d\u8d56\u4e8e ip","_","forward\uff0c\u56e0\u6b64\u9700\u8981\u5148\u5f00\u542f\u5b83\u3002NAT \u7684\u57fa\u7840\u662f nf","_","conntrack\uff0c\u7528\u6765\u8bb0\u5f55 NAT \u8868\u7684\u6620\u5c04\u5173\u7cfb\u3002"),(0,r.kt)("p",null,"NAT \u6709\u4e09\u4e2a\u4f5c\u7528\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u5730\u5740\u8f6c\u6362"),"\uff1a\u8ba9\u5185\u7f51(\u79c1\u6709\u5730\u5740)\u53ef\u4ee5\u5171\u7528\u4e00\u4e2a\u6216\u51e0\u4e2a\u516c\u7f51\u5730\u5740\u8fde\u63a5 Internet\u3002\u8fd9\u662f\u4ece\u5185\u5411\u5916\u7684\uff0c\u9700\u8981\u5728\u7f51\u5173\u5f0f\u9632\u706b\u5899\u7684 POSTROUTING \u5904\u4fee\u6539\u6e90\u5730\u5740\uff0c\u8fd9\u662f SNAT \u529f\u80fd\u3002"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u4fdd\u62a4\u5185\u7f51\u670d\u52a1\u5668"),"\uff1a\u5185\u7f51\u4e3b\u673a\u8fde\u63a5 Internet \u4f7f\u7528\u7684\u662f\u516c\u7f51\u5730\u5740\uff0c\u5bf9\u5916\u754c\u800c\u8a00\u662f\u770b\u4e0d\u5230\u5185\u7f51\u670d\u52a1\u5668\u5730\u5740\u7684\uff0c\u6240\u4ee5\u5916\u754c\u60f3\u8981\u8bbf\u95ee\u5185\u90e8\u4e3b\u673a\u53ea\u80fd\u7ecf\u8fc7\u9632\u706b\u5899\u4e3b\u673a\u7684\u516c\u7f51\u5730\u5740\uff0c\u7136\u540e\u5c06\u76ee\u6807\u5730\u5740\u8f6c\u6362\u4e3a\u5185\u7f51\u670d\u52a1\u5668\u5730\u5740\uff0c\u8fd9\u8d77\u5230\u4e86\u4fdd\u62a4\u5185\u7f51\u670d\u52a1\u5668\u7684\u4f5c\u7528\u3002\u8f6c\u6362\u76ee\u6807\u5730\u5740\u9700\u8981\u5728\u7f51\u5173\u5f0f\u9632\u706b\u5899\u7684 PREROUTING \u94fe\u5904\u4fee\u6539\uff0c\u8fd9\u662f DNAT \u529f\u80fd\u3002"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u7aef\u53e3\u6620\u5c04"),"\uff1aDNAT \u662f\u4fee\u6539\u76ee\u6807\u5730\u5740\uff0c\u7aef\u53e3\u6620\u5c04\u662f\u4fee\u6539\u76ee\u6807\u7aef\u53e3\u3002\u5982\u5c06 web \u670d\u52a1\u5668\u7684 8080 \u7aef\u53e3\u6620\u5c04\u4e3a\u9632\u706b\u5899\u7684 80 \u7aef\u53e3\u3002")),(0,r.kt)("p",null,"\u5916\u7f51\u4e3b\u673a\u548c\u5185\u7f51\u4e3b\u673a\u901a\u4fe1\u6709\u4e24\u79cd\u60c5\u51b5\u7684\u6570\u636e\u5305\uff1a\u4e00\u79cd\u60c5\u51b5\u662f\u5efa\u7acbNEW\u72b6\u6001\u7684\u65b0\u8bf7\u6c42\u8fde\u63a5\u6570\u636e\u5305\uff0c\u4e00\u79cd\u662f\u56de\u5e94\u7684\u6570\u636e\u5305\u3002"),(0,r.kt)("p",null,"\u65e0\u8bba\u54ea\u79cd\u60c5\u51b5\uff0c\u5728 NEW \u72b6\u6001\u6570\u636e\u5305\u7ecf\u8fc7\u5730\u5740\u8f6c\u6362\u4e4b\u540e\u4f1a\u5728\u9632\u706b\u5899\u5185\u5b58\u4e2d\u7ef4\u62a4\u4e00\u5f20 NAT \u8868\uff0c\u4fdd\u5b58\u672a\u5b8c\u6210\u8fde\u63a5\u7684\u5730\u5740\u8f6c\u6362\u8bb0\u5f55\uff0c\u8fd9\u6837\u5f53\u56de\u5e94\u6570\u636e\u5305\u5230\u8fbe\u9632\u706b\u5899\u65f6\u53ef\u4ee5\u6839\u636e\u8fd9\u4e9b\u8bb0\u5f55\u8def\u7531\u7ed9\u6b63\u786e\u7684\u4e3b\u673a\u3002"),(0,r.kt)("p",null,"\u4e5f\u5c31\u662f\u8bf4\uff0cSNAT \u4e3b\u8981\u5e94\u4ed8\u7684\u662f\u5185\u90e8\u4e3b\u673a\u8fde\u63a5\u5230 Internet \u7684\u6e90\u5730\u5740\u8f6c\u6362\uff0c\u8f6c\u6362\u7684\u4f4d\u7f6e\u662f POSTROUTING \u94fe\uff1bDNAT \u4e3b\u8981\u5e94\u4ed8\u7684\u662f\u5916\u90e8\u4e3b\u673a\u8fde\u63a5\u5185\u90e8\u670d\u52a1\u5668\u9632\u6b62\u5185\u90e8\u670d\u52a1\u5668\u88ab\u653b\u51fb\u7684\u76ee\u6807\u5730\u5740\u8f6c\u6362\uff0c\u8f6c\u6362\u4f4d\u7f6e\u5728 PREROUTING\uff1b\u7aef\u53e3\u6620\u5c04\u53ef\u4ee5\u5728\u591a\u4e2a\u5730\u65b9\u8f6c\u6362\u3002"),(0,r.kt)("h4",{id:"2581\u914d\u7f6e\u7f51\u5173\u4ee5\u53ca\u8f6c\u53d1"},"2.5.8.1\u3001\u914d\u7f6e\u7f51\u5173\u4ee5\u53ca\u8f6c\u53d1"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ipv4_forward",src:a(82831).Z,width:"750",height:"293"})),(0,r.kt)("p",null,"\u5b9e\u9a8c\u73af\u5883\u5982\u4e0a\u56fe\u6240\u793a\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"arm64v8 \u4f5c\u4e3a\u8f6c\u53d1\u4e3b\u673a\u6709\u4e24\u4e2a\u7f51\u5361\u4e24\u4e2a\u7f51\u6bb5\uff0c\u4e00\u4e2a\u662f 192.168.0.0/24 \u7f51\u6bb5\u548c 172.16.100.0/24 \u7f51\u6bb5\uff1b"),(0,r.kt)("li",{parentName:"ul"},"x86 \u4e3b\u673a\u7f51\u5173\u6307\u5411 arm64v8 \u4e3b\u673a\uff1b"),(0,r.kt)("li",{parentName:"ul"},"aarch64 \u4e3b\u673a\u7f51\u5173\u6307\u5411 arm64v8 \u4e3b\u673a \uff1b")),(0,r.kt)("p",null,"\u5b9e\u9a8c\u6b65\u9aa4\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"x86 \u4e3b\u673a ping arm64v8 \u4e3b\u673a 192.168.0.181 \u7f51\u5361\uff0caarch64 \u4e3b\u673a ping arm64v8 \u4e3b\u673a 172.16.100.11 \u7f51\u5361\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@x86 ~]# route -n                   # \u67e5\u770b\u8def\u7531\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n0.0.0.0         192.168.0.181   0.0.0.0         UG    0      0        0 ens32\n169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 ens32\n192.168.0.0     0.0.0.0         255.255.255.0   U     0      0        0 ens32\n[root@x86 ~]# ping 192.168.0.181     # \u53ef\u4ee5\u901a\nPING 192.168.0.181 (192.168.0.181) 56(84) bytes of data.\n64 bytes from 192.168.0.181: icmp_seq=1 ttl=64 time=2.49 ms\n64 bytes from 192.168.0.181: icmp_seq=2 ttl=64 time=1.70 ms\n64 bytes from 192.168.0.181: icmp_seq=3 ttl=64 time=2.15 ms\n^C\n--- 192.168.0.181 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2004ms\nrtt min/avg/max/mdev = 1.703/2.118/2.498/0.325 ms\n[root@x86 ~]#\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@aarch64 ~]# route -n               # \u67e5\u770b\u8def\u7531\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n0.0.0.0         172.16.100.11   0.0.0.0         UG    0      0        0 eth0\n169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0\n172.16.100.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0\n[root@aarch64 ~]# \n[root@aarch64 ~]# ping 172.16.100.11 # \u53ef\u4ee5\u901a\nPING 172.16.100.11 (172.16.100.11) 56(84) bytes of data.\n64 bytes from 172.16.100.11: icmp_seq=1 ttl=64 time=0.558 ms\n64 bytes from 172.16.100.11: icmp_seq=2 ttl=64 time=0.591 ms\n64 bytes from 172.16.100.11: icmp_seq=3 ttl=64 time=0.587 ms\n^C\n--- 172.16.100.11 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2097ms\nrtt min/avg/max/mdev = 0.558/0.578/0.591/0.031 ms\n[root@aarch64 ~]#\n")),(0,r.kt)("p",{parentName:"li"},"\u7ed3\u8bba\uff1a\u5bf9\u4e8e\u4e2d\u95f4\u7684 arm64v8 \u8fd9\u53f0\u4e3b\u673a\u6765\u8bf4\uff0c\u6709\u4e24\u4e2a\u76f4\u8fde\u7f51\u6bb5\uff0c192.168.0.0/24 \u7f51\u6bb5\u548c 172.16.100.0/24 \u7f51\u6bb5\uff0c\u540c\u4e00\u7f51\u6bb5\u5185\u7684\u4e3b\u673a\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\u662f\u7406\u6240\u5f53\u7136\u7684\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"x86 \u4e3b\u673a ping arm64v8 \u4e3b\u673a 172.16.100.11 \u7f51\u5361\uff0cx86 \u4e3b\u673a ping aarch64 \u4e3b\u673a 172.16.100.12 \u7f51\u5361\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@x86 ~]# ping 172.16.100.11 # \u53ef\u4ee5\u901a\nPING 172.16.100.11 (172.16.100.11) 56(84) bytes of data.\n64 bytes from 172.16.100.11: icmp_seq=1 ttl=64 time=3.44 ms\n64 bytes from 172.16.100.11: icmp_seq=2 ttl=64 time=1.60 ms\n64 bytes from 172.16.100.11: icmp_seq=3 ttl=64 time=1.66 ms\n^C\n--- 172.16.100.11 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2004ms\nrtt min/avg/max/mdev = 1.606/2.239/3.446/0.855 ms\n[root@x86 ~]# \n[root@x86 ~]# ping 172.16.100.12 # \u4e0d\u53ef\u4ee5\u901a\nPING 172.16.100.12 (172.16.100.12) 56(84) bytes of data.\n^C\n--- 172.16.100.12 ping statistics ---\n32 packets transmitted, 0 received, 100% packet loss, time 31011ms\n\n[root@x86 ~]#\n")),(0,r.kt)("p",{parentName:"li"},"\u7ed3\u8bba\uff1a\u8fd9\u4e2a\u5b9e\u9a8c\u53ef\u80fd\u4f1a\u8ba9\u4eba\u7591\u60d1\uff0c\u56e0\u4e3a\u5b83\u6d89\u53ca\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u77e5\u8bc6\u70b9\uff0c",(0,r.kt)("strong",{parentName:"p"},"IP \u5730\u5740\u5c5e\u4e8e\u5185\u6838\uff0c\u4e0d\u5c5e\u4e8e\u7f51\u5361"),"\u3002"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8e arm64v8 \u8fd9\u53f0\u4e3b\u673a\u6765\u8bf4\uff0c\u5185\u6838\u624b\u91cc\u63e1\u7740\u4e24\u4e2a IP \u5730\u5740\uff0c192.168.0.181 \u548c 172.16.100.11\uff0cx86 \u4e3b\u673a\u7684 192.168.0.124 \u8ddf arm64v8 \u4e3b\u673a\u7684 192.168.0.181 \u5c5e\u4e8e\u76f4\u8fde\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u76f4\u8fbe arm64v8 \u4e3b\u673a\u7684\u5185\u6838\u7f51\u7edc\u6808\uff0c\u6240\u4ee5\u53ef\u4ee5 ping \u901a 172.16.100.11\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u800c 172.16.100.12 \u5e76\u4e0d\u5728 arm64v8 \u4e3b\u673a\u5185\u6838\u624b\u4e0a\uff0c\u800c\u5728\u53e6\u5916\u4e00\u4e2a\u4e3b\u673a aarch64 \u5185\u6838\u624b\u4e0a\uff0cx86 \u4e3b\u673a\u60f3\u8981\u901a\u8fc7 arm64v8 \u4e3b\u673a ping \u901a aarch64 \u4e3b\u673a\uff0c\u5fc5\u987b\u8981\u6c42 arm64v8 \u8fd9\u4e2a\u4e3b\u673a",(0,r.kt)("strong",{parentName:"p"},"\u5f00\u542f\u8f6c\u53d1\u529f\u80fd"),"\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"\u65b9\u6cd5\uff1aecho 1 > /proc/sys/net/ipv4/ip_forward\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5f00\u542f arm64v8 \u4e3b\u673a\u7684\u8f6c\u53d1\u529f\u80fd\uff0cx86 \u4e3b\u673a\u518d ping aarch64 \u4e3b\u673a\u7684 172.16.100.12 \u8bd5\u8bd5"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# echo 1 > /proc/sys/net/ipv4/ip_forward\n[root@arm64v8 ~]# cat /proc/sys/net/ipv4/ip_forward\n1\n[root@arm64v8 ~]#\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@x86 ~]# ping 172.16.100.12         # \u53ef\u4ee5\u901a\nPING 172.16.100.12 (172.16.100.12) 56(84) bytes of data.\n64 bytes from 172.16.100.12: icmp_seq=1 ttl=63 time=4.17 ms\n64 bytes from 172.16.100.12: icmp_seq=2 ttl=63 time=2.96 ms\n64 bytes from 172.16.100.12: icmp_seq=3 ttl=63 time=2.35 ms\n64 bytes from 172.16.100.12: icmp_seq=4 ttl=63 time=3.16 ms\n64 bytes from 172.16.100.12: icmp_seq=5 ttl=63 time=2.16 ms\n^C\n--- 172.16.100.12 ping statistics ---\n5 packets transmitted, 5 received, 0% packet loss, time 4006ms\nrtt min/avg/max/mdev = 2.163/2.963/4.175/0.711 ms\n[root@x86 ~]#\n")))),(0,r.kt)("h4",{id:"2582\u914d\u7f6e\u7f51\u5173\u9632\u706b\u5899"},"2.5.8.2\u3001\u914d\u7f6e\u7f51\u5173\u9632\u706b\u5899"),(0,r.kt)("p",null,'\u6253\u5f00\u8f6c\u53d1\u540e\u5c31\u53ef\u4ee5\u5bf9 filter \u8868\u7684 FORWARD \u94fe\u8fdb\u884c\u8bbe\u7f6e\u4e86\uff0c\u53ea\u8981\u662f\u88ab forward \u7684\u6570\u636e\u5305\u90fd\u4f1a\u53d7\u5230\u9632\u706b\u5899\u7684 "\u94a9\u5b50\u4f3a\u5019"\uff0c\u5e76\u8fdb\u884c\u4e00\u756a\u68c0\u67e5\u3002'),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ipv4_forward1",src:a(10421).Z,width:"750",height:"265"})),(0,r.kt)("p",null,"\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6b64\u65f6\u9632\u706b\u5899\u662f\u8d1f\u8d23\u4e24\u4e2a\u7f51\u6bb5\u7684\uff0c\u8f6c\u53d1\u540e\u7684\u6570\u636e\u5305\u72b6\u6001\u5e76\u4e0d\u4f1a\u56e0\u4e3a\u7ecf\u8fc7 FORWARD \u800c\u6539\u53d8\u3002"),(0,r.kt)("p",null,"\u6bd4\u5982 x86 \u4e3b\u673a\u53d1\u9001 NEW \u72b6\u6001\u7684\u6570\u636e\u5305\u5230 aarch64 \u4e3b\u673a\uff0c\u7ecf\u8fc7 arm64v8 \u4e3b\u673a FORWARD \u94fe\u5230\u8fbe aarch64 \u4e3b\u673a\uff0c\u6570\u636e\u5305\u7684\u72b6\u6001\u8fd8\u662f NEW\u3002"),(0,r.kt)("p",null,"\u5b9e\u9a8c\u6b65\u9aa4(\u5ef6\u7eed\u4e0a\u4e00\u4e2a\u5b9e\u9a8c)\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5f53\u524d arm64v8 \u4e3b\u673a\u5df2\u6253\u5f00\u8f6c\u53d1\uff0c192.168.0.124 \u53ef\u4ee5 ping \u901a 172.16.100.12\uff1b\u8bbe\u7f6e arm64v8 \u4e3b\u673a FORWARD \u94fe\u4e3a DROP\uff0c\u770b\u80fd\u5426 ping \u901a\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@x86 ~]# ping 172.16.100.12         # \u5f53\u524d\u53ef\u4ee5 Ping \u901a\nPING 172.16.100.12 (172.16.100.12) 56(84) bytes of data.\n64 bytes from 172.16.100.12: icmp_seq=1 ttl=63 time=1.74 ms\n64 bytes from 172.16.100.12: icmp_seq=2 ttl=63 time=2.22 ms\n64 bytes from 172.16.100.12: icmp_seq=3 ttl=63 time=2.81 ms\n^C\n--- 172.16.100.12 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 1.745/2.259/2.810/0.437 ms\n[root@x86 ~]#\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -P FORWARD DROP   # \u8bbe\u7f6e FORWARD \u9ed8\u8ba4 DROP\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@x86 ~]# ping 172.16.100.12         # \u4e0d\u901a\nPING 172.16.100.12 (172.16.100.12) 56(84) bytes of data.\n^C\n--- 172.16.100.12 ping statistics ---\n7 packets transmitted, 0 received, 100% packet loss, time 6004ms\n\n[root@x86 ~]#\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"arm64v8 \u4e3b\u673a FORWARD \u94fe\u8bbe\u7f6e\u5982\u4e0b\u89c4\u5219\uff0c\u518d ping\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -A FORWARD -m state --state NEW,ESTABLISHED -j ACCEPT\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@x86 ~]# ping 172.16.100.12         # \u53ef\u4ee5\u901a\nPING 172.16.100.12 (172.16.100.12) 56(84) bytes of data.\n64 bytes from 172.16.100.12: icmp_seq=1 ttl=63 time=4.14 ms\n64 bytes from 172.16.100.12: icmp_seq=2 ttl=63 time=4.27 ms\n64 bytes from 172.16.100.12: icmp_seq=3 ttl=63 time=7.98 ms\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u8f6c\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u6570\u636e\u5305\u7684\u72b6\u6001\u662f\u4e0d\u4f1a\u53d8\u7684\uff0c\u6240\u4ee5\u5728 FORWARD \u94fe\u4e2d\u5b9a\u4e49\u89c4\u5219\u7c7b\u4f3c\u5176\u5b83\u94fe\uff0c\u53ea\u662f\u6570\u636e\u5305\u7684\u6765\u56de\u90fd\u662f\u901a\u8fc7 FORWARD \u94fe\u3002")))),(0,r.kt)("h4",{id:"2583snat"},"2.5.8.3\u3001SNAT"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"SNAT",src:a(97263).Z,width:"901",height:"466"})),(0,r.kt)("p",null,"\u8be5\u5b9e\u9a8c\u73af\u5883\u662f\u6211\u5f53\u524d\u7684\u751f\u4ea7\u73af\u5883\uff1aaarch64 \u4e3b\u673a\u548c arm64v8 \u4e3b\u673a\u90fd\u662f\u529e\u516c\u53f0\u5f0f\u673a\uff0c\u7f51\u7edc\u62d3\u6251\u548c\u5173\u952e\u4fe1\u606f\u5982\u56fe\u6240\u793a\u3002\u7531\u4e8e\u79fb\u52a8\u8fd0\u8425\u5546\u4e0d\u518d\u4e3a\u7528\u6237\u63d0\u4f9b\u52a8\u6001\u516c\u7f51 IP \u5730\u5740\uff0c\u6240\u4ee5\u8def\u7531\u5668 WAN \u53e3\u4e5f\u662f\u79c1\u6709\u5730\u5740\uff1b\u6211\u7684\u529e\u516c Router \u548c\u8fd0\u8425\u5546\u7684 Router \u90fd\u9ed8\u8ba4\u8bbe\u7f6e SNAT\uff0c\u56e0\u6b64\uff0c\u5f53\u524d\u53ef\u4ee5\u8fde\u5165\u4e92\u8054\u7f51\u7684\u8282\u70b9\u622a\u6b62\u5230 arm64v8 \u8fd9\u53f0\u4e3b\u673a\uff0caarch64 \u4e3b\u673a\u4e0d\u80fd\u4e0a\u7f51\u3002"),(0,r.kt)("p",null,"\u73b0\u5728\u4f7f\u7528 SNAT \u6280\u672f\u4f7f aarch64 \u4e3b\u673a\u4e5f\u53ef\u4ee5\u4e0a\u7f51\uff0c\u5f88\u660e\u663e\u9700\u8981\u5728 arm64v8 \u8fd9\u53f0\u4e3b\u673a\u4e0a\u9762\u914d\u7f6e\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@aarch64 ~]# ping baidu.com        # \u5f53\u524d\u662f ping \u4e0d\u901a baidu.com\n^C\n[root@aarch64 ~]#\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# echo 1 > /proc/sys/net/ipv4/ip_forward\n[root@arm64v8 ~]# cat /proc/sys/net/ipv4/ip_forward\n1\n[root@arm64v8 ~]# \n[root@arm64v8 ~]# iptables -t nat -A POSTROUTING -s 172.16.100.0/24 -j SNAT --to-source 192.168.0.181\n[root@arm64v8 ~]#\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@aarch64 ~]# ping baidu.com        # \u73b0\u5728 ping baidu.com \u53ef\u4ee5\u901a\nPING baidu.com (220.181.38.251) 56(84) bytes of data.\n64 bytes from 220.181.38.251 (220.181.38.251): icmp_seq=1 ttl=46 time=48.9 ms\n64 bytes from 220.181.38.251 (220.181.38.251): icmp_seq=3 ttl=46 time=146 ms\n64 bytes from 220.181.38.251 (220.181.38.251): icmp_seq=5 ttl=46 time=145 ms\n")),(0,r.kt)("p",null,"\u53e6\u5916\uff0c\u8bbe\u7f6e SNAT \u7684\u5199\u6cd5\u6709\u591a\u79cd\u65b9\u5f0f\uff0c\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -t NAT -A POSTROUTING -s 172.16.100.0/24 -o wlp6s0u1 -j SNAT --to-source 192.168.0.181\niptables -t NAT -A POSTROUTING -s 172.16.100.0/24 -o wlp6s0u1 -j SNAT --to-source 192.168.0.100-192.168.0.200\niptables -t NAT -A POSTROUTING -s 172.16.100.0/24 -o wlp6s0u1 -j MASQUERADE\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e00\u6761\u8bed\u53e5\u8868\u793a\u5c06\u5185\u7f511\u5411\u5916\u53d1\u51fa\u7684\u6570\u636e\u5305\u8fdb\u884c\u5904\u7406\uff0c\u5c06\u6e90\u5730\u5740\u8f6c\u6362\u4e3a 192.168.0.181\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e8c\u6761\u8bed\u53e5\u8868\u793a\u5c06\u6e90\u5730\u5740\u8f6c\u6362\u6210 192.168.0.{100-200} \u4e4b\u95f4\u7684\u67d0\u4e2a\u5730\u5740\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e09\u6761\u8bed\u53e5\u8868\u793a\u52a8\u6001\u83b7\u53d6\u6d41\u51fa\u63a5\u53e3 wlp6s0u1 \u7684\u5730\u5740\uff0c\u5e76\u5c06\u6e90\u5730\u5740\u8f6c\u6362\u4e3a\u6b64\u5730\u5740\u3002\u8fd9\u79f0\u4e3a\u5730\u5740\u4f2a\u88c5(ip masquerade)\uff0c\u5730\u5740\u4f2a\u88c5\u529f\u80fd\u5f88\u5b9e\u7528\uff0c\u4f46\u662f\u76f8\u6bd4\u524d\u4e24\u79cd\uff0c\u6027\u80fd\u8981\u7a0d\u5dee\u4e00\u4e9b\uff0c\u56e0\u4e3a\u5904\u7406\u6bcf\u4e2a\u6570\u636e\u5305\u65f6\u90fd\u8981\u83b7\u53d6 wlp6s0u1 \u7684\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u8bf4\u591a\u4e86\u4e00\u4e2a\u67e5\u627e\u52a8\u4f5c\u3002")),(0,r.kt)("h4",{id:"2584dnat"},"2.5.8.4\u3001DNAT"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ipv4_forward1",src:a(10421).Z,width:"750",height:"265"})),(0,r.kt)("p",null,"\u8be5\u5b9e\u9a8c\u628a x86 \u4e3b\u673a\u5f53\u4f5c\u516c\u7f51\u4e3b\u673a\uff0carm64v8 \u4e3b\u673a\u5f53\u4f5c\u9632\u706b\u5899\uff0caarch64 \u4e3b\u673a\u5f53\u4f5c\u5185\u7f51\u79c1\u6709\u670d\u52a1\u5668\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528 DNAT \u6280\u672f\u5b9e\u73b0\u6620\u5c04 ",(0,r.kt)("inlineCode",{parentName:"p"},"192.168.0.181:7422 --\x3e 172.16.100.12:22"),"\uff0c\u4ece x86 \u4e3b\u673a ssh \u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"192.168.0.181:7422")," \u5982\u679c\u6700\u7ec8\u662f ssh \u5230 aarch64 \u4e3b\u673a\uff0c\u5219\u5b9e\u9a8c\u6210\u529f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -t nat -A PREROUTING -d 192.168.0.181/32 -p tcp --dport 7422 -j DNAT --to-destination 172.16.100.12:22\n[root@arm64v8 ~]#\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@x86 ~]# ssh -p 7422 192.168.0.181\nroot@192.168.0.181's password: \nLast login: Thu Oct  7 04:25:39 2021 from 192.168.0.124\n[root@aarch64 ~]#                           # \u5f88\u660e\u663e\uff0c\u5b9e\u9a8c\u6210\u529f\uff1b\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u63d0\u793a"),"\uff1a\u5728\u751f\u4ea7\u5e94\u7528\u73af\u5883\u4e2d\uff0c\u4e00\u822c\u662f\u4f7f\u7528\u516c\u7f51 ",(0,r.kt)("inlineCode",{parentName:"p"},"IP:PORT")," \u6620\u5c04\u5230\u79c1\u7f51 ",(0,r.kt)("inlineCode",{parentName:"p"},"IP:PORT")," \u624d\u5177\u6709\u5b9e\u9645\u751f\u4ea7\u610f\u4e49\u3002"),(0,r.kt)("h3",{id:"259mangle-\u8868"},"2.5.9\u3001mangle \u8868"),(0,r.kt)("p",null,"mangle \u8868\u7684\u4e3b\u8981\u529f\u80fd\u662f\u6839\u636e\u89c4\u5219\u4fee\u6539\u6570\u636e\u5305\u7684\u4e00\u4e9b\u6807\u5fd7\u4f4d\uff0c\u4ee5\u4fbf\u5176\u4ed6\u89c4\u5219\u6216\u7a0b\u5e8f\u53ef\u4ee5\u5229\u7528\u8fd9\u79cd\u6807\u5fd7\u5bf9\u6570\u636e\u5305\u8fdb\u884c\u8fc7\u6ee4\u6216\u7b56\u7565\u8def\u7531\u3002"),(0,r.kt)("p",null,"\u4e00\u822c\u6765\u8bf4\uff0cmangle \u8868\u7684\u4f7f\u7528\u6982\u7387\u8fd8\u662f\u6bd4\u8f83\u5c0f\u7684\uff0c\u5728\u5927\u578b\u6846\u67b6\u8bbe\u8ba1\u5f53\u4e2d\u624d\u6709\u53ef\u80fd\u4f7f\u7528\u5230 mangle \u8868\uff0c\u7528\u6765\u5236\u5b9a\u4e00\u4e9b\u7b56\u7565\u8def\u7531\uff0c\u65e0\u8bba\u662f\u4ee3\u7801\u5b9e\u73b0\u8fd8\u662f\u624b\u52a8\u5b9e\u73b0\uff0c\u5927\u81f4\u601d\u8def\u5982\u4e0b\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u521b\u5efa\u8def\u7531\u8868")),(0,r.kt)("p",{parentName:"li"},"\u7f16\u8f91 /etc/iproute2/rt","_","tables\uff0c\u6ce8\u610f\u4e0d\u8981\u52a8\u91cc\u9762\u9ed8\u8ba4\u7684\u8def\u7531\u8868\u3002\u6dfb\u52a0\u8def\u7531\u8868\u6761\u76ee\u683c\u5f0f\u5982\u4e0b\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[ID of your Table] [Name of your table]\n")),(0,r.kt)("p",{parentName:"li"},"\u9ed8\u8ba4\u7684\u8def\u7531\u8868\u5982\u4e0b\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'[root@arm64v8 ~]# grep -v "^#" /etc/iproute2/rt_tables\n255  local\n254  main\n253  default\n0    unspec\n[root@arm64v8 ~]#\n')),(0,r.kt)("p",{parentName:"li"},"\u4f7f\u7528 ip route \u547d\u4ee4\u67e5\u770b\u8def\u7531\u8868\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# ip route show table 254\ndefault via 192.168.0.1 dev wlp6s0u1 proto dhcp metric 600 \n172.16.100.0/24 dev eth0 proto kernel scope link src 172.16.100.11 metric 100 \n192.168.0.0/24 dev wlp6s0u1 proto kernel scope link src 192.168.0.181 metric 600 \n[root@arm64v8 ~]# \n[root@arm64v8 ~]# ip route show table main\ndefault via 192.168.0.1 dev wlp6s0u1 proto dhcp metric 600 \n172.16.100.0/24 dev eth0 proto kernel scope link src 172.16.100.11 metric 100 \n192.168.0.0/24 dev wlp6s0u1 proto kernel scope link src 192.168.0.181 metric 600 \n[root@arm64v8 ~]# \n[root@arm64v8 ~]# ip route show\ndefault via 192.168.0.1 dev wlp6s0u1 proto dhcp metric 600 \n172.16.100.0/24 dev eth0 proto kernel scope link src 172.16.100.11 metric 100 \n192.168.0.0/24 dev wlp6s0u1 proto kernel scope link src 192.168.0.181 metric 600 \n[root@arm64v8 ~]#\n")),(0,r.kt)("p",{parentName:"li"},"\u4e3a\u8def\u7531\u8868\u6307\u5b9a\u9ed8\u8ba4\u7684\u8def\u7531\u8bbe\u5907\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'ip route add default dev "${TUNDEV}" src "${INTERNAL_IP4_ADDRESS}" table "${TABLENAME}"\n')),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5728\u8def\u7531\u8868100\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u9ed8\u8ba4\u8def\u7531(\u5bf9\u6240\u6709\u5730\u5740), \u4f7f\u7528\u672c\u5730\u7f51\u5173192.168.1.1, \u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u4eceeth0\u5230\u8fbe\u7684\u5730\u5740\nip route add default via 192.168.1.1 dev eth0 table 100\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5bf910.1.1.0/30\u8fd9\u4e2a\u76ee\u7684\u5730\u5740\u8303\u56f4\u6dfb\u52a0\u8def\u7531\u89c4\u5219, \u5e76\u6dfb\u52a0MPLS\u6807\u7b7e\nip route add 10.1.1.0/30 encap mpls 200/300 via 10.1.1.1 dev eth0\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u6570\u636e\u5305\u8d70\u54ea\u4e2a\u8def\u7531\u8868")),(0,r.kt)("p",{parentName:"li"},"\u9ed8\u8ba4\u6bcf\u4e2a\u6570\u636e\u62a5\u6587\u8d70\u7684\u8def\u7531\u8868\u90fd\u662f main\uff0c\u4f60\u53ef\u4ee5\u7ed9\u6ee1\u8db3\u4e00\u5b9a\u89c4\u5219\u7684\u6570\u636e\u62a5\u6587\u6307\u5b9a\u4e0d\u540c\u7684\u8def\u7531\u8868, \u800c\u672a\u6ee1\u8db3\u7684\u8fd8\u7ee7\u7eed\u4f7f\u7528\u9ed8\u8ba4\u7684\u8def\u7531\u8868\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u8def\u7531\u89c4\u5219")),(0,r.kt)("p",{parentName:"li"},"\u901a\u8fc7 man ip rule \u53ef\u4ee5\u83b7\u53d6\u53c2\u6570\u5217\u8868\uff0c \u5982\u679c\u8fd8\u4e0d\u591f\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 fwmark \u7ed9\u6570\u636e\u62a5\u6587\u6253 fwmark \u6807\u7b7e\uff0c\u53ef\u4ee5\u901a\u8fc7 iptables \u6765\u5904\u7406\uff0c\u7136\u540e\u901a\u8fc7 ip rule \u6765\u5904\u7406\u3002\u4f8b\u5982\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u6765\u6e90\u4e8e 167.99.208.0/24 \u7684\u7528\u6307\u5b9atable\nip rule add from 167.99.208.0/24 table [table-name]\n\n# \u6240\u6709\u6765\u6e90\u90fd\u7528 table ztable1\nip rule add from all table ztable1\n\n# \u6240\u6709\u6765\u6e90\u4e2d\u5e26\u6807\u7b7e2\u7684\u90fd\u7528table 20\nip rule add from all fwmark 2 table 20 \n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"iptables \u6253\u6807\u7b7e")),(0,r.kt)("p",{parentName:"li"},"\u4f7f\u7528\u7684\u683c\u5f0f\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"-j MARK --set-mark <Your marknumber in decimal form>"),"\u3002MARK \u8fd9\u4e2a target \u53ea\u5728 mangle \u4e2d\u6709\u6548\u3002"),(0,r.kt)("p",{parentName:"li"},"\u5bf9\u4e8e\u6d41\u5165\u7684\u6570\u636e\u62a5\u6587\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"-t mangle -A PREROUTING"),"\uff0c\u5bf9\u4e8e\u6d41\u51fa\u7684\u6570\u636e\u62a5\u6587\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"-t mangle -A OUTPUT"),"\u3002"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"\u6ce8\u610f\uff1a\u5f53\u6570\u636e\u62a5\u6587\u88ab\u8fdb\u7a0b(\u4f8b\u5982 apache)\u5904\u7406\u8fc7\u4e4b\u540e\uff0c\u6807\u7b7e\u5c31\u4e22\u5931\u4e86\u3002\u6240\u4ee5\u5982\u679c\u6253\u8fc7\u6807\u7b7e\u7684\u62a5\u6587\u5728\u8fd4\u56de\u65f6\u4e0d\u6b63\u786e\uff0c\u53ea\u7ed9\u6d41\u5165\u7684\u62a5\u6587\u6253\u6807\u7b7e\u662f\u4e0d\u591f\u7684\uff0c\u4f60\u5fc5\u987b\u7ed9\u4ea7\u751f\u7684\u6d41\u51fa\u62a5\u6587\u4e5f\u6253\u4e0a\u6807\u7b7e\u3002")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6848\u4f8b\u4e00\uff1a")),(0,r.kt)("p",null,"\u5185\u7f51\u7684\u5ba2\u6237\u673a\u901a\u8fc7 Linux \u4e3b\u673a\u8fde\u5165 Internet\uff0c\u800c Linux \u4e3b\u673a\u6709\u4e24\u4e2a\u7f51\u53e3\u4e0e Internet \u8fde\u63a5\uff0c\u5206\u522b\u6709\u4e24\u6761\u7ebf\u8def\uff0c\u5b83\u4eec\u7684\u7f51\u5173\u5206\u522b\u4e3a 10.10.1.1 \u548c 10.10.2.1\u3002\u73b0\u8981\u6c42\u5bf9\u5185\u7f51\u8fdb\u884c\u7b56\u7565\u8def\u7531\uff0c\u6240\u6709\u901a\u8fc7 TCP \u534f\u8bae\u8bbf\u95ee 80 \u7aef\u53e3\u7684\u6570\u636e\u5305\u90fd\u4ece 10.10.1.1 \u7ebf\u8def\u51fa\u53bb\uff0c\u800c\u6240\u6709\u8bbf\u95ee UDP \u534f\u8bae 53 \u53f7\u7aef\u53e3\u7684\u6570\u636e\u5305\u90fd\u4ece 10.10.2.1 \u7ebf\u8def\u51fa\u53bb\u3002"),(0,r.kt)("p",null,"\u8fd9\u662f\u4e00\u4e2a\u7b56\u7565\u8def\u7531\u7684\u95ee\u9898\uff0c\u4e3a\u4e86\u8fbe\u5230\u76ee\u7684\uff0c\u5728\u5bf9\u6570\u636e\u5305\u8fdb\u884c\u8def\u7531\u524d\uff0c\u8981\u5148\u6839\u636e\u6570\u636e\u5305\u7684\u534f\u8bae\u548c\u76ee\u7684\u7aef\u53e3\u7ed9\u6570\u636e\u5305\u505a\u4e0a\u4e00\u79cd\u6807\u5fd7\uff0c\u7136\u540e\u518d\u6307\u5b9a\u76f8\u5e94\u89c4\u5219\uff0c\u6839\u636e\u6570\u636e\u5305\u7684\u6807\u5fd7\u8fdb\u884c\u7b56\u7565\u8def\u7531\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u7ed9\u7279\u5b9a\u7684\u6570\u636e\u5305\u505a\u4e0a\u6807\u5fd7\uff0c\u9700\u8981\u4f7f\u7528 mangle \u8868\uff0cmangle \u8868\u5171\u6709 5 \u6761\u94fe\uff0c\u7531\u4e8e\u9700\u8981\u5728\u8def\u7531\u9009\u62e9\u524d\u505a\u6807\u5fd7\uff0c\u56e0\u6b64\u5e94\u8be5\u4f7f\u7528 PREROUTING \u94fe\uff0c\u4e0b\u9762\u662f\u5177\u4f53\u7684\u547d\u4ee4\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -t mangle -A PREROUTING -i eth0 -p tcp --dport 80 -j MARK --set-mark 1  \niptables -t mangle -A PREROUTING -i eth0 -p udp --dprot 53 -j MARK --set-mark 2 \n")),(0,r.kt)("p",null,"\u4ee5\u4e0a\u547d\u4ee4\u5728 mangle \u8868\u7684 PREROUTING \u94fe\u4e2d\u6dfb\u52a0\u89c4\u5219\uff0c\u4e3a\u6765\u81ea eth0 \u63a5\u53e3\u7684\u6570\u636e\u5305\u505a\u6807\u5fd7\uff0c\u5176\u5339\u914d\u89c4\u5219\u5206\u522b\u662f TCP \u534f\u8bae\u3001\u76ee\u7684\u7aef\u53e3\u53f7\u662f 80 \u548c UDP \u534f\u8bae\u3001\u76ee\u7684\u7aef\u53e3\u53f7\u662f 53\uff0c\u6807\u5fd7\u7684\u503c\u5206\u522b\u662f 1 \u548c 2\u3002\u6570\u636e\u5305\u7ecf\u8fc7 PREROUTING \u94fe\u540e\uff0c\u5c06\u8981\u8fdb\u5165\u8def\u7531\u9009\u62e9\u6a21\u5757\uff0c\u4e3a\u4e86\u5bf9\u5176\u8fdb\u884c\u7b56\u7565\u8def\u7531\uff0c\u6267\u884c\u4ee5\u4e0b\u4e24\u6761\u547d\u4ee4\uff0c\u6dfb\u52a0\u76f8\u5e94\u7684\u89c4\u5219\u3002"),(0,r.kt)("p",null,"\u7f16\u8f91 ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/iproute2/rt_tables"),"\uff0c\u6dfb\u52a0\u5bf9\u5e94\u7684\u8def\u7531\u8868\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'echo -e "${TABLEID}\\t${TABLENAME}" >> /etc/iproute2/rt_tables\n')),(0,r.kt)("p",null,"\u6dfb\u52a0\u8def\u7531\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ip rule add from all fwmark 1 table 10  \nip rule add from all fwmark 2 table 20 \n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e24\u6761\u547d\u4ee4\u8868\u793a\u6240\u6709\u6807\u5fd7\u662f 1 \u7684\u6570\u636e\u5305\u4f7f\u7528\u8def\u7531\u8868 10 \u8fdb\u884c\u8def\u7531\uff0c\u800c\u6240\u6709\u6807\u5fd7\u662f 2 \u7684\u6570\u636e\u5305\u4f7f\u7528\u8def\u7531\u8868 20 \u8fdb\u884c\u8def\u7531\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u8def\u7531\u8868 10 \u548c 20 \u5206\u522b\u4f7f\u7528\u4e86 10.10.1.1 \u548c 10.10.2.1 \u4f5c\u4e3a\u9ed8\u8ba4\u7f51\u5173\u3002"),(0,r.kt)("li",{parentName:"ul"},"fwmark \u5b9e\u9645\u4e0a\u5c31\u662f netfilter mark\uff0c\u4e00\u79cd\u6253\u6807\u7b7e\u7684\u65b9\u5f0f\u6216\u8005\u5b9e\u73b0\uff0c\u6ca1\u6709\u7279\u6b8a\u7684\u542b\u4e49\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ip route add default via 10.10.1.1 dev eth1 table 10  \nip route add default via 10.10.2.1 dev eth2 table 20\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e24\u6761\u547d\u4ee4\u5728\u8def\u7531\u8868 10 \u548c 20 \u4e0a\u5206\u522b\u6307\u5b9a\u4e86 10.10.1.1 \u548c 10.10.2.1 \u4f5c\u4e3a\u9ed8\u8ba4\u7f51\u5173\uff0c\u4e8e\u662f\u4f7f\u7528\u8def\u7531\u8868 10 \u7684\u6570\u636e\u5305\u5c06\u901a\u8fc7 10.10.1.1 \u7ebf\u8def\u51fa\u53bb\uff0c\u800c\u4f7f\u7528\u8def\u7531\u8868 20 \u7684\u6570\u636e\u5305\u5c06\u901a\u8fc7 10.10.2.1 \u7ebf\u8def\u51fa\u53bb\u3002")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6848\u4f8b\u4e8c\uff1a")),(0,r.kt)("p",null,"\u7f51\u5173\u670d\u52a1\u5668\u6709\u4e09\u5757\u7f51\u5361\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"eth0 \u7f51\u901a ip\uff1a10.0.0.1"),(0,r.kt)("li",{parentName:"ul"},"eth1 \u7535\u4fe1 ip\uff1a20.0.0.1"),(0,r.kt)("li",{parentName:"ul"},"eth2 \u7f51\u5173 ip\uff1a192.168.10.1")),(0,r.kt)("p",null,"\u5185\u7f51\u8981\u6c42 192.168.10.1---100 \u4ee5\u5185\u7684 ip \u4f7f\u7528 10.0.0.1 \u7f51\u5173\u4e0a\u7f51\uff0c\u5176\u4ed6 IP \u4f7f\u7528 20.0.0.1 \u4e0a\u7f51\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# \u8bbe\u7f6e\u9ed8\u8ba4\u8def\u7531\nip route add default gw 20.0.0.1\n\n# eth0 \u662f 10.0.0.1 \u6240\u5728\u7684\u7f51\u5361, 10\u662f\u8def\u7531\u8868\u7684\u7f16\u53f7\nip route add table 10 via 10.0.0.1 dev eth0\n\n# fwmark 10 \u662f\u6807\u8bb0, table 10 \u662f\u8def\u7531\u886810, \u6807\u8bb0\u4e8610\u7684\u6570\u636e\u4f7f\u7528table 10\u8def\u7531\u8868\nip rule add fwmark 10 table 10\n\n# \u4f7f\u7528iptables\u7ed9\u76f8\u5e94\u7684\u6570\u636e\u6253\u4e0a\u6807\u8bb0, \u5bf9\u4e8e\u8fd9\u79cdIP\u8303\u56f4\u9700\u8981\u7528\u5230iprange\u6a21\u5757\niptables -A PREROUTING -t mangle -i eth2 -m iprange --src-range 192.168.10.1-192.168.10.100 -j MARK --set-mark 10\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6848\u4f8b\u4e09\uff1a")),(0,r.kt)("p",null,"\u7f51\u5173\u670d\u52a1\u5668\u6709\u4e09\u5757\u7f51\u5361\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"eth0 \u7f51\u901a ip\uff1a10.0.0.1"),(0,r.kt)("li",{parentName:"ul"},"eth1 \u7535\u4fe1 ip\uff1a20.0.0.1"),(0,r.kt)("li",{parentName:"ul"},"eth2 \u7f51\u5173 ip\uff1a192.168.10.1")),(0,r.kt)("p",null,"\u5185\u7f51\u8981\u6c42\u5458\u5de5\u8bbf\u95ee\u5916\u9762\u7684\u7f51\u7ad9\u4f7f\u7528 10.0.0.1 \u7f51\u5173\u4e0a\u7f51\uff0c\u5176\u4ed6 IP \u4f7f\u7528 20.0.0.1 \u4e0a\u7f51\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -t mangle -A PREROUTING -i eth2 -p tcp --dport 80 -j MARK --set-mark 20\nip route add default gw 20.0.0.1\nip route add table 20 via 10.0.0.1 dev eth0\nip rule add fwmark 20 table 20 \n")),(0,r.kt)("h3",{id:"2510raw-\u8868"},"2.5.10\u3001raw \u8868"),(0,r.kt)("p",null,"RAW \u8868\u53ea\u4f7f\u7528\u5728 PREROUTING \u94fe\u548c OUTPUT \u94fe\u4e0a\uff0c\u56e0\u4e3a\u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u4ece\u800c\u53ef\u4ee5\u5bf9\u6536\u5230\u7684\u6570\u636e\u5305\u5728\u8fde\u63a5\u8ddf\u8e2a\u524d\u8fdb\u884c\u5904\u7406\u3002\u4e00\u4f46\u7528\u6237\u4f7f\u7528\u4e86 RAW \u8868\u5904\u7406\u5b8c\u540e\uff0c\u5c06\u8df3\u8fc7 NAT \u8868\u548c nf","_","conntrack \u5904\u7406\uff0c\u5373\u4e0d\u518d\u505a\u5730\u5740\u8f6c\u6362\u548c\u6570\u636e\u5305\u7684\u94fe\u63a5\u8ddf\u8e2a\u5904\u7406\u4e86\u3002"),(0,r.kt)("p",null,"RAW \u8868\u53ef\u4ee5\u5e94\u7528\u5728\u90a3\u4e9b\u4e0d\u9700\u8981\u505a nat \u7684\u60c5\u51b5\u4e0b\uff0c\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\u5982\u5927\u91cf\u8bbf\u95ee\u7684 web \u670d\u52a1\u5668\uff0c\u53ef\u4ee5\u8ba9 80 \u7aef\u53e3\u4e0d\u518d\u8ba9 iptables \u505a\u6570\u636e\u5305\u7684\u94fe\u63a5\u8ddf\u8e2a\u5904\u7406\uff0c\u4ee5\u63d0\u9ad8\u7528\u6237\u7684\u8bbf\u95ee\u901f\u5ea6\u3002"),(0,r.kt)("p",null,"\u589e\u52a0 raw \u8868\uff0c\u5728\u5176\u4ed6\u8868\u5904\u7406\u4e4b\u524d\uff0c-j NOTRACK \u8df3\u8fc7\u5176\u5b83\u8868\u5904\u7406\uff0c\u5bf9\u5e94\u7684 state \u4e3a UNTRACKED\u3002"),(0,r.kt)("p",null,'\u4f8b\u5982\uff1a\u53ef\u4ee5\u4f7f\u7528 "NOTRACK" target \u5141\u8bb8\u89c4\u5219\u6307\u5b9a 80 \u7aef\u53e3\u7684\u5305\u4e0d\u8fdb\u5165\u94fe\u63a5\u8ddf\u8e2a\u6216 NAT \u5b50\u7cfb\u7edf\u3002'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# iptables -t raw -A PREROUTING -d 192.168.0.181/32 -p tcp --dport 80 -j NOTRACK\n[root@arm64v8 ~]# iptables -t raw -A PREROUTING -s 192.168.0.181/32 -p tcp --sport 80 -j NOTRACK\n[root@arm64v8 ~]# iptables -A FORWARD -m state --state UNTRACKED -j ACCEPT\n[root@arm64v8 ~]#\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5728\u542f\u7528\u4e86 iptables web \u670d\u52a1\u5668\u4e0a\uff0c\u6d41\u91cf\u9ad8\u7684\u65f6\u5019\u7ecf\u5e38\u4f1a\u51fa\u73b0\u9519\u8bef\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"ip_conntrack: table full, dropping packet"),"\u3002"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u7531\u4e8e web \u670d\u52a1\u5668\u6536\u5230\u4e86\u5927\u91cf\u7684\u8fde\u63a5\uff0c\u5728\u542f\u7528\u4e86 iptables \u7684\u60c5\u51b5\u4e0b\uff0ciptables \u4f1a\u628a\u6240\u6709\u7684\u8fde\u63a5\u90fd\u505a\u94fe\u63a5\u8ddf\u8e2a\u5904\u7406\uff0c\u8fd9\u6837 iptables \u5c31\u4f1a\u6709\u4e00\u4e2a\u94fe\u63a5\u8ddf\u8e2a\u8868\uff0c\u5f53\u8fd9\u4e2a\u8868\u6ee1\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0a\u9762\u7684\u9519\u8bef\u3002"),(0,r.kt)("li",{parentName:"ul"},"iptables \u7684\u94fe\u63a5\u8ddf\u8e2a\u8868\u6700\u5927\u5bb9\u91cf\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"/proc/sys/net/ipv4/ip_conntrack_max"),"\uff0c\u94fe\u63a5\u78b0\u5230\u5404\u79cd\u72b6\u6001\u7684\u8d85\u65f6\u540e\u5c31\u4f1a\u4ece\u8868\u4e2d\u5220\u9664\u3002"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u89e3\u51b3\u8be5\u95ee\u9898\u7684\u601d\u8def\u4e00\u822c\u6709\u4e09\u4e2a\uff1a"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u52a0\u5927 ip","_","conntrack","_","max \u503c")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"vi /etc/sysctl.conf\n\nnet.ipv4.ip_conntrack_max = 393216\nnet.ipv4.netfilter.ip_conntrack_max = 393216\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u964d\u4f4e ip","_","conntrack timeout \u65f6\u95f4")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"vi /etc/sysctl.conf\n\nnet.ipv4.netfilter.ip_conntrack_tcp_timeout_established = 300\nnet.ipv4.netfilter.ip_conntrack_tcp_timeout_time_wait = 120\nnet.ipv4.netfilter.ip_conntrack_tcp_timeout_close_wait = 60\nnet.ipv4.netfilter.ip_conntrack_tcp_timeout_fin_wait = 120\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 raw \u8868\u5236\u5b9a\u4e0d\u8ddf\u8e2a\u94fe\u63a5")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -t raw -A PREROUTING -d 192.168.0.181/32 -p tcp --dport 80 -j NOTRACK\niptables -t raw -A PREROUTING -s 192.168.0.181/32 -p tcp --sport 80 -j NOTRACK\niptables -A FORWARD -m state --state UNTRACKED -j ACCEPT\n")))),(0,r.kt)("h3",{id:"2511\u9632\u706b\u5899\u6700\u4f73\u5b9e\u8df5"},"2.5.11\u3001\u9632\u706b\u5899\u6700\u4f73\u5b9e\u8df5"),(0,r.kt)("p",null,"\u8fd9\u91cc\u8bf4\u7684\u6700\u4f73\u5b9e\u8df5\u53ea\u662f\u9488\u5bf9\u67d0\u4e2a\u670d\u52a1\u5668\uff0c\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u65f6\uff0c\u5728\u6ca1\u6709\u4e13\u4e1a\u786c\u4ef6\u9632\u706b\u5899\u7684\u524d\u63d0\u4e0b\uff0c\u901a\u8fc7 iptables \u5b9e\u73b0\u6bd4\u8f83\u4e25\u683c\u7684\u6d41\u91cf\u63a7\u5236\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5b89\u88c5 iptables-services \u8f6f\u4ef6\u5305\uff0c\u542f\u52a8 iptables \u670d\u52a1\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install iptables-services -y\nsystemctl start iptables.service \nsystemctl enable iptables.service\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u907f\u514d flush \u540e\u9ed8\u8ba4\u89c4\u5219\u90fd\u662f DROP \u65e0\u6cd5\u8fdc\u7a0b"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -P INPUT ACCEPT\niptables -P OUTPUT ACCEPT\niptables -P FORWARD ACCEPT\niptables -F\niptables -t nat -F\niptables -X\niptables -t nat -X\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u9996\u5148\u53ef\u4ee5\u8ba9 ssh \u80fd\u8fde\u63a5"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\niptables -A OUTPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u4fdd\u8bc1 apt-get \u6216 yum \u53ef\u4ee5\u4f7f\u7528"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\niptables -A OUTPUT -p tcp -m multiport --destination-ports 80,53,443 -m state --state NEW -j ACCEPT\niptables -A OUTPUT -p udp --dport 53 -m state --state NEW -j ACCEPT\niptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u6b63\u5e38\u60c5\u51b5\u8fd9\u4e2a\u603b\u662f\u8981\u914d\u7f6e\u7684\uff0c\u81ea\u5df1\u8981\u80fd\u8ddf\u81ea\u5df1\u901a\u4fe1"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -i lo -j ACCEPT\niptables -A OUTPUT -o lo -j ACCEPT\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u4ee5\u4e0a\u914d\u7f6e\u90fd\u6b63\u786e\u5219\u53ef\u4ee5\u8bbe\u7f6e\u9ed8\u8ba4 DROP\uff0c\u8fd9\u4e2a\u6bd4\u8f83\u5371\u9669\uff0c\u6ca1\u6709\u628a\u63e1\u65f6\uff0c\u5efa\u8bae\u5728\u5199 iptables \u524d\u5199\u4e2a at \u8ba1\u5212\u6216\u8005 crontab \u6765\u6e05\u7a7a\u89c4\u5219"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -P INPUT DROP\niptables -P OUTPUT DROP\niptables -P FORWARD DROP\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u4fdd\u5b58\u89c4\u5219"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"centos7:\niptables-save > /etc/sysconfig/iptables         # \u542f\u52a8 iptables \u670d\u52a1\u540e\u81ea\u52a8\u751f\u6548\n\nubuntu 16.04:\niptables-save > /etc/iptables-rules             # \u4e0d\u4f1a\u81ea\u52a8\u751f\u6548\npost-up iptables-restore < /etc/iptables-rules  # \u5728 /etc/network/interface \u540e\u9762\u52a0\u4e0a\u4e00\u884c\n")))),(0,r.kt)("h2",{id:"26tcp_wrapper-\u8fc7\u6ee4"},"2.6\u3001tcp","_","wrapper \u8fc7\u6ee4"),(0,r.kt)("p",null,"wrap \u5de5\u4f5c\u5728\u5185\u6838\u7a7a\u95f4\u548c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u95f4\u7684\u5e93\u5c42\u6b21\u4e2d\u3002\u5728\u5185\u6838\u63a5\u53d7\u5230\u6570\u636e\u5305\u51c6\u5907\u4f20\u9001\u5230\u7528\u6237\u7a7a\u95f4\u65f6\u90fd\u4f1a\u7ecf\u8fc7\u5e93\u5c42\u6b21\uff0c\u5bf9\u4e8e\u90e8\u5206\uff08\u53ea\u662f\u90e8\u5206\uff09\u5e94\u7528\u7a0b\u5e8f\u4f1a\u5728\u7ecf\u8fc7\u5e93\u5c42\u6b21\u65f6\u4f1a\u88ab wrap \u5e93\u6587\u4ef6\u963b\u6321\u4e0b\u6765\u68c0\u67e5\u4e00\u756a\uff0c\u5982\u679c\u5141\u8bb8\u901a\u8fc7\u5219\u4ea4\u7ed9\u5e94\u7528\u7a0b\u5e8f\u3002"),(0,r.kt)("h3",{id:"261\u67e5\u770b\u662f\u5426\u652f\u6301-wrapper"},"2.6.1\u3001\u67e5\u770b\u662f\u5426\u652f\u6301 wrapper"),(0,r.kt)("p",null,"wrap \u53ea\u4f1a\u68c0\u67e5 tcp \u6570\u636e\u5305\uff0c\u6240\u4ee5\u79f0\u4e3a tcpwrapper\u3002\u4f46\u8fd8\u4e0d\u662f\u68c0\u67e5\u6240\u6709\u7c7b\u578b\u7684 tcp \u6570\u636e\u5305\uff0c\u4f8b\u5982 httpd \u5c31\u4e0d\u652f\u6301\u3002\u662f\u5426\u652f\u6301\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u4f9d\u8d56\u4e8e libwrap.so \u5e93\u6587\u4ef6\u3002(\u8def\u5f84 /lib64/libwrap.so)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# ldd $(which sshd) | grep wrap\n    libwrap.so.0 => /lib64/libwrap.so.0 (0x0000ffffb7360000)\n[root@arm64v8 ~]#\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# ldd $(which vsftpd) | grep wrap\n    libwrap.so.0 => /lib64/libwrap.so.0 (0x0000ffffa0494000)\n[root@arm64v8 ~]#\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@arm64v8 ~]# ldd $(which httpd) | grep wrap\n[root@arm64v8 ~]#\n")),(0,r.kt)("p",null,"\u8bf4\u660e sshd \u548c vsftpd \u90fd\u652f\u6301 wrap \u673a\u5236\uff0c\u800c apache \u7684 httpd \u4e0d\u652f\u6301\u3002"),(0,r.kt)("p",null,"\u5f53\u7136\u4e0a\u9762 grep \u4e0d\u51fa\u7ed3\u679c\u53ea\u80fd\u8bf4\u660e\u4e0d\u652f\u6301\u8fd9\u6837\u7684\u52a8\u6001\u94fe\u63a5\u7684\u65b9\u5f0f\uff0c\u6709\u4e9b\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u9759\u6001\u7f16\u8bd1\u8fdb\u7a0b\u5e8f\u4e2d\u4e86\uff0c\u5982\u65e7\u7248\u672c\u7684 rpc \u5e94\u7528\u7a0b\u5e8f portmap\u3002"),(0,r.kt)("p",null,"\u662f\u5426\u5c06 wrap \u529f\u80fd\u9759\u6001\u7f16\u8bd1\u5230\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u67e5\u770b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"strings $(which portmap) | grep hosts\n")),(0,r.kt)("p",null,"\u5982\u679c\u7b5b\u9009\u51fa\u7684\u7ed3\u679c\u4e2d\u6709 hosts","_","access \u6216\u8005 /etc/hosts.allow \u548c /etc/hosts.deny \u8fd9\u4e24\u4e2a\u6587\u4ef6\uff0c\u5219\u8bf4\u660e\u662f\u652f\u6301\u7684\u3002\u540e\u4e24\u4e2a\u6587\u4ef6\u6b63\u662f wrap \u8bbf\u95ee\u63a7\u5236\u7684\u6587\u4ef6\u3002"),(0,r.kt)("p",null,"\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u8d85\u7ea7\u5b88\u62a4\u8fdb\u7a0b xinetd \u88ab wrap \u63a7\u5236\u4e86\uff0c\u5219\u5176\u4e0b\u7684\u77ac\u65f6\u5b88\u62a4\u8fdb\u7a0b\u90fd\u53d7 wrap \u63a7\u5236\u3002"),(0,r.kt)("h3",{id:"262\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f"},"2.6.2\u3001\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f"),(0,r.kt)("p",null,"hosts.allow \u548c hosts.deny \u4e24\u4e2a\u6587\u4ef6\u7684\u8bed\u6cd5\u683c\u5f0f\u662f\u4e00\u6837\u7684\uff0c\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"daemon_list:   client_list  [:options]\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"daemon","_","list \u8868\u793a\u65b9\u6cd5"),"\uff1a\u7a0b\u5e8f\u540d\u5fc5\u987b\u662f which \u67e5\u51fa\u6765\u540c\u540d\u7684\u540d\u79f0\uff0c\u4f8b\u5982\u6b64\u5904\u7684 in.telnetd"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sshd:\nsshd,vsftpd,in.telnetd:\nALL\ndaemon@host:\n")),(0,r.kt)("p",null,'\u6700\u540e\u4e00\u9879 daemon@host \u6307\u5b9a\u8fde\u63a5 IP \u5730\u5740\uff0c\u9488\u5bf9\u591a\u4e2a IP \u7684\u60c5\u51b5\u3002\u5982\u672c\u673a\u6709 192.168.100.8 \u548c 172.16.100.1 \u4e24\u4e2a\u5730\u5740\uff0c\u4f46\u662f\u53ea\u60f3\u63a7\u5236\u4ece\u5176\u4e2d\u4e00\u4e2a ip \u8fde\u63a5\u7684 vsftpd \u670d\u52a1\uff0c\u53ef\u4ee5\u5199 "',(0,r.kt)("a",{parentName:"p",href:"mailto:vsftpd@192.168.100.8"},"vsftpd@192.168.100.8"),':"\u3002'),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"client","_","list \u8868\u793a\u65b9\u6cd5"),"\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'\u5355IP\uff1a192.168.100.8\n\u7f51\u6bb5\uff1a\u4e24\u79cd\u5199\u6cd5\uff1a"172.16."\u548c10.0.0.0/255.0.0.0\n\u4e3b\u673a\u540d\u6216\u57df\u5339\u914d\uff1afqdn\u6216".a.com"\n\u5b8f\uff1aALL\u3001KNOWN\u3001UNKNOWN\u3001PARANOID\u3001EXCEPT\n')),(0,r.kt)("p",null,'ALL \u8868\u793a\u6240\u6709\u4e3b\u673a\uff1bLOCAL \u8868\u793a\u548c\u4e3b\u673a\u5728\u540c\u4e00\u7f51\u6bb5\u7684\u4e3b\u673a\uff1b(UN)KNOWN \u8868\u793a DNS \u662f\u5426\u53ef\u4ee5\u89e3\u6790\u6210\u529f\u7684\uff1bPARANOID \u8868\u793a\u6b63\u89e3\u53cd\u89e3\u4e0d\u5339\u914d\u7684\uff1bEXCEPT \u8868\u793a "\u9664\u4e86"\u3002'),(0,r.kt)("p",null,"\u5b83\u4eec\u7684\u8bed\u6cd5\u53ef\u4ee5 man hosts","_","access\u3002"),(0,r.kt)("p",null,"tcpwrapper \u7684\u68c0\u67e5\u987a\u5e8f\uff1a",(0,r.kt)("strong",{parentName:"p"},"hosts.allow --\x3e")," ",(0,r.kt)("strong",{parentName:"p"},"hosts.deny --\x3e")," ",(0,r.kt)("strong",{parentName:"p"},"\u5141\u8bb8(\u9ed8\u8ba4\u89c4\u5219)")),(0,r.kt)("p",null,"\u4f8b\u5982 sshd \u4ec5\u5141\u8bb8 172.16 \u7f51\u6bb5\u4e3b\u673a\u8bbf\u95ee\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"hosts.allow:\nsshd: 172.16.\nhosts.deny:\nsshd: ALL\n")),(0,r.kt)("p",null,"telnet \u670d\u52a1\u4e0d\u5141\u8bb8 172.16 \u7f51\u6bb5\u8bbf\u95ee\u4f46\u5141\u8bb8 172.16.100.200 \u8bbf\u95ee\u3002\u6709\u51e0\u79cd\u8868\u8fbe\u65b9\u5f0f\uff1a"),(0,r.kt)("p",null,"\u8868\u8fbe\u65b9\u5f0f\u4e00\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"hosts.allow:\nin.telnetd: 172.16.100.200\nhosts.deny:\nin.telnetd: 172.16.\n")),(0,r.kt)("p",null,"\u8868\u8fbe\u65b9\u5f0f\u4e8c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"hosts.deny:\nin.telnetd: 172.16. EXCEPT 172.16.100.200\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'\u6b64\u6cd5\u4e0d\u80fd\u5199\u5165 hosts.allow\uff1a"in.telnetd: 172.16.100.200 EXCEPT 172.16."')),(0,r.kt)("p",null,"\u8868\u8fbe\u65b9\u5f0f\u4e09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"hosts.allow:\n    in.telnetd: ALL EXCEPT 172.16. EXCEPT 172.16.100.200\nhosts.deny:\n    in.telnetd: ALL\n")),(0,r.kt)("p",null,"EXCEPT \u7684\u6700\u5f62\u8c61\u63cf\u8ff0\u662f \u201c\u5728\u5176\u524d\u9762\u7684\u8303\u56f4\u5185\u6316\u4e00\u4e2a\u6d1e\uff0c\u5728\u6d1e\u8303\u56f4\u5185\u7684\u90fd\u4e0d\u5339\u914d\u201d\u3002\u6240\u4ee5 hosts.allow \u4e2d\uff0cALL \u5185\u6709\u4e00\u4e2a 172.16 \u7684\u6d1e\u662f\u4e0d\u88ab allow \u7684\uff0c\u5728 172.16 \u4e2d\u53c8\u6709\u5c0f\u6d1e 172.16.100.200 \u662f\u88ab\u6392\u9664\u5728 172.16 \u6d1e\u5916\u7684\uff0c\u6240\u4ee5 172.16.100.200 \u662f\u88ab allow \u7684\u3002"),(0,r.kt)("p",null,"\u6ce8\u610f\uff1a\u88ab EXCEPT \u5339\u914d\u5230\u7684\u8868\u793a\u4e0d\u7ecf\u8fc7\u6b64\u6761\u89c4\u5219\u7684\u68c0\u67e5\uff0c\u800c\u4e0d\u662f\u53cd\u610f\u3002\u4f8b\u5982\u5728 allows \u4e2d\u6307\u660e\u4e00\u4e2a EXCEPT\uff0c\u5f53\u6709 except \u4e2d\u7684\u4e3b\u673a\u88ab\u5339\u914d\u5230\uff0c\u8868\u793a\u7684\u4e0d\u662f\u8be5\u4e3b\u673a\u88ab\u62d2\u7edd\u3002\u800c\u662f\u8df3\u8fc7 allow \u68c0\u6d4b\u8fdb\u5165 deny \u7684\u68c0\u6d4b\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},":options \u8868\u8fbe\u65b9\u5f0f"),"\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},":ALLOW\n:DENY\n:spawn\n")),(0,r.kt)("p",null,"ALLOW \u548c DENY \u53ef\u4ee5\u5206\u522b\u5199\u5165 deny \u6587\u4ef6\u548c allow \u6587\u4ef6\uff0c\u8868\u793a\u5728 allow \u6587\u4ef6\u4e2d\u62d2\u7edd\u5728 deny \u6587\u4ef6\u4e2d\u63a5\u53d7\u3002\u5982 allow \u6587\u4ef6\u4e2d\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"in.telnetd: 172.16. :DENY\n")),(0,r.kt)("p",null,"spawn \u8868\u793a\u542f\u52a8\u67d0\u7a0b\u5e8f\u7684\u610f\u601d(/etc/inittab \u4e2d\u7684 respawn \u8868\u793a\u91cd\u542f\u6307\u5b9a\u7a0b\u5e8f)\u3002\u4f8b\u5982\u542f\u52a8\u4e00\u4e2a echo \u7a0b\u5e8f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'in.telnetd: 172.16 :spawn echo "we are good $(date) >> /var/log/telnetd.log"\n')))}N.isMDXComponent=!0},97263:function(t,e,a){e.Z=a.p+"assets/images/SNAT-9a5a284adbf148c22ba340bb7c16b3bf.png"},29071:function(t,e,a){e.Z=a.p+"assets/images/conntrack related-21d069ab537ca40c64fc2f77e7d62f19.png"},39711:function(t,e,a){e.Z=a.p+"assets/images/ip package-b27272d7de492ee7c798df6ed1ae5709.png"},21164:function(t,e,a){e.Z=a.p+"assets/images/iptables-e59e35333c97d15fed01fad21dabb58d.png"},82831:function(t,e,a){e.Z=a.p+"assets/images/ipv4_forward-1caba53cf2e9ef632a91e701642f54ca.png"},10421:function(t,e,a){e.Z=a.p+"assets/images/ipv4_forward1-c7198b4263341a75e0c7b40bdc201a35.png"},93033:function(t,e,a){e.Z=a.p+"assets/images/network package flow encapsulated-69156003742a7a5976e036a94c2613a8.png"},53330:function(t,e,a){e.Z=a.p+"assets/images/networking-c82624047f0f52d2b7d6f24540689c3a.png"},78935:function(t,e,a){e.Z=a.p+"assets/images/self defined chains-73e846a7efa95d4be9654ba42b555ce3.png"},75742:function(t,e,a){e.Z=a.p+"assets/images/tcp break-f6fe708dac6c5f2dd506a64a6d33a8c2.png"},58171:function(t,e,a){e.Z=a.p+"assets/images/tcp establish-a97f01afcff42d0f3aa9d26bc9f3de7f.png"},75381:function(t,e){e.Z="data:image/png;base64,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"}}]);