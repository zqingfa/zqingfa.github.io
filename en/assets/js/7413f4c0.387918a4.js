"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[7877],{3905:function(l,e,a){a.d(e,{Zo:function(){return m},kt:function(){return c}});var n=a(67294);function t(l,e,a){return e in l?Object.defineProperty(l,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):l[e]=a,l}function s(l,e){var a=Object.keys(l);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(l);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable}))),a.push.apply(a,n)}return a}function r(l){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?s(Object(a),!0).forEach((function(e){t(l,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(e){Object.defineProperty(l,e,Object.getOwnPropertyDescriptor(a,e))}))}return l}function o(l,e){if(null==l)return{};var a,n,t=function(l,e){if(null==l)return{};var a,n,t={},s=Object.keys(l);for(n=0;n<s.length;n++)a=s[n],e.indexOf(a)>=0||(t[a]=l[a]);return t}(l,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(l);for(n=0;n<s.length;n++)a=s[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(l,a)&&(t[a]=l[a])}return t}var p=n.createContext({}),i=function(l){var e=n.useContext(p),a=e;return l&&(a="function"==typeof l?l(e):r(r({},e),l)),a},m=function(l){var e=i(l.components);return n.createElement(p.Provider,{value:e},l.children)},u={inlineCode:"code",wrapper:function(l){var e=l.children;return n.createElement(n.Fragment,{},e)}},k=n.forwardRef((function(l,e){var a=l.components,t=l.mdxType,s=l.originalType,p=l.parentName,m=o(l,["components","mdxType","originalType","parentName"]),k=i(a),c=t,y=k["".concat(p,".").concat(c)]||k[c]||u[c]||s;return a?n.createElement(y,r(r({ref:e},m),{},{components:a})):n.createElement(y,r({ref:e},m))}));function c(l,e){var a=arguments,t=e&&e.mdxType;if("string"==typeof l||t){var s=a.length,r=new Array(s);r[0]=k;var o={};for(var p in e)hasOwnProperty.call(e,p)&&(o[p]=e[p]);o.originalType=l,o.mdxType="string"==typeof l?l:t,r[1]=o;for(var i=2;i<s;i++)r[i]=a[i];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},22380:function(l,e,a){a.r(e),a.d(e,{assets:function(){return m},contentTitle:function(){return p},default:function(){return c},frontMatter:function(){return o},metadata:function(){return i},toc:function(){return u}});var n=a(83117),t=a(80102),s=(a(67294),a(3905)),r=["components"],o={id:"linux-cicd-5",slug:"/linux-cicd-5",title:"\u7b2c 5 \u7ae0 Linux Ansible \u8fdb\u9636\u77e5\u8bc6",authors:"zhangqf",keywords:["linux","ansible"]},p=void 0,i={unversionedId:"linux/cicd/linux-cicd-5",id:"linux/cicd/linux-cicd-5",title:"\u7b2c 5 \u7ae0 Linux Ansible \u8fdb\u9636\u77e5\u8bc6",description:"\u5728\u524d\u9762\u7efc\u5408\u6848\u4f8b\u7684\u6700\u540e\uff0c\u6211\u4eec\u5c06\u521d\u59cb\u5316\u914d\u7f6e\u670d\u52a1\u5668\u7684\u591a\u4e2a\u4efb\u52a1\u7ec4\u5408\u5230\u4e86\u5355\u4e2a playbook \u4e2d\uff0c\u8fd9\u79cd\u7ec4\u7ec7\u65b9\u5f0f\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u90fd\u5f88\u5dee\uff0c\u6574\u4e2a playbook \u770b\u4e0a\u53bb\u4e5f\u975e\u5e38\u51cc\u4e71\u3002",source:"@site/docs/linux/cicd/\u7b2c 5 \u7ae0 Linux Ansible \u8fdb\u9636\u77e5\u8bc6.md",sourceDirName:"linux/cicd",slug:"/linux-cicd-5",permalink:"/en/docs/linux-cicd-5",draft:!1,tags:[],version:"current",frontMatter:{id:"linux-cicd-5",slug:"/linux-cicd-5",title:"\u7b2c 5 \u7ae0 Linux Ansible \u8fdb\u9636\u77e5\u8bc6",authors:"zhangqf",keywords:["linux","ansible"]},sidebar:"linux",previous:{title:"\u7b2c 4 \u7ae0 Linux Ansible \u5165\u95e8\u77e5\u8bc6",permalink:"/en/docs/linux-cicd-4"},next:{title:"\u7b2c 6 \u7ae0 DevOps \u5b9e\u8df5",permalink:"/en/docs/linux-cicd-6"}},m={},u=[{value:"4.1\u3001Include \u548c Import \u6307\u4ee4",id:"41include-\u548c-import-\u6307\u4ee4",level:2},{value:"4.2\u3001\u7ec4\u7ec7 task",id:"42\u7ec4\u7ec7-task",level:2},{value:"4.2.1\u3001\u5728\u5faa\u73af\u4e2d include \u6587\u4ef6",id:"421\u5728\u5faa\u73af\u4e2d-include-\u6587\u4ef6",level:3},{value:"4.3\u3001\u7ec4\u7ec7 handler",id:"43\u7ec4\u7ec7-handler",level:2},{value:"4.4\u3001\u7ec4\u7ec7\u53d8\u91cf",id:"44\u7ec4\u7ec7\u53d8\u91cf",level:2},{value:"4.4.1\u3001vars_files",id:"441vars_files",level:3},{value:"4.4.2\u3001include_vars",id:"442include_vars",level:3},{value:"4.4.3\u3001\u2013extra-vars \u9009\u9879",id:"443extra-vars-\u9009\u9879",level:3},{value:"4.5\u3001\u7ec4\u7ec7 playbook \u6587\u4ef6",id:"45\u7ec4\u7ec7-playbook-\u6587\u4ef6",level:2},{value:"4.6\u3001\u66f4\u4e3a\u89c4\u8303\u7684\u7ec4\u7ec7\u65b9\u5f0f\uff1aRole",id:"46\u66f4\u4e3a\u89c4\u8303\u7684\u7ec4\u7ec7\u65b9\u5f0frole",level:2},{value:"4.6.1\u3001Role \u6587\u4ef6\u7ed3\u6784",id:"461role-\u6587\u4ef6\u7ed3\u6784",level:3},{value:"4.6.2\u3001\u5b9a\u4e49 Role \u7684 task",id:"462\u5b9a\u4e49-role-\u7684-task",level:3},{value:"4.6.3\u3001\u5b9a\u4e49 Role \u7684 handler",id:"463\u5b9a\u4e49-role-\u7684-handler",level:3},{value:"4.6.4\u3001\u5b9a\u4e49 Role \u7684\u53d8\u91cf",id:"464\u5b9a\u4e49-role-\u7684\u53d8\u91cf",level:3},{value:"4.6.5\u3001Role \u7528\u5230\u7684\u5916\u90e8\u6587\u4ef6\u548c\u6a21\u677f\u6587\u4ef6",id:"465role-\u7528\u5230\u7684\u5916\u90e8\u6587\u4ef6\u548c\u6a21\u677f\u6587\u4ef6",level:3},{value:"4.6.6\u3001Role \u4e2d\u5b9a\u4e49\u7684\u6a21\u5757\u548c\u63d2\u4ef6",id:"466role-\u4e2d\u5b9a\u4e49\u7684\u6a21\u5757\u548c\u63d2\u4ef6",level:3},{value:"4.6.7\u3001\u5b9a\u4e49 Role \u7684\u4f9d\u8d56\u5173\u7cfb",id:"467\u5b9a\u4e49-role-\u7684\u4f9d\u8d56\u5173\u7cfb",level:3},{value:"4.6.8\u3001\u52a8\u624b\u5199\u4e00\u4e2a Role",id:"468\u52a8\u624b\u5199\u4e00\u4e2a-role",level:3},{value:"4.7\u3001\u4f7f\u7528 Role",id:"47\u4f7f\u7528-role",level:2},{value:"4.8\u3001\u67e5\u770b\u4efb\u52a1\u548c\u6253\u6807\u7b7e tags",id:"48\u67e5\u770b\u4efb\u52a1\u548c\u6253\u6807\u7b7e-tags",level:2},{value:"4.9\u3001Ansible Galaxy",id:"49ansible-galaxy",level:2},{value:"4.10\u3001\u7efc\u5408\u6848\u4f8b",id:"410\u7efc\u5408\u6848\u4f8b",level:2}],k={toc:u};function c(l){var e=l.components,o=(0,t.Z)(l,r);return(0,s.kt)("wrapper",(0,n.Z)({},k,o,{components:e,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"\u5728\u524d\u9762\u7efc\u5408\u6848\u4f8b\u7684\u6700\u540e\uff0c\u6211\u4eec\u5c06\u521d\u59cb\u5316\u914d\u7f6e\u670d\u52a1\u5668\u7684\u591a\u4e2a\u4efb\u52a1\u7ec4\u5408\u5230\u4e86\u5355\u4e2a playbook \u4e2d\uff0c\u8fd9\u79cd\u7ec4\u7ec7\u65b9\u5f0f\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u90fd\u5f88\u5dee\uff0c\u6574\u4e2a playbook \u770b\u4e0a\u53bb\u4e5f\u975e\u5e38\u51cc\u4e71\u3002"),(0,s.kt)("p",null,"\u5982\u679c\u6211\u4eec\u5c06\u6bcf\u4e00\u4e2a\u529f\u80fd\u5757\u5355\u72ec\u7ef4\u62a4\u5728\u4e00\u4e2a playbook \u4e2d\uff0c\u7136\u540e\u901a\u8fc7\u76ee\u5f55\u6811\u7684\u65b9\u5f0f\u7ec4\u7ec7\u8fd9\u4e9b playbook\uff0c\u6700\u540e\u901a\u8fc7 python \u7684\u7f16\u7a0b\u903b\u8f91\u7edf\u4e00\u6267\u884c\u8fd9\u4e9b playbook\u3002\u8fd9\u79cd\u65b9\u5f0f\u770b\u8d77\u6765\u6709\u70b9\u50cf\u7f16\u7a0b\u4e2d\u7684\u6846\u67b6\u601d\u60f3\u3002\u4e0d\u9519\uff0c\u786e\u5b9e\u5f88\u50cf\uff0c\u5728 ansible \u4e2d\u6211\u4eec\u53eb\u8fd9\u79cd\u6846\u67b6\u4e3a Role\u3002"),(0,s.kt)("p",null,"\u5728\u5b66\u4e60 Role \u4e4b\u524d\u9700\u8981\u6253\u4e00\u4e0b\u57fa\u7840\uff0c\u4e0b\u9762\u68b3\u7406\u4e00\u4e0b\u8109\u7edc\u3002"),(0,s.kt)("h2",{id:"41include-\u548c-import-\u6307\u4ee4"},"4.1\u3001Include \u548c Import \u6307\u4ee4"),(0,s.kt)("p",null,"\u524d\u9762\u6211\u4eec\u5b66\u4e60\u4e86 play\u3001task\u3001variable\u3001handler\u7b49\uff0c\u4e3a\u4e86\u5b9e\u73b0\u67d0\u4e9b\u529f\u80fd\u628a\u5b83\u4eec\u653e\u5230\u4e00\u4e2a playbook \u5f53\u4e2d\uff0c\u73b0\u5728\u6211\u4eec\u6253\u7b97\u5206\u95e8\u522b\u7c7b\u7ec4\u7ec7\u5b83\u4eec\u3002"),(0,s.kt)("p",null,"\u5c06\u5404\u7c7b\u6587\u4ef6\u5206\u7c7b\u5b58\u653e\u540e\uff0c\u6700\u7ec8\u9700\u8981\u5728\u67d0\u4e2a\u5165\u53e3\u6587\u4ef6\u53bb\u6c47\u96c6\u5f15\u5165\u8fd9\u4e9b\u5916\u90e8\u6587\u4ef6\u3002\u52a0\u8f7d\u8fd9\u4e9b\u5916\u90e8\u6587\u4ef6\u901a\u5e38\u53ef\u4ee5\u4f7f\u7528 include \u6307\u4ee4\u3001include","_","xxx \u6307\u4ee4\u548c import","_","xxx \u6307\u4ee4\uff0c\u5176\u4e2d xxx \u8868\u793a\u5185\u5bb9\u7c7b\u578b\u3002"),(0,s.kt)("p",null,"\u5728\u65e9\u671f Ansible \u7248\u672c\uff0c\u7ec4\u7ec7\u6587\u4ef6\u7684\u65b9\u5f0f\u5747\u4f7f\u7528 include \u6307\u4ee4\uff0c\u4f46\u968f\u7740\u7248\u672c\u7684\u66f4\u8fed\uff0cAnsible \u5bf9\u8fd9\u65b9\u9762\u505a\u4e86\u66f4\u4e3a\u7ec6\u81f4\u7684\u533a\u5206\u3002\u867d\u7136\u76ee\u524d\u4ecd\u7136\u652f\u6301 include\uff0c\u4f46\u65e9\u5df2\u7eb3\u5165\u5e9f\u5f03\u7684\u8ba1\u5212\uff0c\u6240\u4ee5\u73b0\u5728\u4e0d\u8981\u518d\u4f7f\u7528 include \u6307\u4ee4\u3002"),(0,s.kt)("p",null,"\u5bf9\u4e8e playbook \u4e2d\u7684 play \u6216 task\uff0c\u5e94\u8be5\u4f7f\u7528 include","_","xxx \u6216 import","_","xxx \u6307\u4ee4\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"include","_","tasks \u548c import","_","tasks \u7528\u4e8e\u5f15\u5165\u5916\u90e8\u4efb\u52a1\u6587\u4ef6\uff1b"),(0,s.kt)("li",{parentName:"ul"},"import","_","playbook \u7528\u4e8e\u5f15\u5165 playbook \u6587\u4ef6\uff1b"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("em",{parentName:"li"},"include \u53ef\u7528\u4e8e\u5f15\u5165\u51e0\u4e4e\u6240\u6709\u5185\u5bb9\u6587\u4ef6\uff0c\u4f46\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u5b83\uff1b"))),(0,s.kt)("p",null,"\u5bf9\u4e8e handler\uff0c\u56e0\u4e3a\u5b83\u672c\u8eab\u4e5f\u662f task\uff0c\u6240\u4ee5\u5b83\u4e5f\u80fd\u4f7f\u7528 include","_","tasks\u3001import","_","tasks \u6765\u5f15\u5165\uff0c\u4f46\u662f\u8fd9\u5e76\u4e0d\u662f\u60f3\u8c61\u4e2d\u90a3\u4e48\u7b80\u5355\uff0c\u540e\u6587\u518d\u7ec6\u8bf4\u3002"),(0,s.kt)("p",null,"\u5bf9\u4e8e variable\uff0c\u4f7f\u7528 include","_","vars(\u8fd9\u662f\u6838\u5fc3\u6a21\u5757\u63d0\u4f9b\u7684\u529f\u80fd)\u6216\u5176\u5b83\u7ec4\u7ec7\u65b9\u5f0f(\u5982 vars","_","files)\uff0c\u6ca1\u6709\u5bf9\u5e94\u7684 import","_","vars\u3002"),(0,s.kt)("p",null,"\u5bf9\u4e8e\u540e\u6587\u8981\u4ecb\u7ecd\u7684 Role\uff0c\u4f7f\u7528 ",(0,s.kt)("strong",{parentName:"p"},"include","_","role \u6216 import","_","role \u6216 roles")," \u6307\u4ee4\u3002"),(0,s.kt)("p",null,"\u65e2\u7136\u67d0\u7c7b\u5185\u5bb9\u6587\u4ef6\u65e2\u53ef\u4ee5\u4f7f\u7528 include","_","xxx \u5f15\u5165\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 import","_","xxx \u5f15\u5165\uff0c\u90a3\u4e48\u5c31\u6709\u5fc5\u8981\u53bb\u641e\u6e05\u695a\u5b83\u4eec\u6709\u4ec0\u4e48\u533a\u522b\u3002\u672c\u6587\u6700\u540e\u6211\u4f1a\u8be6\u7ec6\u89e3\u91ca\u5b83\u4eec\uff0c\u73b0\u5728\u6211\u5148\u628a\u7ed3\u8bba\u5199\u5728\u8fd9\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"include","_","xxx \u6307\u4ee4\u662f\u5728\u9047\u5230\u5b83\u7684\u65f6\u5019\u624d\u52a0\u8f7d\u6587\u4ef6\u5e76\u89e3\u6790\u6267\u884c\uff0c\u6240\u4ee5\u5b83\u662f\u52a8\u6001\u89e3\u6790\u7684\uff1b"),(0,s.kt)("li",{parentName:"ul"},"import","_","xxx \u662f\u5728\u89e3\u6790 playbook \u7684\u65f6\u5019\u89e3\u6790\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u6267\u884c playbook \u4e4b\u524d\u5c31\u5df2\u7ecf\u89e3\u6790\u597d\u4e86\uff0c\u6240\u4ee5\u5b83\u4e5f\u79f0\u4e3a\u9759\u6001\u52a0\u8f7d\u3002")),(0,s.kt)("h2",{id:"42\u7ec4\u7ec7-task"},"4.2\u3001\u7ec4\u7ec7 task"),(0,s.kt)("p",null,"\u5728\u6b64\u524d\u7684\u6240\u6709\u793a\u4f8b\u4e2d\uff0c\u4e00\u76f4\u90fd\u662f\u5c06\u6240\u6709\u4efb\u52a1\u7f16\u5199\u5728\u5355\u4e2a playbook \u6587\u4ef6\u4e2d\u3002\u4f46 Ansible \u5141\u8bb8\u5c06\u4efb\u52a1\u5206\u79bb\u5230\u4e0d\u540c\u7684\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u53bb\u5f15\u5165\u5916\u90e8\u4efb\u52a1\u6587\u4ef6\u3002"),(0,s.kt)("p",null,"\u7528\u793a\u4f8b\u6765\u89e3\u91ca\u4f1a\u975e\u5e38\u7b80\u5355\u3002\u5047\u8bbe\uff0c\u4e24\u4e2a playbook \u6587\u4ef6 pb1.yml \u548c pb2.yml\u3002"),(0,s.kt)("p",null,"pb1.yml \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: play1\n  hosts: localhost\n  gather_facts: false\n  tasks:\n    - name: task1 in play1\n      debug:\n        msg: "task1 in play1"\n\n  # - include_tasks: pb2.yml\n    - import_tasks: pb2.yml\n')),(0,s.kt)("p",null,"pb2.yml \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: task2 in play1\n  debug: \n    msg: "task2 in play1"\n\n- name: task3 in play1\n  debug: \n    msg: "task3 in play1"\n')),(0,s.kt)("p",null,"\u6267\u884c pb1.yml\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-playbook pb1.yml\n")),(0,s.kt)("p",null,"\u4e0a\u9762\u662f\u5728 pb1.yml \u6587\u4ef6\u4e2d\u901a\u8fc7 import","_","tasks \u5f15\u5165\u4e86\u989d\u5916\u7684\u4efb\u52a1\u6587\u4ef6 pb2.yml\uff0c\u5bf9\u4e8e\u6b64\u5904\u6765\u8bf4\uff0c\u5c06 import","_","tasks \u66ff\u6362\u6210 include","_","tasks \u4e5f\u80fd\u6b63\u786e\u5de5\u4f5c\uff0c\u4e0d\u4f1a\u6709\u4efb\u4f55\u5f71\u54cd\u3002"),(0,s.kt)("p",null,"\u4f46\u5982\u679c\u662f\u5728\u5faa\u73af\u4e2d(\u6bd4\u5982 loop)\uff0c\u5219\u53ea\u80fd\u4f7f\u7528 include","_","tasks \u800c\u4e0d\u80fd\u518d\u4f7f\u7528 import","_","tasks\u3002"),(0,s.kt)("h3",{id:"421\u5728\u5faa\u73af\u4e2d-include-\u6587\u4ef6"},"4.2.1\u3001\u5728\u5faa\u73af\u4e2d include \u6587\u4ef6"),(0,s.kt)("p",null,"\u4fee\u6539 pb1.yml \u548c pb2.yml \u6587\u4ef6\u5185\u5bb9\uff1a"),(0,s.kt)("p",null,"pb1.yml \u5185\u5bb9\u5982\u4e0b\uff0c\u6ce8\u610f\u8be5\u6587\u4ef6\u4e2d\u7684 include","_","tasks \u6307\u4ee4\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: play1\n  hosts: localhost\n  gather_facts: false\n  tasks: \n    - name: task1 in play1\n      debug: \n        msg: "task1 in play1"\n\n    - name: include two times\n      include_tasks: pb2.yml\n      loop: \n        - ONE\n        - TWO\n')),(0,s.kt)("p",null,"pb2.yml \u5185\u5bb9\u5982\u4e0b\uff0c\u6ce8\u610f\u8be5\u6587\u4ef6\u4e2d\u7684\u53d8\u91cf\u5f15\u7528\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: task2 in play1\n  debug: \n    msg: "task2 in {{item}}"\n')),(0,s.kt)("p",null,"\u6267\u884c pb1.yml \u6587\u4ef6\uff0c\u89c2\u5bdf\u6267\u884c\u7ed3\u679c\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'$ ansible-playbook pb1.yml\n\nTASK [task1 in play1] ************************\nok: [localhost] => {\n    "msg": "task1 in play1"\n}\n\nTASK [include two times] *********************\nincluded: /root/ansible/pb2.yml for localhost\nincluded: /root/ansible/pb2.yml for localhost\n\nTASK [task2 in play1] ************************\nok: [localhost] => {\n    "msg": "task2 in ONE"\n}\n\nTASK [task2 in play1] ************************\nok: [localhost] => {\n    "msg": "task2 in TWO"\n}\n')),(0,s.kt)("p",null,"\u4e0a\u9762\u662f\u5728 loop \u5faa\u73af\u4e2d\u52a0\u8f7d\u4e24\u6b21 pb2.yml \u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u4e2d\u7684\u4efb\u52a1\u88ab\u6267\u884c\u4e86\u4e24\u6b21\uff0c\u5e76\u4e14\u5728 pb2.yml \u4e2d\u80fd\u591f\u5f15\u7528\u5916\u90e8\u6587\u4ef6(pb1.yml)\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\u3002"),(0,s.kt)("p",null,"\u5206\u6790\u4e00\u4e0b\u4e0a\u9762\u7684\u6267\u884c\u6d41\u7a0b\uff1a"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"\u89e3\u6790 playbook \u6587\u4ef6 pb1.yml"),(0,s.kt)("li",{parentName:"ol"},"\u6267\u884c\u7b2c\u4e00\u4e2a play"),(0,s.kt)("li",{parentName:"ol"},"\u5f53\u6267\u884c\u5230 pb1.yml \u4e2d\u7684\u7b2c\u4e8c\u4e2a\u4efb\u52a1\u65f6\uff0c\u8be5\u4efb\u52a1\u5728\u5faa\u73af\u4e2d\uff0c\u4e14\u5176\u4f5c\u7528\u662f\u52a0\u8f7d\u5916\u90e8\u4efb\u52a1\u6587\u4ef6 pb2.yml"),(0,s.kt)("li",{parentName:"ol"},"\u5f00\u59cb\u5faa\u73af\uff0c\u6bcf\u8f6e\u5faa\u73af\u90fd\u52a0\u8f7d\u3001\u89e3\u6790\u5e76\u6267\u884c pb2.yml \u6587\u4ef6\u4e2d\u7684\u6240\u6709\u4efb\u52a1"),(0,s.kt)("li",{parentName:"ol"},"\u9000\u51fa")),(0,s.kt)("p",null,"\u6b63\u662f\u56e0\u4e3a include","_","tasks \u6307\u4ee4\u662f\u5728\u9047\u5230\u5b83\u7684\u65f6\u5019\u624d\u8fdb\u884c\u52a0\u8f7d\u89e3\u6790\u4ee5\u53ca\u6267\u884c\uff0c\u6240\u4ee5\u5728 pb2.yml \u4e2d\u624d\u80fd\u4f7f\u7528\u53d8\u91cf\u3002"),(0,s.kt)("p",null,"\u5982\u679c\u5c06\u4e0a\u9762 loop \u5faa\u73af\u4e2d\u7684 include","_","tasks \u6362\u6210 import","_","tasks \u5462\uff1f\u8bed\u6cd5\u4f1a\u62a5\u9519\uff0c\u4e0b\u9762\u53ef\u4ee5\u627e\u5230\u7b54\u6848\u3002"),(0,s.kt)("h2",{id:"43\u7ec4\u7ec7-handler"},"4.3\u3001\u7ec4\u7ec7 handler"),(0,s.kt)("p",null,"handler \u5176\u672c\u8d28\u4e5f\u662f task\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u4f7f\u7528 include","_","tasks \u6216 import","_","tasks \u6765\u52a0\u8f7d\u5916\u90e8\u4efb\u52a1\u6587\u4ef6\u3002\u4f46\u662f\u5b83\u4eec\u5f15\u5165 handler \u4efb\u52a1\u6587\u4ef6\u7684\u65b9\u5f0f\u6709\u5f88\u5927\u7684\u5dee\u522b\u3002"),(0,s.kt)("p",null,"\u5148\u770b include","_","tasks \u5f15\u5165 handler \u4efb\u52a1\u6587\u4ef6\u7684\u793a\u4f8b\uff1a"),(0,s.kt)("p",null,"pb1.yml \u7684\u5185\u5bb9\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: play1\n  hosts: localhost\n  gather_facts: false\n  handlers: \n    - name: h1\n      include_tasks: handler1.yml\n\n  tasks: \n    - name: task1 in play1\n      debug: \n        msg: "task1 in play1"\n      changed_when: true\n      notify: \n        - h1\n')),(0,s.kt)("p",null,"\u6ce8\u610f\u5728 tasks \u7684\u4efb\u52a1\u4e2d\u52a0\u4e86\u4e00\u4e2a\u6307\u4ee4 ",(0,s.kt)("inlineCode",{parentName:"p"},"changed_when: true"),"\uff0c\u5b83\u7528\u6765",(0,s.kt)("strong",{parentName:"p"},"\u5f3a\u5236\u6307\u5b9a\u5b83\u6240\u5728\u4efb\u52a1\u7684 changed \u72b6\u6001"),"\uff0c\u5982\u679c\u6761\u4ef6\u4e3a\u771f\uff0c\u5219 changed=1\uff0c\u5426\u5219 changed=0\u3002\u4f7f\u7528\u8fd9\u4e2a\u6307\u4ee4\u662f\u56e0\u4e3a debug \u6a21\u5757\u9ed8\u8ba4\u4e0d\u4f1a\u5f15\u8d77 changed=1 \u884c\u4e3a\uff0c\u6240\u4ee5\u53ea\u80fd\u4f7f\u7528\u8be5\u6307\u4ee4\u6765\u5f3a\u5236\u5176\u72b6\u6001\u4e3a changed=1\u3002"),(0,s.kt)("p",null,"\u5f53 Ansible \u76d1\u63a7\u5230\u4e86 changed=1\uff0cnotify \u6307\u4ee4\u4f1a\u751f\u6548\uff0c\u5b83\u4f1a\u53bb\u89e6\u53d1\u5bf9\u5e94\u7684 handler\uff0c\u5b83\u89e6\u53d1\u7684 handler \u7684\u540d\u79f0\u662f handler1\uff0c\u5176\u4f5c\u7528\u662f\u4f7f\u7528 include","_","tasks \u6307\u4ee4\u5f15\u5165 handler1.yml \u6587\u4ef6\u3002"),(0,s.kt)("p",null,"\u4e0b\u9762\u662f handler1.yml \u6587\u4ef6\u7684\u5185\u5bb9\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: h11\n  debug: \n    msg: "task h11"\n')),(0,s.kt)("p",null,"\u6ce8\u610f\u4e24\u4e2a\u540d\u79f0\uff0c\u4e00\u4e2a\u662f notify \u89e6\u53d1 handler \u7684\u4efb\u52a1\u540d\u79f0(\u201ch1\u201d)\uff0c\u4e00\u4e2a\u662f\u5f15\u5165\u6587\u4ef6\u4e2d\u4efb\u52a1\u7684\u540d\u79f0(\u201ch11\u201d)\uff0c\u5b83\u4eec\u662f\u4e24\u4e2a\u4efb\u52a1\u3002"),(0,s.kt)("p",null,"\u518d\u6765\u770b import","_","tasks \u5f15\u5165 handler \u6587\u4ef6\u7684\u793a\u4f8b\uff0c\u6ce8\u610f\u89c2\u5bdf\u540d\u79f0\u7684\u4e0d\u540c\u70b9\u3002"),(0,s.kt)("p",null,"\u5982\u4e0b\u662f pb1.yml \u6587\u4ef6\u7684\u5185\u5bb9\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: play1\n  hosts: localhost\n  gather_facts: false\n  handlers: \n    - name: h2\n      import_tasks: handler2.yml\n\n  tasks: \n    - name: task1 in play1\n      debug: \n        msg: "task1 in play1"\n      changed_when: true\n      notify: \n        - h22\n')),(0,s.kt)("p",null,"\u4e0b\u9762\u662f\u4f7f\u7528 import","_","tasks \u5f15\u5165\u7684 handler2.yml \u6587\u4ef6\u7684\u5185\u5bb9\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: h22\n  debug: \n    msg: "task h22"\n')),(0,s.kt)("p",null,"\u5728\u5f15\u5165 handler \u4efb\u52a1\u6587\u4ef6\u7684\u65f6\u5019\uff0cinclude","_","tasks \u548c import","_","tasks \u7684\u533a\u522b\u8868\u73b0\u5728\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u4f7f\u7528 include","_","tasks \u65f6\uff0cnotify \u6307\u4ee4\u89e6\u53d1\u7684 handler \u540d\u79f0\u662f include","_","tasks \u4efb\u52a1\u672c\u8eab\u7684\u540d\u79f0"),(0,s.kt)("li",{parentName:"ul"},"\u4f7f\u7528 import","_","tasks \u65f6\uff0cnotify \u6307\u4ee4\u89e6\u53d1\u7684 handler \u540d\u79f0\u662f import","_","tasks \u6240\u5f15\u5165\u6587\u4ef6\u5185\u7684\u4efb\u52a1\u540d\u79f0")),(0,s.kt)("p",null,"\u5c06\u4e0a\u9762\u7684\u4e24\u4e2a\u793a\u4f8b\u5408\u5728\u4e00\u8d77\uff0c\u6216\u8bb8\u8981\u66f4\u6e05\u6670\u4e00\u70b9\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: play1\n  hosts: localhost\n  gather_facts: false\n  handlers: \n    - name: h1\n      include_tasks: handler1.yml\n    - name: h2\n      import_tasks: handler2.yml\n\n  tasks: \n    - name: task1 in play1\n      debug: \n        msg: "task1 in play1"\n      changed_when: true\n      notify: \n        - h1   # \u6ce8\u610fh1\u548ch22\u540d\u79f0\u7684\u4e0d\u540c\n        - h22\n')),(0,s.kt)("p",null,"\u5176\u5b9e\u5206\u6790\u4e00\u4e0b\u5c31\u5f88\u5bb9\u6613\u7406\u89e3\u4e3a\u4ec0\u4e48 notify \u89e6\u53d1\u7684\u540d\u79f0\u8981\u4e0d\u540c\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"include","_","tasks \u662f\u5728\u9047\u5230\u8fd9\u4e2a\u6307\u4ee4\u7684\u65f6\u5019\u624d\u5f15\u5165\u6587\u4ef6\u7684\uff0c\u6240\u4ee5 notify \u4e0d\u53ef\u80fd\u53bb\u89e6\u53d1\u5916\u90e8 handler \u6587\u4ef6\u91cc\u7684\u540d\u79f0(h11)\uff0c\u5916\u90e8 handler \u6587\u4ef6\u4e2d\u7684\u540d\u79f0\u5728\u5176\u5f15\u5165\u4e4b\u524d\u6839\u672c\u5c31\u4e0d\u5b58\u5728\u3002"),(0,s.kt)("li",{parentName:"ul"},"import","_","tasks \u662f\u5728\u89e3\u6790 playbook \u7684\u65f6\u5019\u5f15\u5165\u7684\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u5728\u6267\u884c play \u4e4b\u524d\u5c31\u5df2\u7ecf\u628a\u5916\u90e8 handler \u6587\u4ef6\u7684\u5185\u5bb9\u5f15\u5165\u5e76\u66ff\u6362\u5728 handler \u7684\u4f4d\u7f6e\u5904\uff0c\u800c\u539f\u6765\u7684\u540d\u79f0(h2)\u5219\u88ab\u8986\u76d6\u4e86\u3002")),(0,s.kt)("p",null,"\u6700\u540e\uff0c\u4e0d\u8981\u5fd8\u4e86 import","_","tasks \u6216 include","_","tasks \u81ea\u8eab\u4e5f\u662f\u4efb\u52a1\uff0c\u65e2\u7136\u662f\u4efb\u52a1\uff0c\u5c31\u80fd\u4f7f\u7528 task \u5c42\u6b21\u7684\u6307\u4ee4\u3002\u4f8b\u5982\u4e0b\u9762\u7684\u793a\u4f8b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'handlers: \n  - name: h1\n    include_tasks: handler.yml\n    vars: \n      my_var: my_value\n    when: my_var == "my_value"\n')),(0,s.kt)("p",null,"\u4f46\u8fd9\u4e24\u4e2a\u6307\u4ee4\u5bf9 task \u5c42\u6b21\u6307\u4ee4\u7684\u5904\u7406\u65b9\u5f0f\u4e0d\u540c\uff0c\u76f8\u5173\u7ec6\u8282\u4ecd\u7136\u4fdd\u7559\u5230\u540e\u6587\u7edf\u4e00\u89e3\u91ca\u3002"),(0,s.kt)("h2",{id:"44\u7ec4\u7ec7\u53d8\u91cf"},"4.4\u3001\u7ec4\u7ec7\u53d8\u91cf"),(0,s.kt)("p",null,"\u5f15\u5165\u4fdd\u5b58\u4e86\u53d8\u91cf\u7684\u6587\u4ef6\u6709\u4e24\u79cd\u65b9\u5f0f\uff1ainclude","_","vars \u548c vars","_","files\u3002\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u5728\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528 -e \u6216 --extra-vars \u9009\u9879\u6765\u5f15\u5165\u3002"),(0,s.kt)("h3",{id:"441vars_files"},"4.4.1\u3001vars","_","files"),(0,s.kt)("p",null,"\u5148\u4ecb\u7ecd ",(0,s.kt)("inlineCode",{parentName:"p"},"vars_files"),"\uff0c\u5b83\u662f\u4e00\u4e2a play \u7ea7\u522b\u7684\u6307\u4ee4\uff0c\u53ef\u7528\u4e8e\u5728\u89e3\u6790 playbook \u7684\u9636\u6bb5\u5f15\u5165\u4e00\u4e2a\u6216\u591a\u4e2a\u4fdd\u5b58\u4e86\u53d8\u91cf\u7684\u5916\u90e8\u6587\u4ef6\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\uff0cpb.yml \u6587\u4ef6\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: play1\n  hosts: localhost\n  gather_facts: false\n  vars_files: \n    - varfile1.yml\n    - varfile2.yml\n  tasks: \n    - debug:\n        msg: "var in varfile1: {{var1}}"\n    - debug:\n        msg: "var in varfile2: {{var2}}"\n')),(0,s.kt)("p",null,"pb.yml \u6587\u4ef6\u901a\u8fc7 vars","_","files \u5f15\u5165\u4e86\u4e24\u4e2a\u53d8\u91cf\u6587\u4ef6\uff0c\u53d8\u91cf\u6587\u4ef6\u7684\u5199\u6cd5\u8981\u6c42\u9075\u5b88 YAML \u6216 JSON \u683c\u5f0f\u3002\u4e0b\u9762\u662f\u8fd9\u4e24\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'# \u4e0b\u9762\u662fvarfile1.yml\u6587\u4ef6\u7684\u5185\u5bb9\n---\nvar1: "value1"\nvar11: "value11"\n\n# \u4e0b\u9762\u662fvarfile2.yml\u6587\u4ef6\u7684\u5185\u5bb9\n---\nvar2: "value2"\nvar22: "value22"\n')),(0,s.kt)("p",null,"\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"vars_files")," \u6307\u4ee4\u662f play \u7ea7\u522b\u7684\u6307\u4ee4\uff0c\u4e14\u662f\u5728\u89e3\u6790 playbook \u7684\u65f6\u5019\u52a0\u8f7d\u5e76\u89e3\u6790\u7684\uff0c\u6240\u4ee5\u6240\u5f15\u5165\u53d8\u91cf\u7684\u53d8\u91cf\u662f play \u8303\u56f4\u5185\u53ef\u7528\u7684\uff0c\u5176\u5b83 play \u4e0d\u53ef\u4f7f\u7528\u8fd9\u4e9b\u53d8\u91cf\u3002"),(0,s.kt)("h3",{id:"442include_vars"},"4.4.2\u3001include","_","vars"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"include_vars")," \u6307\u4ee4\u4e5f\u53ef\u7528\u4e8e\u5f15\u5165\u5916\u90e8\u53d8\u91cf\u6587\u4ef6\uff0c\u5b83\u548c ",(0,s.kt)("inlineCode",{parentName:"p"},"vars_files")," \u4e0d\u540c\u3002\u4e00\u65b9\u9762\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"include_vars")," \u662f\u6a21\u5757\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u5b83\u662f\u4e00\u4e2a\u5b9e\u5b9e\u5728\u5728\u7684\u4efb\u52a1\uff0c\u6240\u4ee5\u5728\u8fd9\u4e2a\u4efb\u52a1\u6267\u884c\u4e4b\u540e\u624d\u4f1a\u521b\u5efa\u53d8\u91cf\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u65e2\u7136 ",(0,s.kt)("inlineCode",{parentName:"p"},"include_vars")," \u662f\u4e00\u4e2a\u4efb\u52a1\uff0c\u5b83\u5c31\u53ef\u4ee5\u88ab\u4e00\u4e9b task \u7ea7\u522b\u7684\u6307\u4ee4\u63a7\u5236\uff0c\u5982 ",(0,s.kt)("inlineCode",{parentName:"p"},"when")," \u6307\u4ee4\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: play1\n  hosts: localhost\n  gather_facts: false\n  tasks: \n    - name: include vars from files\n      include_vars: varfile1.yml\n      when: 3 > 2\n    - debug:\n        msg: "var in varfile1: {{var1}}"\n')),(0,s.kt)("p",null,"\u4e0a\u9762\u793a\u4f8b\u4e2d\u5f15\u5165\u53d8\u91cf\u6587\u4ef6\u7684\u65b9\u5f0f\u662f\u76f4\u63a5\u6307\u5b9a\u6587\u4ef6\u540d ",(0,s.kt)("inlineCode",{parentName:"p"},"include_vars: varfile1.yml"),"\uff0c\u4e5f\u53ef\u4ee5\u660e\u786e\u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"file")," \u53c2\u6570\u6765\u6307\u5b9a\u8def\u5f84\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: include vars from files\n  include_vars: \n    file: varfile1.yml\n")),(0,s.kt)("p",null,"\u5982\u679c\u60f3\u8981\u5f15\u5165\u591a\u4e2a\u6587\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528\u5faa\u73af\u7684\u65b9\u5f0f\u3002\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'- name: include two var files\n  include_vars: \n    file: "{{item}}"\n  loop:\n    - varfile1.yml\n    - varfile2.yml\n')),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u6ce8\u610f\uff1ainclude","_","vars \u5728\u5f15\u5165\u6587\u4ef6\u7684\u65f6\u5019\u8981\u6c42\u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\uff0c\u5982\u679c\u6709\u591a\u4e2a\u53ef\u80fd\u7684\u6587\u4ef6\u4f46\u4e0d\u786e\u5b9a\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"li"},"with_first_found")," \u6307\u4ee4\u6216 ",(0,s.kt)("inlineCode",{parentName:"li"},"lookup")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"li"},"first_found")," \u63d2\u4ef6\u3002")),(0,s.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'tasks: \n  - name: include vars from files\n    include_vars: \n      file: "{{item}}"\n    with_first_found:\n      - varfile1.yml\n      - varfile2.yml\n      - default.yml\n\n# \u7b49\u4ef7\u4e8e\uff1a\ntasks: \n  - name: include vars from files\n    include_vars: \n      file: "{{ lookup(\'first_found\',any_files) }}"\n    vars:\n      any_files:\n        - varfile1.yml\n        - varfile2.yml\n        - default.yml\n')),(0,s.kt)("p",null,"\u6b64\u5916\uff0cinclude","_","vars \u8fd8\u80fd\u4ece\u76ee\u5f55\u4e2d\u5bfc\u5165\u591a\u4e2a\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4f1a\u9012\u5f52\u5230\u5b50\u76ee\u5f55\u4e2d\u3002\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: Include all files in vars/all\n  include_vars:\n    dir: vars/all\n")),(0,s.kt)("h3",{id:"443extra-vars-\u9009\u9879"},"4.4.3\u3001\u2013extra-vars \u9009\u9879"),(0,s.kt)("p",null,"ansible-playbook \u547d\u4ee4\u7684 -e \u9009\u9879\u6216 --extra-vars \u9009\u9879\u4e5f\u53ef\u4ee5\u7528\u6765\u5b9a\u4e49\u53d8\u91cf\u6216\u5f15\u5165\u53d8\u91cf\u6587\u4ef6\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5b9a\u4e49\u5355\u4e2a\u53d8\u91cf\n$ ansible-playbook -e 'var1=\"value1\"' xxx.yml\n\n# \u5b9a\u4e49\u591a\u4e2a\u53d8\u91cf\n$ ansible-playbook -e 'var1=\"value1\" var2=\"value2\"' xxx.yml\n\n# \u5f15\u5165\u5355\u4e2a\u53d8\u91cf\u6587\u4ef6\n$ ansible-playbook -e '@varfile1.yml' xxx.yml\n\n# \u5f15\u5165\u591a\u4e2a\u53d8\u91cf\u6587\u4ef6\n$ ansible-playbook -e '@varfile1.yml' -e '@varfile2.yml' xxx.yml\n")),(0,s.kt)("p",null,"\u56e0\u4e3a\u662f\u901a\u8fc7\u9009\u9879\u7684\u65b9\u5f0f\u6765\u5b9a\u4e49\u53d8\u91cf\u7684\uff0c\u6240\u4ee5\u5b83\u6240\u5b9a\u4e49\u7684\u53d8\u91cf\u662f\u5168\u5c40\u7684\uff0c\u5bf9\u6240\u6709 play \u90fd\u6709\u6548\u3002"),(0,s.kt)("p",null,"\u901a\u5e38\u6765\u8bf4\u4e0d\u5efa\u8bae\u4f7f\u7528 -e \u9009\u9879\uff0c\u56e0\u4e3a\u8fd9\u5bf9\u7528\u6237\u6765\u8bf4\u662f\u4e0d\u900f\u660e\u4e5f\u4e0d\u53cb\u597d\u7684\uff0c\u8981\u6c42\u7528\u6237\u8bb0\u4f4f\u8981\u5b9a\u4e49\u54ea\u4e9b\u53d8\u91cf\u3002"),(0,s.kt)("h2",{id:"45\u7ec4\u7ec7-playbook-\u6587\u4ef6"},"4.5\u3001\u7ec4\u7ec7 playbook \u6587\u4ef6"),(0,s.kt)("p",null,"import","_","playbook \u6307\u4ee4\u53ef\u7528\u4e8e\u5f15\u5165 playbook \u6587\u4ef6\uff0c\u5b83\u662f\u4e00\u4e2a play \u7ea7\u522b\u7684\u6307\u4ee4\uff0c\u5176\u672c\u8d28\u662f\u5f15\u5165\u5916\u90e8\u6587\u4ef6\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a play\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\uff0cpb.yml \u662f\u5165\u53e3 playbook \u6587\u4ef6\uff0c\u6b64\u6587\u4ef6\u4e2d\u5f15\u5165\u4e86\u5176\u5b83 playbook \u6587\u4ef6\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n# \u5f15\u5165\u5176\u5b83playbook\u6587\u4ef6\n- import_playbook: pb1.yml\n- import_playbook: pb2.yml\n\n# \u6587\u4ef6\u672c\u8eab\u7684play\n- name: play in self\n  hosts: localhost\n  gather_facts: false\n  tasks:\n    - debug: 'msg=\"file pb.yml\"'\n")),(0,s.kt)("p",null,"pb1.yml \u6587\u4ef6\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 playbook\uff0c\u5b83\u53ef\u4ee5\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a play\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- name: play in pb1.yml\n  hosts: localhost\n  gather_facts: false\n  tasks:\n    - debug: 'msg=\"imported file: pb1.yml\"'\n")),(0,s.kt)("p",null,"pb2.yml \u6587\u4ef6\u4e5f\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 playbook\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- name: play in pb2.yml\n  hosts: localhost\n  gather_facts: false\n  tasks:\n    - debug: 'msg=\"imported file: pb2.yml\"'\n")),(0,s.kt)("h2",{id:"46\u66f4\u4e3a\u89c4\u8303\u7684\u7ec4\u7ec7\u65b9\u5f0frole"},"4.6\u3001\u66f4\u4e3a\u89c4\u8303\u7684\u7ec4\u7ec7\u65b9\u5f0f\uff1aRole"),(0,s.kt)("p",null,"\u6211\u4eec\u4e0a\u9762\u81ea\u5df1\u7ec4\u7ec7 playbook \u5176\u5b9e\u4e5f\u5f88\u4e0d\u9519\uff0c\u9488\u5bf9\u4e00\u4e9b\u5c0f\u9879\u76ee\u591f\u7528\u3002\u5f53\u7136\u8fd9\u91cc\u4ecb\u7ecd\u7684 Role \u4e0d\u8fc7\u662f\u4e00\u79cd\u66f4\u89c4\u8303\u7684\u7ec4\u7ec7\u65b9\u5f0f\uff0c\u53e6\u5916 Role \u80cc\u540e\u7684\u903b\u8f91\u53ef\u4ee5\u7531 python \u7ec4\u7ec7\uff0c\u6240\u4ee5\u66f4\u52a0\u7075\u6d3b\u591a\u53d8\uff0c\u6211\u4eec\u53ea\u5b66\u4e00\u4e9b\u7b80\u5355\u9002\u7528\u7684\u6280\u5de7\u5373\u53ef\u3002"),(0,s.kt)("h3",{id:"461role-\u6587\u4ef6\u7ed3\u6784"},"4.6.1\u3001Role \u6587\u4ef6\u7ed3\u6784"),(0,s.kt)("p",null,"Role \u53ef\u4ee5\u7ec4\u7ec7\u4efb\u52a1\u3001\u53d8\u91cf\u3001handler \u4ee5\u53ca\u5176\u5b83\u4e00\u4e9b\u5185\u5bb9\uff0c\u6240\u4ee5\u4e00\u4e2a\u5b8c\u6574\u7684 Role \u91cc\u5305\u542b\u7684\u76ee\u5f55\u548c\u6587\u4ef6\u53ef\u80fd\u8f83\u591a\uff0c\u624b\u52a8\u53bb\u521b\u5efa\u6240\u6709\u8fd9\u4e9b\u76ee\u5f55\u548c\u6587\u4ef6\u662f\u4e00\u4ef6\u6bd4\u8f83\u70e6\u4eba\u7684\u4e8b\uff0c\u597d\u5728\u53ef\u4ee5\u4f7f\u7528 ansible-galaxy init ROLE","_","NAME \u547d\u4ee4\u6765\u5feb\u901f\u521b\u5efa\u4e00\u4e2a\u7b26\u5408 Role \u6587\u4ef6\u7ec4\u7ec7\u89c4\u8303\u7684\u6846\u67b6\u3002\u5173\u4e8eansible galaxy\uff0c\u6211\u7a0d\u540e\u4f1a\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u5b83\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\uff0c\u4e0b\u9762\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3a first","_","role \u7684 Role\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-galaxy init first_role\n$ tree\n.\n\u2514\u2500\u2500 first_role\n    \u251c\u2500\u2500 defaults\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 files\n    \u251c\u2500\u2500 handlers\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 meta\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 README.md\n    \u251c\u2500\u2500 tasks\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 templates\n    \u251c\u2500\u2500 tests\n    \u2502   \u251c\u2500\u2500 inventory\n    \u2502   \u2514\u2500\u2500 test.yml\n    \u2514\u2500\u2500 vars\n        \u2514\u2500\u2500 main.yml\n")),(0,s.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528 ansible-galaxy init --help \u67e5\u770b\u66f4\u591a\u9009\u9879\u3002\u6bd4\u5982\uff0c\u4f7f\u7528 --init-path \u9009\u9879\u6307\u5b9a\u521b\u5efa\u7684 Role \u8def\u5f84\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-galaxy init --init-path /etc/ansible/roles first_role\n")),(0,s.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u9762\u5df2\u7ecf\u5305\u542b\u4e86\u4e0d\u5c11\u76ee\u5f55\u548c\u6587\u4ef6\uff0c\u8fd9\u4e9b\u76ee\u5f55\u7684\u542b\u4e49\u7a0d\u540e\u6211\u4f1a\u4e00\u4e00\u89e3\u91ca\uff0c\u4e0d\u8fc7\u4ece\u90e8\u5206\u6587\u4ef6\u540d\u4e2d\uff0c\u5927\u6982\u80fd\u770b\u51fa\u4e00\u4e2a Role \u5305\u542b\u4e86\u4efb\u52a1\u3001\u53d8\u91cf\u3001handler \u7b49\u3002\u8fd9\u4e9b\u76ee\u5f55\u6216\u76ee\u5f55\u91cc\u7684\u6587\u4ef6\u5141\u8bb8\u4e0d\u5b58\u5728\uff0c\u5728\u6ca1\u6709\u4f7f\u7528\u5230\u76f8\u5173\u6587\u4ef6\u7684\u65f6\u5019\u5e76\u4e0d\u5f3a\u5236\u8fd9\u4e9b\u6587\u4ef6\u6216\u76ee\u5f55\u5b58\u5728\u3002"),(0,s.kt)("p",null,"\u4e0d\u96be\u53d1\u73b0\u5927\u591a\u6570\u6587\u4ef6\u547d\u540d\u4e3a main.yml\uff0c\u8fd9\u662f Role \u81ea\u52a8\u52a0\u8f7d\u7684\u4e3b\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u679c\u6362\u6210\u522b\u7684\u540d\u5b57\uff0c\u9700\u8981\u4f7f\u7528 include","_","xxx \u6216 import","_","xxx \u53bb\u52a0\u8f7d\u3002\u53e6\u5916\uff0c\u8fd9\u4e9b\u76ee\u5f55\u4e0b\u53ef\u80fd\u8fd8\u5305\u542b\u5176\u5b83 yml \u6587\u4ef6\uff0c\u6bd4\u5982 tasks \u76ee\u5f55\u4e0b\u6709\u591a\u4e2a\u4efb\u52a1\u6587\u4ef6\uff0c\u9700\u8981\u5728 main.yml \u6587\u4ef6\u4e2d\u4f7f\u7528 include","_","xxx \u6216 import","_","xxx \u52a0\u8f7d\u5176\u5b83\u5916\u90e8\u6587\u4ef6\u3002"),(0,s.kt)("p",null,"\u56e0\u4e3a\u6709\u53ef\u80fd\u540c\u65f6\u4f1a\u6709\u591a\u4e2a Role\uff0c\u6bd4\u5982\u521b\u5efa\u4e00\u4e2a Nginx \u7684 Role\uff0c\u518d\u521b\u5efa\u4e00\u4e2a MySQL \u7684 Role\uff0c\u8fd8\u521b\u5efa\u4e00\u4e2a Haproxy \u7684 Role\uff0c\u6240\u4ee5\u4e3a\u4e86\u7ec4\u7ec7\u591a\u4e2a Role\uff0c\u901a\u5e38\u4f1a\u5c06\u6bcf\u4e2a Role \u653e\u5728\u4e00\u4e2a\u79f0\u4e3a roles \u7684\u76ee\u5f55\u4e0b\u3002\u5373\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ tree -L 2\n.\n\u2514\u2500\u2500 roles\n    \u251c\u2500\u2500 first_role\n    \u2514\u2500\u2500 second_role\n")),(0,s.kt)("p",null,"\u6709\u4e86 Role \u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5c06 Role \u5f53\u4f5c\u4e00\u4e2a\u4e0d\u53ef\u5206\u5272\u7684\u4efb\u52a1\u6574\u4f53\u6765\u5bf9\u5f85\uff0c\u4e00\u4e2a Role \u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u529f\u80fd\u3002\u4f46\u5728\u6b64\u9700\u8981\u660e\u786e\u4e00\u4e2a\u5c42\u6b21\u4e0a\u7684\u6982\u5ff5\uff0cRole \u53ea\u662f\u7528\u4e8e\u7ec4\u7ec7\u4e00\u4e2a\u6216\u591a\u4e2a\u4efb\u52a1\uff0c\u539f\u6765\u5728 play \u7ea7\u522b\u4e2d\u4f7f\u7528 tasks \u6307\u4ee4\u6765\u5b9a\u4e49\u4efb\u52a1\uff0c\u73b0\u5728\u4f7f\u7528 roles \u6307\u4ee4\u6765\u5f15\u5165 Role \u4e2d\u5b9a\u4e49\u7684\u4efb\u52a1\u3002\u5f53\u7136\uff0croles \u6307\u4ee4\u548c tasks \u6307\u4ee4\u5e76\u4e0d\u51b2\u7a81\uff0c\u5b83\u4eec\u53ef\u4ee5\u5171\u5b58\u3002"),(0,s.kt)("p",null,"\u901a\u8fc7\u4e0b\u9762\u7684\u56fe\uff0c\u5e94\u80fd\u5e2e\u52a9\u7406\u89e3 Role \u7684\u89d2\u8272\u3002"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"ansible_playbook",src:a(59217).Z,width:"787",height:"511"})),(0,s.kt)("p",null,"\u65e2\u7136 Role \u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u4efb\u52a1\u4f53\u7cfb\uff0c\u62e5\u6709 Role \u4e4b\u540e\u5c31\u53ef\u4ee5\u53bb\u4f7f\u7528\u5b83\uff0c\u6216\u8005\u4e5f\u53ef\u4ee5\u5206\u53d1\u7ed9\u522b\u4eba\u4f7f\u7528\uff0c\u4f46\u662f\u4e00\u4e2a Role \u4ec5\u4ec5\u53ea\u662f\u76ee\u5f55\u800c\u5df2\uff0c\u5982\u4f55\u53bb\u4f7f\u7528\u8fd9\u4e2a Role \u5462\uff1f"),(0,s.kt)("p",null,"\u6240\u4ee5\uff0c\u8fd8\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u88ab ansible-playbook \u6267\u884c\u7684\u5165\u53e3 playbook \u6587\u4ef6(\u5c31\u50cf main() \u51fd\u6570\u4e00\u6837)\uff0c\u5728\u8fd9\u4e2a\u5165\u53e3\u6587\u4ef6\u4e2d\u5f15\u5165\u4e00\u4e2a\u6216\u591a\u4e2a roles \u76ee\u5f55\u4e0b\u7684 Role\u3002\u5165\u53e3\u6587\u4ef6\u7684\u540d\u79f0\u53ef\u4ee5\u968f\u610f\uff0c\u6bd4\u5982 www.yml\u3001site.yml\u3001main.yml \u7b49\uff0c\u4f46\u6ce8\u610f\u5b83\u4eec\u548c roles \u76ee\u5f55\u8981\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\u4e0b\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},".\n\u251c\u2500\u2500 enter.yml\n\u2514\u2500\u2500 roles\n    \u251c\u2500\u2500 first_role/\n    \u2514\u2500\u2500 second_role/\n")),(0,s.kt)("p",null,"\u4e0a\u9762\u548c roles \u540c\u76ee\u5f55\u7684 enter.yml \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff0c\u6b64\u6587\u4ef6\u4e2d\u4f7f\u7528 roles \u6307\u4ee4\u5f15\u5165\u4e86 roles \u76ee\u5f55\u5185\u7684\u4e24\u4e2a Role\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- name: play with role\n  hosts: nginx\n  gather_facts: false\n  roles: \n    - first_role\n    - second_role\n")),(0,s.kt)("p",null,"\u5982\u679c\u9075\u5faa\u4e86 Role \u89c4\u8303\uff0c\u5165\u53e3\u6587\u4ef6\u4e2d\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Role \u540d\u79f0\u6765\u5f15\u5165 roles \u76ee\u5f55\u4e0b\u7684 Role(\u6b63\u5982\u4e0a\u9762\u7684\u793a\u4f8b)\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a Role \u7684\u8def\u5f84\u6765\u5f15\u5165\u3002"),(0,s.kt)("h3",{id:"462\u5b9a\u4e49-role-\u7684-task"},"4.6.2\u3001\u5b9a\u4e49 Role \u7684 task"),(0,s.kt)("p",null,"Role \u7684\u4efb\u52a1\u5b9a\u4e49\u5728 roles/xxx/tasks/main.yml \u6587\u4ef6\u4e2d\uff0cmain.yml \u662f\u8be5 Role \u4efb\u52a1\u7684\u5165\u53e3\uff0c\u5728\u6267\u884c Role \u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u6267\u884c main.yml \u4e2d\u7684\u4efb\u52a1\u3002\u53ef\u4ee5\u76f4\u63a5\u5c06\u6240\u6709\u4efb\u52a1\u5b9a\u4e49\u5728\u6b64\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u5728\u5176\u5b83\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u5728 main.yml \u6587\u4ef6\u4e2d\u53bb\u5f15\u5165\u3002"),(0,s.kt)("p",null,"\u4ee5 first","_","role \u8fd9\u4e2a Role \u4e3a\u4f8b\uff0c\u4f8b\u5982\uff0c\u76f4\u63a5\u5c06\u4efb\u52a1\u5b9a\u4e49\u5728 main.yml \u6587\u4ef6\u4e2d\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: task in main.yml\n  debug:\n    msg: "task in main.yml"\n')),(0,s.kt)("p",null,"\u6216\u8005\uff0c\u5c06\u4efb\u52a1\u5b9a\u4e49\u5728 roles/xxx/tasks/ \u76ee\u5f55\u4e0b\u7684\u5176\u5b83\u6587\u4ef6\u4e2d\uff0c\u5982 mytask.yml\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: task in main.yml\n  debug:\n    msg: "task in main.yml"\n')),(0,s.kt)("p",null,"\u7136\u540e\u5728 roles/xxx/tasks/main.yml \u4e2d\u901a\u8fc7 include","_","tasks \u6216 import","_","tasks \u5f15\u5165\u5b83\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- include_tasks: mytask.yml\n# \u6216\u8005\n#- import_tasks: mytask.yml\n")),(0,s.kt)("p",null,"Role \u7684\u4efb\u52a1\u6587\u4ef6\u5b9a\u4e49\u597d\u540e\uff0c\u7136\u540e\u5728 Role \u7684\u5165\u53e3\u6587\u4ef6(\u5373 roles \u540c\u76ee\u5f55\u4e0b\u7684 playbook \u6587\u4ef6)enter.yml \u4e2d\u5f15\u5165\u8fd9\u4e2a Role\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- name: play1\n  hosts: localhost\n  gather_facts: false\n  roles: \n    - first_role\n")),(0,s.kt)("p",null,"\u6267\u884c\u5b83\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-playbook enter.yml\n")),(0,s.kt)("h3",{id:"463\u5b9a\u4e49-role-\u7684-handler"},"4.6.3\u3001\u5b9a\u4e49 Role \u7684 handler"),(0,s.kt)("p",null,"handler \u548c task \u7c7b\u4f3c\uff0c\u5b83\u5b9a\u4e49\u5728 roles/xxx/handlers/main.yml \u4e2d\uff0c\u5f53 Role \u7684 task \u89e6\u53d1\u4e86\u5bf9\u5e94\u7684 handler\uff0c\u4f1a\u81ea\u52a8\u6765\u6b64\u6587\u4ef6\u4e2d\u5bfb\u627e\u3002"),(0,s.kt)("p",null,"\u4ecd\u7136\u8981\u8bf4\u7684\u662f\uff0c\u53ef\u4ee5\u5c06 handler \u5b9a\u4e49\u5728\u5176\u5b83\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u5728 roles/xxx/handlers/main.yml \u4f7f\u7528 include","_","tasks \u6216 import","_","tasks \u6307\u4ee4\u6765\u5f15\u5165\uff0c\u800c\u4e14\u524d\u9762\u4e5f\u63d0\u5230\u8fc7\u8fd9\u4e24\u8005\u5728 handler \u4e0a\u7684\u533a\u522b\u548c\u6ce8\u610f\u4e8b\u9879\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\uff0croles/first","_","role/handlers/main.yml \u4e2d\u5b9a\u4e49\u4e86\u5982\u4e0b\u7b80\u5355\u7684 handler\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: handler for test\n  debug: \n    msg: "a simple handler for test"\n')),(0,s.kt)("p",null,"\u5728 roles/first","_","role/tasks/main.yml \u4e2d\u901a\u8fc7 notify \u89e6\u53d1\u8be5 Handler\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: task in main.yml\n  debug:\n    msg: "task in main.yml"\n  changed_when: true\n  notify: handler for test\n')),(0,s.kt)("p",null,"\u7136\u540e\u6267\u884c\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-playbook enter.yml\n")),(0,s.kt)("h3",{id:"464\u5b9a\u4e49-role-\u7684\u53d8\u91cf"},"4.6.4\u3001\u5b9a\u4e49 Role \u7684\u53d8\u91cf"),(0,s.kt)("p",null,"Role \u4e2d\u6709\u4e24\u4e2a\u5730\u65b9\u53ef\u4ee5\u5b9a\u4e49\u53d8\u91cf\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"roles/xxx/vars/main.yml"),(0,s.kt)("li",{parentName:"ul"},"roles/xxx/defaults/main.yml")),(0,s.kt)("p",null,"\u4ece\u76ee\u5f55\u540d\u79f0\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0cdefaults/main.yml \u4e2d\u7528\u4e8e\u5b9a\u4e49 Role \u7684\u9ed8\u8ba4\u53d8\u91cf\uff0c\u90a3\u4e48\u663e\u7136\uff0cvars/main.yml \u7528\u4e8e\u5b9a\u4e49\u5176\u4ed6\u53d8\u91cf\u3002"),(0,s.kt)("p",null,"\u8fd9\u4e24\u4e2a\u6587\u4ef6\u4e4b\u95f4\u7684\u533a\u522b\u5728\u4e8e\uff0cdefaults/main.yml \u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\u4f18\u5148\u7ea7\u4f4e\u4e8e vars/main.yml \u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u4e8b\u5b9e\u4e0a\uff0c defaults/main.yml \u4e2d\u7684\u53d8\u91cf\u4f18\u5148\u7ea7\u51e0\u4e4e\u662f\u6700\u4f4e\u7684\uff0c\u57fa\u672c\u4e0a\u5176\u5b83\u4efb\u4f55\u5730\u5b9a\u4e49\u7684\u53d8\u91cf\u90fd\u53ef\u4ee5\u8986\u76d6\u5b83\u3002"),(0,s.kt)("h3",{id:"465role-\u7528\u5230\u7684\u5916\u90e8\u6587\u4ef6\u548c\u6a21\u677f\u6587\u4ef6"},"4.6.5\u3001Role \u7528\u5230\u7684\u5916\u90e8\u6587\u4ef6\u548c\u6a21\u677f\u6587\u4ef6"),(0,s.kt)("p",null,"\u6709\u65f6\u5019\u9700\u8981\u5c06 Ansible \u7aef\u7684\u6587\u4ef6\u62f7\u8d1d\u5230\u8fdc\u7a0b\u8282\u70b9\u4e0a\uff0c\u6bd4\u5982\u62f7\u8d1d\u672c\u5730\u5df2\u7ecf\u5199\u597d\u7684 MySQL \u914d\u7f6e\u6587\u4ef6 my.cnf \u5230\u591a\u4e2a\u8fdc\u7a0b\u8282\u70b9\u4e0a\uff0c\u62f7\u8d1d\u672c\u5730\u5199\u597d\u7684\u811a\u672c\u6587\u4ef6\u5230\u591a\u4e2a\u8fdc\u7a0b\u8282\u70b9\u6267\u884c\uff0c\u7b49\u7b49\u3002"),(0,s.kt)("p",null,"\u8fd9\u65f6\u5019\u5728\u8fdb\u884c\u62f7\u8d1d\u7684\u6a21\u5757\u4e2d\u53ef\u4ee5\u6307\u5b9a\u8fd9\u4e9b\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u3002\u4f46\u5728 Role \u4e2d\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u6587\u4ef6\u653e\u5728 roles/xxx/files/ \u6216 roles/xxx/templates/ \u76ee\u5f55\u4e0b\uff0c\u9075\u5b88\u4e86\u8fd9\u4e2a Role \u89c4\u8303\uff0c\u5c31\u53ef\u4ee5\u5728\u6a21\u5757\u4e2d\u76f4\u63a5\u6307\u5b9a\u6587\u4ef6\u540d\u79f0\uff0c\u800c\u4e0d\u7528\u52a0\u4e0a\u8def\u5f84\u524d\u7f00(\u5f53\u7136\uff0c\u52a0\u4e0a\u4e5f\u4e0d\u4f1a\u9519)\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\uff0cRole \u4e2d\u6709\u4e00\u4e2a copy \u6a21\u5757\u7684\u4efb\u52a1\uff0c\u60f3\u8981\u62f7\u8d1d roles/first","_","role/files/my.cnf \u5230\u76ee\u6807\u8282\u70b9\u7684 /etc/my.cnf\uff0c\u5219\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yml"},"- name: copy file\n  copy:\n    src: my.cnf    # \u76f4\u63a5\u6307\u5b9a\u6587\u4ef6\u540dmy.cnf\u5373\u53ef\n    dest: /etc/my.cnf\n")),(0,s.kt)("p",null,"\u8fd9\u4e9b\u6a21\u5757\u77e5\u9053\u53bb roles/xxx/files/ \u76ee\u5f55\u6216 roles/xxx/templates/ \u4e0b\u641c\u7d22\u5bf9\u5e94\u6587\u4ef6\u7684\u539f\u56e0\uff0c\u5728\u4e8e\u8fd9\u4e9b\u6a21\u5757\u7684\u4ee3\u7801\u5185\u90e8\u5b9a\u4e49\u4e86\u6587\u4ef6\u641c\u7d22\u8def\u5f84\uff0c\u4e0d\u540c\u7684\u6a21\u5757\u641c\u7d22\u8def\u5f84\u4e0d\u540c\uff0c\u4e14\u53ef\u80fd\u4e0d\u6b62\u4e00\u4e2a\u641c\u7d22\u8def\u5f84\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\u5bf9\u4e8e Role \u4e2d\u7684 template \u6a21\u5757\u4efb\u52a1(template \u6a21\u5757\u76ee\u524d\u5c1a\u672a\u4ecb\u7ecd\uff0c\u4e4b\u540e\u9047\u5230\u7684\u65f6\u5019\u518d\u89e3\u91ca\uff0c\u6216\u8005\u5404\u4f4d\u53ef\u81ea\u641c\u5176\u7528\u6cd5\uff0c\u73b0\u5728\u5c06\u5176\u5f53\u4f5c copy \u6a21\u5757\u5373\u53ef)\uff0c\u5982\u679c\u5176\u53c2\u6570 src=my.cnf\uff0c\u5219\u4f9d\u6b21\u641c\u7d22\u5982\u4e0b\u8def\u5f84\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"roles/first_role/templates/my.cnf\nroles/first_role/my.cnf\nroles/first_role/tasks/templates/my.cnf\nroles/first_role/tasks/my.cnf\ntemplates/my.cnf\nmy.cnf\n")),(0,s.kt)("p",null,"\u4e00\u822c\u6765\u8bf4\uff0c\u9700\u8981\u8003\u8651\u6e90\u6587\u4ef6\u5b58\u653e\u4f4d\u7f6e\u7684\u6a21\u5757\u5305\u62ec copy\u3001script\u3001template \u6a21\u5757\uff0c\u524d\u4e24\u4e2a\u6a21\u5757\u4ee5\u53ca\u5176\u5b83\u53ef\u80fd\u7684\u6a21\u5757\uff0c\u4e00\u822c\u4f1a\u5148\u641c\u7d22 roles/xxx/files/ \u76ee\u5f55\uff0c\u4f46\u4e0d\u4f1a\u641c\u7d22 templates \u76ee\u5f55\uff0c\u800c template \u6a21\u5757\u5219\u4f1a\u5148\u641c\u7d22 templates \u76ee\u5f55\u800c\u4e0d\u4f1a\u641c\u7d22 files \u76ee\u5f55\u3002"),(0,s.kt)("p",null,"\u6362\u53e5\u8bdd\u8bf4\uff0c\u9664\u4e86 template \u6a21\u5757\u5916\uff0c\u5176\u5b83\u6a21\u5757\u4f7f\u7528\u5230\u7684\u6587\u4ef6\u5f88\u53ef\u80fd\u90fd\u5e94\u8be5\u5b58\u653e\u4e8e roles/xxx/files/ \u76ee\u5f55\u3002\u5982\u679c\u4e0d\u786e\u5b9a\u67d0\u4e2a\u6a21\u5757\u7684\u641c\u7d22\u8def\u5f84\uff0c\u6d4b\u8bd5\u4e00\u756a\u5373\u53ef\uff0c\u6216\u8005\u76f4\u63a5\u770b\u62a5\u9519\u4fe1\u606f\u4e2d\u7ed9\u51fa\u7684\u8def\u5f84\u641c\u7d22\u8fc7\u7a0b\u3002"),(0,s.kt)("h3",{id:"466role-\u4e2d\u5b9a\u4e49\u7684\u6a21\u5757\u548c\u63d2\u4ef6"},"4.6.6\u3001Role \u4e2d\u5b9a\u4e49\u7684\u6a21\u5757\u548c\u63d2\u4ef6"),(0,s.kt)("p",null,"\u5bf9\u4e8e\u7edd\u5927\u591a\u6570\u9700\u6c42\uff0c\u4f7f\u7528 Ansible \u5df2\u7ecf\u63d0\u4f9b\u7684\u6a21\u5757\u548c\u63d2\u4ef6\u5c31\u80fd\u89e3\u51b3\u95ee\u9898\uff0c\u4f46\u6709\u65f6\u5019\u786e\u5b9e\u6709\u4e9b\u9700\u6c42\u9700\u8981\u81ea\u5df1\u53bb\u5199\u6a21\u5757\u6216\u63d2\u4ef6\uff0cAnsible \u4e5f\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u6a21\u5757\u548c\u63d2\u4ef6\u3002"),(0,s.kt)("p",null,"\u5bf9\u4e8e Role \u6765\u8bf4\uff0c\u5982\u679c\u8fd9\u4e2a Role \u9700\u8981\u989d\u5916\u4f7f\u7528\u81ea\u5df1\u7f16\u5199\u7684\u6a21\u5757\u6216\u63d2\u4ef6\uff0c\u5219\u6a21\u5757\u653e\u5728 roles/xxx/librarys/ \u76ee\u5f55\u4e0b\uff0c\u800c\u63d2\u4ef6\u653e\u5728\u5404\u81ea\u5bf9\u5e94\u7c7b\u578b\u7684\u76ee\u5f55\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"roles/xxx/action_plugins/\nroles/xxx/lookup_plugins/\nroles/xxx/callback_plugins/\nroles/xxx/connection_plugins/\nroles/xxx/filter_plugins/\nroles/xxx/strategy_plugins/\nroles/xxx/cache_plugins/\nroles/xxx/test_plugins/\nroles/xxx/shell_plugins/\n")),(0,s.kt)("p",null,"\u4e00\u822c\u60c5\u51b5\u7528\u4e0d\u4e0a\u81ea\u5b9a\u4e49\u6a21\u5757\u6216\u63d2\u4ef6\uff0c\u76ee\u524d\u5404\u4f4d\u4e86\u89e3\u5373\u53ef\u3002"),(0,s.kt)("h3",{id:"467\u5b9a\u4e49-role-\u7684\u4f9d\u8d56\u5173\u7cfb"},"4.6.7\u3001\u5b9a\u4e49 Role \u7684\u4f9d\u8d56\u5173\u7cfb"),(0,s.kt)("p",null,"\u5f53\u6211\u4eec\u5b9a\u4e49\u591a\u4e2a Role \u5b9e\u73b0\u4e00\u4e2a\u9879\u76ee\u9700\u6c42\u65f6\uff0c\u8fd9\u4e9b Role \u4e4b\u95f4\u6216\u591a\u6216\u5c11\u5177\u6709\u4f9d\u8d56\u5173\u7cfb\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u6709\u7684 Role \u5fc5\u987b\u5148\u6267\u884c\uff0c\u53ea\u6709\u5b83\u6267\u884c\u5b8c\u4e86\u540e\uff0c\u4f9d\u8d56\u5b83\u7684 Role \u624d\u80fd\u63a5\u7740\u6267\u884c\u3002"),(0,s.kt)("p",null,"\u6309\u7167 Role \u89c4\u8303\uff0c\u88ab\u4f9d\u8d56\u7684\u5148\u884c\u4efb\u52a1\u90fd\u5b9a\u4e49\u5728 roles/xxx/meta/main.yml \u6587\u4ef6\u4e2d\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\ndependencies: \n  - second_role\n  - third_role\n")),(0,s.kt)("p",null,"\u6ce8\u610f\uff0cRole \u7684 dependencies \u6307\u4ee4\u53ea\u80fd\u6307\u5b9a\u88ab\u4f9d\u8d56\u7684 Role\uff0c\u4e0d\u80fd\u76f4\u63a5\u6307\u5b9a\u88ab\u4f9d\u8d56\u7684\u4efb\u52a1\u3002\u4f8b\u5982\uff0c\u4e0b\u9762\u662f\u9519\u8bef\u7684\u4f9d\u8d56\u5b9a\u4e49\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\ndependencies: \n  - debug: msg="check it"\n')),(0,s.kt)("p",null,"\u5f53\u771f\u6b63\u5f00\u59cb\u6267\u884c Role \u7684\u65f6\u5019\uff0c\u4f1a\u5148\u68c0\u67e5\u662f\u5426\u6709\u4f9d\u8d56\u4efb\u52a1\uff0c\u5982\u679c\u6709\uff0c\u5219\u5148\u6267\u884c\u4f9d\u8d56\u4efb\u52a1\uff0c\u4f9d\u8d56\u4efb\u52a1\u6267\u884c\u5b8c\u540e\u518d\u5f00\u59cb\u6267\u884c\u666e\u901a\u4efb\u52a1\u3002"),(0,s.kt)("h3",{id:"468\u52a8\u624b\u5199\u4e00\u4e2a-role"},"4.6.8\u3001\u52a8\u624b\u5199\u4e00\u4e2a Role"),(0,s.kt)("p",null,"\u4e86\u89e3\u5b8c Role \u5404\u4e2a\u76ee\u5f55\u548c\u6587\u4ef6\u7684\u610f\u4e49\u540e\uff0c\u53ef\u4ee5\u5f00\u59cb\u52a8\u624b\u5199\u4e00\u4e2a Role \u6765\u4f53\u9a8c\u4e00\u756a\u3002"),(0,s.kt)("p",null,"\u5c31\u4ee5 first","_","role \u4e3a\u4f8b\uff0c\u8fd9\u4e2a Role \u6ca1\u6709\u5177\u4f53\u7684\u529f\u80fd\uff0c\u5168\u90e8\u90fd\u662f debug \u6a21\u5757\u7684\u8c03\u8bd5\u4fe1\u606f\uff0c\u6240\u4ee5\u8fd9\u4e2a Role \u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u4e2a Role \u552f\u4e00\u7684\u610f\u4e49\u662f\uff1a\u5b66\u4f1a\u5199\u6700\u7b80\u5355\u7684 Role \u5e76\u770b\u61c2\u6267\u884c\u6d41\u7a0b\u3002"),(0,s.kt)("p",null,"\u9996\u5148\u5728 defaults/main.yml \u4e2d\u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf default","_","var\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\ndefault_var: default_value\n")),(0,s.kt)("p",null,"\u7136\u540e\u5728 vars/main.yml \u4e2d\u5b9a\u4e49\u4e24\u4e2a\u53d8\u91cf my","_","var \u548c default","_","var\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\nmy_var: my_value\ndefault_var: overrided_default_value\n")),(0,s.kt)("p",null,"\u663e\u7136 vars/main.yml \u4e2d\u7684 default","_","var \u4f1a\u8986\u76d6 defaults/main.yml \u4e2d\u7684 default","_","var\u3002"),(0,s.kt)("p",null,"\u5b9a\u4e49\u5b8c\u53d8\u91cf\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 task\u3001handler \u751a\u81f3 template \u6a21\u677f\u6587\u4ef6\u4e2d\u4f7f\u7528\u8fd9\u4e9b\u53d8\u91cf\u3002\u5f53\u7136\uff0c\u5728\u5b9e\u9645\u7f16\u5199 Role \u7684\u65f6\u5019\uff0c\u4e00\u822c\u4e0d\u53ef\u80fd\u9884\u5148\u77e5\u9053\u8981\u5b9a\u4e49\u54ea\u4e9b\u53d8\u91cf\uff0c\u901a\u5e38\u90fd\u662f\u5728\u7f16\u5199 task \u7684\u8fc7\u7a0b\u4e2d\u6765\u53d8\u91cf\u6587\u4ef6\u4e2d\u6dfb\u52a0\u53d8\u91cf\u7684\u3002"),(0,s.kt)("p",null,"\u7136\u540e\u662f tasks/main.yml \u6587\u4ef6\uff0c\u5728\u6b64\u6587\u4ef6\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u4f7f\u7528\u53d8\u91cf\u7684\u4efb\u52a1\uff0c\u5e76\u5f15\u5165\u4e86\u4e00\u4e2a\u5916\u90e8 task \u6587\u4ef6 t.yml\u3002\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: task1\n  debug: \n    msg: "task in my_var: {{my_var}}"\n\n- name: include t.yml\n  import_tasks: t.yml\n')),(0,s.kt)("p",null,"\u5728 t.yml \u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u4efb\u52a1\uff0c\u4e14\u901a\u8fc7 notify \u89e6\u53d1\u4e00\u4e2a handler\uff0c\u5176\u5185\u5bb9\u4e3a\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: task in t.yml\n  debug: \n    msg: "default_var: {{default_var}}"\n  changed_when: true\n  notify: "go to handler"\n')),(0,s.kt)("p",null,"\u7136\u540e\u53bb handlers/main.yml \u4e2d\u5b9a\u4e49\u5bf9\u5e94\u7684 handler \u5373\u53ef\uff0c\u5176\u5185\u5bb9\u4e3a\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- name: go to handler\n  debug: \n    msg: "new_var: {{new_var}}"\n')),(0,s.kt)("p",null,"\u8fd9\u4e2a Role \u5c31\u8fd9\u4e48\u7b80\u5355\uff0c\u56e0\u4e3a\u6ca1\u6709\u5b9a\u4e49\u4f9d\u8d56\u5173\u7cfb\uff0c\u4e5f\u6ca1\u6709\u62f7\u8d1d\u6587\u4ef6\uff0c\u6240\u4ee5 roles/first","_","role/{meta,files,templates} \u8fd9\u4e09\u4e2a\u76ee\u5f55\u90fd\u53ef\u4ee5\u5220\u6389\u3002"),(0,s.kt)("p",null,"\u5199\u597d Role \u540e\uff0c\u518d\u63d0\u4f9b\u4e00\u4e2a\u88ab ansible-playbook \u547d\u4ee4\u6267\u884c\u7684\u5165\u53e3 playbook \u6587\u4ef6\uff0c\u7136\u540e\u5728\u6b64 playbook \u6587\u4ef6\u4e2d\u53bb\u52a0\u8f7d\u5bf9\u5e94\u7684 Role \u5e76\u6267\u884c\u3002\u4f8b\u5982\uff0c\u8fd9\u4e2a\u5165\u53e3\u6587\u4ef6\u540d\u4e3a enter.yml\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- name: play1\n  hosts: localhost\n  gather_facts: false\n  roles: \n    - role: first_role\n      vars: \n        new_var: new_value\n")),(0,s.kt)("p",null,"\u6700\u540e\u6267\u884c\u8be5\u5165\u53e3\u6587\u4ef6\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'$ ansible-playbook enter.yml\n\nPLAY [play1] ****************************************\nTASK [first_role : task1] ***************************\nok: [localhost] => {\n    "msg": "task in my_var: my_value"\n}\n\nTASK [first_role : task in t.yml] *******************\nchanged: [localhost] => {\n    "msg": "default_var: overrided_default_value"\n}\n\nRUNNING HANDLER [first_role : go to handler] ********\nok: [localhost] => {\n    "msg": "new_var: new_value"\n}\n')),(0,s.kt)("h2",{id:"47\u4f7f\u7528-role"},"4.7\u3001\u4f7f\u7528 Role"),(0,s.kt)("p",null,"\u5199\u597d Role \u4e4b\u540e\u5c31\u662f\u4f7f\u7528 Role\uff0c\u5373\u5728\u4e00\u4e2a\u5165\u53e3 playbook \u6587\u4ef6\u4e2d\u53bb\u52a0\u8f7d Role\u3002\u52a0\u8f7d Role \u7684\u65b9\u5f0f\u6709\u591a\u79cd\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"roles \u6307\u4ee4\uff1aplay \u7ea7\u522b\u7684\u6307\u4ee4\uff0c\u5728 playbook \u89e3\u6790\u9636\u6bb5\u52a0\u8f7d\u5bf9\u5e94\u6587\u4ef6\uff0c\u8fd9\u662f\u4f20\u7edf\u7684\u5f15\u5165 Role \u7684\u65b9\u5f0f\u3002"),(0,s.kt)("li",{parentName:"ul"},"import","_","role \u6307\u4ee4\uff1atask \u7ea7\u522b\u7684\u6307\u4ee4\uff0c\u5728 playbook \u89e3\u6790\u9636\u6bb5\u52a0\u8f7d\u5bf9\u5e94\u6587\u4ef6\u3002"),(0,s.kt)("li",{parentName:"ul"},"include","_","role \u6307\u4ee4\uff1atask \u7ea7\u522b\u7684\u6307\u4ee4\uff0c\u5728\u9047\u5230\u8be5\u6307\u4ee4\u7684\u65f6\u5019\u624d\u52a0\u8f7d Role \u5bf9\u5e94\u6587\u4ef6\u3002")),(0,s.kt)("p",null,"\u4f8b\u5982\u524d\u9762\u4f7f\u7528\u7684\u662f roles\uff0c\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- name: play1\n  hosts: localhost\n  gather_facts: false\n  roles: \n    - first_role\n")),(0,s.kt)("p",null,"\u4e0a\u9762\u901a\u8fc7 roles \u6307\u4ee4\u6765\u5b9a\u4e49\u8981\u89e3\u6790\u548c\u6267\u884c\u7684 Role\uff0c\u53ef\u4ee5\u540c\u65f6\u6307\u5b9a\u591a\u4e2a Role\uff0c\u4e14\u4e5f\u53ef\u4ee5\u52a0\u4e0a role:\u53c2\u6570\uff0c\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"roles: \n  - first_role\n  - role: seconde_role\n  - role: third_role\n")),(0,s.kt)("p",null,"\u4e5f\u53ef\u4ee5\u4f7f\u7528 include","_","role \u548c import","_","role \u6765\u5f15\u5165 Role\uff0c\u4f46\u9700\u6ce8\u610f\uff0c\u8fd9\u4e24\u4e2a\u6307\u4ee4\u662f tasks \u7ea7\u522b\u7684\uff0c\u4e5f\u6b63\u56e0\u4e3a\u5b83\u4eec\u662f task \u7ea7\u522b\uff0c\u4f7f\u5f97\u5b83\u4eec\u53ef\u4ee5\u548c\u5176\u5b83 task \u5171\u5b58\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- hosts: localhost\n  gather_facts: false\n  tasks:\n  - debug:\n      msg: "before first role"\n  - import_role:\n      name: first_role\n  - include_role:\n      name: second_role\n  - debug:\n      msg: "after second role"\n')),(0,s.kt)("p",null,"\u8fd9\u4e09\u79cd\u5f15\u5165 Role \u7684\u65b9\u5f0f\u90fd\u53ef\u4ee5\u4e3a\u5bf9\u5e94\u7684 Role \u4f20\u9012\u53c2\u6570\uff0c\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},'---\n- hosts: localhost\n  gather_facts: false\n  roles: \n    - role: first_role\n      varvar: "valuevalue"\n      vars: \n        var1: value1\n\n  tasks:\n  - import_role:\n      name: second_role\n    vars: \n      var1: value1\n  - include_role:\n      name: third_role\n    vars: \n      var1: value1\n')),(0,s.kt)("p",null,"\u6709\u65f6\u5019\u9700\u8981\u8ba9\u67d0\u4e2a Role \u6309\u9700\u6267\u884c\uff0c\u6bd4\u5982\u5bf9\u4e8e\u76ee\u6807\u8282\u70b9\u662f CentOS 7 \u65f6\u6267\u884c Role7 \u800c\u4e0d\u6267\u884c Role6\uff0c\u76ee\u6807\u8282\u70b9\u662f CentOS 6 \u65f6\u6267\u884c Role6 \u800c\u4e0d\u662f Role7\uff0c\u8fd9\u53ef\u4ee5\u4f7f\u7528 when \u6307\u4ee4\u6765\u63a7\u5236\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- hosts: localhost\n  gather_facts: false\n  roles: \n    # \u4e0b\u9762\u662f\u7b49\u4ef7\u7684\uff0c\u5206\u522b\u91c7\u7528YAML\u548cJson\u8bed\u6cd5\u4e66\u5199\n    - role: first_role\n      when: xxx\n    - {role: ffirst_role, when: xxx}\n  tasks:\n  - import_role:\n      name: second_role\n    when: xxx\n  - include_role:\n      name: third_role\n    when: xxx\n")),(0,s.kt)("p",null,"\u6ce8\u610f\uff0c\u5728 roles\u3001import","_","role \u548c include","_","role \u4e09\u79cd\u65b9\u5f0f\u4e2d\uff0cwhen \u6307\u4ee4\u7684\u5c42\u6b21\u3002"),(0,s.kt)("h2",{id:"48\u67e5\u770b\u4efb\u52a1\u548c\u6253\u6807\u7b7e-tags"},"4.8\u3001\u67e5\u770b\u4efb\u52a1\u548c\u6253\u6807\u7b7e tags"),(0,s.kt)("p",null,"\u6709\u65f6\u5019 Role \u6587\u4ef6\u6bd4\u8f83\u591a\uff0c\u76f8\u4e92\u8c03\u7528\u6709\u4e9b\u590d\u6742\uff0c\u901a\u8fc7\u67e5\u770b\u6587\u4ef6\u60f3\u77e5\u9053\u6267\u884c\u6d41\u7a0b\u6709\u70b9\u56f0\u96be\uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 ansible-playbook --list-tasks \u67e5\u770b\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"[root@controller ~]# ansible-playbook --list-tasks sshd_config.yml \n\nplaybook: sshd_config.yml\n\n  play #1 (new): modify sshd_config TAGS: []\n    tasks:\n      backup sshd config    TAGS: []\n      disable root login    TAGS: []\n      disable password auth TAGS: []\n")),(0,s.kt)("p",null,"\u4ece\u7ed3\u679c\u4e2d\u8fd8\u770b\u5230 play \u548c task \u7684\u540e\u9762\u90fd\u5e26\u6709 TAGS: ","[","]","\uff0c\u5b83\u662f\u6807\u7b7e\u3002\u5f53\u5728 play \u6216 task \u7ea7\u522b\u4f7f\u7528 tags \u6307\u4ee4\u540e\u5c31\u8868\u793a\u4e3a\u6b64 play \u6216 task \u6253\u4e86\u6807\u7b7e\u3002"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"\u53ef\u4ee5\u5728 task \u7ea7\u522b\u4e3a\u5355\u4e2a\u4efb\u52a1\u6253\u4e00\u4e2a\u6216\u591a\u4e2a\u6807\u7b7e\uff0c\u591a\u4e2a\u4efb\u52a1\u53ef\u4ee5\u6253\u540c\u4e00\u4e2a\u6807\u7b7e\u540d\u3002"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: yum install ntp\n yum: \n   name: ntp\n   state: present\n tags: \n   - initialize\n   - pkginstall\n   - ntp\n\n- name: started ntpd\n service:\n   name: ntpd\n   state: started\n tags: \n   - ntp\n   - initialize\n")),(0,s.kt)("p",{parentName:"li"},"\u5f53\u4efb\u52a1\u5177\u6709\u4e86\u6807\u7b7e\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 ansible-playbook \u547d\u4ee4\u884c\u4e2d\u4f7f\u7528 --tags \u6765\u6307\u5b9a\u53ea\u6709\u5e26\u6709\u67d0\u6807\u8bb0\u7684\u4efb\u52a1\u624d\u6267\u884c\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 --skip-tags \u9009\u9879\u660e\u786e\u6307\u5b9a\u4e0d\u8981\u6267\u884c\u67d0\u4e2a\u4efb\u52a1\u3002"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'# \u53ea\u6267\u884c\u7b2c\u4e00\u4e2a\u4efb\u52a1\n$ ansible-playbook test.yml --tags "pkginstall"\n\n# \u4e24\u4e2a\u4efb\u52a1\u90fd\u6267\u884c\n$ ansible-playbook test.yml --tags "ntp,initialize"\n\n# \u7b2c\u4e00\u4e2a\u4efb\u52a1\u4e0d\u6267\u884c\n$ ansible-playbook test.yml --skip-tags "pkginstall"\n')),(0,s.kt)("p",{parentName:"li"},"\u5982\u679c\u60f3\u8981\u786e\u5b9a tag \u7b5b\u9009\u4e4b\u540e\u4f1a\u6267\u884c\u54ea\u4e9b\u4efb\u52a1\uff0c\u52a0\u4e0a --list-tasks \u5373\u53ef\uff1a"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'$ ansible-playbook test.yml --tags "ntp" --list-tasks\n'))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"\u53ef\u4ee5\u5728 play \u7ea7\u522b\u6253\u6807\u7b7e\uff0c\u8fd9\u7b49\u4ef7\u4e8e\u5bf9 play \u4e2d\u7684\u6240\u6709\u4efb\u52a1\u90fd\u6253\u4e0a\u6807\u7b7e\u3002"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: play1\n hosts: localhost\n gather_facts: false\n tags: \n   - tag1\n   - tag2\n pre_tasks:\n   - debug: \"msg='pre_task1'\"\n   - debug: \"msg='pre_task2'\"\n tasks: \n   - debug: \"msg='task1'\"\n   - debug: \"msg='task2'\"\n")),(0,s.kt)("p",{parentName:"li"},"\u8fd9\u4f1a\u4e3a 4 \u4e2a\u4efb\u52a1\u90fd\u6253 tag1 \u548c tag2 \u6807\u7b7e\u3002"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-playbook a.yml --list-tasks\n\nplaybook: a.yml\n\n play #1 (localhost): play1    TAGS: [tag1,tag2]\n   tasks:\n     debug     TAGS: [tag1, tag2]\n     debug     TAGS: [tag1, tag2]\n     debug     TAGS: [tag1, tag2]\n     debug     TAGS: [tag1, tag2]\n"))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"\u5728\u9759\u6001\u52a0\u8f7d\u6587\u4ef6\u7684\u6307\u4ee4\u4e0a\u6253\u6807\u7b7e\uff0c\u7b49\u4ef7\u4e8e\u4e3a\u6240\u52a0\u8f7d\u6587\u4ef6\u4e2d\u6240\u6709\u5b50\u4efb\u52a1\u6253\u6807\u7b7e\u3002\u5728\u52a8\u6001\u52a0\u8f7d\u6587\u4ef6\u7684\u6307\u4ee4\u4e0a\u6253\u6807\u7b7e\uff0c\u4e0d\u4f1a\u4e3a\u5b50\u4efb\u52a1\u6253\u6807\u7b7e\uff0c\u800c\u662f\u4e3a\u7236\u4efb\u52a1\u81ea\u8eab\u6253\u6807\u7b7e\u3002"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"\u9759\u6001\u52a0\u8f7d\u7684\u6307\u4ee4\u6709\uff1aroles\u3001include\u3001import","_","tasks\u3001import","_","role\n"),(0,s.kt)("li",{parentName:"ul"},"\u52a8\u6001\u52a0\u8f7d\u7684\u6307\u4ee4\u53ea\u6709include","_","xxx\uff0c\u5305\u62ecinclude","_","tasks\u3001include","_","role\n")),(0,s.kt)("p",{parentName:"li"},"import","_","playbook \u548c include","_","playbook \u56e0\u4e3a\u672c\u8eab\u5c31\u662f play \u7ea7\u522b\u6216\u9ad8\u4e8e play \u7ea7\u522b\uff0c\u6240\u4ee5\u4e0d\u80fd\u4e3a\u8fd9\u4e24\u4e2a\u6307\u4ee4\u6253\u6807\u7b7e\u3002"),(0,s.kt)("p",{parentName:"li"},"\u4f8b\u5982\uff0c\u5728 b.yml \u6587\u4ef6\u4e2d\u6709\u4e24\u4e2a\u4efb\u52a1\uff1a"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- debug: \"msg='task1 in b.yml'\"\n- debug: \"msg='task2 in b.yml'\"\n")),(0,s.kt)("p",{parentName:"li"},"\u5728 c.yml \u4e2d\u4e5f\u6709\u4e24\u4e2a\u4efb\u52a1\uff1a"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n- debug: \"msg='task1 in c.yml'\"\n- debug: \"msg='task2 in c.yml'\"\n")),(0,s.kt)("p",{parentName:"li"},"\u7136\u540e\u5728 a.yml \u4e2d\u5206\u522b\u4f7f\u7528 import","_","tasks \u6307\u4ee4\u5f15\u5165 b.yml\uff0c\u4f7f\u7528 include","_","tasks \u6307\u4ee4\u5f15\u5165 c.yml\uff0c\u540c\u65f6\u4e3a\u8fd9\u4e24\u4e2a\u6307\u4ee4\u6253\u6807\u7b7e\uff1a"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: play1\n hosts: localhost\n gather_facts: false\n\n tasks: \n   - import_tasks: b.yml\n     tags: [tag1,tag2]\n\n   - include_tasks: c.yml\n     tags: [tag3,tag4]\n")),(0,s.kt)("p",{parentName:"li"},"\u8fd9\u4f1a\u4e3a b.yml \u4e2d\u7684\u4e24\u4e2a\u4efb\u52a1\u6253\u4e0a tag1 \u548c tag2 \u6807\u7b7e\uff0c\u8fd8\u4f1a\u4e3a a.yml \u4e2d\u7684 include","_","tasks \u4efb\u52a1\u81ea\u8eab\u6253\u4e0a\u6807\u7b7e tag3 \u548c tag4\u3002"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-playbook a.yml --list-tasks\n\nplaybook: a.yml\n\n play #1 (localhost): play1    TAGS: []\n   tasks:\n     debug     TAGS: [tag1, tag2]\n     debug     TAGS: [tag1, tag2]\n     include_tasks     TAGS: [tag3, tag4]\n")))),(0,s.kt)("h2",{id:"49ansible-galaxy"},"4.9\u3001Ansible Galaxy"),(0,s.kt)("p",null,"\u5f88\u591a\u65f6\u5019\u6211\u4eec\u60f3\u8981\u5b9e\u73b0\u7684 Ansible \u90e8\u7f72\u9700\u6c42\u5176\u5b9e\u522b\u4eba\u5df2\u7ecf\u5199\u597d\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u81ea\u5df1\u4e0d\u7528\u518d\u52a8\u624b\u5199(\u751a\u81f3\u4e0d\u5e94\u8be5\u81ea\u5df1\u5199)\uff0c\u76f4\u63a5\u53bb\u7f51\u4e0a\u627e\u522b\u4eba\u5df2\u7ecf\u5199\u597d\u7684\u8f6e\u5b50\u5373\u53ef\u3002"),(0,s.kt)("p",null,"Ansible Galaxy(",(0,s.kt)("a",{parentName:"p",href:"https://galaxy.ansible.com/"},"https://galaxy.ansible.com/)\u662f\u4e00\u4e2a"),"%E6%98%AF%E4%B8%80%E4%B8%AA) Ansible \u5b98\u65b9\u7684 Role \u4ed3\u5e93\uff0c\u4e16\u754c\u5404\u5730\u7684\u4eba\u90fd\u5728\u91cc\u9762\u5206\u4eab\u81ea\u5df1\u5199\u597d\u7684 Role\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u53bb Galaxy \u4e0a\u641c\u7d22\u662f\u5426\u6709\u81ea\u5df1\u60f3\u8981\u7684 Role\uff0c\u5982\u679c\u6709\u7b26\u5408\u81ea\u5df1\u5fc3\u610f\u7684\uff0c\u76f4\u63a5\u5b89\u88c5\u4fbf\u53ef\u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u5199\u597d\u7684 Role \u5206\u4eab\u51fa\u53bb\u7ed9\u522b\u4eba\u4f7f\u7528\u3002"),(0,s.kt)("p",null,"Ansible \u63d0\u4f9b\u4e86\u4e00\u4e2a ansible-galaxy \u547d\u4ee4\u884c\u5de5\u5177\uff0c\u53ef\u4ee5\u5feb\u901f\u521b\u5efa\u3001\u5b89\u88c5\u3001\u7ba1\u7406\u7531\u8be5\u5de5\u5177\u7ef4\u62a4\u7684 Role\u3002\u5b83\u5e38\u7528\u7684\u547d\u4ee4\u6709\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5b89\u88c5Role:\nansible-galaxy install username.role_name\n\n# \u79fb\u9664Role:\nansible-galaxy remove username.role_name\n\n# \u5217\u51fa\u5df2\u5b89\u88c5\u7684Role:\nansible-galaxy list\n\n# \u67e5\u770bRole\u4fe1\u606f:\nansible-galaxy info username.role_name\n\n# \u641c\u7d22Role:\nansible-galaxy search role_name\n\n# \u521b\u5efaRole\nansible-galaxy init role_name\n\n# \u6b64\u5916\u8fd8\u6709\uff1a'delete','import', 'setup', 'login'\n# \u5b83\u4eec\u90fd\u7528\u4e8e\u7ba1\u7406galaxy.ansible.com\u4e2a\u4eba\u8d26\u6237\u6216\u91cc\u9762\u7684Role\n# \u65e0\u89c6\u5b83\u4eec\n")),(0,s.kt)("p",null,"\u4f8b\u5982\uff0c\u524d\u9762\u5df2\u7ecf\u7528\u8be5\u547d\u4ee4\u5feb\u901f\u521b\u5efa\u8fc7\u4e00\u4e2a Role\uff0c\u514d\u53bb\u4e86\u624b\u52a8\u521b\u5efa Role \u7684\u4e00\u5806\u76ee\u5f55\u548c\u6587\u4ef6\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-galaxy init --init-path /etc/ansible/roles first_role\n")),(0,s.kt)("p",null,"\u5f53\u4ece Galaxy \u4e2d\u641c\u7d22\u5230\u4e86 Role \u4e4b\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 ansible-galaxy install author.rolename \u6765\u5b89\u88c5\uff0c\u4e4b\u6240\u4ee5\u8981\u52a0\u4e0a\u4f5c\u8005\u540d author\uff0c\u662f\u56e0\u4e3a\u4e0d\u540c\u7684\u4eba\u53ef\u80fd\u4f1a\u4e0a\u4f20\u540d\u79f0\u76f8\u540c\u7684 Role\u3002"),(0,s.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cansible-galaxy install\u5b89\u88c5Role\u7684\u4f4d\u7f6e\u987a\u5e8f\u662f\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"~/.ansible/roles")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"/usr/share/ansible/roles")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"/etc/ansible/roles"))),(0,s.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528 -p \u6216 --roles-path \u9009\u9879\u6307\u5b9a\u5b89\u88c5\u8def\u5f84\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-galaxy install -p roles/ chusiang.helloworld\n")),(0,s.kt)("p",null,"\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a Role\u3002\u4f8b\u5982\uff0c\u521b\u5efa\u4e00\u4e2a enter.yml \u6587\u4ef6\uff0c\u5e76\u5728\u6b64\u6587\u4ef6\u4e2d\u5f15\u5165\u8be5 Role\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"--- \n- name: role from galaxy\n  hosts: localhost\n  gather_facts: false\n  roles: \n    - role: chusiang.helloworld\n")),(0,s.kt)("p",null,"\u7136\u540e\u6267\u884c\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-playbook enter.yml\n")),(0,s.kt)("p",null,"\u867d\u7136 Ansible Galaxy \u4e2d\u6709\u5927\u91cf\u7684 Role\uff0c\u4f46\u6709\u65f6\u5019\u6211\u4eec\u4e5f\u4f1a\u5728 Github \u4e0a\u641c\u7d22 Role\uff0c\u800c\u4e14 Galaxy \u4ed3\u5e93\u4e0a\u7684 Role \u5927\u591a\u4e5f\u90fd\u5728 Github \u4e0a\u3002ansible-galaxy install \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4ece git \u4e0a\u4e0b\u8f7d\u5b89\u88c5 Role\u3002"),(0,s.kt)("p",null,"\u4f8b\u5982\uff0c\u4e0a\u9762 \u201dhelloworld\u201d Role \u5b58\u653e\u5728",(0,s.kt)("a",{parentName:"p",href:"https://github.com/chusiang/helloworld.ansible.role%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BB%8E"},"https://github.com/chusiang/helloworld.ansible.role\uff0c\u76f4\u63a5\u4ece")," github \u4e0a\u5b89\u88c5\u5b83\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"$ ansible-galaxy install -p roles/ git+https://github.com/chusiang/helloworld.ansible.role.git\n")),(0,s.kt)("h2",{id:"410\u7efc\u5408\u6848\u4f8b"},"4.10\u3001\u7efc\u5408\u6848\u4f8b"),(0,s.kt)("p",null,"\u53c2\u89c1 ",(0,s.kt)("a",{parentName:"p",href:"https://www.brinnatt.com/supplement/%E7%AC%AC-b-%E7%AB%A0-ansible-lnmp-%E6%A1%88%E4%BE%8B/"},"LNMP \u5b9e\u8df5")))}c.isMDXComponent=!0},59217:function(l,e,a){e.Z=a.p+"assets/images/ansible_playbook-a65d573c4370bb0421c31a527be7fdb9.png"}}]);