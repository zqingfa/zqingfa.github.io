<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-linux/primary/linux-primary-9">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">第 9 章 Linux 进程和信号 - Linux技术分享</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zhangqf.com/en/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://zhangqf.com/en/img/logo.png"><meta data-rh="true" property="og:url" content="https://zhangqf.com/en/docs/linux-primary-9"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="第 9 章 Linux 进程和信号 - Linux技术分享"><meta data-rh="true" name="description" content="9.1、进程概念"><meta data-rh="true" property="og:description" content="9.1、进程概念"><meta data-rh="true" name="keywords" content="linux,process,Signal"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhangqf.com/en/docs/linux-primary-9"><link data-rh="true" rel="alternate" href="https://zhangqf.com/en/docs/linux-primary-9" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-primary-9" hreflang="zh"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-primary-9" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9B0V5WT2X8-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Linux技术分享" href="/en/opensearch.xml">
<link rel="preconnect" href="https://zhangqf.com/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://zhangqf.com/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c9a3849aa75f9c4a4e65f846cd1a5155",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/en/rss.xml" title="zhangqf RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/atom.xml" title="zhangqf Atom Feed">
<link rel="alternate" type="application/json" href="/en/feed.json" title="zhangqf JSON Feed">

<link rel="icon" href="/en/img/logo.png">
<link rel="manifest" href="/en/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><link rel="stylesheet" href="/en/assets/css/styles.86c9ae18.css">
<link rel="preload" href="/en/assets/js/runtime~main.06ffa367.js" as="script">
<link rel="preload" href="/en/assets/js/main.7f2e5564.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>更新 <a href="/website">网址导航</a> 带你发现感兴趣的技术</span></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">kuizuo</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/en/docs/linux">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/category/Linux基础">Linux 基础</a></li><li><a class="dropdown__link" href="/en/docs/category/Linux进阶">Linux 进阶</a></li><li><a class="dropdown__link" href="/en/docs/category/Linux测试">Linux 测试</a></li><li><a class="dropdown__link" href="/en/docs/category/LinuxCICD">Linux CICD研发</a></li><li><a class="dropdown__link" href="/en/docs/skill/">Notes</a></li><li><a class="dropdown__link" href="/en/docs/tools/">Recommended Tools</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Blog</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/tags">Tags</a></li><li><a class="dropdown__link" href="/en/archive">Archive</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Tools</a><ul class="dropdown__menu"><li><a href="https://api.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">API Service</a></li><li><a href="https://js-de-obfuscator.vercel.app" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS Deobfuscate</a></li><li><a href="https://cipher.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">CyberChef Encryption</a></li><li><a href="https://pan.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">Cloudreve</a></li></ul></div><a class="navbar__item navbar__link" href="/en/website">Links</a><a class="navbar__item navbar__link" href="/en/project">Projects</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/en/"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"><b>kuizuo</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/linux">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/docs/category/linux基础">Linux基础</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux基础&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-1">第 1 章 Linux 基础命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-2">第 2 章 Linux 系统用户</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-3">第 3 章 Linux 文件权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-4">第 4 章 Linux ext 文件系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-5">第 5 章 Linux 磁盘管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-6">第 6 章 Linux LVM 存储管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-7">第 7 章 Linux Raid 存储管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-8">第 8 章 Linux 包管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/linux-primary-9">第 9 章 Linux 进程和信号</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-10">第 10 章 Linux 系统资源监控</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-11">第 11 章 Linux 服务管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-12">第 12 章 Linux 定时任务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-13">第 13 章 Linux 网络管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-14">第 14 章 Linux 开机启动流程(UEFI+systemd)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux进阶">Linux进阶</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux进阶&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux测试">Linux测试</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux测试&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linuxcicd">LinuxCICD</a><button aria-label="Toggle the collapsible sidebar category &#x27;LinuxCICD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/category/linux基础"><span itemprop="name">Linux基础</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第 9 章 Linux 进程和信号</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>第 9 章 Linux 进程和信号</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="91进程概念">9.1、进程概念<a class="hash-link" href="#91进程概念" title="Direct link to heading">​</a></h2><p>进程是一个复杂而且比较抽象的概念，涉及的内容也非常多。对于开发者来说，比较关心的问题是自己写得程序运行效率是否高效，那就必须对进程的理解要足够到位。程序设计使用进程还是轻量级线程，设计的思想是使用同步还是异步，阻塞还是非阻塞，这些都对程序的性能有不同程度的影响。</p><p>对于运维者来说，涉及到某个特定的项目，一定是整合了大量的程序，来适应不同层次不同角度的客户需求。这个时候我们需要对这个正在运行的程序进行监控收集，调优排错，这都是比较高级的技能，如果对进程的运行不够了解，是很难下手的，也决不能轻易下手。</p><p>所以无论是开发人员还是运维人员，只要是对程序的性能有要求，那是逃不过对进程的深入学习的，本章节会涉及到很多概念，好比武侠小说里面的内功心法一样，内力纯厚，也就不在乎使用什么工具招式，飞沙走石亦是剑。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="911进程和程序">9.1.1、进程和程序<a class="hash-link" href="#911进程和程序" title="Direct link to heading">​</a></h3><p>程序是二进制文件，是静态存放在磁盘上的，不会占用系统运行资源(cpu/内存)。</p><p>进程是用户执行程序或者触发程序的结果，可以认为进程是程序的一个运行实例。进程是动态的，会申请和使用系统资源，并与操作系统内核进行交互。在后文中，不少状态统计工具的结果中显示的是 system 类的状态，其实 system 状态的同义词就是内核状态。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="912多任务和-cpu-时间片">9.1.2、多任务和 CPU 时间片<a class="hash-link" href="#912多任务和-cpu-时间片" title="Direct link to heading">​</a></h3><p>现在所有的操作系统都能 &quot;同时&quot; 运行多个进程，也就是多任务或者说是并行执行。但实际上这是人类的错觉，一颗物理 cpu 在同一时刻只能运行一个进程，只有多颗物理 cpu 才能真正意义上实现多任务。</p><p>人类会产生错觉，以为操作系统能并行做几件事情，这是通过在极短时间内进行进程间切换实现的，因为时间极短，前一刻执行的是进程 A，下一刻切换到进程 B，不断的在多个进程间进行切换，使得人类以为在同时处理多件事情。</p><p>不过，cpu 如何选择下一个要执行的进程，这是一件非常复杂的事情。在 Linux 上，决定下一个要运行的进程是通过 &quot;调度类&quot;(调度程序) 来实现的。程序何时运行，由进程的优先级决定，但要注意，优先级值越低，优先级就越高，就越快被调度类选中。</p><p>除此之外，优先级还影响分配给进程的时间片长短。在 Linux 中，改变进程的 nice 值，可以影响某类进程的优先级值。</p><p>有些进程比较重要，要让其尽快完成，有些进程则比较次要，早点或晚点完成不会有太大影响，所以操作系统要能够知道哪些进程比较重要，哪些进程比较次要。比较重要的进程，应该多给它分配一些 cpu 的执行时间，让其尽快完成。下图是 cpu 时间片的概念。</p><p><img loading="lazy" alt="cpu time slice" src="/en/assets/images/CPU time slice-38ce51dea6a1d9d4bbfba4fb63893af7.png" width="714" height="565" class="img_ev3q"></p><p>由此可以知道，所有的进程都有机会运行，但重要的进程总是会获得更多的 cpu 时间，这种方式是 &quot;抢占式多任务处理&quot;：内核可以强制在时间片耗尽的情况下收回 cpu 使用权，并将 cpu 交给调度类选中的进程，此外，在某些情况下也可以直接抢占当前运行的进程。</p><p>进程进行到某个阶段时，有可能会发起 IO 请求，到磁盘上拿数据，这个过程相对 CPU 来说很漫长，该进程暂时进入睡眠状态等待数据完成复制，然后被唤醒。这个过程中会把 CPU 时间片让出来给别的进程使用。这只是其中一种情况，让不让别的进程插进来，都是由调度器算法实现的。</p><p>但因为前面的进程还没有完成，在未来某个时候调度类还是会选中它，所以内核应该将每个进程临时停止时的运行时环境(寄存器中的内容和页表)保存下来(保存位置为内核占用的内存)，这称为保护现场，在下次进程恢复运行时，将原来的运行时环境加载到 cpu 上，这称为恢复现场，这样 cpu 可以在当初的运行时环境下继续执行。</p><p>调度类选中了下一个要执行的进程后，要进行底层的任务切换，也就是上下文切换，这一过程需要和 cpu 进程紧密的交互。进程切换不应太频繁，也不应太慢。切换太频繁将导致 cpu 闲置在保护和恢复现场的时间过长，保护和恢复现场对人类或者进程来说是没有产生生产力的(因为它没有在执行程序)。切换太慢将导致进程调度切换慢，很可能下一个进程要等待很久才能轮到它执行，直白的说，如果你发出一个 ls 命令，你可能要等半天，这显然是不允许的。</p><p>至此，也就知道了cpu 的衡量单位是时间，就像内存的衡量单位是空间大小一样。进程占用的 cpu 时间长，说明 cpu 运行在它身上的时间就长。注意，cpu 的百分比值不是其工作强度或频率高低，而是 &quot;进程占用 cpu 时间 / cpu 总时间&quot;，这个衡量概念一定不要搞错。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="913父子进程及创建进程的方式">9.1.3、父子进程及创建进程的方式<a class="hash-link" href="#913父子进程及创建进程的方式" title="Direct link to heading">​</a></h3><p>根据执行程序的用户 UID 以及其他标准，会为每一个进程分配一个唯一的 PID。</p><p>父子进程的概念，简单来说，在某进程(父进程)的环境下执行或调用程序，这个程序触发的进程就是子进程，而进程的 PPID 表示的是该进程的父进程的 PID。由此也知道了，<strong>子进程总是由父进程创建</strong>。</p><p>在 Linux，父子进程以树型结构的方式存在，父进程创建出来的多个子进程之间称为兄弟进程。CentOS 6 上，init 进程是所有进程的父进程，CentOS 7 systemd 进程是所有进程的父进程。</p><p>Linux 上创建子进程的方式有三种(极其重要的概念)：一种是 fork 出来的进程，一种是 exec 出来的进程，一种是 clone 出来的进程。</p><ol><li>fork 是复制进程，它会复制当前进程的副本(不考虑写时复制的模式)，以适当的方式将这些资源交给子进程。所以子进程掌握的资源和父进程是一样的，包括内存中的内容，<strong>所以也包括环境变量和变量</strong>。但父子进程是完全独立的，它们是一个程序的两个实例。</li><li>exec 是加载另一个应用程序，替代当前运行的进程，也就是说在不创建新进程的情况下加载一个新程序。exec 还有一个动作，在进程执行完毕后，退出 exec 所在环境<ul><li>实际上是进程直接跳转到 exec 上，执行完 exec 就直接退出。而非 exec 加载程序的方式是：父进程睡眠，然后执行子进程，执行完后回到父进程，所以不会立即退出当前环境。</li><li>所以为了保证进程安全，若要形成新的且独立的子进程，都会先 fork 一份当前进程，然后在 fork 出来的子进程上调用 exec 来加载新程序替代该子进程。<ul><li>例如在 bash 下执行 cp 命令，会先 fork 出一个 bash，然后再 exec 加载 cp 程序覆盖子 bash 进程变成 cp 进程。但要注意，fork 进程时会复制所有内存页，但使用 exec 加载新程序时会初始化地址空间，意味着复制动作完全是多余的操作，当然，有了写时复制技术不用过多考虑这个问题。</li></ul></li></ul></li><li>clone 用于实现线程。clone 的工作原理和 fork 相同，但 clone 出来的新进程不独立于父进程，它只会和父进程共享某些资源，在 clone 进程的时候，可以指定要共享的是哪些资源。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="914进程的状态">9.1.4、进程的状态<a class="hash-link" href="#914进程的状态" title="Direct link to heading">​</a></h3><p>进程并非总是处于运行中，至少 cpu 没运行在它身上时它就是非运行的。进程有几种状态，不同的状态之间可以实现状态切换。下图是进程状态描述图。</p><p><img loading="lazy" alt="process state" src="/en/assets/images/process state-6a3d2c58d4a827beddd9b5c3db80a312.png" width="890" height="634" class="img_ev3q"></p><p>下面解释一下进程的这些状态是什么意思：</p><ol><li>就绪状态：进程可以运行，已经处于等待队列中，也就是说调度类下次可能会选中它。</li><li>运行态：进程正在运行，即已获得 cpu 时间片，正在计算。</li><li>暂停态：表示进程被停止执行</li><li>可中断阻塞状态：表示进程被阻塞，直到某个条件为真。如果条件达成，则状态变为可运行态。</li><li>不可中断阻塞状态：不能通过接受一个信号来唤醒。</li><li>僵死状态：表示进程的执行被终止，但是父进程还没有使用 wait() 等系统调用来获知它的终止信息。</li></ol><p>进程的各种状态之间可以切换，什么样的情况下会发生这种切换，为了更好的理解，图中使用箭头和文字表述的很直观。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="915进程状态转换过程">9.1.5、进程状态转换过程<a class="hash-link" href="#915进程状态转换过程" title="Direct link to heading">​</a></h3><p>进程间状态的转换情况可能很复杂，这里举一个例子，以在 bash 下执行 cp 命令为例，尽可能详细地描述它们。</p><ol><li>在当前 bash 环境下，处于可运行状态(即就绪态)时，当执行 cp 命令时，首先 fork 出一个 bash 子进程，然后在子 bash 上 exec 加载 cp 程序，cp 子进程进入等待队列，由于在命令行下敲的命令，所以优先级较高，调度类很快选中它。</li><li>在 cp 这个子进程执行过程中，父进程 bash 会进入睡眠状态(不仅是因为 cpu 只有一颗的情况下一次只能执行一个进程，还因为进程等待)，并等待被唤醒，此刻 bash 无法和人类交互。</li><li>当 cp 命令执行完毕，它将自己的退出状态码告知父进程，此次复制是成功还是失败，然后 cp 进程自己消逝掉，父进程 bash 被唤醒再次进入等待队列，并且此时 bash 已经获得了 cp 退出状态码。</li><li>根据状态码这个 &quot;信号&quot;，父进程 bash 知道了子进程已经终止，所以通告给内核，内核收到通知后将进程列表中的 cp 进程项删除。至此，整个 cp 进程正常完成。</li></ol><p>假如 cp 这个子进程复制的是一个大文件，一个 cpu 时间片无法完成复制，那么在一个 cpu 时间片消耗尽的时候它将进入等待队列。</p><p>假如 cp 这个子进程复制文件时，目标位置已经有了同名文件，那么默认会询问是否覆盖，发出询问时它等待 yes 或 no 的信号，所以它进入了睡眠状态(可中断睡眠)，当在键盘上敲入 yes 或 no 信号给 cp 的时候，cp 收到信号，从睡眠态转入就绪态，等待调度类选中它完成 cp 进程。</p><p>在 cp 复制时，它需要和磁盘进行 IO 交互，在和硬件交互的短暂过程中，cp 将处于不可中断睡眠。</p><p>假如 cp 进程结束了，但是结束的过程出现了某种意外，使得 bash 这个父进程不知道它已经结束了(此例中是不可能出现这种情况的)，那么 bash 就不会通知内核回收进程列表中的 cp 表项，cp 此时就成了僵尸进程。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="916进程结构和子-shell">9.1.6、进程结构和子 shell<a class="hash-link" href="#916进程结构和子-shell" title="Direct link to heading">​</a></h3><p>前台进程</p><ul><li>一般命令(如 cp 命令)在执行时都会 fork 子进程来执行，在子进程执行过程中，父进程会进入睡眠，这类是前台进程。</li><li>前台进程执行时，其父进程睡眠，因为 cpu 只有一颗，即使是多颗 cpu，也会因为执行流(进程等待)的原因而只能执行一个进程，要想实现真正的多任务，应该使用进程内多线程实现多个执行流。</li></ul><p>后台进程</p><ul><li>若在执行命令时，在命令的结尾加上符号 &quot;&amp;&quot;，它会进入后台。</li><li>将命令放入后台，会立即返回父进程，并返回该后台进程的的 job id 和 pid，所以后台进程的父进程不会进入睡眠。</li><li>当后台进程出错，或者执行完成，总之后台进程终止时，父进程会收到信号。</li><li>所以，通过在命令后加上 &quot;&amp;&quot;，再在 &quot;&amp;&quot; 后给定另一个要执行的命令，可以实现 &quot;伪并行&quot; 执行的方式，例如 &quot;cp /etc/fstab /tmp &amp; cat /etc/fstab&quot;。</li></ul><p>bash 内置命令</p><ul><li>bash 内置命令是非常特殊的，父进程不会创建子进程来执行这些命令，而是直接在当前 bash 进程中执行。</li><li>但如果将内置命令放在管道后，则此内置命令将和管道左边的进程同属于一个进程组，所以仍然会创建子进程。</li></ul><p>下面解释下子 shell，这个特殊的子进程。</p><ul><li>一般 fork 出来的子进程，内容和父进程是一样的，包括变量，例如执行 cp 命令时也能获取到父进程的变量。但是 cp 命令是在哪里执行的呢？<ul><li>在子 shell 中。执行 cp 命令敲入回车后，当前的 bash 进程 fork 出一个子 bash，然后子 bash 通过 exec 加载 cp 程序替代子 bash。</li><li>请不要在此纠结子 bash 和子 shell，如果搞不清它们的关系，就当它是同一种东西好了。</li></ul></li><li>那是否可以理解为所有命令、脚本其运行环境都是在子 shell 中呢？<ul><li>显然，上面所说的 bash 内置命令不是在子 shell 中运行的。其他的所有方式，都是在子 shell 中完成，只不过方式不尽相同。</li></ul></li></ul><p>分几种情况列出几种比较能说明问题的例子。</p><ol><li>执行bash内置命令<ul><li>bash 内置命令是非常特殊的，父进程不会创建子进程来执行这些命令，而是直接在当前 bash 进程中执行。</li><li>但如果将内置命令放在管道后，则此内置命令将和管道左边的进程同属于一个进程组，所以仍然会创建子进程，但却不一定是子 shell。请先阅读完下面的几种情况再来考虑此项。</li></ul></li><li>执行 bash 命令<ul><li>显然它会进入子 shell 环境，它的绝大多数环境都是新配置的，因为会加载一些环境配置文件。</li><li>事实上 fork 出来的 bash 子进程内容完全继承父 shell，但因<strong>重新加载了环境配置项，所以子 shell 没有继承普通变量，更准确的说是覆盖了从父 shell 中继承的变量。</strong></li><li>不妨试试在 /etc/bashrc 文件中定义一个变量，再在父 shell 中 export 名称相同值却不同的环境变量，然后到子 shel l中看看该变量的值为何？<ul><li>其实执行 bash 命令，既可以认为进入了子 shell，也可以认为没有进入子 shell。在执行 bash 命令后从变量 $BASH<!-- -->_<!-- -->SUBSHELL 的值为 0 可以认为它没有进入子 shell。但从执行 bash 命令后进入了新的 shell 环境来看，它有其父 bash 进程，且 $BASHPID 值和父 shell 不同，所以它算是进入了子 shell。</li><li>执行 bash 命令更应该被认为是进入了一个完全独立的、全新的 shell 环境，而不应该认为是进入了片面的子 shell 环境。</li></ul></li></ul></li><li>执行 shell 脚本<ul><li>因为脚本中第一行总是 &quot;#!/bin/bash&quot; 或者直接 &quot;bash xyz.sh&quot;，所以这和上面的执行 bash 进入子 shell 其实是一回事，都是使用 bash 命令进入子 shell。</li><li>只不过此时的 bash 命令和情况 2 中直接执行 bash 命令所隐含的选项不一样，所以继承和加载的 shell 环境也不一样。</li><li>事实也确实如此，<strong>shell 脚本只会继承父 shell 的一项属性，即父进程所存储的各命令的路径。</strong><ul><li>另外，执行 shell 脚本有一个动作，即命令执行完毕后自动退出子 shell。</li></ul></li></ul></li><li>执行非 bash 内置命令<ul><li>例如执行 cp 命令、grep 命令等，它们直接 fork 一份 bash 进程，然后使用 exec 加载程序替代该子 bash。</li><li>此类子进程会继承所有父 bash 的环境。但严格地说，这已经不是子 shell，因为 exec 加载的程序已经把子 bash 进程替换掉了，这意味着丢失了很多 bash 环境。</li></ul></li><li>非内置命令的命令替换<ul><li>当命令行中包含了命令替换部分时，将开启一个子 shell 先执行这部分内容，再将执行结果返回给当前命令。</li><li>因为这次的子 shell 不是通过 bash 命令进入的子 shell，所以它会继承父 shell 的所有变量内容。这也就解释了 &quot;$(echo $$)&quot; 中 &quot;$$&quot; 的结果是当前 bash 的 pid 号，而不是子 shell 的 pid 号，因为它不是使用 bash 命令进入的子 shell。</li></ul></li><li>使用括号 () 组合一系列命令<ul><li>例如( ls; date; echo haha)，独立的括号将会开启一个子 shell 来执行括号内的命令。这种情况等同于情况 5。</li></ul></li></ol><p>最后需要说明的是，子 shell 的环境设置不会粘滞到父 shell 环境，也就是说子 shell 的变量等不会影响父 shell。</p><p>还有两种特殊的脚本调用方式：exec 和 source。</p><ul><li>exec<ul><li>exec 是加载程序替换当前进程，所以它不开启子 shell，而是直接在当前 shell 中执行命令或脚本，执行完 exec 后直接退出 exec 所在的 shell。</li><li>这就解释了为何 bash 下执行 cp 命令时，cp 执行完毕后会自动退出 cp 所在的子 shell。</li></ul></li><li>source<ul><li>source 一般用来加载环境配置类脚本。它也不会开启子 shell，直接在当前 shell 中执行调用脚本且执行脚本后不退出当前 shell。</li><li>所以脚本会继承当前已有的变量，且脚本执行完毕后加载的环境变量会粘滞给当前 shell，在当前 shell 生效。</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="917-daemon-类进程">9.1.7 Daemon 类进程<a class="hash-link" href="#917-daemon-类进程" title="Direct link to heading">​</a></h3><p>当一个进程脱离了 Shell 环境后，它就可以被称为后台服务类进程，即 Daemon 类守护进程，显然 Daemon 类进程的 PPID=1。当某进程脱离 Shell 的控制，也意味着它脱离了终端：当终端断开连接时，不会影响这些进程。</p><p>需特别关注的是创建 Daemon 类进程的流程：先有一个父进程，父进程在某个时间点 fork 出一个子进程继续运行代码逻辑，父进程立即终止，该子进程成为孤儿进程，即 Daemon 类进程。</p><p>当然，要创建一个完善的 Daemon 类进程还需考虑其它一些事情，比如要独立一个会话和进程组，要关闭 stdin/stdout/stderr，要 chdir 到 / 下防止文件系统错误导致进程异常，等等。不过最关键的特性仍在于其脱离 Shell、脱离终端。</p><p>为什么要 fork 一个子进程作为 Daemon 进程？为什么父进程要立即退出？</p><ol><li>所有的 Daemon 类进程都要脱离 Shell 脱离终端，才能不受终端不受用户影响，从而保持长久运行。</li><li>在代码层面上，脱离 Shell 脱离终端是通过 setsid() 创建一个独立的 Session 实现的，而进程组的首进程(pg leader) 不允许创建新的 Session 自立山头，只有进程组中的非首进程(比如进程组首进程的子进程) 才能创建会话，从而脱离原会话。</li><li>而 Shell 命令行下运行的命令，总是会创建一个新的进程组并成为 leader 进程，所以要让该程序成为长久运行的 Daemon 进程，只能创建一个新的子进程来创建新的 session 脱离当前的 Shell。</li><li>另外，父进程立即退出的原因是可以立即将终端控制权交还给当前的 Shell 进程。但这不是必须的，比如可以让子进程成为 Daemon 进程后，父进程继续运行并占用终端，只不过这种代码不友好罢了。</li></ol><p><strong>总之，当用户运行一个 Daemon 类程序时，总是会有一个瞬间消失的父进程。</strong></p><p>举例：为了更接近实际环境，这里再用 nginx 来论证这个现象。默认配置下，nginx 以 daemon 方式运行，所以 nginx 启动时会有一个瞬间消失的父进程。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ps -o pid,ppid,comm; nginx; ps -o pid,ppid,comm $(pgrep nginx)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  PID  </span><span class="token environment constant" style="color:rgb(129, 31, 63)">PPID</span><span class="token plain"> COMMAND</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">16849</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">16844</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17026</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">16849</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">ps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  PID  </span><span class="token environment constant" style="color:rgb(129, 31, 63)">PPID</span><span class="token plain"> COMMAND</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17029</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17030</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17031</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17032</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17033</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17035</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17036</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17037</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17038</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17039</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17040</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17041</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17042</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17043</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17044</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17045</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17028</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>第一个 ps 命令查看到当前分配到的 PID 值为 17026，下一个进程的 PID 应该分配为 17027，但是第二个 ps 查看到 nginx 的 main 进程 PID 为 17028，中间消失的就是 nginx main 进程的父进程。</li></ul><p>可以修改配置文件使得 nginx 以非 daemon 方式运行，即在前台运行，这样 nginx 将占用终端，且没有中间的父进程，占用终端的进程就是 main 进程。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ps -o pid,ppid,comm; nginx -g &#x27;daemon off;&#x27; &amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  PID  </span><span class="token environment constant" style="color:rgb(129, 31, 63)">PPID</span><span class="token plain"> COMMAND</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">16849</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">16844</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17087</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">16849</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">ps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ps -o pid,ppid,comm $(pgrep nginx)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  PID  </span><span class="token environment constant" style="color:rgb(129, 31, 63)">PPID</span><span class="token plain"> COMMAND</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">16849</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17089</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17090</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17091</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17092</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17093</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17094</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17095</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17096</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17097</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17098</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17099</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17100</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17101</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17102</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17103</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">17104</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17088</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后需要<strong>区分后台进程和 Daemon 类进程</strong>，它们都在后台运行。但普通的后台进程仍然受 shell 进程的监督和管理，用户可以将其从后台调度到前台运行，即让其再次获得终端控制权。而 Daemon 类进程脱离了终端、脱离了 Shell，它们不再受 Shell 的监督和管理，而是接受 pid=1 的 systemd 进程的管理。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="92job-任务">9.2、job 任务<a class="hash-link" href="#92job-任务" title="Direct link to heading">​</a></h2><p>大部分进程都能将其放入后台，这时它就是一个后台任务，所以常称为 job，每个开启的 shell 会维护一个 job table，后台中的每个 job 都在 job table 中对应一个 Job 项。</p><p>手动将命令或脚本放入后台运行的方式是在命令行后加上 &quot;&amp;&quot; 符号。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp /etc/fstab /tmp/ &amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">403913</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  已完成               </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> -i /etc/fstab /tmp/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>将进程放入后台后，会立即返回其父进程，一般对于手动放入后台的进程都是在 bash 下进行的，所以立即返回 bash 环境。</li><li>在返回父进程的同时，还会返回给父进程其 job id 和 pid。</li><li>未来要引用 job id，都应该在 job id前加上百分号 &quot;%&quot;，其中 &quot;%%&quot; 表示当前 job，例如 &quot;kill -9 %1&quot; 表示杀掉 job id 为 1 的后台进程，如果不加百分号，完了，把 Init 进程给杀了（但该进程特殊，不会受影响）。</li></ul><p>通过 jobs 命令可以查看后台 job 信息。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">jobs</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-lrs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">job id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-l：jobs默认不会列出后台工作的PID，加上-l会列出进程的PID</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r：显示后台工作处于run状态的jobs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s：显示后台工作处于stopped状态的jobs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过 &quot;&amp;&quot; 放入后台的任务，在后台中仍会处于运行中。当然，对于那种交互式如 vim 类的命令，将转入暂停运行状态。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sleep 10 &amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">412776</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  运行中               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>一定要注意，此处看到的是 &quot;运行中&quot; 和 ps 或 top 显示的 R 状态，它们并不总是表示正在运行，处于等待队列的进程也属于 &quot;运行中&quot;</strong>。它们都属于 task<!-- -->_<!-- -->running 标识。</p><p>另一种手动加入后台的方式是按下 CTRL+Z 键，这可以将正在运行中的进程加入到后台，但这样加入后台的进程会在后台暂停运行。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sleep 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">^Z</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  已停止               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  已停止               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>从 jobs 信息也看到了在每个 job id 的后面有个 &quot;+&quot; 号，还有 &quot;-&quot;，或者不带符号。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sleep 30 &amp; vim /etc/my.cnf &amp; sleep 50 &amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">437387</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">437388</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">437390</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">   运行中               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  已停止               </span><span class="token function" style="color:rgb(0, 0, 255)">vim</span><span class="token plain"> /etc/my.cnf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">-  运行中               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>发现 vim 的进程后是加号，&quot;+&quot; 表示最近进入后台的作业，也称为当前作业，&quot;-&quot; 表示倒数第二个进入后台的作业。</li><li>如果后进入后台的作业先执行完成了，则 &quot;+&quot; 和 &quot;-&quot; 所代表的作业顺位前移。</li><li>如果只有一个后台作业，则 &quot;+&quot; 和 &quot;-&quot; 都代表这个作业。</li><li>所以，使用 &quot;%+&quot; 和 &quot;%%&quot; 可以代表最后一个作业的 job id，使用 &quot;%-&quot; 可以代表倒数第二个 job 的 job id。</li></ul><p>回归正题。既然能手动将进程放入后台，那肯定能调回到前台，调到前台查看了下执行进度，又想调入后台，这肯定也得有方法，总不能使用 CTRL+Z 以暂停方式加到后台吧。</p><p>fg 和 bg 命令分别是 foreground 和 background 的缩写，也就是放入前台和放入后台，严格的说，是以运行状态放入前台和后台，即使原来任务是 stopped 状态的。</p><p>操作方式也很简单，直接在命令后加上 job id 即可(即<!-- -->[<!-- -->fg|bg<!-- -->]<!-- --> <!-- -->[<!-- -->%jobid<!-- -->]<!-- -->)，不给定 job id 时操作的将是当前任务，即带有 &quot;+&quot; 的任务项。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sleep 100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">^Z                                      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 按下CTRL+Z进入暂停并放入后台</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  已停止               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  已停止               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)"># 此时为stopped状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># bg %1               # 使用 bg 可以让暂停状态的进程变会运行态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+ </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># fg %1               # 使用 fg 可以将后台任务调回至前台并处于运行状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">^Z</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  已停止               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>disown 命令可以从 job table 中直接移除一个 job，仅仅只是移出 job table，并非是结束任务。而且移出 job table 后，作业将脱离 shell 管理，不再依赖于终端，当终端断开会立即挂在 init/systemd 进程之下。所以， disown 命令提供了让进程脱离终端的另一种方式。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">disown </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-ar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-h</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">%jobid </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-h：给定该选项，将不从job table中移除job，而是将其设置为不接受shell发送的sighup信号。具体说明见</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;信号&quot;</span><span class="token plain">小节。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-a：如果没有给定jobid，该选项表示针对Job table中的所有job进行操作。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r：如果没有给定jobid，该选项严格限定为只对running状态的job进行操作</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果不给定任何选项，该 shell 中所有的 job 都会被移除，移除是 disown 的默认操作，如果也没给定 job id，而且也没给定 -a 或 -r，则表示只针对当前任务即带有 &quot;+&quot; 号的任务项。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sleep 30 &amp; sleep 40 &amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">517131</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">517132</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">-  运行中               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  运行中               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">-  运行中               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  运行中               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># disown %2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># jobs            # 已经移除一个</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">+  已完成               </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="93终端和进程的关系">9.3、终端和进程的关系<a class="hash-link" href="#93终端和进程的关系" title="Direct link to heading">​</a></h2><p>使用 pstree 命令查看下当前的进程，不难发现在某个终端执行的进程其父进程或上几个级别的父进程总是会是终端的连接程序。</p><p>例如下面筛选出了两个终端下的父子进程关系，第一个行是 tty 终端(即直接在虚拟机中)中执行的进程情况，第二行和第三行是 ssh 连接到 Linux 上执行的进程。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># pstree -c | grep bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-login---bash---bash---vim</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-sshd-+-sshd---bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">      `-sshd---bash-+-grep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>正常情况下杀死父进程会导致子进程变为孤儿进程，即其 PPID 改变，但是杀掉终端这种特殊的进程，会导致该终端上的所有进程都被杀掉。</p><p>这在很多执行长时间任务的时候是很不方便的。比如要下班了，但是你连接的终端上还在执行数据库备份脚本，这可能会花掉很长时间，如果直接退出终端，备份就终止了。所以应该保证一种安全的退出方法。</p><p>一般的方法也是最简单的方法是使用 nohup 命令带上要执行的命令或脚本放入后台，这样任务就脱离了终端的关联。当终端退出时，该任务将自动挂到 init(或systemd) 进程下执行。如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># nohup tar rf a.tar.gz /tmp/*.txt &amp;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另一种方法是使用 screen 这个工具，该工具可以模拟多个物理终端，虽然模拟后 screen 进程仍然挂在其所在的终端上的，但同 nohup 一样，当其所在终端退出后将自动挂到 init/systemd 进程下继续存在，只要 screen 进程仍存在，其所模拟的物理终端就会一直存在，这样就保证了模拟终端中的进程继续执行。</p><p>它的实现方式其实和 nohup 差不多，只不过它花样更多，管理方式也更多。一般对于简单的后台持续运行进程，使用 nohup 足以。</p><p>另外，在<strong>子 shell 中的后台进程在终端被关闭时也会脱离终端，因此也不受 shell 和终端的控制。例如 shell 脚本中的后台进程，再如&quot;(sleep 10 &amp;)&quot;。</strong></p><p>可能你已经发现了，很多进程是和终端无关的，也就是不依赖于终端，这类进程一般是内核类进程/线程以及 daemon 类进程，若它们也依赖于终端，则终端一被终止，这类进程也立即被终止，这是绝对不允许的。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="94信号">9.4、信号<a class="hash-link" href="#94信号" title="Direct link to heading">​</a></h2><p>信号在操作系统中控制着进程的绝大多数动作，信号可以让进程知道某个事件发生了，也指示着进程下一步要做出什么动作。</p><p>信号的来源可以是硬件信号(如按下键盘或其他硬件故障)，也可以是软件信号(如kill信号，还有内核发送的信号)。不过，很多可以感受到的信号都是从进程所在的控制终端发送出去的。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="941常见信号">9.4.1、常见信号<a class="hash-link" href="#941常见信号" title="Direct link to heading">​</a></h3><p>Linux 中支持非常多种信号，它们都以 SIG 字符串开头，SIG 字符串后的才是真正的信号名称，信号还有对应的数值，其实数值才是操作系统真正认识的信号。</p><p>但由于不少信号在不同架构的计算机上数值不同(例如 CTRL+Z 发送的 SIGSTP 信号就有三种值 18,20,24)，所以在不确定信号数值是否唯一的时候，最好指定其字符名称。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Signal     Value     Comment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">─────────────────────────────</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGHUP        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">      终端退出时，此终端内的进程都将被终止</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGINT        </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">      中断进程，可被捕捉和忽略，几乎等同于sigterm，所以也会尽可能的释放执行clean-up，释放资源，保存状态等</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">CTRL+C</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGQUIT       </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">      从键盘发出杀死</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">终止</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">进程的信号</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGKILL       </span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">      强制杀死进程，该信号不可被捕捉和忽略，进程收到该信号后不会执行任何clean-up行为，所以资源不会释放，状态不会保存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGTERM      </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">      杀死</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">终止</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">进程，可被捕捉和忽略，几乎等同于sigint信号，会尽可能的释放执行clean-up，释放资源，保存状态等</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGCHLD      </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain">      当子进程中断或退出时，发送该信号告知父进程自己已完成，父进程收到信号将告知内核清理进程列表。所以该信号可以解除僵尸进</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                     程，也可以让非正常退出的进程工作得以正常的clean-up，释放资源，保存状态等。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGSTOP      </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain">      该信号是不可被捕捉和忽略的进程停止信息，收到信号后会进入stopped状态</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGTSTP      </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">      该信号是可被忽略的进程停止信号</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">CTRL+Z</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGCONT      </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">      发送此信号使得stopped进程进入running，该信号主要用于jobs，例如bg </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">fg</span><span class="token plain"> 都会发送该信号。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                     可以直接发送此信号给stopped进程使其运行起来  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGUSR1      </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">      用户自定义信号1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SIGUSR2      </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain">      用户自定义信号2 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>除了这些信号外，还需要知道一个特殊信号，代码为 0 的信号。此信号为 EXIT 信号，表示直接退出。</p><ul><li>如果 kill 发送的信号是 0(即 kill -0) 则表示不做任何处理直接退出，但执行错误检查，当检查发现给定的 pid 进程存在，则返回 0，否则返回 1。也就是说，0 信号可以用来检测进程是否存在，可以代替 <code>ps aux | grep proc_name</code> 。</li></ul><p>以上所列的信号中，只有 SIGKILL 和 SIGSTOP 这两个信号是不可被捕捉且不可被忽略的信号，其他所有信号都可以通过 trap 或其他编程手段捕捉到或忽略掉。</p><p>此外，经常看到有些服务程序(如 httpd/nginx) 的启动脚本中使用 WINCH 和 USR1 这两个信号，发送这两个信号时它们分别表示 graceful stop 和 graceful restart。</p><ul><li><p>所谓的 graceful，译为优雅，不过使用这两个字去描述这种环境实在有点不伦不类。它对于后台服务程序而言，传达了几个意思</p><ul><li>当前已经运行的进程不再接受新请求</li><li>给当前正在运行的进程足够多的时间去完成正在处理的事情</li><li>允许启动新进程接受新请求</li><li>可能还有日志文件是否应该滚动、pid 文件是否修改的可能，这要看服务程序对信号的具体实现</li></ul></li><li><p>再来说说，为什么后台服务程序可以使用这两个信号。以 httpd 的为例，在其头文件 mpm<!-- -->_<!-- -->common.h 中有如下几行代码</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">/* Signal used to gracefully restart */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#define AP_SIG_GRACEFUL SIGUSR1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/* Signal used to gracefully stop */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#define AP_SIG_GRACEFUL_STOP SIGWINCH</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这说明注册了对应信号的处理函数，它们分别表示将接收到信号时，执行对应的 GRACEFUL 函数。</li></ul></li><li><p>注意，SIGWINCH 是窗口程序的尺寸改变时发送该信号，如 vim 的窗口改变了就会发送该信号。但是对于后台服务程序，它们根本就没有窗口，所以 WINCH 信号对它们来说是没有任何作用的。</p></li><li><p>因此，大概是约定俗成的，大家都喜欢用它来作为后台服务程序的 GRACEFUL 信号。</p></li><li><p>但注意，WINCH 信号对前台程序可能是有影响的，不要乱发这种信号。同理，USR1 和 USR2 也是一样的，如果源代码中明确为这两个信号注册了对应函数，那么发送这两个信号就可以实现对应的功能，反之，如果没有注册，则这两个信号对进程来说是错误信号。</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="942sighup">9.4.2、SIGHUP<a class="hash-link" href="#942sighup" title="Direct link to heading">​</a></h3><ol><li><p>当控制终端退出时，会向该终端中的进程发送 sighup 信号，因此该终端上运行的 shell 进程、其他普通进程以及任务都会收到 sighup 而导致进程终止。</p><p>多种方式可以改变因终端中断发送 sighup 而导致子进程也被结束的行为，这里仅介绍比较常见的三种：</p><ol><li>使用 nohup 命令启动进程，它会忽略所有的 sighup 信号，使得该进程不会随着终端退出而结束；</li><li>将待执行命令放入子 shell 中并放入后台运行，例如&quot;(sleep 10 &amp;)&quot;；</li><li>使用 disown，将任务列表中的任务移除出 job table 或者直接使用 disown -h 的功能设置其不接收终端发送的 sighup 信号。但不管是何种实现方式，终端退出后未被终止的进程将只能挂靠在 init/systemd 下。</li></ol></li><li><p>对于 daemon 类的程序(即服务性进程)，这类程序不依赖于终端(它们的父进程都是 init 或 systemd)，它们收到 sighup 信号时会重读配置文件并重新打开日志文件，使得服务程序可以不用重启就可以加载配置文件。</p></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="943僵尸进程和-sigchld">9.4.3、僵尸进程和 SIGCHLD<a class="hash-link" href="#943僵尸进程和-sigchld" title="Direct link to heading">​</a></h3><p>一个编程完善的程序，在<strong>子进程终止、退出的时候，内核会发送 SIGCHLD 信号给其父进程</strong>，父进程收到信号就会对该子进程进行善后(接收子进程的退出状态、释放未关闭的资源)，同时内核也会进行一些善后操作(比如清理进程表项、关闭打开的文件等)。</p><p>在子进程死亡的那一刹那，子进程的状态就是僵尸进程，但因为发出了 SIGCHLD 信号给父进程，父进程只要收到该信号，子进程就会被清理也就不再是僵尸进程。<strong>所以正常情况下，所有终止的进程都会有一小段时间处于僵尸态(发送 SIGCHLD 信号到父进程收到该信号之间)，只不过这种僵尸进程存在时间极短</strong>，几乎是不可被 ps 或 top 这类的程序捕捉到的。</p><p>如果在特殊情况下，子进程终止了，但父进程没收到 SIGCHLD 信号，没收到这信号的原因可能是多种的，不管如何，此时子进程已经成了永存的僵尸，能轻易的被 ps 或 top 捕捉到。</p><ul><li>僵尸爸爸并不知道它儿子已经变成了僵尸，因为有僵尸爸爸的掩护，内核见不到小僵尸，所以也没法收尸。</li><li>悲催的是，人类能力不足，直接发送信号(如 kill) 给僵尸进程是无效的，因为僵尸进程本就是终结了的进程，它收不到信号。</li><li>只有内核从进程列表中将僵尸进程表项移除才算完成收尸。</li></ul><p>要解决掉永存的僵尸有几种方法：</p><ol><li><strong>杀死僵尸进程的父进程</strong>。没有了僵尸爸爸的掩护，小僵尸就暴露给了 init/systemd，init/systemd 会定期清理它下面的各种僵尸进程。所以这种方法有点不讲道理，僵尸爸爸是正常的啊，不过如果僵尸爸爸下面有很多僵尸儿子，这僵尸爸爸肯定是有问题的，比如编程不完善，杀掉是应该的。</li><li><strong>手动发送 SIGCHLD 信号给僵尸进程的父进程</strong>，主动通知僵尸爸爸，让僵尸爸爸知道自己的儿子死而不僵，然后通知内核来收尸。<ul><li>手动发送 SIGCHLD 信号的方法要求父进程能收到信号，而 SIGCHLD 信号默认是被忽略的，所以应该显式地在程序中加上获取信号的代码。</li><li>也就是人类主动通知僵尸爸爸的时候，默认僵尸爸爸是不搭理人类的，所以要强制让僵尸爸爸收到通知。不过一般 daemon 类的程序在编程上都是很完善的，发送 SIGCHLD 总是会收到，不用担心。</li></ul></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="944手动发送信号">9.4.4、手动发送信号<a class="hash-link" href="#944手动发送信号" title="Direct link to heading">​</a></h3><p>使用 kill 命令可以手动发送信号给指定的进程。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">kill</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-s signal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> pid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">kill</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-signal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> pid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">kill</span><span class="token plain"> -l</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 kill -l 可以列出 Linux 中支持的信号，有 64 种之多，但绝大多数非编程人员都用不上。</p><p>使用 -s 或 -signal 都可以发送信号，不给定发送的信号时，默认为 TREM 信号，即 kill -15。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">shell</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">kill</span><span class="token plain"> -9 pid1 pid2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">shell</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">kill</span><span class="token plain"> -TREM pid1 pid2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">shell</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">kill</span><span class="token plain"> -s TREM pid1 pid2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="945pkill-和-killall">9.4.5、pkill 和 killall<a class="hash-link" href="#945pkill-和-killall" title="Direct link to heading">​</a></h3><p>这两个命令都可以直接指定进程名来发送信号，不指定信号时，默认信号都是 TERM。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9451-pkill-命令">9.4.5.1 pkill 命令<a class="hash-link" href="#9451-pkill-命令" title="Direct link to heading">​</a></h4><p>pkill 和 pgrep 命令是同族命令，都是先通过给定的匹配模式搜索到指定的进程，然后发送信号(pkill) 或列出匹配的进程(pgrep)，pgrep 就不介绍了。</p><p>pkill 能够指定模式匹配，所以可以使用进程名来删除，想要删除指定 pid 的进程，反而还要使用 &quot;-s&quot; 选项来指定。默认发送的信号是 SIGTERM 即数值为 15 的信号。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">pkill</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-signal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-v</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-P ppid,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-s pid,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-U uid,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-t term,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">pattern</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-P ppid,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. ：匹配</span><span class="token environment constant" style="color:rgb(129, 31, 63)">PPID</span><span class="token plain">为指定值的进程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s pid,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.  ：匹配PID为指定值的进程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-U uid,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.  ：匹配</span><span class="token environment constant" style="color:rgb(129, 31, 63)">UID</span><span class="token plain">为指定值的进程，可以使用数值</span><span class="token environment constant" style="color:rgb(129, 31, 63)">UID</span><span class="token plain">，也可以使用用户名称</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-t term,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. ：匹配给定终端，终端名称不能带上</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/dev/&quot;</span><span class="token plain">前缀，其实</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;w&quot;</span><span class="token plain">命令获得终端名就满足此处条件了，所以pkill可以直接杀掉整个终端</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v          ：反向匹配</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-signal     ：指定发送的信号，可以是数值也可以是字符代表的信号</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f          ：默认情况下，pgrep/pkill只会匹配进程名。使用-f将匹配命令行</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 CentOS 7 上，还有两个好用的新功能选项。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-F, --pidfile file：匹配进程时，读取进程的pid文件从中获取进程的pid值。这样就不用去写获取进程pid命令的匹配模式</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-L, --logpidfile  ：如果</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-F&quot;</span><span class="token plain">选项读取的pid文件未加锁，则pkill或pgrep将匹配失败。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ps x | grep ssh[d]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">2477</span><span class="token plain"> ?        Ss     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 /usr/sbin/sshd -D</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">402315</span><span class="token plain"> ?        Ss     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">priv</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">402714</span><span class="token plain"> ?        S      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root@pts/12</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">750267</span><span class="token plain"> ?        Ss     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">priv</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">750282</span><span class="token plain"> ?        S      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root@pts/13</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">750385</span><span class="token plain"> ?        Ss     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">priv</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">750405</span><span class="token plain"> ?        S      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root@pts/16</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">750478</span><span class="token plain"> ?        Ss     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">priv</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">750492</span><span class="token plain"> ?        S      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root@pts/17</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">750539</span><span class="token plain"> ?        Ss     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">priv</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">750586</span><span class="token plain"> ?        S      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root@pts/18</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">750661</span><span class="token plain"> ?        Ss     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">priv</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">750674</span><span class="token plain"> ?        S      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 sshd: root@pts/19</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>现在想匹配/usr/sbin/sshd。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># pgrep bin/sshd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># pgrep -f bin/sshd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2477</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>可以看到第一个什么也不返回。因为不加 -f 选项时，pgrep 只能匹配进程名，而进程名指的是 sshd，而非 /usr/sbin/sshd，所以匹配失败。</li><li>加上 -f 后，就能匹配成功。<strong>所以，当 pgrep 或 pkill 匹配不到进程时，考虑加上 -f 选项。</strong></li></ul><p>踢出终端：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># pkill -t pts/18</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9452killall-命令">9.4.5.2、killall 命令<a class="hash-link" href="#9452killall-命令" title="Direct link to heading">​</a></h4><p>killall 主要用于杀死一批进程，例如杀死整个进程组。其强大之处还体现在<strong>可以通过指定文件来搜索哪个进程打开了该文件，然后对该进程发送信号，在这一点上，fuser 和 lsof 命令也一样能实现。</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">killall</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-r,--regexp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-s,--signal signal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-u,--user user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-v,--verbose</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-w,--wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-I,--ignore-case</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">--</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> name </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-I           ：匹配时不区分大小写</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r           ：使用扩展正则表达式进行模式匹配</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s, --signal ：发送信号的方式可以是-HUP或-SIGHUP，或数值的</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-1&quot;</span><span class="token plain">，或使用</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-s&quot;</span><span class="token plain">选项指定信号</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-u, --user   ：匹配该用户的进程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v,          ：给出详细信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-w, --wait   ：等待直到该杀的进程完全死透了才返回。默认killall每秒检查一次该杀的进程是否还存在，只有不存在了才会给出退出状态码。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               如果一个进程忽略了发送的信号、信号未产生效果、或者是僵尸进程将永久等待下去</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="95-fuser-和-lsof">9.5 fuser 和 lsof<a class="hash-link" href="#95-fuser-和-lsof" title="Direct link to heading">​</a></h2><p>fuser 可以查看文件或目录所属进程的pid，即由此知道该文件或目录被哪个进程使用。例如，umount 的时候提示 the device busy 可以判断出来哪个进程在使用。</p><p>而 lsof 则反过来，它是通过进程来查看进程打开了哪些文件，但要注意的是，一切皆文件，包括普通文件、目录、链接文件、块设备、字符设备、套接字文件、管道文件，所以 lsof 出来的结果可能会非常多。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="951fuser-命令">9.5.1、fuser 命令<a class="hash-link" href="#951fuser-命令" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">fuser</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-ki</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-signal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> file/dir</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-k：找出文件或目录的pid，并试图kill掉该pid。发送的信号是SIGKILL</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-i：一般和-k一起使用，指的是在kill掉pid之前询问。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-signal：发送信号，如-1 -15，如果不写，默认-9，即kill -9</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">不加选项：直接显示出文件或目录的pid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在不加选项时，显示结果中文件或目录的pid后会带上一个修饰符：<ul><li>c: 在当前目录下</li><li>e: 可被执行的</li><li>f: 是一个被开启的文件或目录</li><li>F: 被打开且正在写入的文件或目录</li><li>r: 代表 root directory</li></ul></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># fuser /usr/sbin/crond </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/crond:      2483e</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>表示 /usr/sbin/crond 被 2483 这个进程打开了，后面的修饰符 e 表示该文件是一个可执行文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ps aux | grep 248[3]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root        </span><span class="token number" style="color:rgb(9, 134, 88)">2483</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">216128</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">4544</span><span class="token plain"> ?        Ss   </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">月27   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:11 /usr/sbin/crond -n</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root       </span><span class="token number" style="color:rgb(9, 134, 88)">26562</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">24832</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14976</span><span class="token plain"> ?        Ss   </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">月29   </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">:14 /usr/lib/systemd/systemd --user</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">354023</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">1.1</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">30784</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">24832</span><span class="token plain"> ?        Sl   </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">月29 </span><span class="token number" style="color:rgb(9, 134, 88)">1484</span><span class="token plain">:43 /var/lib/zstack/kvm/collectd_exporter -collectd.listen-address :25826</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="952lsof-命令">9.5.2、lsof 命令<a class="hash-link" href="#952lsof-命令" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># lsof -u root | grep bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sh</span><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">354022</span><span class="token plain"> root  txt       REG                </span><span class="token number" style="color:rgb(9, 134, 88)">8,4</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">1280832</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">27396695</span><span class="token plain"> /usr/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sh</span><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">354059</span><span class="token plain"> root  txt       REG                </span><span class="token number" style="color:rgb(9, 134, 88)">8,4</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">1280832</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">27396695</span><span class="token plain"> /usr/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sh</span><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">354120</span><span class="token plain"> root  txt       REG                </span><span class="token number" style="color:rgb(9, 134, 88)">8,4</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">1280832</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">27396695</span><span class="token plain"> /usr/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">402717</span><span class="token plain"> root  cwd       DIR                </span><span class="token number" style="color:rgb(9, 134, 88)">8,4</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">41811969</span><span class="token plain"> /root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">402717</span><span class="token plain"> root  rtd       DIR                </span><span class="token number" style="color:rgb(9, 134, 88)">8,4</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain">          </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">402717</span><span class="token plain"> root  txt       REG                </span><span class="token number" style="color:rgb(9, 134, 88)">8,4</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">1280832</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">27396695</span><span class="token plain"> /usr/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">402717</span><span class="token plain"> root  mem       REG                </span><span class="token number" style="color:rgb(9, 134, 88)">8,4</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">131494</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">27396655</span><span class="token plain"> /usr/share/locale/zh_CN/LC_MESSAGES/libc.mo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">402717</span><span class="token plain"> root  mem       REG                </span><span class="token number" style="color:rgb(9, 134, 88)">8,4</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">159999</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">27396743</span><span class="token plain"> /usr/share/locale/zh_CN/LC_MESSAGES/bash.mo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>输出信息中各列意义：<ul><li>COMMAND：进程的名称</li><li>PID：进程标识符</li><li>USER：进程所有者</li><li>FD：文件描述符，应用程序通过文件描述符识别该文件。如 cwd、txt 等</li><li>TYPE：文件类型，如 DIR、REG 等</li><li>DEVICE：指定磁盘的名称</li><li>SIZE/OFF：文件的大小或文件的偏移量(单位kb)(size and offset)</li><li>NODE：索引节点（文件在磁盘上的标识）</li><li>NAME：打开文件的确切名称</li></ul></li></ul><p>lsof 的各种用法：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> ［options］ filename</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain">  /path/to/somefile：显示打开指定文件的所有进程之列表</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -c string：显示其COMMAND列中包含指定字符</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">的进程所有打开的文件；此选项可以重复使用，以指定多个模式；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -p PID：查看该进程打开了哪些文件；进程号前可以使用脱字符“^”取反；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -U：列出套接字类型的文件。一般和其他条件一起使用。如lsof -u root -a -U</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -u USERNAME：显示指定用户的进程打开的文件；用户名前可以使用脱字符“^”取反，如“lsof -u ^root”则用于显示非root用户打开的所有文件；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -g GID：显示归属gid的进程情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> +d /DIR/：显示指定目录下被进程打开的文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> +D /DIR/：基本功能同上，但lsof会对指定目录进行递归查找，注意这个参数要比grep版本慢：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -a：按“与”组合多个条件，如lsof -a -c apache -u apache</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -N：列出所有NFS（网络文件系统）文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -d FD：显示指定文件描述符的相关进程；也可以为描述符指定一个范围，如0-2表示0,1,2三个文件描述符；另外，-d还支持其它很多特殊值，如：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    mem: 列出所有内存映射文件；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    mmap：显示所有内存映射设备；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    txt：列出所有加载在内存中并正在执行的进程，包含code和data；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    cwd：正在访问当前目录的进程列表；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -n：不反解IP至</span><span class="token environment constant" style="color:rgb(129, 31, 63)">HOSTNAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -i：用以显示符合条件的进程情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">lsof</span><span class="token plain"> -i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">46</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">@hostname</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">hostaddr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:service</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">46</span><span class="token plain">：IPv4或IPv6</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    protocol：TCP or UDP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    hostname：Internet </span><span class="token function" style="color:rgb(0, 0, 255)">host</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    hostaddr：IPv4地址</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    service：/etc/service中的服务名称</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">可以不只一个</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    port：端口号 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">可以不只一个</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>大概 &quot;-i&quot; 是使用最多的了，而 &quot;-i&quot; 中使用最多的又是服务名或端口了。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># lsof -i :22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COMMAND    PID </span><span class="token environment constant" style="color:rgb(129, 31, 63)">USER</span><span class="token plain">   FD   TYPE    DEVICE SIZE/OFF NODE NAME</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sshd      </span><span class="token number" style="color:rgb(9, 134, 88)">2477</span><span class="token plain"> root    3u  IPv4      </span><span class="token number" style="color:rgb(9, 134, 88)">2599</span><span class="token plain">      0t0  TCP *:ssh </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sshd      </span><span class="token number" style="color:rgb(9, 134, 88)">2477</span><span class="token plain"> root    4u  IPv6      </span><span class="token number" style="color:rgb(9, 134, 88)">2601</span><span class="token plain">      0t0  TCP *:ssh </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sshd    </span><span class="token number" style="color:rgb(9, 134, 88)">402315</span><span class="token plain"> root    3u  IPv4 </span><span class="token number" style="color:rgb(9, 134, 88)">520997541</span><span class="token plain">      0t0  TCP computer1:ssh-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10.254:54407 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sshd    </span><span class="token number" style="color:rgb(9, 134, 88)">402714</span><span class="token plain"> root    3u  IPv4 </span><span class="token number" style="color:rgb(9, 134, 88)">520997541</span><span class="token plain">      0t0  TCP computer1:ssh-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10.254:54407 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sshd    </span><span class="token number" style="color:rgb(9, 134, 88)">750267</span><span class="token plain"> root    3u  IPv4 </span><span class="token number" style="color:rgb(9, 134, 88)">521729693</span><span class="token plain">      0t0  TCP computer1:ssh-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10.254:58305 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sshd    </span><span class="token number" style="color:rgb(9, 134, 88)">750282</span><span class="token plain"> root    3u  IPv4 </span><span class="token number" style="color:rgb(9, 134, 88)">521729693</span><span class="token plain">      0t0  TCP computer1:ssh-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10.254:58305 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sshd    </span><span class="token number" style="color:rgb(9, 134, 88)">750385</span><span class="token plain"> root    3u  IPv4 </span><span class="token number" style="color:rgb(9, 134, 88)">521729700</span><span class="token plain">      0t0  TCP computer1:ssh-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10.254:58307 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sshd    </span><span class="token number" style="color:rgb(9, 134, 88)">750405</span><span class="token plain"> root    3u  IPv4 </span><span class="token number" style="color:rgb(9, 134, 88)">521729700</span><span class="token plain">      0t0  TCP computer1:ssh-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10.254:58307 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sshd    </span><span class="token number" style="color:rgb(9, 134, 88)">750478</span><span class="token plain"> root    3u  IPv4 </span><span class="token number" style="color:rgb(9, 134, 88)">521729707</span><span class="token plain">      0t0  TCP computer1:ssh-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10.254:58308 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sshd    </span><span class="token number" style="color:rgb(9, 134, 88)">750492</span><span class="token plain"> root    3u  IPv4 </span><span class="token number" style="color:rgb(9, 134, 88)">521729707</span><span class="token plain">      0t0  TCP computer1:ssh-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10.254:58308 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ESTABLISHED</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@computer1 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/linux-primary-8"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">第 8 章 Linux 包管理</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/linux-primary-10"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">第 10 章 Linux 系统资源监控</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#91进程概念" class="table-of-contents__link toc-highlight">9.1、进程概念</a><ul><li><a href="#911进程和程序" class="table-of-contents__link toc-highlight">9.1.1、进程和程序</a></li><li><a href="#912多任务和-cpu-时间片" class="table-of-contents__link toc-highlight">9.1.2、多任务和 CPU 时间片</a></li><li><a href="#913父子进程及创建进程的方式" class="table-of-contents__link toc-highlight">9.1.3、父子进程及创建进程的方式</a></li><li><a href="#914进程的状态" class="table-of-contents__link toc-highlight">9.1.4、进程的状态</a></li><li><a href="#915进程状态转换过程" class="table-of-contents__link toc-highlight">9.1.5、进程状态转换过程</a></li><li><a href="#916进程结构和子-shell" class="table-of-contents__link toc-highlight">9.1.6、进程结构和子 shell</a></li><li><a href="#917-daemon-类进程" class="table-of-contents__link toc-highlight">9.1.7 Daemon 类进程</a></li></ul></li><li><a href="#92job-任务" class="table-of-contents__link toc-highlight">9.2、job 任务</a></li><li><a href="#93终端和进程的关系" class="table-of-contents__link toc-highlight">9.3、终端和进程的关系</a></li><li><a href="#94信号" class="table-of-contents__link toc-highlight">9.4、信号</a><ul><li><a href="#941常见信号" class="table-of-contents__link toc-highlight">9.4.1、常见信号</a></li><li><a href="#942sighup" class="table-of-contents__link toc-highlight">9.4.2、SIGHUP</a></li><li><a href="#943僵尸进程和-sigchld" class="table-of-contents__link toc-highlight">9.4.3、僵尸进程和 SIGCHLD</a></li><li><a href="#944手动发送信号" class="table-of-contents__link toc-highlight">9.4.4、手动发送信号</a></li><li><a href="#945pkill-和-killall" class="table-of-contents__link toc-highlight">9.4.5、pkill 和 killall</a><ul><li><a href="#9451-pkill-命令" class="table-of-contents__link toc-highlight">9.4.5.1 pkill 命令</a></li><li><a href="#9452killall-命令" class="table-of-contents__link toc-highlight">9.4.5.2、killall 命令</a></li></ul></li></ul></li><li><a href="#95-fuser-和-lsof" class="table-of-contents__link toc-highlight">9.5 fuser 和 lsof</a><ul><li><a href="#951fuser-命令" class="table-of-contents__link toc-highlight">9.5.1、fuser 命令</a></li><li><a href="#952lsof-命令" class="table-of-contents__link toc-highlight">9.5.2、lsof 命令</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Study</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/en/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/skill">Notes</a></li><li class="footer__item"><a class="footer__link-item" href="/en/project">Projects</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/linux">Linux</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/about">About Me</a></li><li class="footer__item"><a href="https://github.com/zqingfa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Juejin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/en/friends">Friends</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/en/website">Links</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">闽ICP备2020017848号-2</a></p><p>Copyright © 2020 – PRESENT kuizuo Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.06ffa367.js"></script>
<script src="/en/assets/js/main.7f2e5564.js"></script>
</body>
</html>