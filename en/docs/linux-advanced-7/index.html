<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-linux/advanced/linux-advanced-7">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">第 7 章 Linux httpd 服务进阶配置 - Linux技术分享</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zhangqf.com/en/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://zhangqf.com/en/img/logo.png"><meta data-rh="true" property="og:url" content="https://zhangqf.com/en/docs/linux-advanced-7"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="第 7 章 Linux httpd 服务进阶配置 - Linux技术分享"><meta data-rh="true" name="description" content="6.1、httpd 虚拟主机配置"><meta data-rh="true" property="og:description" content="6.1、httpd 虚拟主机配置"><meta data-rh="true" name="keywords" content="linux,httpd"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhangqf.com/en/docs/linux-advanced-7"><link data-rh="true" rel="alternate" href="https://zhangqf.com/en/docs/linux-advanced-7" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-7" hreflang="zh"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-7" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9B0V5WT2X8-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Linux技术分享" href="/en/opensearch.xml">
<link rel="preconnect" href="https://zhangqf.com/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://zhangqf.com/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?77dc6b24cf1d939292e9fe13be271a96",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/en/rss.xml" title="zhangqf RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/atom.xml" title="zhangqf Atom Feed">
<link rel="alternate" type="application/json" href="/en/feed.json" title="zhangqf JSON Feed">

<link rel="icon" href="/en/img/logo.png">
<link rel="manifest" href="/en/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><link rel="stylesheet" href="/en/assets/css/styles.86c9ae18.css">
<link rel="preload" href="/en/assets/js/runtime~main.9e6f80ce.js" as="script">
<link rel="preload" href="/en/assets/js/main.77e89f19.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>更新 <a href="/website">网址导航</a> 带你发现感兴趣的技术</span></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">kuizuo</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/en/docs/linux">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/category/Linux基础">Linux 基础</a></li><li><a class="dropdown__link" href="/en/docs/category/Linux进阶">Linux 进阶</a></li><li><a class="dropdown__link" href="/en/docs/category/Linux测试">Linux 测试</a></li><li><a class="dropdown__link" href="/en/docs/category/LinuxCICD">Linux CICD研发</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Blog</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/tags">Tags</a></li><li><a class="dropdown__link" href="/en/archive">Archive</a></li></ul></div><a class="navbar__item navbar__link" href="/en/docs/skill/">Notes</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Tools</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/tools/">Recommended Tools</a></li><li><a href="https://api.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">API Service</a></li><li><a href="https://js-de-obfuscator.vercel.app" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS Deobfuscate</a></li><li><a href="https://cipher.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">CyberChef Encryption</a></li></ul></div><a class="navbar__item navbar__link" href="/en/website">Links</a><a class="navbar__item navbar__link" href="/en/project">Projects</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/en/docs/linux-advanced-7" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-GB">English</a></li><li><a href="/docs/linux-advanced-7" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/en/"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"><b>kuizuo</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/linux">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux基础">Linux基础</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux基础&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/docs/category/linux进阶">Linux进阶</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux进阶&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-1">第 1 章 Linux 进阶命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-2">第 2 章 Linux 防火墙</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-3">第 3 章 Linux NFS 网络文件系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-4">第 4 章 Linux DHCP 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-5">第 5 章 Linux DNS 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-6">第 6 章 Linux httpd 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/linux-advanced-7">第 7 章 Linux httpd 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-8">第 8 章 Linux httpd 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-9">第 9 章 Linux Nginx 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-10">第 10 章 Linux Tomcat 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-11">第 11 章 Linux Tomcat 服务实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-12">第 12 章 Linux haproxy 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-13">第 13 章 Linux haproxy 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-14">第 14 章 Linux haproxy 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-15">第 15 章 Linux LVS 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-16">第 16 章 Linux Keepalived 服务配置</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux测试">Linux测试</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux测试&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linuxcicd">LinuxCICD</a><button aria-label="Toggle the collapsible sidebar category &#x27;LinuxCICD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/category/linux进阶"><span itemprop="name">Linux进阶</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第 7 章 Linux httpd 服务进阶配置</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>第 7 章 Linux httpd 服务进阶配置</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61httpd-虚拟主机配置">6.1、httpd 虚拟主机配置<a class="hash-link" href="#61httpd-虚拟主机配置" title="Direct link to heading">​</a></h2><p>httpd 使用 VirtualHost 指令进行虚拟主机的定义。支持三种虚拟主机：基于 ip，基于端口和基于名称。其中基于端口的虚拟主机在 httpd 的术语上也属于基于 IP 的。</p><p>当一个请求到达时，将首先匹配虚拟主机。匹配虚拟主机的规则为最佳匹配法。所谓最佳，是指通配的越少，匹配的<strong>优先级</strong>越高。</p><ul><li>例如 &quot;192.168.0.99:80&quot; 的优先级高于 &quot;<!-- -->*<!-- -->:80&quot;。</li><li>如果基于名称的虚拟主机无法匹配上，则采用虚拟主机列表中的第一个虚拟主机作为响应主机。</li><li>如果所有虚拟主机都无法匹配上，则采用从主配置段落中的主机，如果主配置段落中注释了 DocumentRoot，则返回对应的错误。</li></ul><p>主配置段落的指令基本上都能使用在虚拟主机容器中。至于虚拟主机中必须配有什么指令，这没有规定，因为虚拟主机只是封装一组指令而已，即使其中没有任何指令，它也会从主配置段落中继承。</p><p>但是，既然要使用且已经使用了虚拟主机，按照常理来说，至少得提供不同的 ServerName，DocumentRoot 等指令以让它们各自独立。</p><p>最后需要说明的是，httpd 的 &quot;-S&quot; 选项在调试虚拟主机配置选项时非常有用。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="611基于-ip-的虚拟主机">6.1.1、基于 IP 的虚拟主机<a class="hash-link" href="#611基于-ip-的虚拟主机" title="Direct link to heading">​</a></h3><p>基于 IP 的虚拟主机是在不同的 IP+PORT 上提供不同的站点服务，最常见的是在不同端口上提供不同站点。</p><p>如果仅基于 IP，使用不同 IP 地址，那么要求操作系统上有两个或更多 IP 地址，可以提供多个网卡，或者通过网卡别名来实现。</p><p>如果基于端口，使用不同端口，则使用相同 IP 或不同 IP 均可，但在 httpd 术语中，基于单个 IP 但不同端口的虚拟主机，也是基于 IP 的虚拟主机。</p><p>假设本机为 192.168.0.99：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 首先设置个虚拟网卡。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ip add add 192.168.0.111 dev eth0 label eth0:0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 添加基于IP地址的虚拟主机，DocumentRoot使用的相对路径，基于ServerRoot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim /etc/apache/extra/vhosts.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot htdocs/a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.111:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot htdocs/b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在主配置文件中，将该虚拟主机配置文件 vhosts.conf 包含进去：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Include /etc/apache/extra/vhosts.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再提供 DocumentRoot 和各自的 index.html：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mkdir /usr/local/apache/htdocs/{a.com,b.com}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27;&lt;h1&gt;a.com&lt;h1&gt;&#x27; &gt;/usr/local/apache/htdocs/a.com/index.html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27;&lt;h1&gt;b.com&lt;h1&gt;&#x27; &gt;/usr/local/apache/htdocs/b.com/index.html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 <code>httpd -S</code> 查看配置文件加载过程：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># /usr/local/apache/bin/httpd -S -f /etc/apache/httpd.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">VirtualHost configuration:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.111:80       www.b.com </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">/etc/apache/extra/vhosts.conf:6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99:80        www.a.com </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">/etc/apache/extra/vhosts.conf:1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ServerRoot: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/usr/local/apache&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Main DocumentRoot: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/usr/local/apache/htdocs&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Main ErrorLog: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/usr/local/apache/logs/error_log&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Mutex default: </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">dir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/usr/local/apache/logs/&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">mechanism</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">default </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PidFile: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/usr/local/apache/logs/httpd.pid&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Define: DUMP_VHOSTS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Define: DUMP_RUN_CFG</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">User: </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;daemon&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Group: </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;daemon&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启 httpd：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">service</span><span class="token plain"> httpd restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.0.99:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">a.com</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.0.111:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">b.com</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>注意：以上的实验是基于 httpd 源码编译实验后，进行的虚拟主机实验。httpd 源码编译后还有一些配置需要完善，请参见 <a href="https://www.brinnatt.com/high/%e7%ac%ac-6-%e7%ab%a0-linux-httpd-%e6%9c%8d%e5%8a%a1%e9%ab%98%e7%ba%a7%e9%85%8d%e7%bd%ae/#67%E3%80%81%E5%BC%80%E5%A7%8B%E7%BC%96%E8%AF%91_httpd" target="_blank" rel="noopener noreferrer">httpd 源码编译</a>。</em></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="612基于端口的虚拟主机">6.1.2、基于端口的虚拟主机<a class="hash-link" href="#612基于端口的虚拟主机" title="Direct link to heading">​</a></h3><p>基于端口的虚拟主机需要监听两个套接字。</p><p>首先在配置文件中使用 Listen 指令修改监听套接字，这里假设只基于端口，所以只需修改端口号即可。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">listen </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">listen </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改虚拟主机配置文件 vhosts.conf 文件如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/apache/extra/vhosts.conf </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot htdocs/a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99:808</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot htdocs/b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启httpd，测试 <a href="http://www.a.com" target="_blank" rel="noopener noreferrer">www.a.com</a> 和 <a href="http://www.b.com" target="_blank" rel="noopener noreferrer">www.b.com</a> 能否显示：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl daemon-reload </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart httpd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.0.99:80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">a.com</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.0.99:8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">b.com</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="613基于名称的虚拟主机">6.1.3、基于名称的虚拟主机<a class="hash-link" href="#613基于名称的虚拟主机" title="Direct link to heading">​</a></h3><p>请求报文中获取资源时包含了两部分资源定位的格式：TCP/IP 协议和 HTTP 协议，虽然 TCP/IP 部分相同，但是 HTTP 协议的请求报文中指定了 HOST，这就是基于域名的虚拟主机能实现的原因。也因此，基于名称的虚拟主机必须指定 ServerName 指令，否则它将会继承操作系统的 FQDN。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/apache/extra/vhosts.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot htdocs/a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot htdocs/b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试：为了方便测试，在没有 DNS 服务的前提下，需要在 hosts 文件中配置临时域名解析，然后重启服务，测试域名请求。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/hosts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99 www.a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99 www.b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># service httpd restart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Restarting httpd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">via systemctl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">:                          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">  OK  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl www.a.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">a.com</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl www.b.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">b.com</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p><em>注意：对于基于名称的虚拟主机，当使用 IP 地址请求(例如浏览器中输入的是 IP 地址)，或者无法匹配到任何虚拟主机时，将采用第一个虚拟主机作为默认虚拟主机。</em></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.0.99</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;192.168.0.99 www.c.com&quot; &gt;&gt; /etc/hosts # 没有配置对应虚拟主机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl www.c.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><em>注意：ServerName 用于唯一标识提供 web 服务的主机名，只有在基于名称的虚拟主机中该指令才是必须提供的。</em></p><ul><li><em>如果不是在基于名称的虚拟主机中，可以任意指定该指令的值，只要你认为它能唯一标识你的主机。</em></li><li><em>但如果不设置该指令，那么 httpd 在启动时，将会反解操作系统的 IP 地址。</em></li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62httpd-网页身份认证">6.2、httpd 网页身份认证<a class="hash-link" href="#62httpd-网页身份认证" title="Direct link to heading">​</a></h2><p>httpd 对 web 身份认证的支持很丰富，提供的控制也非常细致。无疑，功能丰富意味着模块多。关于完整的模块，见 <a href="https://httpd.apache.org/docs/2.4/mod/" target="_blank" rel="noopener noreferrer">https://httpd.apache.org/docs/2.4/mod/</a> ，其中 mod<!-- -->_<!-- -->authX<!-- -->_<!-- -->XXX 都是和认证有关的模块。</p><p>要实现最基本的帐户认证访问控制，只需几个常见的模块即可：mod<!-- -->_<!-- -->authz<!-- -->_<!-- -->core，mod<!-- -->_<!-- -->authz<!-- -->_<!-- -->user，mod<!-- -->_<!-- -->authz<!-- -->_<!-- -->host ... 。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="621htpasswd-命令">6.2.1、htpasswd 命令<a class="hash-link" href="#621htpasswd-命令" title="Direct link to heading">​</a></h3><p>htpasswd 用于为指定用户生成基于网页用户身份认证的密码，由 httpd-tools 软件包提供。支持 3 种加密算法：MD5、SHA 和系统上的 crypt() 函数，不指定算法时，默认为 md5。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">htpasswd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -c </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -m </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -D </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> passwdfile username</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">htpasswd -b </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -c </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -m </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> -d </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> -p </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> -s </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -D </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> passwdfile username password</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">htpasswd -n </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -m </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> -d </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> -s </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> -p </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> username</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">htpasswd -nb </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -m </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> -d </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> -s </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> -p </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> username password</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">passwdfile：包含用户名及其密码的用户密码文件。如果使用了</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-c&quot;</span><span class="token plain">选项，则会创建或覆盖文件。不使用</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-n&quot;</span><span class="token plain">选项时必须指定passwdfile参数。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">username：为指定的用户名创建密码。如果该用户记录已存在，则更新。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-c：创建用户密码文件passwdfile，如果文件已经存在则会覆盖已存在的文件。不能和</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-n&quot;</span><span class="token plain">一起使用。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-n：在标准输出中输出结果，而不是将其写入到用户密码文件中。该选项会忽略用户密码文件passwdfile参数。不能和</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-c&quot;</span><span class="token plain">选项一起使用。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-m：使用MD5加密算法。默认。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-d：使用crypt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">函数计算密码，不安全。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s：使用SHA加密算法。安全。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-P：强制不加密密码，保持明文状态，不安全。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-B：强制bcrypt加密密码，非常安全。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-D：从用户密码文件中删除指定的用户及其密码。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-b：使用批处理模式，即非交互模式，可以直接待加密的传递明文密码。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">password：指定要输入的明文密码。只能在批处理模式中使用，即和</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-b&quot;</span><span class="token plain">一起使用。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><p>使用 &quot;-n&quot; 选项直接将结果输出到标准输出而不创建 passwdfile。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># htpasswd -n brinnatt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">New password: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Re-type new password: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt:</span><span class="token variable" style="color:rgb(9, 134, 88)">$apr1</span><span class="token variable" style="color:rgb(9, 134, 88)">$LchJiq9J</span><span class="token variable" style="color:rgb(9, 134, 88)">$JpMVs4SxFvXP</span><span class="token plain">.Wrt5/ETU1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>使用批处理模式直接传递密码。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># htpasswd -nb brinnatt Firewall; htpasswd -nb brinnatt Firewall</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt:</span><span class="token variable" style="color:rgb(9, 134, 88)">$apr1</span><span class="token variable" style="color:rgb(9, 134, 88)">$f5FXdjZ2</span><span class="token variable" style="color:rgb(9, 134, 88)">$hK3MzwAs2HV</span><span class="token plain">.oX9Kw5Evi0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt:</span><span class="token variable" style="color:rgb(9, 134, 88)">$apr1</span><span class="token variable" style="color:rgb(9, 134, 88)">$ay7Tf9Wt</span><span class="token variable" style="color:rgb(9, 134, 88)">$Sjp3FekQyNqOgwZwNNED5</span><span class="token plain">/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>发现密码完全是随机的。</li></ul></li><li><p>创建用户密码文件 passwdfile。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># htpasswd -cb usercryfile brinnatt Firewall</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Adding password </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> user brinnatt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat usercryfile </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt:</span><span class="token variable" style="color:rgb(9, 134, 88)">$apr1</span><span class="token variable" style="color:rgb(9, 134, 88)">$0E6btbxL</span><span class="token variable" style="color:rgb(9, 134, 88)">$NuKbnLvfu</span><span class="token plain">.277/a8R5aMw1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>删除用户文件中的某用户。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># htpasswd -D usercryfile brinnatt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Deleting password </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> user brinnatt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat usercryfile </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>使用 sha 和 md5 加密算法计算密码。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># htpasswd -sb usercryfile brinnatt Firewall</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Adding password </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> user brinnatt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat usercryfile </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">SHA</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">SZotReXw4wRZa3tm9mgzEk8zAFg</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># htpasswd -mb usercryfile Tina Passkey</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Adding password </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> user Tina</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat usercryfile </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">SHA</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">SZotReXw4wRZa3tm9mgzEk8zAFg</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tina:</span><span class="token variable" style="color:rgb(9, 134, 88)">$apr1</span><span class="token variable" style="color:rgb(9, 134, 88)">$mFxN</span><span class="token plain">/NhQ</span><span class="token variable" style="color:rgb(9, 134, 88)">$VYNBh1D</span><span class="token plain">/1O2S2R/Q4ndGn0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="622身份认证类基本指令">6.2.2、身份认证类基本指令<a class="hash-link" href="#622身份认证类基本指令" title="Direct link to heading">​</a></h3><p><code>AuthType</code>：指定 web 身份认证的类型。有效值为 none、basic、digest 以及 form。通常最基本的认证使用的是文件认证，所以通常使用 basic。</p><p><code>AuthName</code>：设置身份认证时的提示信息。</p><p><code>AuthUserFile file-path</code>：指定 web 用户认证列表。由 htpasswd 命令生成。</p><p><code>AuthGroupFile file-path</code>：指定组认证文件，文件中分组格式为 &quot;mygroup: Jim Bob Alice&quot;。如果文件路径为相对路径，则相对于 ServerRoot。</p><p>基于 basic 类型的认证就这么几个指令，最主要的还是 require 指令的使用。更多的认证方法见官方手册的 auth 类模块。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="623require-指令">6.2.3、Require 指令<a class="hash-link" href="#623require-指令" title="Direct link to heading">​</a></h3><p>该指令只能放在 Directory 容器中，用于控制对目录的访问权限。它的主要功能是由 mod<!-- -->_<!-- -->authz<!-- -->_<!-- -->core 模块提供，但有些身份认证类模块也提供它额外的功能，这时它可以放在 &lt; Directory &gt;、&lt; Files &gt; 或 &lt; Location &gt; 容器中。</p><p>主要功能：</p><ul><li>Require all granted：无条件允许所有人访问该目录</li><li>Require all denied：无条件拒绝所有人访问该目录</li><li>Require env env-var <!-- -->[<!-- -->env-var<!-- -->]<!-- --> ...：只有给定的环境变量 var-env 已经定义才允许访问该目录</li><li>Require method http-method <!-- -->[<!-- -->http-method<!-- -->]<!-- --> ...：只有给定的 HTTP 请求方法才允许访问该目录，如只允许 GET 才能访问</li><li>Require expr expression：只有给定的表达式为 true 才允许访问该目录</li></ul><p>身份认证类模块提供的 require 指令功能包括：</p><ul><li>mod<!-- -->_<!-- -->authz<!-- -->_<!-- -->user 为 require 指令提供的功能：<ul><li>Require user userid <!-- -->[<!-- -->userid<!-- -->]<!-- --> ...：认证列表中只有指定的 userid 才能访问</li><li>Require valid-user：认证列表中的所有用户都可以访问</li></ul></li><li>mod<!-- -->_<!-- -->authz<!-- -->_<!-- -->groupfile 为 require 指令提供的功能：<ul><li>Require group group1 <!-- -->[<!-- -->group2<!-- -->]<!-- --> ...：指定组内的用户都可以访问</li></ul></li><li>本地文件系统身份参考类：<ul><li>Require file-owner：要求 web 用户名必须和请求文件的 uid 对应的 username 完全相同</li><li>Require file-group：要求 web 用户名必须为请求文件的 gid 组中的一员</li></ul></li><li>mod<!-- -->_<!-- -->authz<!-- -->_<!-- -->host 为 require 指令提供的 ip 和 host 功能：<ul><li>Require ip 192.168.1.104 192.168.1.205</li><li>Require ip 10.1</li><li>Require ip 10 172.20 192.168.2</li><li>Require ip 10.1.0.0/255.255.0.0</li><li>Require ip 10.1.0.0/16</li><li>Require host <a href="http://www.example.org" target="_blank" rel="noopener noreferrer">www.example.org</a></li><li>Require host example.org</li><li>Require host .net example.edu</li><li>Require local</li></ul></li></ul><p>可以在 require 指令后紧跟 not 关键字，表示取反。例如 &quot;require not group group1&quot;、&quot;require not local&quot; 等。</p><p>还支持 require 条件容器，包括 &lt; RequireAll &gt;、&lt; RequireAny &gt; 和 &lt; RequireNone &gt;，当 require 指令没有写在任何 Require 容器中时，它们隐式包含在一个 &lt; RequireAny &gt; 容器中。</p><ul><li>&lt; RequireAll &gt;：其内封装的 Require 指令必须全都不能失败，且至少有一个成功时，该容器成功。如果其内所有指令既不成功又不失败，则该容器中立。其余所有情况都会导致该容器失败。</li><li>&lt; RequireAny &gt;：其内封装的 Require 指令只要有一个成功，该容器就成功。如果其内所有指令既不成功又不失败，则该容器中立。其余所有情况(即全部失败时)都会导致该容器失败。</li><li>&lt; RequireNone &gt;：其内封装的 Require 指令只要有一个成功时该容器就失败，否则就中立。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="624web-身份认证示例">6.2.4、web 身份认证示例<a class="hash-link" href="#624web-身份认证示例" title="Direct link to heading">​</a></h3><p>以最常见的 Basic 认证方式为例。支持基于用户的认证和基于组的认证。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6241基于用户的认证">6.2.4.1、基于用户的认证<a class="hash-link" href="#6241基于用户的认证" title="Direct link to heading">​</a></h4><p>先创建一个 web 用户及其密码列表文件。其内有 4 个用户：East、South、West 和 North。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># htpasswd -cb /usr/local/apache/a_com.pass East EpassKey</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Adding password </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> user East</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># htpasswd -b /usr/local/apache/a_com.pass South SpassKey</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Adding password </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> user South</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># htpasswd -b /usr/local/apache/a_com.pass West WpassKey</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Adding password </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> user West</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># htpasswd -b /usr/local/apache/a_com.pass North NpassKey</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Adding password </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> user North</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /usr/local/apache/a_com.pass </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">East:</span><span class="token variable" style="color:rgb(9, 134, 88)">$apr1</span><span class="token variable" style="color:rgb(9, 134, 88)">$SnPs00ty</span><span class="token variable" style="color:rgb(9, 134, 88)">$u</span><span class="token plain">/5llOVRdnmJ/fM8XAPBF1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">South:</span><span class="token variable" style="color:rgb(9, 134, 88)">$apr1</span><span class="token variable" style="color:rgb(9, 134, 88)">$AxSf3CFN</span><span class="token variable" style="color:rgb(9, 134, 88)">$PjbY2TSWe</span><span class="token plain">.lDHpGF7y.Dq.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">West:</span><span class="token variable" style="color:rgb(9, 134, 88)">$apr1</span><span class="token variable" style="color:rgb(9, 134, 88)">$B5A7z4yL</span><span class="token variable" style="color:rgb(9, 134, 88)">$MOQD1DGWkecdMCBfQ43eV0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">North:</span><span class="token variable" style="color:rgb(9, 134, 88)">$apr1</span><span class="token variable" style="color:rgb(9, 134, 88)">$Ois62HWt</span><span class="token variable" style="color:rgb(9, 134, 88)">$fFiXEzVcqf</span><span class="token plain">/q2mVim1AGL1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改 httpd 配置文件，假设只有 <a href="http://www.a.com" target="_blank" rel="noopener noreferrer">www.a.com</a> 中的 a.com 目录才需要认证且只有 East 和 West 可以认证，而其他目录以及 <a href="http://www.b.com" target="_blank" rel="noopener noreferrer">www.b.com</a> 不需要认证，其他用户认证不通过。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/apache/extra/vhosts.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot /usr/local/apache/htdocs/a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Directory /usr/local/apache/htdocs/a.com</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        AllowOverride Authconfig</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        AuthType Basic</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        AuthName </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;please enter your name &amp; passwd&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        AuthUserFile a_com.pass</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Require user East West </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/Directory</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot /usr/local/apache/htdocs/b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>此处 AuthUserFile 使用的相对路径，所以该文件必须放在 ServerRoot(我的测试环境 ServerRoot 为 /usr/local/apache)下。且 Require user 行可以替换为 &quot;Require valid-user&quot; 表示 a<!-- -->_<!-- -->com.pass 中的所有用户都允许认证。</li></ul><p>然后重启 httpd，并修改客户端 hosts 文件：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># service httpd restart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Restarting httpd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">via systemctl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">:                          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">  OK  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">编辑 windows C:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">System32</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">Drivers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">etc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">hosts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99 www.a.com www.b.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>windows 测试访问：</p><p><img loading="lazy" alt="httpd auth" src="data:image/png;base64,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" width="415" height="178" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6242基于组的认证">6.2.4.2、基于组的认证<a class="hash-link" href="#6242基于组的认证" title="Direct link to heading">​</a></h4><p>基于组的认证只需创建一个组文件，文件中包含的是组名和组中用户成员。</p><p>例如，将 South 和 North 加入到 allow 组，使它们也可以访问 a.com 目录。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27;allow:North South&#x27; &gt; /usr/local/apache/auth_group</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改配置文件，例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/apache/extra/vhosts.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot /usr/local/apache/htdocs/a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Directory /usr/local/apache/htdocs/a.com</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        AllowOverride Authconfig</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        AuthType Basic</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        AuthName </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;please enter your name &amp; passwd&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        AuthUserFile a_com.pass</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        AuthGroupFile auth_group</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Require user East West </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Require group allow</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/Directory</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.99:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot /usr/local/apache/htdocs/b.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再重启 httpd 服务进行测试。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="63httpd-日志和日志轮替工具">6.3、httpd 日志和日志轮替工具<a class="hash-link" href="#63httpd-日志和日志轮替工具" title="Direct link to heading">​</a></h2><p>需要记录的日志类型有：错误日志 ErrorLog、访问日志 CustomLog。错误日志一般采用默认即可，最多改下错误日志的存放路径，而 CustomLog 因为量比较多，很可能需要定制。</p><p>事实上，ErrorLog 由 httpd 的核心模块提供，而 CustomLog 却提供了专门的模块 mod<!-- -->_<!-- -->log<!-- -->_<!-- -->config 来处理，该模块还支持 TransferLog 指令，该指令和 CustomLog 作用和用法基本类似，如有需要可查官方手册，本文略过。</p><p>最后介绍两种日志轮替工具：apache httpd 自带的 rotatelogs 工具和 cronolog 工具。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="631错误日志-errorlog">6.3.1、错误日志 ErrorLog<a class="hash-link" href="#631错误日志-errorlog" title="Direct link to heading">​</a></h3><p>错误日志的级别 LogLevel：debug, info, notice, warn(默认), error, crit, alert, emerg。</p><p>错误日志的定义语法：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ErrorLog file-path</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">syslog</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">facility</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:tag</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果使用 syslog 替换 file-path，则表示采用系统自带的 syslog 日志工具，facility 是记录 syslog 日志的设施类型。一般来说，不会采用这种方法记录日志。</p><p>如果采用 file-path，则有两种方式：直接指定文件路径；前面使用管道，表示将输出的日志作为标准输入传递给管道后的日志处理程序，例如传递给 apache 自带的 rotatelogs 工具。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ErrorLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;logs/error_log&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ErrorLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;|/usr/local/apache/bin/rotatelogs /var/log/error_log 86400&quot;</span><span class="token plain"> common</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然，对于 ErrorLog 来说，数据量并不会太多，一般直接使用文件记录即可。对于 CustomLog，则可以考虑使用日志切割工具进行分割、轮替等行为。</p><p>错误日志的记录格式由 ErrorLogFormat 指令控制，例如以下是 worker 和 event 模式下错误日志的默认记录格式，其中各参数代表的意义见官方手册 <a href="http://httpd.apache.org/docs/2.4/mod/core.html#errorlogformat" target="_blank" rel="noopener noreferrer">ErrorLogFormat</a>。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ErrorLogFormat </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;[%{u}t] [%-m:%l] [pid %P:tid %T] %7F: %E: [client\ %a] %M% ,\ referer\ %{Referer}i&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="632访问日志-customlog">6.3.2、访问日志 CustomLog<a class="hash-link" href="#632访问日志-customlog" title="Direct link to heading">​</a></h3><p>使用 CustomLog 指令指定访问日志记录的位置，可以在同一个 host 下多次使用该指令表示同一条日志记录到多个位置。语法格式为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">CustomLog </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">pipe </span><span class="token function" style="color:rgb(0, 0, 255)">format</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">nickname </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">env</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">environment-variable</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">expr</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">expression</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 LogFormat 可以指定日志记录的事项，例如是否要记录客户端 IP 地址，是否要记录请求方法等。使用 LogFormat 还可以定义日志分类(在 httpd 术语中称为 nickname)，例如 common 类、combined 类、combinedio 类。它支持非常弹性化的记录事项，具体的见官方手册 <a href="http://httpd.apache.org/docs/2.4/mod/mod_log_config.html#formats" target="_blank" rel="noopener noreferrer">LogFormat</a>。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">LogFormat </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;%h %l %u %t </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%r</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)"> %&gt;s %b </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%{Referer}i</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)"> </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%{User-Agent}i</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token plain"> combined</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LogFormat </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;%h %l %u %t </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%r</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)"> %&gt;s %b&quot;</span><span class="token plain"> common</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IfModule logio_module</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># You need to enable mod_logio.c to use %I and %O</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  LogFormat </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;%h %l %u %t </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%r</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)"> %&gt;s %b </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%{Referer}i</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)"> </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%{User-Agent}i</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)"> %I %O&quot;</span><span class="token plain"> combinedio</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/IfModule</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后使用 CustomLog 指令就可以使用已经定义的日志类。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;logs/access_log&quot;</span><span class="token plain"> combined</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然，使用 LogFormat 定义分类只是为了方便，CustomLog 指令完全可以不使用 nickname 而是直接定义要记录的事项。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;logs/access_log&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;%h %l %u %t </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%r</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)"> %&gt;s %b </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%{Referer}i</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)"> </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%{User-Agent}i</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果提供 CustomLog 的第三个参数，即 env 或者 expr，则表示满足条件的请求才会记录日志。例如，当请求的是 gif 文件时将独立记录该日志，而其他请求则记录在另一个日志中。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SetEnvIf Request_URI </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">.gif$ gif-image</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;gif-requests.log&quot;</span><span class="token plain"> common </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">env</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">gif-image</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;nongif-requests.log&quot;</span><span class="token plain"> common </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">env</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain">gif-image</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通常来说，除了特殊需求，一般都只需使用 LogFormat 提供的各个事项即可。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="633日志轮替-rotatelogs-工具">6.3.3、日志轮替 rotatelogs 工具<a class="hash-link" href="#633日志轮替-rotatelogs-工具" title="Direct link to heading">​</a></h3><p>首先说明 rotatelogs 工具，它是 apache httpd 提供的一个基于时间间隔、大小切分日志的简单工具。</p><p>默认，它在启动时不会立即创建日志文件，而是在有请求到达时才会创建。同理在轮替时也如此，如果到达了轮替的时间间隔，如果没有新请求到达，则暂时不会创建新的日志文件。</p><p>如果使用 &quot;-f&quot; 选项，则在启动时，不管是否有没有请求，都立即创建日志文件。如果使用 &quot;-c&quot; 选项，则在每次轮替时无论是否有新请求到达，都创建新日志文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">rotatelogs </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -l </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -f </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -t </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -v </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -e </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -c </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -n number-of-files </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> logfile rotationtime</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">filesize</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">B</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">K</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">M</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">G</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>选项说明：</p><ul><li><code>logfile</code>：指定日志记录路径。可以加上一些修饰符，例如时间类的 <code>a.log_%Y.%m.%d</code> 将在 a.log 后追加年、月、日的后缀，如果没有给定任何后缀修饰，则自动加上 <code>&quot;.nnnnnnnn&quot;</code>，表示创建时的时间点换算成距离 <code>1970-01-01 00:00:00</code> 的总秒数，也就是 <code>&quot;date +%s&quot;</code>，每次轮替时也会加上该后缀。如果使用相对路径，则相对于 ServerRoot。</li><li><code>-n</code>：使用数字作为后缀，且表示轮替的循环列表，例如 <code>&quot;-n 3&quot;</code> 表示一直在 log.1、log.2、log.3 这三个文件中记录，不会再创建任何新的日志文件。</li><li><code>rotationtime</code>：指定轮替的时间间隔。将初始化为对应时间格式的起始值。例如，设置为 3600 时，将表示在每个小时的开头进行轮替，尽管当前时间点进入下一个小时可能只有 5 分钟，在 5 分钟之后也会进行一次轮替。</li><li><code>filesize</code>：以大小方式轮替日志。</li><li><code>-l</code>：使用本地时间计算时间间隔。默认使用的是 UTC 时间。</li><li><code>-f</code>：强制立即打开日志文件。因为有些时候在启动 httpd 时，可能一小段时间内没有任何请求到达，因为没有日志需要记录，所以暂时不会创建日志文件。使用该选项可立即创建文件。</li><li><code>-t</code>：截断日志而不再是轮替日志。这种情况下，不会再添加任何文件后缀。</li><li><code>-v</code>：详细记录轮替或截断时的信息。</li><li><code>-e</code>：将日志也输出到标准错误输出中。当日志还需要被其他工具处理时，该选项有用。</li><li><code>-c</code>：每个时间间隔到了都创建新文件，尽管没有日志到达。而默认的情况下，在轮替时间间隔到达时，如果没有日志到达，将暂时不会创建日志，而是等待第一个请求到达后才创建。</li></ul><p>注意，如果出现了轮替时文件名重复的情况，例如按照 5M 大小进行轮替，但文件名的格式为 <code>&quot;a.log_%Y.%m.%d&quot;</code>，如果同一天内出现了多次轮替，由于文件名相同，则会覆盖旧文件进行记录。</p><p>另外，rotatelogs 只能对日志文件名本身使用时间类修饰符，无法将其设置在目录上，否则启动 httpd 时会因为无法打开日志而报错。</p><p>示例：以下使用了日志管道 &quot;|&quot;，表示记录的日志传递给后面的程序(此处为 rotatelogs) 进行处理。</p><p>每天轮替一次 <code>$ServerRoot/logs/mylog.nnnnnnnn</code>，其中 nnnnnnnn 是当前时间换算成秒的数值。且在启动时不立即创建日志文件，轮替时也不立即创建新日志文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;|/usr/local/apache/bin/rotatelogs logs/mylog 86400&quot;</span><span class="token plain"> common</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>按照文件大小轮替。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;|bin/rotatelogs /var/log/logfile 5M&quot;</span><span class="token plain"> common</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>轮替错误日志，达到 5M 时就轮替。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ErrorLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;|bin/rotatelogs /var/log/errorlog.%Y-%m-%d-%H_%M_%S 5M&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>截断日志而非轮替日志。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;|bin/rotatelogs -t /var/log/logfile 86400&quot;</span><span class="token plain"> common</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以下是日期类的修饰符。下面的 cronolog 工具也采用这同一套修饰符。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">%    %字符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">n    换行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">t    水平制表符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">时间类:  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">H    小时</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">I    小时</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">01</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">p    该locale下的AM或PM标识</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">M    分钟</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token number" style="color:rgb(9, 134, 88)">59</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">S    秒 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token number" style="color:rgb(9, 134, 88)">61</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">which</span><span class="token plain"> allows </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> leap seconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">X    该locale下时间表示符</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e.g.: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;15:12:47&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Z    时区。若时区不能确定，则无意义</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">日期类:  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a    该locale下的工作日简名</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e.g.: Sun</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">Sat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">A    该locale下的工作日全名</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e.g.: Sunday </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">  Satur-ay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">b    该locale下的月份简称</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e.g.: Jan </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"> Dec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">B    该locale下的月份全称</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e.g.:  January </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"> December</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">c    该locale下的日期和时间</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e.g.: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Sun Dec 15  14:12:47 GMT 1996&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">d    当月中的天数 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">01 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">j    当年中的天数 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">001 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">366</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">m    月数 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">01 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">U    当年中的星期数，以周日作为一周开始,其中第一周为首个含星期天的星期</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token number" style="color:rgb(9, 134, 88)">53</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">W    当年中的星期数，以星期一作为一周的开始,其中第一周为首个含星期天的星期</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token number" style="color:rgb(9, 134, 88)">53</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">w    工作日数</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">, </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">表示星期天</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">x    该locale下的日期表示</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e.g. </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;13/04/97&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">y    两位数的年份</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">99</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Y    四位数的年份</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1970</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2038</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="634日志轮替-cronolog-工具">6.3.4、日志轮替 cronolog 工具<a class="hash-link" href="#634日志轮替-cronolog-工具" title="Direct link to heading">​</a></h3><p>通过 epel 源安装：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install cronolog -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cronolog -h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">usage: cronolog </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">OPTIONS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> logfile-spec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -H NAME,   --hardlink</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">NAME maintain a hard </span><span class="token function" style="color:rgb(0, 0, 255)">link</span><span class="token plain"> from NAME to current log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -S NAME,   --symlink</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">NAME  maintain a symbolic </span><span class="token function" style="color:rgb(0, 0, 255)">link</span><span class="token plain"> from NAME to current log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -P NAME,   --prev-symlink</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">NAME  maintain a symbolic </span><span class="token function" style="color:rgb(0, 0, 255)">link</span><span class="token plain"> from NAME to previous log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -l NAME,   --link</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">NAME     same as -S/--symlink</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -h,        --help          print this help, </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -p PERIOD, --period</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">PERIOD </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> the rotation period explicitly</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -d DELAY,  --delay</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DELAY   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> the rotation period delay</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -o,        --once-only     create single output log from template </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">not rotated</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -x FILE,   --debug</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">FILE    </span><span class="token function" style="color:rgb(0, 0, 255)">write</span><span class="token plain"> debug messages to FILE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                              </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> or to standard error </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> FILE is </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -a,        --american         American </span><span class="token function" style="color:rgb(0, 0, 255)">date</span><span class="token plain"> formats</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -e,        --european         European </span><span class="token function" style="color:rgb(0, 0, 255)">date</span><span class="token plain"> formats </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -s,    --start-time</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">TIME   starting </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -z TZ, --time-zone</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">TZ      use TZ </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> timezone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   -V,      --version         print version number, </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个工具的使用非常简单，但必须得搞懂它的轮替原理。以下面设置为例：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;|/usr/local/sbin/cronolog logs/%Y/%m/%d/access.log&quot;</span><span class="token plain"> combined</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>由于使用的是相对路径，所以它相对于 ServerRoot。假设 ServerRoot 为 /usr/local/apache，则这里的日志将创建在 <code>/usr/local/apache/logs/%Y/%m/%d/access.log</code>，其中 <code>%Y、%m、%d</code> 分别表示的是年、月、日。这些修饰符组成的文件名或目录被称为模板。</li></ul><p>cronolog 的轮替原理是：</p><ul><li>根据当前日志文件模板的时间点，和当前时间进行比较，如果模板中的某个部分和当前时间点不同，则需要进行轮替，轮替时会自动创建缺失的目录，并且计算下一次进行轮替的时间点。</li><li>在轮替时，先关闭当前日志文件，再根据当前时间点创建新日志文件，并打开新日志文件。</li><li>但注意，cronolog 工具在创建或轮替时，如果没有请求到达，则不会立即创建日志文件，这和 rotatelogs 工具的默认情况是一样的。</li></ul><p>看上去很简单，确实很简单，它只需要根据指定的时间修饰符和当前时间点进行比较就可以了。</p><p>例如上面的配置，如果当前时间点为 2021-10-01，则按照以下顺序进行创建，注意，只有在请求到达时才会创建，没有请求时是不会创建的。</p><ol><li>Period 1：在第一个请求到达时创建<ul><li>logs/2021 目录是否存在，不存在则创建。</li><li>logs/2021/10 目录是否存在，不存在则创建。</li><li>logs/2021/10/01 目录是否存在，不存在则创建。</li><li>创建 logs/2021/10/01/access.log 文件，并写日志。</li></ul></li><li>Period 2：在 2021-10-02 凌晨第一个请求到达时创建<ul><li>logs/2021 目录已存在，不创建。</li><li>logs/2021/10 目录已存在，不创建。</li><li>logs/2021/10/02 目录不存在，创建。</li><li>创建 logs/2021/10/02/access.log 文件，并写日志。</li></ul></li><li>之后将继续按照此规则不断进行下去 ......</li></ol><p>也就是说，cronolog 默认将按照最小单位的时间修饰符为轮替时间间隔。例如，最小单位为 <code>%d</code> 时，将按照天轮替，最小单位为 <code>%W</code> 将按周轮替，最小单位为 <code>%S</code>，将按秒轮替。但仍然需要说明的是，只有请求到达时，才会按照当前时间点创建新的日志文件。</p><ul><li>例如，如果按秒轮替，第 10 秒时创建了一个文件 10.log，第 11 秒将关闭该日志文件，但是不会立即创建新日志文件，假设在第 15 秒时新的请求到达，则创建一个 15.log，而不是 11.log。</li></ul><p>此外，cronolog 可使用 &quot;-p N UNITs&quot; 选项显式指定轮替时间间隔，有效单位 UNITs 为：seconds, minutes, hours,days, weeks 和 months。</p><ul><li>例如 &quot;-p 5 minutes&quot; 表示每 5 分钟轮替一次。</li><li>但需要注意，N 的值必须为更高一级 UNITs 的公因数(不包括最大公因数)，例如小时的长度为 60 分钟，在指定 minutes 单位时，可以指定 &quot;1,2,3,4,5,6,10,15,20,30 minutes&quot;，但不能指定为 &quot;7,9,11,12,13,14&quot; 等 minutes。</li></ul><p>如果不想轮替，有两种方法：不要使用时间类的修饰符；使用 &quot;-o&quot; 选项。这时候会一直写同一个文件。</p><p>cronolog 还支持动态符号链接功能，例如下面的配置，这样就使得每次访问 /usr/local/apache/logs/access<!-- -->_<!-- -->log 都能访问到最新的日志文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;|/path/to/cronolog --symlink=/usr/local/apache/logs/access_log /usr/local/apache/logs/%Y/%m/access_log&quot;</span><span class="token plain"> combined</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后，cronolog 不支持日志截断。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="635rotatelogs-和-cronolog-的比较">6.3.5、rotatelogs 和 cronolog 的比较<a class="hash-link" href="#635rotatelogs-和-cronolog-的比较" title="Direct link to heading">​</a></h3><p>这两个工具各有优缺点：</p><ol><li>在日志文件路径上：rotatelogs 无法将时间类修饰符作为目录，只能使用在日志文件名上。而 cronolog 可以。例如 <code>logs/%Y%m/%d/access.log</code>。</li><li>在日志控制力度上：rotatelogs 对日志的控制力更强，它可以控制启动时、轮替时是否立即创建日志文件。而 cronolog 仅只能在有新请求到达时才创建日志文件。</li><li>在特性上：rotatelogs 更丰富一些，它支持日志截断，支持在一定数量内循环轮替。而 cronolog 只能轮替，且只能按照时间不断向后轮替。</li><li>在日志访问方便性上：cronolog 通过它的动态符号链接功能使得这一点比 rotatelogs 方便的多。</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="64httpd-路径映射和重定向">6.4、httpd 路径映射和重定向<a class="hash-link" href="#64httpd-路径映射和重定向" title="Direct link to heading">​</a></h2><p>主要包括 Alias 指令、AliasMatch、Redirect、RedirectMatch、ScriptAlias 和 ScriptAliasMatch。它们由 mod<!-- -->_<!-- -->alias 模块提供，该模块用于提供简单的路径映射和重定向需求，更复杂的内容见 <a href="http://httpd.apache.org/docs/2.4/mod/mod_rewrite.html" target="_blank" rel="noopener noreferrer">URL重写</a>。</p><p>其中 ScriptAlias 用法和 Alias 完全一样，唯一不同的是 ScriptAlias 映射的目标路径被认为是 CGI 文件或包含 CGI 文件的目录，它们将会被 cgi 处理器处理执行。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="641处理顺序">6.4.1、处理顺序<a class="hash-link" href="#641处理顺序" title="Direct link to heading">​</a></h3><p>Redirect、RedirectMatch 指令优先于 Alias、AliasMatch 进行处理；同类型的 Redirect 或 Alias 按照出现顺序进行匹配，匹配到了立即停止。</p><p>例如，如果几个指令按照下面的顺序出现：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Redirect1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Alias1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AliasMatch2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Alias3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RedirectMatch2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Redirect3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>那么它们匹配的顺序为：Redirect1 &gt; RedirectMatch2 &gt; Redirect3 &gt; Alias1 &gt; AliasMatch2 &gt; Alias3。且一被匹配立即生效，后面的将被忽略。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="642alias-和-aliasmatch">6.4.2、Alias 和 AliasMatch<a class="hash-link" href="#642alias-和-aliasmatch" title="Direct link to heading">​</a></h3><p>Alias 指令用于将 URL 路径映射到本地文件系统的路径，且本地路径不受 DocumentRoot 的限制。AliasMatch 是正则版本的 Alias。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Alias </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/image&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/ftp/pub/image&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这将使得 <a href="http://myserver/image/foo.gif" target="_blank" rel="noopener noreferrer">http://myserver/image/foo.gif</a> 的请求得到 /ftp/pub/image/foo.gif，由于是精确匹配的，所以 <a href="http://myserver/image/foo.gif" target="_blank" rel="noopener noreferrer">http://myserver/image/foo.gif</a> 不会返回该路径下的文件。但 Alias 有支持正则匹配的指令 AliasMatch。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">AliasMatch </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;(?i)^/image(.*)&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/ftp/pub/image</span><span class="token string variable" style="color:rgb(9, 134, 88)">$1</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Alias 中如果 URL 部分包含了尾随斜线，则映射路径也应该包含斜线。例如下面的例子，这时如果请求 <a href="http://myserver/icons" target="_blank" rel="noopener noreferrer">http://myserver/icons</a> ，将不会得到 /usr/local/apache/icons/$DirectoryIndex。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Alias </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/icons/&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/usr/local/apache/icons/&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>设置了 Alias 后，需要考虑映射到的本地路径的权限是否放行。特别是对于 DocumentRoot 外的路径，通常会因为 &lt; Directory &quot;/&quot;&gt; 的拒绝而导致这些映射目标不能访问。所以，对于这样的映射路径应该还需要为 Alias 指令配一个 &lt; Directory &gt; 容器放行。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Alias </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/image&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/ftp/pub/image&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/ftp/pub/image&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Require all granted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/Directory</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果 Alias 或 AliasMatch 出现在 &lt; Location &gt; 容器中，则它们只需要一个映射路径作为参数即可，因为 URL 已经包含在容器路径中。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Location </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/image&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Alias </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/ftp/pub/image&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/Location</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="643redirect-和-redirectmatch-指令">6.4.3、Redirect 和 RedirectMatch 指令<a class="hash-link" href="#643redirect-和-redirectmatch-指令" title="Direct link to heading">​</a></h3><p>它们告知客户端资源已经转移，让它们重新发送对新路径资源的 HTTP 请求。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Redirect </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> old-URL new-URL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>旧的 URL 必须是以斜线 &quot;/&quot; 开头的绝对路径，新 URL 也必须是绝对路径，但可以是包含了 scheme://serverhost 的绝对路径，也可以是使用斜线开头的绝对路径。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 重定向到不同主机上</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Redirect </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/service&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://foo2.example.com/service&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 重定向到相同主机上</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Redirect </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/one&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/two&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>如果客户端请求 <a href="http://example.com/service/foo.txt" target="_blank" rel="noopener noreferrer">http://example.com/service/foo.txt</a> ，将被告知重新去请求 <a href="http://foo2.example.com/service/foo.txt" target="_blank" rel="noopener noreferrer">http://foo2.example.com/service/foo.txt</a> 。</li><li>可以是包含 GET 参数的 URL，例如 <a href="http://example.com/service/foo.pl?q=23&amp;a=42" target="_blank" rel="noopener noreferrer">http://example.com/service/foo.pl?q=23<!-- -->&amp;<!-- -->a=42</a> ，将重定向到 <a href="http://foo2.example.com/service/foo.pl?q=23&amp;a=42" target="_blank" rel="noopener noreferrer">http://foo2.example.com/service/foo.pl?q=23<!-- -->&amp;<!-- -->a=42</a> 。但注意，POST 方法会被无视。</li></ul><p>如果没有指定 status 参数，则重定向是临时重定向(HTTP status 302)。对客户端来说，此资源的路径变动是临时性的。以下几个 status 参数可以返回各自不同的 HTTP 状态码：</p><ul><li>permanent：返回一个永久性重定向状态码(301)，表示此资源的位置变动是永久性的。</li><li>temp：返回一个临时性重定向状态码(302)，这是默认值。</li><li>seeother：返回一个 &quot;参见&quot; 状态码(303)，表示此资源已经被替代。</li><li>gone：返回一个 &quot;已废弃&quot; 状态码(410)，表示此资源已经被永久性地删除了。如果指定了这个状态码，则 new-URL 参数将被忽略。</li></ul><p>status 可以被指定为某个数值以返回其他指定状态码。如果此值在 300-399 之间，则必须提供 new-URL 参数，否则必须忽略 new-URL，但不管如何，值必须是有效的 http 状态码值。</p><p>和 alias 指令一样，如果写在 Location 容器中，则 old-URL 忽略，因为它已经包含在 location 容器的路径中。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Location </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/one&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Redirect permanent </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://example.com/two&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/Location</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Location </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/three&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Redirect </span><span class="token number" style="color:rgb(9, 134, 88)">303</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://example.com/other&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/Location</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">LocationMatch </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/error/(?&lt;NUMBER&gt;[0-9]+)&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Redirect permanent </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;http://example.com/errors/%{env:MATCH_NUMBER}.html&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/LocationMatch</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="65httpd-添加新模块">6.5、httpd 添加新模块<a class="hash-link" href="#65httpd-添加新模块" title="Direct link to heading">​</a></h2><p>有些时候因为特殊需求，需要在已安装的 httpd 上添加一些额外的模块，这时候要使用 httpd-devel 中的 apxs 工具。要使用这个扩展机制，你的平台必须支持 DSO 特性，即要求 Apache httpd 必须内建了 mod<!-- -->_<!-- -->so 模块。</p><p>apxs 添加模块的方法很简单，以下是几个可能用上的选项：</p><ul><li><code>-c mod_foo.c</code>：将 c 文件编译为 .so 文件。</li><li><code>-i</code>：表示安装一个或多个模块到 apache 服务所在目录的 modules 目录中。</li><li><code>-a</code>：表示自动在 httpd.conf 中加入 LoadModule 行。</li><li><code>-A</code>：表示自动在 httpd.conf 中加入 #LoadModule 行，也就是说安装了模块但是不启用。</li><li><code>-n</code>：显式指定 -i 需要安装的模块名。</li></ul><p>例如：添加 mod<!-- -->_<!-- -->proxy.so 模块。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">cd</span><span class="token plain"> httpd-2.4.51/modules  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 进入到httpd源码的解压目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apxs -c -i -A proxy/mod_proxy.c proxy/proxy_util.c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装成功后的最后几行会告诉你要去修改配置文件，看情况是否要修改 LoadModule 指令来加载模块。</p><p>有时候添加一个模块后重启失败了并提示 undefined Symbol，说明还需添加另外相关的所需模块。</p><p>例如，上面如果只安装 <code>apxs -c -i -a proxy/mod_proxy.c</code> 时重启 httpd。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Starting httpd: httpd: Syntax error on line </span><span class="token number" style="color:rgb(9, 134, 88)">117</span><span class="token plain"> of /etc/apache/httpd.conf: Cannot load modules/mod_proxy.so into server: /usr/local/apache/modules/mod_proxy.so: undefined symbol: ap_proxy_strmatch_domain</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这说明还需要装相关的 devel 或者 util 对应的模块。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/linux-advanced-6"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">第 6 章 Linux httpd 服务基础配置</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/linux-advanced-8"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">第 8 章 Linux httpd 服务高级配置</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#61httpd-虚拟主机配置" class="table-of-contents__link toc-highlight">6.1、httpd 虚拟主机配置</a><ul><li><a href="#611基于-ip-的虚拟主机" class="table-of-contents__link toc-highlight">6.1.1、基于 IP 的虚拟主机</a></li><li><a href="#612基于端口的虚拟主机" class="table-of-contents__link toc-highlight">6.1.2、基于端口的虚拟主机</a></li><li><a href="#613基于名称的虚拟主机" class="table-of-contents__link toc-highlight">6.1.3、基于名称的虚拟主机</a></li></ul></li><li><a href="#62httpd-网页身份认证" class="table-of-contents__link toc-highlight">6.2、httpd 网页身份认证</a><ul><li><a href="#621htpasswd-命令" class="table-of-contents__link toc-highlight">6.2.1、htpasswd 命令</a></li><li><a href="#622身份认证类基本指令" class="table-of-contents__link toc-highlight">6.2.2、身份认证类基本指令</a></li><li><a href="#623require-指令" class="table-of-contents__link toc-highlight">6.2.3、Require 指令</a></li><li><a href="#624web-身份认证示例" class="table-of-contents__link toc-highlight">6.2.4、web 身份认证示例</a><ul><li><a href="#6241基于用户的认证" class="table-of-contents__link toc-highlight">6.2.4.1、基于用户的认证</a></li><li><a href="#6242基于组的认证" class="table-of-contents__link toc-highlight">6.2.4.2、基于组的认证</a></li></ul></li></ul></li><li><a href="#63httpd-日志和日志轮替工具" class="table-of-contents__link toc-highlight">6.3、httpd 日志和日志轮替工具</a><ul><li><a href="#631错误日志-errorlog" class="table-of-contents__link toc-highlight">6.3.1、错误日志 ErrorLog</a></li><li><a href="#632访问日志-customlog" class="table-of-contents__link toc-highlight">6.3.2、访问日志 CustomLog</a></li><li><a href="#633日志轮替-rotatelogs-工具" class="table-of-contents__link toc-highlight">6.3.3、日志轮替 rotatelogs 工具</a></li><li><a href="#634日志轮替-cronolog-工具" class="table-of-contents__link toc-highlight">6.3.4、日志轮替 cronolog 工具</a></li><li><a href="#635rotatelogs-和-cronolog-的比较" class="table-of-contents__link toc-highlight">6.3.5、rotatelogs 和 cronolog 的比较</a></li></ul></li><li><a href="#64httpd-路径映射和重定向" class="table-of-contents__link toc-highlight">6.4、httpd 路径映射和重定向</a><ul><li><a href="#641处理顺序" class="table-of-contents__link toc-highlight">6.4.1、处理顺序</a></li><li><a href="#642alias-和-aliasmatch" class="table-of-contents__link toc-highlight">6.4.2、Alias 和 AliasMatch</a></li><li><a href="#643redirect-和-redirectmatch-指令" class="table-of-contents__link toc-highlight">6.4.3、Redirect 和 RedirectMatch 指令</a></li></ul></li><li><a href="#65httpd-添加新模块" class="table-of-contents__link toc-highlight">6.5、httpd 添加新模块</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Study</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/en/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/skill">Notes</a></li><li class="footer__item"><a class="footer__link-item" href="/en/project">Projects</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/linux">Linux</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/about">About Me</a></li><li class="footer__item"><a href="https://github.com/zqingfa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Juejin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/en/friends">Friends</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/en/website">Links</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">浙ICP备20024502号-1</a></p><p>Copyright © 2022 – PRESENT zhangqf Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.9e6f80ce.js"></script>
<script src="/en/assets/js/main.77e89f19.js"></script>
</body>
</html>