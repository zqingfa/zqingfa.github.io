<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-linux/primary/linux-primary-2">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">第 2 章 Linux 系统用户 - Linux技术分享</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zhangqf.com/en/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://zhangqf.com/en/img/logo.png"><meta data-rh="true" property="og:url" content="https://zhangqf.com/en/docs/linux-primary-2"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="第 2 章 Linux 系统用户 - Linux技术分享"><meta data-rh="true" name="description" content="用户和组是操作系统中一种身份认证资源。"><meta data-rh="true" property="og:description" content="用户和组是操作系统中一种身份认证资源。"><meta data-rh="true" name="keywords" content="linux,command"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhangqf.com/en/docs/linux-primary-2"><link data-rh="true" rel="alternate" href="https://zhangqf.com/en/docs/linux-primary-2" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-primary-2" hreflang="zh"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-primary-2" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9B0V5WT2X8-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Linux技术分享" href="/en/opensearch.xml">
<link rel="preconnect" href="https://zhangqf.com/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://zhangqf.com/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c9a3849aa75f9c4a4e65f846cd1a5155",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/en/rss.xml" title="zhangqf RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/atom.xml" title="zhangqf Atom Feed">
<link rel="alternate" type="application/json" href="/en/feed.json" title="zhangqf JSON Feed">

<link rel="icon" href="/en/img/logo.png">
<link rel="manifest" href="/en/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><link rel="stylesheet" href="/en/assets/css/styles.86c9ae18.css">
<link rel="preload" href="/en/assets/js/runtime~main.3ab0938b.js" as="script">
<link rel="preload" href="/en/assets/js/main.7af82c56.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>更新 <a href="/website">网址导航</a> 带你发现感兴趣的技术</span></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">kuizuo</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/en/docs/linux">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/category/Linux基础">Linux 基础</a></li><li><a class="dropdown__link" href="/en/docs/category/Linux进阶">Linux 进阶</a></li><li><a class="dropdown__link" href="/en/docs/category/Linux测试">Linux 测试</a></li><li><a class="dropdown__link" href="/en/docs/category/LinuxCICD">Linux CICD研发</a></li><li><a class="dropdown__link" href="/en/docs/skill/">Notes</a></li><li><a class="dropdown__link" href="/en/docs/tools/">Recommended Tools</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Blog</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/tags">Tags</a></li><li><a class="dropdown__link" href="/en/archive">Archive</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Tools</a><ul class="dropdown__menu"><li><a href="https://api.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">API Service</a></li><li><a href="https://js-de-obfuscator.vercel.app" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS Deobfuscate</a></li><li><a href="https://cipher.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">CyberChef Encryption</a></li></ul></div><a class="navbar__item navbar__link" href="/en/website">Links</a><a class="navbar__item navbar__link" href="/en/project">Projects</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/en/"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"><b>kuizuo</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/linux">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/docs/category/linux基础">Linux基础</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux基础&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-1">第 1 章 Linux 基础命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/linux-primary-2">第 2 章 Linux 系统用户</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-3">第 3 章 Linux 文件权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-4">第 4 章 Linux ext 文件系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-5">第 5 章 Linux 磁盘管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-6">第 6 章 Linux LVM 存储管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-7">第 7 章 Linux Raid 存储管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-8">第 8 章 Linux 包管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-9">第 9 章 Linux 进程和信号</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-10">第 10 章 Linux 系统资源监控</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-11">第 11 章 Linux 服务管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-12">第 12 章 Linux 定时任务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-13">第 13 章 Linux 网络管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-primary-14">第 14 章 Linux 开机启动流程(UEFI+systemd)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux进阶">Linux进阶</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux进阶&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux测试">Linux测试</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux测试&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linuxcicd">LinuxCICD</a><button aria-label="Toggle the collapsible sidebar category &#x27;LinuxCICD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/category/linux基础"><span itemprop="name">Linux基础</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第 2 章 Linux 系统用户</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>第 2 章 Linux 系统用户</h1></header><p>用户和组是操作系统中一种身份认证资源。</p><p><strong>用户</strong>，都有用户名、用户的唯一编号 uid(user id)、所属组及其默认的 shell，可能还有密码、家目录、附属组、注释信息等。</p><p><strong>组</strong>，也有自己的名称、组唯一编号 gid(group id)。组分为主组(primary group)和辅助组(secondary group)两种，用户一定会属于某个主组，也可以同时加入多个辅助组。</p><p>Linux 有 3 种用户：</p><ol><li><p>超级管理员</p><p>超级管理员是最高权限者，它的 uid=0，默认超级管理员用户名为 root。超级管理员默认只能有一个。</p></li><li><p>系统用户</p><p>有时候需要一类具有某些特权但又不需要登录操作系统的用户，这类用户称为系统用户。Centos 7+ uid 范围从 201 到 999。Centos 6- uid 范围是 1 到 499。出于安全考虑，它们一般不用来登录，所以它们的shell一般是 /sbin/nologin，而且大多数时候它们是没有家目录的。</p></li><li><p>普通用户</p><p>普通用户是权限受到限制的用户，默认只能执行 /bin、/usr/bin、/usr/local/bin 和自身家目录下的命令。它们的 uid 从 1000 开始。尽管普通用户权限收到限制，但是它对自身家目录下的文件是有所有权限的。</p></li></ol><p>uid=0 的超级管理员，命令提示符是 &quot;#&quot;，其他的为 &quot;$&quot;。</p><p>默认 root 用户的家目录为 /root，其他用户的家目录一般在 /home 下以用户名命名的目录中。家目录可以自定义位置和名称。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21用户和组相关文件">2.1、用户和组相关文件<a class="hash-link" href="#21用户和组相关文件" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="211用户文件">2.1.1、用户文件<a class="hash-link" href="#211用户文件" title="Direct link to heading">​</a></h3><p>/etc/passwd 文件里记录的是操作系统中用户的信息，这里面记录了几行就表示系统中有几个用户。它的格式大致如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root:x:0:0:root:/root:/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bin:x:1:1:bin:/bin:/sbin/nologin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">python:x:1000:1000::/home/python:/bin/bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>用户名 : x : uid : gid : 用户注释信息 : 家目录 : 使用的 shell 类型</p><ul><li>第一列：用户名。注意两个个特殊的用户名，root、nobody</li><li>第二列：x，在以前老版本的系统上，第二列是存放用户密码的，但是密码和用户信息放在一起不便于管理(密钥要保证其特殊属性)，所以后来将密码单独放在另一个文件 /etc/shadow 中，这里就都写成x了</li><li>第三列：uid</li><li>第四列：gid</li><li>第五列：用户注释信息。</li><li>第六列：用户家目录。注意 root 用户的家目录为 /root</li><li>第七列：用户的默认 shell，虽然叫 shell，但其实可以是任意一个可执行程序或脚本。例如上面的 /bin/bash、/sbin/nologin、/sbin/shutdown</li></ul><p>用户的默认 shell 表示的是用户登录(如果允许登录)时的环境或执行的命令。</p><p>shell 为 /bin/bash 时，表示登录时就执行 /bin/bash 命令进入 bash 环境。</p><p>shell 为 /sbin/nologin 表示该用户不能登录，之所以不能登录不是因为指定了这个特殊的程序，而是由 /sbin/nologin 这个程序的功能实现的。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="212密码文件">2.1.2、密码文件<a class="hash-link" href="#212密码文件" title="Direct link to heading">​</a></h3><p>/etc/shadow 文件中存放的是用户的密码信息。该文件具有特殊属性，除了超级管理员，任何人都不能直接读取和修改该文件，而用户自身之所以能修改密码，则是因为 passwd 程序的 suid 属性，使得修改密码时临时提升为 root 权限。</p><p>该文件的格式大致如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root:</span><span class="token variable" style="color:rgb(9, 134, 88)">$6</span><span class="token variable" style="color:rgb(9, 134, 88)">$SELV0CfK0HK7Llac</span><span class="token variable" style="color:rgb(9, 134, 88)">$gK1WevRicfGlijDSNFGFIDzdjoHUCYFBaUDifCdaWDDVstc</span><span class="token plain">/iuRIPyBxhLJ9rG0cZZ7qLnTKkfEZSPpiz3X9E0::0:99999:7:::</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bin:*:17632:0:99999:7:::</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">daemon:*:17632:0:99999:7:::</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>每一行表示一个用户密码的属性，有 8 个冒号共 9 列属性。</p><ul><li>第一列：用户名。</li><li>第二列：加密后的密码。但是这一列是有玄机的，有些特殊的字符表示特殊的意义。<ul><li>该列留空，即 &quot;::&quot;，表示该用户没有密码。</li><li>该列为 &quot;!&quot;，即 &quot;:!:&quot;，表示该用户被锁，被锁将无法登陆，但是可能其他的登录方式是不受限制的，如 ssh key 的方式，su 的方式。</li><li>该列为 &quot;<!-- -->*<!-- -->&quot;，即 &quot;:<!-- -->*<!-- -->:&quot;，也表示该用户被锁，和 &quot;!&quot; 效果是一样的。</li><li>该列以 &quot;!&quot; 或 &quot;!!&quot; 开头，则也表示该用户被锁。</li><li>该列为 &quot;!!&quot;，即 &quot;:!!:&quot;，表示该用户从来没设置过密码。</li><li>如果格式为 <code>&quot;$id$salt$hashed&quot;</code>，则表示该用户密码正常。其中 <code>$id$</code> 的 id 表示密码的加密算法，<code>$1$</code> 表示使用 MD5 算法，<code>$2a$</code> 表示使用 Blowfish 算法，<code>&quot;$2y$&quot;</code> 是另一算法长度的 Blowfish, <code>&quot;$5$&quot;</code> 表示 SHA-256 算法，而 <code>&quot;$6$&quot;</code> 表示 SHA-512 算法，可见上面的结果中都是使用 sha-512 算法的。<code>$5$</code> 和 <code>$6$</code> 这两种算法的破解难度远高于 MD5。<code>$salt$</code> 是加密时使用的 salt，<code>$hashed</code> 才是真正的密码部分。</li></ul></li><li>第三列：从 1970 年 1 月 1 日到上次密码修改经过的时间(天数)。通过计算现在离 1970 年 1 月 1 日的天数减去这个值，结果就是上次修改密码到现在已经经过了多少天，即现在的密码已经使用了多少天。</li><li>第四列：密码最少使用期限(天数)。省略或者 0 表示不设置期限。例如，刚修改完密码又想修改，可以限制多久才能再次修改。</li><li>第五列：密码最大使用期限(天数)。超过了它不一定密码就失效，可能下一个字段设置了过期后的宽限天数。设置为空时将永不过期，后面设置的提醒和警告将失效。root 等一些用户的已经默认设置为了 99999，表示永不过期。如果值设置小于最短使用期限，用户将不能修改密码。</li><li>第六列：密码过期前多少天就开始提醒用户密码将要过期。空或 0 将不提醒。</li><li>第七列：密码过期后宽限的天数，在宽限时间内用户无法使用原密码登录，必须改密码或者联系管理员。设置为空表示没有强制的宽限时间，可以过期后的任意时间内修改密码。</li><li>第八列：帐号过期时间。从 1970 年 1 月 1 日开始计算天数。设置为空帐号将永不过期，不能设置为 0。不同于密码过期，密码过期后账户还有效，改密码后还能登录；帐号过期后帐号失效，修改密码重设密码都无法使用该帐号。</li><li>第九列：保留字段。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="213组文件">2.1.3、组文件<a class="hash-link" href="#213组文件" title="Direct link to heading">​</a></h3><p>大致知道有 /etc/group 和 /etc/gshadow 这两件文件即可。</p><p>/etc/group 包含了组信息。每行一个组，每一行 3 个冒号共 4 列属性。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root:x:0:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bin:x:1:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">daemon:x:2:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>第一列：组名。</li><li>第二列：占位符。</li><li>第三列：gid。</li><li>第四列：该组下的 user 列表，这些 user 成员以该组做为辅助组，多个成员使用逗号隔开。</li></ul><p>/etc/gshadow 包含了组密码信息</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="214骨架目录">2.1.4、骨架目录<a class="hash-link" href="#214骨架目录" title="Direct link to heading">​</a></h3><p>骨架目录 /etc/skel 中的文件是每次新建用户时，都会复制到新用户家目录里的文件。默认只有 3 个环境配置文件，可以修改这里面的内容，或者添加几个文件在骨架目录中，以后新建用户时就会自动获取到这些环境和文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ll -A /etc/skel/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--. </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root root  </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> Apr </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">2018</span><span class="token plain"> .bash_logout</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--. </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root root </span><span class="token number" style="color:rgb(9, 134, 88)">193</span><span class="token plain"> Apr </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">2018</span><span class="token plain"> .bash_profile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--. </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root root </span><span class="token number" style="color:rgb(9, 134, 88)">231</span><span class="token plain"> Apr </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">2018</span><span class="token plain"> .bashrc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>删除家目录下这些文件，会导致某些设置出现问题。万一删除其中某个文件，只需拷贝一个正常的同名文件到其家目录中即可，一般还会修改该文件的所有者和权限。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="215账号限制文件">2.1.5、账号限制文件<a class="hash-link" href="#215账号限制文件" title="Direct link to heading">​</a></h3><p>/etc/login.defs 设置用户帐号限制，该文件里的配置对root用户无效。</p><p>如果 /etc/shadow 文件里有相同的选项，则以 /etc/shadow 里的设置为准，也就是说 /etc/shadow 的配置优先级高于 /etc/login.defs。</p><p>该文件有很多配置项，文件的默认内容只给出了一小部分，若想知道全部的配置项以及配个配置项的详细说明，可以 &quot;man 5 login.defs&quot; 查看。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/login.defs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#QMAIL_DIR      Maildir              # QMAIL_DIR是Qmail邮件的目录，所以可以不设置它</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">MAIL_DIR        /var/spool/mail      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 默认邮件根目录，即信箱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#MAIL_FILE      .mail                # mail文件的格式是.mail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Password aging controls:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PASS_MAX_DAYS   </span><span class="token number" style="color:rgb(9, 134, 88)">99999</span><span class="token plain">         </span><span class="token comment" style="color:rgb(0, 128, 0)"># 密码最大有效期(天)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PASS_MIN_DAYS   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">             </span><span class="token comment" style="color:rgb(0, 128, 0)"># 两次密码修改之间最小时间间隔</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PASS_MIN_LEN    </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">             </span><span class="token comment" style="color:rgb(0, 128, 0)"># 密码最短长度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PASS_WARN_AGE   </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">             </span><span class="token comment" style="color:rgb(0, 128, 0)"># 密码过期前给警告信息的时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 控制useradd创建用户时自动选择的uid范围</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Min/max values for automatic uid selection in useradd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">UID_MIN                  </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">UID_MAX                 </span><span class="token number" style="color:rgb(9, 134, 88)">60000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># System accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SYS_UID_MIN               </span><span class="token number" style="color:rgb(9, 134, 88)">201</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SYS_UID_MAX               </span><span class="token number" style="color:rgb(9, 134, 88)">999</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 控制groupadd创建组时自动选择的gid范围</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Min/max values for automatic gid selection in groupadd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">GID_MIN                  </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">GID_MAX                 </span><span class="token number" style="color:rgb(9, 134, 88)">60000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># System accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SYS_GID_MIN               </span><span class="token number" style="color:rgb(9, 134, 88)">201</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SYS_GID_MAX               </span><span class="token number" style="color:rgb(9, 134, 88)">999</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置此项后，在删除用户时，将自动删除用户拥有的at/cron/print等job</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#USERDEL_CMD    /usr/sbin/userdel_local</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 控制useradd添加用户时是否默认创建家目录，useradd -m选项会覆盖此处设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CREATE_HOME     </span><span class="token function" style="color:rgb(0, 0, 255)">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置创建家目录时的umask值，若不指定则默认为022</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">UMASK           077</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置此项表示当组中没有成员时自动删除该组</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 且useradd是否同时创建同用户名的主组。(该文件中并没有此项说明，来自于man useradd中-g选项的说明)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">USERGROUPS_ENAB </span><span class="token function" style="color:rgb(0, 0, 255)">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置用户和组密码的加密算法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENCRYPT_METHOD SHA512</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>注意：/etc/login.defs中的设置控制的是shadow-utils包中的组件，也就是说，该组件中的工具执行操作时会读取该文件中的配置。该组件中包含下面的程序</em></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">/usr/bin/gpasswd      ：administer /etc/group and /etc/gshadow</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/bin/newgrp       ：log </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> to a new group，可用来修改gid，哪怕是正在登陆的会话也可以修改</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/bin/sg           ：execute </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">command</span><span class="token plain"> as different group ID</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/groupadd    ：添加组</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/groupdel    ：删除组</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/groupmems   ：管理当前用户的主组中的成员，root用户则可以指定要管理的组</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/groupmod    ：modify a group definition on the system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/grpck       ：verify integrity of group files</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/grpconv     ：无视它</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/grpunconv   ：无视它</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/pwconv      ：无视它</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/pwunconv    ：无视它</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/adduser     ：是useradd的一个软链接，添加用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/chpasswd    ：update passwords </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> batch mode</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/newusers    ：update and create new </span><span class="token function" style="color:rgb(0, 0, 255)">users</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> batch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/pwck        ：verify integrity of passsword files</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/useradd     ：添加用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/userdel     ：删除用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/usermod     ：重定义用户信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/vigr        ：edit the group and shadow-group </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/vipw        ：edit the password and shadow-password </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/bin/lastlog      ：输出所有用户或给定用户最近登录信息</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="216创建用户默认配置文件">2.1.6、创建用户默认配置文件<a class="hash-link" href="#216创建用户默认配置文件" title="Direct link to heading">​</a></h3><p>/etc/default/useradd 创建用户时的默认配置。useradd -D 修改的就是此文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/default/useradd  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># useradd defaults file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">GROUP</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain">       </span><span class="token comment" style="color:rgb(0, 128, 0)"># 在useradd使用-N或/etc/login.defs中USERGROUPS_ENAB=no时表示创建用户时不创建同用户名的主组(primary group)，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token comment" style="color:rgb(0, 128, 0)"># 此时新建的用户将默认以此组为主组，网上关于该设置的很多说明都是错的，具体可看man useradd的-g选项或useradd -D的-g选项</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">HOME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/home      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 把用户的家目录建在/home中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">INACTIVE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">-1     </span><span class="token comment" style="color:rgb(0, 128, 0)"># 是否启用帐号过期设置(是帐号过期不是密码过期)，-1表示不启用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">EXPIRE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">         </span><span class="token comment" style="color:rgb(0, 128, 0)"># 帐号过期时间，不设置表示不启用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/bin/bash </span><span class="token comment" style="color:rgb(0, 128, 0)"># 新建用户默认的shell类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">SKEL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/skel  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定骨架目录，前文的/etc/skel就在这里</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">CREATE_MAIL_SPOOL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">yes  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 是否创建用户mail缓冲</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>man useradd 的 useradd -D 选项介绍部分说明了这些项的意义。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22用户和组管理命令">2.2、用户和组管理命令<a class="hash-link" href="#22用户和组管理命令" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="221useradd-or-adduser-命令">2.2.1、useradd or adduser 命令<a class="hash-link" href="#221useradd-or-adduser-命令" title="Direct link to heading">​</a></h3><p>adduser 是 useradd 的一个软链接。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">useradd</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> login_name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-b：指定家目录的basedir，默认为/home目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-d：指定用户家目录，不写时默认为/home/user_name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-m：要创建家目录时，若家目录不存在则自动创建，若不指定该项且/etc/login.defs中的CREATE_HOME未启用时将不会创建家目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-M：显式指明不要创建家目录，会覆盖/etc/login.defs中的CREATE_HOME设置</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-g：指定用户主组，要求组已存在</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-G：指定用户的辅助组，多个组以逗号分隔</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-N：明确指明不要创建和用户名同名的组名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-U：明确指明要创建一个和用户名同名的组，并将用户加入到此组中</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-o：允许创建一个重复</span><span class="token environment constant" style="color:rgb(129, 31, 63)">UID</span><span class="token plain">的用户，只有和-u选项同时使用时才生效</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r：创建一个系统用户。useradd命令不会为此选项的系统用户创建家目录，除非明确使用-m选项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s：指定用户登录的shell，默认留空。此时将选择/etc/default/useradd中的</span><span class="token environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token plain">变量设置</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-u：指定用户uid，默认uid必须唯一，除非使用了-o选项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-c：用户的注释信息 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-k：指定骨架目录</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">skeleton</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-K：修改/etc/login.defs文件中有关于用户的配置项，不能修改组相关的配置。设置方式为KEY</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">VALUE，如-K </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UID_MIN</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-D：修改useradd创建用户时的默认选项，就修改/etc/default/useradd文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-e：帐户过期时间，格式为</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;YYYY-MM-DD&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f：密码过期后，该账号还能存活多久才被禁用，设置为0表示密码过期立即禁用帐户，设置为-1表示禁用此功能</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-l：不要将用户的信息写入到lastlog和faillog文件中。默认情况下，用户信息会写入到这两个文件中</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 修改/etc/default/useradd文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">useradd</span><span class="token plain"> -D </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：不加任何选项时会列出默认属性</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-b, --base-dir BASE_DIR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-e, --expiredate EXPIRE_DATE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f, --inactive INACTIVE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-g, --gid GROUP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s, --shell </span><span class="token environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># useradd -D -e &quot;2050-05-29&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># useradd -D</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">GROUP</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">HOME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/home</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">INACTIVE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">-1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">EXPIRE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2050</span><span class="token plain">-05-29</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">SKEL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/skel</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">CREATE_MAIL_SPOOL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">yes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>useradd 创建用户时，默认会自动创建一个和用户名相同的用户组，这是 /etc/login.defs 中的 USERGROUP<!-- -->_<!-- -->ENAB 变量控制的。</p><p>useradd 创建普通用户时，不加任何和家目录相关的选项时，是否创建家目录是由 /etc/login.defs 中的 CREATE<!-- -->_<!-- -->HOME 变量控制的。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="222newusers-命令">2.2.2、newusers 命令<a class="hash-link" href="#222newusers-命令" title="Direct link to heading">​</a></h3><p>newusers 用于批量创建或修改已有用户信息。在创建用户时，它会读取 /etc/login.defs 文件中的配置项。</p><p>newusers 命令从 file 中或标准输入中读取要创建或修改用户的信息，文件中每行格式都一样，一行代表一个用户。格式如下：</p><p>pw<!-- -->_<!-- -->name:pw<!-- -->_<!-- -->passwd:pw<!-- -->_<!-- -->uid:pw<!-- -->_<!-- -->gid:pw<!-- -->_<!-- -->gecos:pw<!-- -->_<!-- -->dir:pw<!-- -->_<!-- -->shell</p><ul><li>pw<!-- -->_<!-- -->name：用户名，若不存在则新创建，否则修改已存在用户的信息</li><li>pw<!-- -->_<!-- -->passwd：用户密码，该项使用明文密码，在修改或创建用户时会按照指定的算法自动对其进行加密转换</li><li>pw<!-- -->_<!-- -->uid：指定 uid，留空则自动选择 uid。如果该项为已存在的用户名，则使用该用户的 uid，但不建议这么做，uid 应尽量保证唯一性</li><li>pw<!-- -->_<!-- -->gid：用户主组的 gid 或组名。若给定组不存在，则自动创建组。若留空，则创建同用户名的组，gid 将自动选择</li><li>pw<!-- -->_<!-- -->gecos：用户注释信息</li><li>pw<!-- -->_<!-- -->dir：指定用户家目录，若不存在则自动创建。留空则不创建。</li><li>pw<!-- -->_<!-- -->shell：指定用户的默认 shell</li></ul><p><em>注意：newusers 命令不会递归创建父目录，父目录不存在时将会给出信息，但 newusers 命令仍会继续执行以完成创建剩下的用户，所以这些错误的用户家目录需要手动去创建。</em></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">newusers </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-c：指定加密方法，可选DES,MD5,NONE,SHA256和SHA512</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r：创建一个系统用户</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>newusers 首先尝试创建或修改所有指定的用户，然后将信息写入到 user 和 group 的文件中。</p><p>如果尝试创建或修改用户过程中发生错误，则所有动作都将回滚，但如果在写入过程中发生错误，则写入成功的不会回滚，这将可能导致文件的不一致性。</p><p>要检查用户、组文件的一致性，可以使用 showdow-utils 包提供的 grpck 和 pwck 命令。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /tmp/userlist</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Brinnatt:password:2000:2000::/home/Brinnatt:/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Monkey:password:2001:2001::/home/Monkey:/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># newusers -c SHA512 /tmp/userlist </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tail -2 /etc/passwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Brinnatt:x:2000:2000::/home/Brinnatt:/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Monkey:x:2001:2001::/home/Monkey:/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tail -2 /etc/shadow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Brinnatt:</span><span class="token variable" style="color:rgb(9, 134, 88)">$6</span><span class="token variable" style="color:rgb(9, 134, 88)">$d</span><span class="token plain">/1MVonTJl/</span><span class="token variable" style="color:rgb(9, 134, 88)">$XhjoDACS8Zs40yZsuLXIh5d5PsZBMYN67H0HFwSgvoMIunFPDIVYqFLM7O80pTbizNoa</span><span class="token plain">/zWQ6l6p8xkSsvN4Q/:18777:0:99999:7:::</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Monkey:</span><span class="token variable" style="color:rgb(9, 134, 88)">$6</span><span class="token plain">$/9F7daRNS</span><span class="token variable" style="color:rgb(9, 134, 88)">$b3</span><span class="token plain">/n1WBRj.qNXqDMUWpdL9yfmzMl5ao2gHzHRFBz/.BBNUq6UxTHzy8d.0/YFjdvDE2VvtEo/0P/9C0w6VtjB.:18777:0:99999:7:::</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="223groupadd">2.2.3、groupadd<a class="hash-link" href="#223groupadd" title="Direct link to heading">​</a></h3><p>创建一个新组。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">groupadd</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> group</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f：如果要创建的组已经存在，默认会错误退出，使用该选项则强制创建且以正确状态退出，只不过gid可能会不受控制。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-g：指定gid，默认gid必须唯一，除非使用了-o选项。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-K：修改/etc/login.defs中关于组相关的配置项。配置方式为KEY</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">VALUE，例如-K </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">GID_MIN</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"> -K </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">GID_MAX</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">499</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-o：允许创建一个非唯一gid的组</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r：创建系统组</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="224passwd-命令">2.2.4、passwd 命令<a class="hash-link" href="#224passwd-命令" title="Direct link to heading">​</a></h3><p>修改密码的工具。默认 passwd 命令不允许为用户创建空密码。</p><p>passwd 修改密码前会通过 pam 认证用户，pam 配置文件中与此相关的设置项如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">passwd</span><span class="token plain"> password requisite pam_cracklib.so </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">retry</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">passwd</span><span class="token plain"> password required pam_unix.so use_authtok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>命令的用法如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">passwd</span><span class="token plain"> options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">username</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-l：锁定指定用户的密码，在/etc/shadow的密码列加上前缀</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;!&quot;</span><span class="token plain">或</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;!!&quot;</span><span class="token plain">。这种锁定不是完全锁定，使用ssh公钥还是能登录。要完全锁定，使用chage -E </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">来设置帐户过期。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-u：解锁-l锁定的密码，解锁的方式是将/etc/shadow的密码列的前缀</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;!&quot;</span><span class="token plain">或</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;!!&quot;</span><span class="token plain">移除掉。但不能移除只有</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;!&quot;</span><span class="token plain">或</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;!!&quot;</span><span class="token plain">的项。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--stdin：从标准输入中读取密码</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-d：删除用户密码，将/etc/shadow的密码列设置为空</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f：指定强制操作</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-e：强制密码过期，下次登录将强制要求修改密码</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-n：密码最小使用天数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-x：最大密码使用天数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-w：过期前几天开始提示用户密码将要过期</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-i：设置密码过期后多少天，用户才过期。用户过期将被禁用，修改密码也无法登陆。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="225chpasswd-命令">2.2.5、chpasswd 命令<a class="hash-link" href="#225chpasswd-命令" title="Direct link to heading">​</a></h3><p>以批处理模式从标准输入中获取提供的用户和密码来修改用户密码，可以一次修改多个用户密码。也就是说不用交互。适用于一次性创建了多个用户时为他们提供密码。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">chpasswd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-e -c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;user:passwd&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-c：指定加密算法，可选的算法有 DES,MD5,NONE,SHA256和SHA512</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-e：passwd 默认使用的是明文密码，如果要使用密文，则使用-e选项。参见 </span><span class="token function" style="color:rgb(0, 0, 255)">man</span><span class="token plain"> chpasswd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">user:passwd 为用户密码对，其中默认 </span><span class="token function" style="color:rgb(0, 0, 255)">passwd</span><span class="token plain"> 是明文密码，可以指定多对，每行一个用户密码对。前提是用户是已存在的。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>chpasswd 会读取 /etc/login.defs 中的相关配置，修改成功后会将密码信息写入到密码文件中。</p><p>该命令的修改密码的处理方式是先在内存中修改，如果所有用户的密码都能设置成功，然后才写入到磁盘密码文件中。在内存中修改过程中出错，则所有修改都回滚，但若在写入密码文件过程中出错，则成功的不会回滚。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 修改单个用户密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;Brinnatt:aes123&quot; | chpasswd -c SHA512</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 修改多个用户密码，则提供的每个用户对都要分行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;Brinnatt:aes456\nMonkey:aes456&quot; | chpasswd </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>提示：如果有大批量的用户名要改密码，可以使用文件的标准输入</em></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="226chage-命令">2.2.6、chage 命令<a class="hash-link" href="#226chage-命令" title="Direct link to heading">​</a></h3><p>chage 命令主要修改或查看和密码时间相关的内容。具体的看 man 文档</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">chage </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> LOGIN</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-l：列出指定用户密码相关信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-E：指定帐户</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">不是密码</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">过期时间，所以是强锁定，如果指定为0，则立即过期，即直接锁定该用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chage -l Brinnatt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Last password change                    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain">, </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Password expires                    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> never</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Password inactive                   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> never</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account expires                     </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> never</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Minimum number of days between password change      </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Maximum number of days between password change      </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">99999</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Number of days of warning before password expires   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chage -E 0 Brinnatt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chage -l Brinnatt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Last password change                    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain">, </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Password expires                    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> never</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Password inactive                   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> never</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account expires                     </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> Jan 01, </span><span class="token number" style="color:rgb(9, 134, 88)">1970</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Minimum number of days between password change      </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Maximum number of days between password change      </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">99999</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Number of days of warning before password expires   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="227userdel-命令">2.2.7、userdel 命令<a class="hash-link" href="#227userdel-命令" title="Direct link to heading">​</a></h3><p>userdel 命令用于删除用户</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">userdel</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> login_name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r：递归删除家目录，默认不删除家目录。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f：强制删除用户，即使这个用户正处于登录状态。同时也会强制删除家目录。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>一般不直接删除家目录，即不用 -r，可以 vim /etc/passwd，将不需要的用户直接注释掉。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="228groupdel-命令">2.2.8、groupdel 命令<a class="hash-link" href="#228groupdel-命令" title="Direct link to heading">​</a></h3><p>删除组，如果要删除的组是某用户的主组，需要先删除主组中的用户。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="229usermod-命令">2.2.9、usermod 命令<a class="hash-link" href="#229usermod-命令" title="Direct link to heading">​</a></h3><p>修改帐户属性信息。必须要确保在执行该命令的时候，待修改的用户没有在执行进程。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">usermod</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> login</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-l: 修改用户名，仅仅只是改用户名，其他的一切都不会改动</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">uid、家目录等</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-u: 新的uid，新的uid必须唯一，除非同时使用了-o选项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-g: 修改用户主组，可以是以gid或组名。对于那些以旧组为所属组的文件</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">除原家目录</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">，需要重新手动修改其所属组</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-m: 移动家目录内容到新的位置，该选项只在和-d选项一起使用时才生效</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-d: 修改用户的家目录位置，若不存在则自动创建。默认旧的家目录不会删除</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    如果同时指定了-m选项，则旧的家目录中的内容会移到新家目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    如果当前用户家目录不存在或没有家目录，则也不会创建新的家目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-o: 允许用户使用非唯一的</span><span class="token environment constant" style="color:rgb(129, 31, 63)">UID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s: 修改用的shell，留空则选择默认shell</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-c: 修改用户注释信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-a: 将用户以追加的方式加入到辅助组中，只能和-G选项一起使用</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-G: 将用户加入指定的辅助组中，若此处未列出某组，而此前该用户又是该组成员，则会删除该组中此成员</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-L: 锁定用户的密码，将在/etc/shadow的密码列加上前缀</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;!&quot;</span><span class="token plain">或</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;!!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-U: 解锁用户的密码，解锁的方式是移除shadow文件密码列的前缀</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;!&quot;</span><span class="token plain">或</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;!!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-e: 帐户过期时间，时间格式为</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;YYYY-MM-DD&quot;</span><span class="token plain">，如果给一个空的参数，则立即禁用该帐户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f: 密码过期后多少天，帐户才过期被禁用，0表示密码过期帐户立即禁用，-1表示禁用该功能</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2210groupmod-命令">2.2.10、groupmod 命令<a class="hash-link" href="#2210groupmod-命令" title="Direct link to heading">​</a></h3><p>修改系统中一个组的相关定义</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">groupmod</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> GROUP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-g, --gid GID：修改指定组的 GID</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-n, --new-name NEW_GROUP：修改指定组的名字</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2211vipw-or-vigr-命令">2.2.11、vipw or vigr 命令<a class="hash-link" href="#2211vipw-or-vigr-命令" title="Direct link to heading">​</a></h3><p>vipw 和 vigr 是编辑用户和组文件的工具</p><p>vipw 可以修改 /etc/passwd 和 /etc/shadow</p><p>vigr 可以修改 /etc/group 和 /etc/gshadow</p><p>用这两个工具比较安全，在修改的时候会检查文件的一致性。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23手动创建用户">2.3、手动创建用户<a class="hash-link" href="#23手动创建用户" title="Direct link to heading">​</a></h2><p>手动创建用户的全过程，需要管理员权限。</p><ol><li><p>在 /etc/group 中添加用户所属组的相关信息。如果用户还有辅助组则在对应组中加入该用户作为成员。</p></li><li><p>在 /etc/passwd 和 /etc/shadow 中添加用户相关信息。此时指定的家目录还不存在，密码不存在，所以 /etc/shadow 的密码位使用&quot;!!&quot;代替。</p></li><li><p>创建家目录，并复制骨架目录中的文件到家目录中。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mkdir /home/Seri</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp -a /etc/skel/. /home/Seri/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>修改家目录及子目录的所有者和属组。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chown -R Seri:Seri /home/Seri/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>修改家目录及子目录的权限。例如设置组和其他用户无任何权限但所有者有。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod -R 700 /home/Seri/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>到此为止，用户已经创建完成了，只是没有密码，所以只能 su，不能登录。</p></li><li><p>生成密码</p><ul><li><p>使用 openssl passwd 生成密码。但 openssl passwd 生成的密码只能是 MD5 算法的，很容易被破解</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 生成使用 md5 算法的密码，然后将其复制到 /etc/shadow 对应的密码位</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 其中 -1 是指 md5，-salt &#x27;12345678&#x27; 是使用 8 位字符创建密码的杂项</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># openssl passwd -1 -salt &#x27;12345678&#x27; &#x27;123456&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$1</span><span class="token variable" style="color:rgb(9, 134, 88)">$12345678</span><span class="token variable" style="color:rgb(9, 134, 88)">$a4ge4d5iJ5vwvbFS88TEN0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>直接使用passwd命令创建密码</p></li></ul></li><li><p>测试手动创建的用户是否可以正确登录。</p></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="24补充命令">2.4、补充命令<a class="hash-link" href="#24补充命令" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="241finger-命令">2.4.1、finger 命令<a class="hash-link" href="#241finger-命令" title="Direct link to heading">​</a></h3><p>从 CentOS 6 版本开始就没有该命令了，要先安装。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install finger -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># finger root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Login: root                     Name: root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Directory: /root                        Shell: /bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On since Mon May </span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:37 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">CST</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> on pts/0 from </span><span class="token number" style="color:rgb(9, 134, 88)">110.52</span><span class="token plain">.210.213</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> second idle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">No mail.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">No Plan.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="242id-命令">2.4.2、id 命令<a class="hash-link" href="#242id-命令" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> username</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-u：得到uid</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-n：得到用户名而不是uid</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-z：无任何空白字符输出模式，不能在默认的格式下使用。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># id root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">uid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">root</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">root</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">groups</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">root</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="243users-命令">2.4.3、users 命令<a class="hash-link" href="#243users-命令" title="Direct link to heading">​</a></h3><p>查看当前正在登陆的用户名。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="244last-命令">2.4.4、last 命令<a class="hash-link" href="#244last-命令" title="Direct link to heading">​</a></h3><p>查看最近登录的用户列表，其实 last 查看的是 /var/log/wtmp 文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-n 显示行数：列出最近几次登录的用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># last -n 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     pts/0        </span><span class="token number" style="color:rgb(9, 134, 88)">110.52</span><span class="token plain">.210.213   Mon May </span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:37   still logged </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     pts/0        </span><span class="token number" style="color:rgb(9, 134, 88)">120.227</span><span class="token plain">.21.217   Sat May </span><span class="token number" style="color:rgb(9, 134, 88)">29</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">:48 - </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">:01  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">01:12</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     pts/0        </span><span class="token number" style="color:rgb(9, 134, 88)">120.227</span><span class="token plain">.21.217   Sat May </span><span class="token number" style="color:rgb(9, 134, 88)">29</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">:00 - </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">:48  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00:47</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     pts/0        </span><span class="token number" style="color:rgb(9, 134, 88)">120.227</span><span class="token plain">.21.217   Sat May </span><span class="token number" style="color:rgb(9, 134, 88)">29</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">:39 - </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">:39  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00:00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     tty1                          Sat May </span><span class="token number" style="color:rgb(9, 134, 88)">29</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">:25 - </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">:25  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00:00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     pts/0        </span><span class="token number" style="color:rgb(9, 134, 88)">120.227</span><span class="token plain">.21.217   Sat May </span><span class="token number" style="color:rgb(9, 134, 88)">29</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">:19 - </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">:20  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00:01</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wtmp begins Fri Apr </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:19:11 </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="245lastb-命令">2.4.5、lastb 命令<a class="hash-link" href="#245lastb-命令" title="Direct link to heading">​</a></h3><p>查看谁尝试登陆过但没有登录成功的。即能够审核和查看谁曾经不断的登录，可能那就是黑客。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-n:只列出最近的n个尝试对象。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># lastb -n 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     ssh:notty    </span><span class="token number" style="color:rgb(9, 134, 88)">143.198</span><span class="token plain">.156.250  Sun May </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain">:08 - </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain">:08  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00:00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     ssh:notty    </span><span class="token number" style="color:rgb(9, 134, 88)">143.198</span><span class="token plain">.156.250  Sun May </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain">:08 - </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain">:08  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00:00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     ssh:notty    </span><span class="token number" style="color:rgb(9, 134, 88)">143.198</span><span class="token plain">.156.250  Sun May </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain">:08 - </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain">:08  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">00:00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">btmp begins Mon May </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain">:12:54 </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="246who-or-w-命令">2.4.6、who or w 命令<a class="hash-link" href="#246who-or-w-命令" title="Direct link to heading">​</a></h3><p>都是查看谁登录过，并干了什么事</p><p>w 查看的信息比 who 多</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># w</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain">:37:16 up </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> days,  </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">:21,  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> user,  load average: </span><span class="token number" style="color:rgb(9, 134, 88)">0.00</span><span class="token plain">, </span><span class="token number" style="color:rgb(9, 134, 88)">0.00</span><span class="token plain">, </span><span class="token number" style="color:rgb(9, 134, 88)">0.00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token environment constant" style="color:rgb(129, 31, 63)">USER</span><span class="token plain">     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     pts/0    </span><span class="token number" style="color:rgb(9, 134, 88)">110.52</span><span class="token plain">.210.213   </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:37    </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">.00s  </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">.07s  </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">.00s w</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># who</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root     pts/0        </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-05-31 </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:37 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">110.52</span><span class="token plain">.210.213</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 w 的第一行，分别表示当前时间，已开机时长，当前在线用户，过去 1、5、15 分钟的平均负载率。这一行和 uptime 命令获取的信息是完全一致的。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="247lastlog-命令">2.4.7、lastlog 命令<a class="hash-link" href="#247lastlog-命令" title="Direct link to heading">​</a></h3><p>可以查看登录的来源IP</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-u 指定查看用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># lastlog | head -n 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Username         Port     From             Latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root             pts/0    </span><span class="token number" style="color:rgb(9, 134, 88)">110.52</span><span class="token plain">.210.213   Mon May </span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:37:52 +0800 </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bin                                        **Never logged in**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">daemon                                     **Never logged in**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">adm                                        **Never logged in**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lp                                         **Never logged in**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="25用户身份切换">2.5、用户身份切换<a class="hash-link" href="#25用户身份切换" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="251su-命令">2.5.1、su 命令<a class="hash-link" href="#251su-命令" title="Direct link to heading">​</a></h3><p>切换用户或以指定用户运行命令。</p><p>使用 su 可以指定运行命令的身份(user/group/uid/gid)。</p><p>为了向后兼容，su 默认不会改变当前目录，且仅设置 HOME 和 SHELL 这两个环境变量(若目标用户非 root，则还设置 USER 和 LOGNAME 环境变量)。推荐使用 --login 选项(即 &quot;-&quot; 选项)避免环境变量混乱。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">su</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">user </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-c command：使用-c选项传递要指定的命令到shell上执行。使用-c执行命令会为每个su都分配新的会话环境</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-, -l, --login：启动shell作为登录的shell，模拟真正的登录环境。它会做下面几件事：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">.清除除了</span><span class="token environment constant" style="color:rgb(129, 31, 63)">TERM</span><span class="token plain">外的所有环境变量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">.初始化</span><span class="token environment constant" style="color:rgb(129, 31, 63)">HOME</span><span class="token plain">,</span><span class="token environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token plain">,</span><span class="token environment constant" style="color:rgb(129, 31, 63)">USER</span><span class="token plain">,</span><span class="token environment constant" style="color:rgb(129, 31, 63)">LOGNAME</span><span class="token plain">,</span><span class="token environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token plain">环境变量</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">.进入目标用户的家目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">.设置argv</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">为</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain">以便设置shell作为登录的shell</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  使用--login的su是交互式登录。不使用--login的su是非交互式登录</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">除不带任何参数的su外</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-m, -p, --preserve-environment：保留整个环境变量</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">不会重新设置</span><span class="token environment constant" style="color:rgb(129, 31, 63)">HOME</span><span class="token plain">,</span><span class="token environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token plain">,</span><span class="token environment constant" style="color:rgb(129, 31, 63)">USER</span><span class="token plain">和</span><span class="token environment constant" style="color:rgb(129, 31, 63)">LOGNAME</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">，</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                保留环境的方法是新用户shell上执行原用户的各配置文件，如~/.bashrc。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                当设置了--login时，将忽略该选项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s </span><span class="token environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token plain">：运行指定的shell而非默认shell，选择shell的顺序优先级如下：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">.--shell指定的shell</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">.如果使用了--preserve-environment，选择</span><span class="token environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token plain">环境变量的shell</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">.选项目标用户在passwd文件中指定的shell</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">./bin/sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意：</p><ol><li>若 su 没有给定任何参数，将默认以 root 身份运行交互式的 shell(交互式，所以需要输入密码)，即切换到 root 用户，但只改变 HOME 和 SHELL 环境变量。</li><li>su - username 是交互式登录，要求密码，会重置整个环境变量，它实际上是在模拟真实的登录环境。</li><li>su username 是非交互登录，不会重置除 HOME/SHELL 外的环境变量。</li></ol><p>举例：</p><ol><li><p>创建 hadoop 用户，家目录是 /home/hadoop，其 shell 为 /bin/zsh</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># useradd -c &quot;special user with zsh&quot; -s /bin/zsh hadoop</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># head -1 /etc/passwd; tail -1 /etc/passwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root:x:0:0:root:/root:/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hadoop:x:1000:1000:special user with zsh:/home/hadoop:/bin/zsh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>首先 su 到 hadoop 上，再执行一个完全不带参数的 su</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 使用su - username后，以登录shell的方式模拟登录，会重新设置各环境变量，su - username是交互式登录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># su - hadoop</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hadoop@arm64v8</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">~% </span><span class="token function" style="color:rgb(0, 0, 255)">env</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">egrep</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;^home|^shell|^path|^logname|^user&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">HOME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/home/hadoop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/bin/zsh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">USER</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">hadoop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">LOGNAME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">hadoop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/bin:/bin:/usr/bin:/home/hadoop/bin:/usr/local/sbin:/usr/sbin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hadoop@arm64v8</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">~%</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 不带任何参数的su，是交互式登录切换回root，但只会改变HOME和SHELL环境变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hadoop@arm64v8</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">~% </span><span class="token function" style="color:rgb(0, 0, 255)">su</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Password: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 hadoop</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># env | egrep -i &#x27;^home|^shell|^path|^logname|^user|^pwd&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">USER</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">hadoop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/bin:/bin:/usr/bin:/home/hadoop/bin:/usr/local/sbin:/usr/sbin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">PWD</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/home/hadoop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">HOME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">LOGNAME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">hadoop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 hadoop</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># su - 的方式切换回root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 hadoop</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># su -</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Last login: Mon May </span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:38:56 CST </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"> on pts/0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># env | egrep -i &#x27;^home|^shell|^path|^logname|^user|^pwd&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">USER</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">PWD</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">HOME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">LOGNAME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 再直接su username，它只会重置SHELL和HOME两个环境变量，其他环境变量保持不变</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># su hadoop</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hadoop@arm64v8</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">/root% </span><span class="token function" style="color:rgb(0, 0, 255)">env</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">egrep</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;^home|^shell|^path|^logname|^user|^pwd&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">SHELL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/bin/zsh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">USER</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">hadoop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">PWD</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">HOME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/home/hadoop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">LOGNAME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">hadoop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hadoop@arm64v8</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">/root% </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在某些环境下或脚本中，可能需要临时切换身份执行命令，注意这时候的环境变量是否会改变，否则很可能报错提示命令找不到。</p></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="252sudo-配置">2.5.2、sudo 配置<a class="hash-link" href="#252sudo-配置" title="Direct link to heading">​</a></h3><p>sudo 可以让一个用户以某个身份(如 root 或其他用户)执行某些命令，它隐含的执行方式是切换到指定用户再执行命令，因为涉及到了用户的切换，所以环境变量是否重置是需要设置的。</p><p>sudo 支持插件实现安全策略。默认的安全策略插件是 sudoers，它是通过 /etc/sudoers 或 LDAP 来配置的。</p><p>安全策略是控制用户使用 sudo 命令时具有什么权限，但要注意，安全策略可能需要用户进行身份认证，如密码认证的机制或其他认证机制，如果开启了认证要求，则在指定时间内未完成认证时 sudo 会退出，默认超时时间为 5 分钟。</p><p>安全策略支持对认证进行缓存，使得在一定时间内该用户无需再次认证就可以执行 sudo 命令，默认缓存时间为 5 分钟，sudo -v 可以更新认证缓存。</p><p>sudo 支持日志审核，可以记录下成功或失败的 sudo。</p><p><strong>/etc/sudoers</strong> 配置文件</p><p>该文件里主要配置 sudo 命令时指定的用户和对应的权限</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># visudo 是专门打开 /etc/sudoers 配置文件的命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># visudo </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 主机别名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Host Aliases</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Host_Alias     FILESERVERS = fs1, fs2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Host_Alias     MAILSERVERS = smtp, smtp2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 用户别名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## User Aliases</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># User_Alias ADMINS = jsmith, mikem</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 命令别名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Command Aliases</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Networking</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Cmnd_Alias NETWORKING = /sbin/route, /sbin/ifconfig, /bin/ping, /sbin/dhclient, /usr/bin/net, /sbin/iptables, /usr/bin/rfcomm, /usr/bin/wvdial, /sbin/iwconfig, /sbin/mii-tool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Installation and management of software</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Cmnd_Alias SOFTWARE = /bin/rpm, /usr/bin/up2date, /usr/bin/yum</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Services</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Cmnd_Alias SERVICES = /sbin/service, /sbin/chkconfig, /usr/bin/systemctl start, /usr/bin/systemctl stop, /usr/bin/systemctl reload, /usr/bin/systemctl restart, /usr/bin/systemctl status, /usr/bin/systemctl enable, /usr/bin/systemctl disable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Updating the locate database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Cmnd_Alias LOCATE = /usr/bin/updatedb</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Storage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Cmnd_Alias STORAGE = /sbin/fdisk, /sbin/sfdisk, /sbin/parted, /sbin/partprobe, /bin/mount, /bin/umount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 核心配置区域，sudo权限的配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Allow root to run any commands anywhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ALL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ALL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">       ALL</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Allows members of the &#x27;sys&#x27; group to run networking, software,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## service management apps and more.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># %sys ALL = NETWORKING, SOFTWARE, SERVICES, STORAGE, DELEGATING, PROCESSES, LOCATE, DRIVERS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Allows people in group wheel to run all commands</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">%wheel  </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ALL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ALL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">       ALL</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Same thing without a password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># %wheel        ALL=(ALL)       NOPASSWD: ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## Allows members of the users group to mount and unmount the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">## cdrom as root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># %users  ALL=/sbin/mount /mnt/cdrom, /sbin/umount /mnt/cdrom</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在这个文件里，主要有别名(用户别名，主机别名，命令别名)的配置和 sudo 权限的配置。</p><p>安全策略配置格式为：</p><blockquote><p>用户名 主机名 = (可切换到的用户身份) 权限和命令</p><p>① ② ③ ④</p></blockquote><ul><li>用户名：可以用组，只需在组名前加个百分号 % 表示。</li><li>主机名：表示该用户可以在哪些主机上运行 sudo，可以用 hostname 也可以用 ip 指定。</li><li>可切换的用户身份：即指定执行命令的用户，也可以用组。</li><li>权限和命令：允许执行和不允许执行的命令(多个命令间用逗号分隔)和特殊权限，命令可以带其选项及参数。命令要写绝对路径。不允许执行的命令需要在命令前加上 &quot;!&quot; 来表示。可以使用标签，如 NOPASSWD 标签表示切换或以指定用户执行该标签后的命令时不需要输入密码。一行写不下时可使用&quot;<!-- -->\<!-- -->&quot;续行。</li></ul><p>标签使用方法：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">NOPASSWD:/usr/sbin/useradd,PASSWD:/usr/sbin/userdel</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>它表示 useradd 命令不需要输入密码，而 userdel 需要输入密码。</li></ul><p>对于别名，相当于用户对于用户组。权限配置处都可以使用别名，即①②③④处都能使用别名来配置。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 示例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">DEFAULT</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/bin/*,/sbin/ldconfig,/sbin/ifconfig,/usr/sbin/useradd,/usr/sbin/userdel,/bin/rpm,/usr/bin/yum,/sbin/service,/sbin/chkconfig,sudoedit /etc/rc.local,sudoedit /etc/hosts,sudoedit /etc/ld.so.conf,/bin/mount,sudoedit /etc/exports,/usr/bin/passwd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain">-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">*,</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain">/usr/bin/passwd root,/bin/su - </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain">-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">*,</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain">/bin/su - root,</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain">/bin/su root, /bin/bash, /usr/sbin/dmidecode, /usr/sbin/lsof, /usr/bin/du, /usr/bin/python, /usr/sbin/xm,sudoedit /etc/profile,sudoedit /etc/bashrc,/usr/bin/make,sudoedit /etc/security/limits.conf,/etc/init.d/*,/usr/bin/ruby</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ADMINS </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ALL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ALL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">NOPASSWD:DEFAULT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中上面的 &quot;/usr/bin/passwd <!-- -->[<!-- -->!-<!-- -->]<!-- -->*<!-- -->&quot; 表示允许修改加参数的密码。&quot;/bin/su - <!-- -->[<!-- -->!-<!-- -->]<!-- -->*<!-- -->&quot; 表示允许 &quot;su -&quot; 到某用户下，但必须给参数。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="253sudo-or-sudoedit-命令">2.5.3、sudo or sudoedit 命令<a class="hash-link" href="#253sudo-or-sudoedit-命令" title="Direct link to heading">​</a></h3><p>当 sudo 执行指定的 command 时，它会调用 fork 函数，并设置命令的执行环境(如某些环境变量)，然后在子进程中执行 command，sudo 的主进程等待命令执行完毕，然后传递命令的退出状态码给安全策略并退出。</p><p>sudoedit 等价于 sudo -e，它是以 sudo 的方式执行文件编辑动作。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-b             </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">background</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">该选项告诉sudo在后台执行指定的命令。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                 注意，如果使用该选项，将无法使用任务计划</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">job</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">来控制维护这些后台进程，</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                 需要交互的命令应该考虑是否真的要后台，因为可能会失败</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-l</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">l</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: 当单独使用-l选项时，将列出</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">用户可执行和被禁止的命令。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                 当配合command时，且该command是被允许执行的命令，将列出命令的全路径及该命令参数。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                 如果command是不被允许执行的，则sudo直接以状态码-1退出。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                 可以指定多个字母</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;l&quot;</span><span class="token plain">来显示更详细的格式</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-n             </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 使得sudo变成非交互模式，但如果安全策略是要求输入密码的，则sudo将报错</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-S             </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">stdin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">该选项使得sudo从标准输入而非终端设备上读取密码，给定的密码必须在尾部加上换行符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">shell</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">指定要切换到的shell，如果给定command，则在此shell上执行该命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-U user        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">other user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">配合-l选项来指定要列出哪个用户的权限信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-u user        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">该选项明确指定要以此处指定的用户而非root来运行command。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                 若使用uid的方式指定用户，则需要使用</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;#uid&quot;</span><span class="token plain">，但很多时候可能需要对</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;#&quot;</span><span class="token plain">使用</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">转义，即使用&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">#uid&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-E             </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">该选项告诉sudo在执行命令时保留自己的环境变量，保留环境变量的方式是执行环境配置文件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                 但因为跨了用户，所以很可能某些家目录下的环境配置文件会因为无权限而执行失败，此时sudo将报错   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-k </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 当单独使用-k选项时，sudo将使得用户的认证缓存失效。下次执行sudo命令需要输入密码。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                 当配合command时，-k选项将忽略用户的缓存，所以sudo将要求用户输入密码，但这次输入密码不会更新认证缓存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                 但执行-k选项本身，不需要密码</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-K             </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">sure </span><span class="token function" style="color:rgb(0, 0, 255)">kill</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">类似于-k选项，但它会完全移除用户的认证缓存，且不会配合command，执行-K本身不需要密码</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v             </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">validate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">该选项使得sudo更新用户认证缓存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--             </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 暗示sudo命令行参数到此结束</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 sudo 上可以直接设置环境变量，它会传递为 command 的环境。设置的方式为 var=value，如 LD<!-- -->_<!-- -->LIBRARY<!-- -->_<!-- -->PATH=/usr/local/pkg/lib</p><p>由于 sudo 默认的安全策略插件是 sudoers，所以当用户执行 sudo 时，系统会自动去寻找 /etc/sudoers 文件(该文件里被 root 配置了用户对应的权限，也即安全策略)，查看 sudo 要使用的用户是否有对应的权限，如果有则执行，如果没有权限就失败退出 sudo。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/linux-primary-1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">第 1 章 Linux 基础命令</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/linux-primary-3"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">第 3 章 Linux 文件权限</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#21用户和组相关文件" class="table-of-contents__link toc-highlight">2.1、用户和组相关文件</a><ul><li><a href="#211用户文件" class="table-of-contents__link toc-highlight">2.1.1、用户文件</a></li><li><a href="#212密码文件" class="table-of-contents__link toc-highlight">2.1.2、密码文件</a></li><li><a href="#213组文件" class="table-of-contents__link toc-highlight">2.1.3、组文件</a></li><li><a href="#214骨架目录" class="table-of-contents__link toc-highlight">2.1.4、骨架目录</a></li><li><a href="#215账号限制文件" class="table-of-contents__link toc-highlight">2.1.5、账号限制文件</a></li><li><a href="#216创建用户默认配置文件" class="table-of-contents__link toc-highlight">2.1.6、创建用户默认配置文件</a></li></ul></li><li><a href="#22用户和组管理命令" class="table-of-contents__link toc-highlight">2.2、用户和组管理命令</a><ul><li><a href="#221useradd-or-adduser-命令" class="table-of-contents__link toc-highlight">2.2.1、useradd or adduser 命令</a></li><li><a href="#222newusers-命令" class="table-of-contents__link toc-highlight">2.2.2、newusers 命令</a></li><li><a href="#223groupadd" class="table-of-contents__link toc-highlight">2.2.3、groupadd</a></li><li><a href="#224passwd-命令" class="table-of-contents__link toc-highlight">2.2.4、passwd 命令</a></li><li><a href="#225chpasswd-命令" class="table-of-contents__link toc-highlight">2.2.5、chpasswd 命令</a></li><li><a href="#226chage-命令" class="table-of-contents__link toc-highlight">2.2.6、chage 命令</a></li><li><a href="#227userdel-命令" class="table-of-contents__link toc-highlight">2.2.7、userdel 命令</a></li><li><a href="#228groupdel-命令" class="table-of-contents__link toc-highlight">2.2.8、groupdel 命令</a></li><li><a href="#229usermod-命令" class="table-of-contents__link toc-highlight">2.2.9、usermod 命令</a></li><li><a href="#2210groupmod-命令" class="table-of-contents__link toc-highlight">2.2.10、groupmod 命令</a></li><li><a href="#2211vipw-or-vigr-命令" class="table-of-contents__link toc-highlight">2.2.11、vipw or vigr 命令</a></li></ul></li><li><a href="#23手动创建用户" class="table-of-contents__link toc-highlight">2.3、手动创建用户</a></li><li><a href="#24补充命令" class="table-of-contents__link toc-highlight">2.4、补充命令</a><ul><li><a href="#241finger-命令" class="table-of-contents__link toc-highlight">2.4.1、finger 命令</a></li><li><a href="#242id-命令" class="table-of-contents__link toc-highlight">2.4.2、id 命令</a></li><li><a href="#243users-命令" class="table-of-contents__link toc-highlight">2.4.3、users 命令</a></li><li><a href="#244last-命令" class="table-of-contents__link toc-highlight">2.4.4、last 命令</a></li><li><a href="#245lastb-命令" class="table-of-contents__link toc-highlight">2.4.5、lastb 命令</a></li><li><a href="#246who-or-w-命令" class="table-of-contents__link toc-highlight">2.4.6、who or w 命令</a></li><li><a href="#247lastlog-命令" class="table-of-contents__link toc-highlight">2.4.7、lastlog 命令</a></li></ul></li><li><a href="#25用户身份切换" class="table-of-contents__link toc-highlight">2.5、用户身份切换</a><ul><li><a href="#251su-命令" class="table-of-contents__link toc-highlight">2.5.1、su 命令</a></li><li><a href="#252sudo-配置" class="table-of-contents__link toc-highlight">2.5.2、sudo 配置</a></li><li><a href="#253sudo-or-sudoedit-命令" class="table-of-contents__link toc-highlight">2.5.3、sudo or sudoedit 命令</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Study</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/en/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/skill">Notes</a></li><li class="footer__item"><a class="footer__link-item" href="/en/project">Projects</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/linux">Linux</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/about">About Me</a></li><li class="footer__item"><a href="https://github.com/zqingfa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Juejin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/en/friends">Friends</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/en/website">Links</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">浙ICP备20024502号-1</a></p><p>Copyright © 2022 – PRESENT zhangqf Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.3ab0938b.js"></script>
<script src="/en/assets/js/main.7af82c56.js"></script>
</body>
</html>