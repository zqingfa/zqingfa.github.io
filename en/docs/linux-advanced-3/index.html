<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-linux/advanced/linux-advanced-3">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">第 3 章 Linux NFS 网络文件系统 - Linux技术分享</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zhangqf.com/en/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://zhangqf.com/en/img/logo.png"><meta data-rh="true" property="og:url" content="https://zhangqf.com/en/docs/linux-advanced-3"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="第 3 章 Linux NFS 网络文件系统 - Linux技术分享"><meta data-rh="true" name="description" content="类似 ext 家族、xfs 格式的本地文件系统，它们都是通过单个文件名称空间(name space)来包含很多文件，并提供基本的文件管理和空间分配功能。这类文件系统和存在上面的文件都是存放在本地主机上的。"><meta data-rh="true" property="og:description" content="类似 ext 家族、xfs 格式的本地文件系统，它们都是通过单个文件名称空间(name space)来包含很多文件，并提供基本的文件管理和空间分配功能。这类文件系统和存在上面的文件都是存放在本地主机上的。"><meta data-rh="true" name="keywords" content="linux,nfs"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhangqf.com/en/docs/linux-advanced-3"><link data-rh="true" rel="alternate" href="https://zhangqf.com/en/docs/linux-advanced-3" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-3" hreflang="zh"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-3" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9B0V5WT2X8-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Linux技术分享" href="/en/opensearch.xml">
<link rel="preconnect" href="https://zhangqf.com/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://zhangqf.com/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?77dc6b24cf1d939292e9fe13be271a96",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/en/rss.xml" title="zhangqf RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/atom.xml" title="zhangqf Atom Feed">
<link rel="alternate" type="application/json" href="/en/feed.json" title="zhangqf JSON Feed">

<link rel="icon" href="/en/img/logo.png">
<link rel="manifest" href="/en/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><link rel="stylesheet" href="/en/assets/css/styles.86c9ae18.css">
<link rel="preload" href="/en/assets/js/runtime~main.9e6f80ce.js" as="script">
<link rel="preload" href="/en/assets/js/main.77e89f19.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>更新 <a href="/website">网址导航</a> 带你发现感兴趣的技术</span></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">kuizuo</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/en/docs/linux">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/category/Linux基础">Linux 基础</a></li><li><a class="dropdown__link" href="/en/docs/category/Linux进阶">Linux 进阶</a></li><li><a class="dropdown__link" href="/en/docs/category/Linux测试">Linux 测试</a></li><li><a class="dropdown__link" href="/en/docs/category/LinuxCICD">Linux CICD研发</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Blog</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/tags">Tags</a></li><li><a class="dropdown__link" href="/en/archive">Archive</a></li></ul></div><a class="navbar__item navbar__link" href="/en/docs/skill/">Notes</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Tools</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/tools/">Recommended Tools</a></li><li><a href="https://api.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">API Service</a></li><li><a href="https://js-de-obfuscator.vercel.app" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS Deobfuscate</a></li><li><a href="https://cipher.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">CyberChef Encryption</a></li></ul></div><a class="navbar__item navbar__link" href="/en/website">Links</a><a class="navbar__item navbar__link" href="/en/project">Projects</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/en/docs/linux-advanced-3" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-GB">English</a></li><li><a href="/docs/linux-advanced-3" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/en/"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"><b>kuizuo</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/linux">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux基础">Linux基础</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux基础&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/docs/category/linux进阶">Linux进阶</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux进阶&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-1">第 1 章 Linux 进阶命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-2">第 2 章 Linux 防火墙</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/linux-advanced-3">第 3 章 Linux NFS 网络文件系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-4">第 4 章 Linux DHCP 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-5">第 5 章 Linux DNS 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-6">第 6 章 Linux httpd 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-7">第 7 章 Linux httpd 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-8">第 8 章 Linux httpd 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-9">第 9 章 Linux Nginx 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-10">第 10 章 Linux Tomcat 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-11">第 11 章 Linux Tomcat 服务实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-12">第 12 章 Linux haproxy 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-13">第 13 章 Linux haproxy 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-14">第 14 章 Linux haproxy 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-15">第 15 章 Linux LVS 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/linux-advanced-16">第 16 章 Linux Keepalived 服务配置</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux测试">Linux测试</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux测试&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linuxcicd">LinuxCICD</a><button aria-label="Toggle the collapsible sidebar category &#x27;LinuxCICD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/category/linux进阶"><span itemprop="name">Linux进阶</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第 3 章 Linux NFS 网络文件系统</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>第 3 章 Linux NFS 网络文件系统</h1></header><p>类似 ext 家族、xfs 格式的本地文件系统，它们都是通过单个文件名称空间(name space)来包含很多文件，并提供基本的文件管理和空间分配功能。这类文件系统和存在上面的文件都是存放在本地主机上的。</p><p>实际上，还有网络文件系统。顾名思义，就是跨网络的文件系统，将远程主机上的文件系统(或目录)存放在本地主机上，就像它本身就是本地文件系统一样。在 Windows 环境下有 cifs 协议实现的网络文件系统，在 Unix 环境下，最出名是由 NFS 协议实现的 NFS 文件系统。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31rpc-框架">3.1、RPC 框架<a class="hash-link" href="#31rpc-框架" title="Direct link to heading">​</a></h2><p>要介绍 NFS，必然要先介绍 RPC。RPC 是 remote procedure call 的简写，人们都将其译为 &quot;远程过程调用&quot;，它是一种框架，这种框架在大型公司应用非常多。而 NFS 正是其中一种，此外 NIS、hadoop 也是使用 rpc 框架实现的。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="311rpc-原理">3.1.1、RPC 原理<a class="hash-link" href="#311rpc-原理" title="Direct link to heading">​</a></h3><p>所谓的 remote procedure call，就是在本地调用远程主机上的 procedure。</p><p>以本地执行 &quot;cat -n ~/abc.txt&quot; 命令为例，在本地执行 cat 命令时，会发起某些系统调用(如 open()、read()、close() 等)，并将 cat 的选项和参数传递给这些函数，于是最终实现了文件的查看功能。</p><p>如何实现远程 cat，甚至其他远程命令？通常有两种可能实现的方式：</p><ol><li><p>使用 ssh 类的工具，将要执行的命令传递到远程主机上并执行。但 ssh 无法直接调用远程主机上 cat 所发起的那些系统调用(如 open()、read()、close() 等)。</p></li><li><p>使用网络 socket 的方式，告诉远程服务进程要调用的函数。但这样的主机间进程通信方式一般都是 daemon 类服务，daemon 类的客户端(即服务的消费方)每调用一个服务的功能，都需要编写一堆实现网络通信相关的代码。不仅容易出错，还比较复杂。</p><p>而 rpc 是最好的解决方式。rpc 是一种框架，在此框架中已经集成了网络通信代码和封包、解包方式(编码、解码)。以下是 rpc 整个过程，以 cat NFS 文件系统中的 a.sh 文件为例。</p><p><img loading="lazy" alt="rpc stub" src="/en/assets/images/rpc stub-787eb7e303184c6f5cf5adb618ab2f23.png" width="694" height="424" class="img_ev3q"></p></li><li><p>nfs 客户端执行 cat a.sh，由于 a.sh 是 NFS 文件系统内的文件，所以 cat 会发起一些 procedure 调用(如open/read/close)，这些 procedure 对应的 ID 号码和对应的参数会发送给 rpc client(可能是单个 procedure ID，也可能是多个 procedure 组合在一起一次性发送给 rpc client，在 NFSv4 上是后者)。</p></li><li><p>rpc client 会将这些数据进行编码封装(封装和解封装功能由 stub 代码实现)，封装后的消息称为 &quot;call message&quot;。</p></li><li><p>call message 通过网络发送给 rpc server，rpc server 会对封装的数据进行解封提取，于是就得到了要调用的 procedures ID 和对应的参数，然后将它们交给 NFS 服务进程，最终调用 procedure ID 对应的 procedure 来执行，并返回结果。</p></li><li><p>NFS 服务发起 procedure 调用后，会得到数据(可能是数据本身，可能是状态消息等)，于是将返回结果交给 rpc server，rpc server 会将这些数据封装，这部分数据称为 &quot;reply message&quot;。</p></li><li><p>然后将 reply message 通过网络发送给 rpc client，rpc client 解封提取，于是得到最终的返回结果。</p></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="312rpc-工具介绍">3.1.2、RPC 工具介绍<a class="hash-link" href="#312rpc-工具介绍" title="Direct link to heading">​</a></h3><p>在 ARM64 RedFlag ATM Linux for Phytium 7.5.1804.14 操作系统上，rpc server 由 rpcbind 程序实现，该程序由 rpcbind 包提供。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install rpcbind</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpm -ql rpcbind | grep bin/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/rpcbind</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/rpcinfo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 rpcbind 是 rpc 主程序，在 rpc 服务端该程序必须处于已运行状态，其<strong>默认监听在 111 端口</strong>。rpcinfo 是 rpc 相关信息查询工具。</p><p>对于 rpc 而言，直接管理的是 programs，programs 由一个或多个 procedure 组成。这些 program 称为 RPC program 或 RPC service。</p><p><img loading="lazy" alt="rpc programs" src="/en/assets/images/rpc programs-e0e95874b981820f1c09ef141ca3de32.png" width="651" height="540" class="img_ev3q"></p><p>其中 NFS、NIS、hadoop 等称为网络服务，它们由多个进程或程序(program)组成。</p><p>例如 NFS 包括 rpc.nfsd、rpc.mountd、rpc.statd 和 rpc.idmapd 等 programs，其中每个 program 都包含了一个或多个 procedure，例如 rpc.nfsd 这个程序包含了如 OPEN、CLOSE、READ、COMPOUND、GETATTR 等 procedure，rpc.mountd 也主要有 MNT 和 UMNT 两个 procedure。</p><p>对于 RPC 而言，它是不知道 NFS/NIS/hadoop 这一层的，它直接管理 programs。每个 program 启动时都需要找 111 端口的 rpc 服务登记注册，然后 RPC 服务会为该 program 映射一个 program number 以及分配一个端口号。每个 program 都有一个唯一与之对应的 program number，它们的映射关系定义在 /etc/rpc 文件中。</p><p>以后 rpc server 将使用 program number 来判断要调用的是哪个 program 中的哪个 procedure(因为这些都是 rpc client 封装在 &quot;call message&quot; 中的)，并将解包后的数据传递给该 program 和 procedure。</p><p>例如只启动 rpcbind 时。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl start rpcbind.service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpcinfo -p localhost</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   program vers proto   port  </span><span class="token function" style="color:rgb(0, 0, 255)">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   tcp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   tcp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   tcp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   udp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   udp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   udp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中第一列就是 program number，第二列 vers 表示对应 program 的版本号，最后一列为 RPC 管理的 RPC service 名，其实就是各 program 对应的称呼。</p><p>当客户端获取到 rpc 所管理的 service 的端口后，就可以与该端口进行通信了。<strong>但注意，即使客户端已经获取了端口号，客户端仍会借助 rpc 做为中间人进行通信。也就是说，无论何时，客户端和 rpc 所管理的服务的通信都必须通过 rpc 来完成。之所以如此，是因为只有 rpc 才能封装和解封装数据。</strong></p><p>既然客户端不能直接拿着端口号和 rpc service 通信，那还提供端口号干嘛？这个端口号是为 rpc server 提供的，rpc server 解包数据后，会将数据通过此端口交给对应的 rpc service。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32启动-nfs">3.2、启动 NFS<a class="hash-link" href="#32启动-nfs" title="Direct link to heading">​</a></h2><p>NFS 本身是很复杂的，它由很多进程组成。这些进程的启动程序由 nfs-utils 包提供。由于 nfs 是使用 RPC 框架实现的，所以需要先安装好 rpcbind。不过安装 nfs-utils 时会自动安装 rpcbind。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install nfs-utils -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpm -ql nfs-utils | grep /usr/sbin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/blkmapd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/exportfs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/mountstats</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/nfsdcltrack</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/nfsidmap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/nfsiostat</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/nfsstat</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/rpc.gssd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/rpc.idmapd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/rpc.mountd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/rpc.nfsd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/rpcdebug</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/showmount</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/sm-notify</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/start-statd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中以 &quot;rpc.&quot; 开头的程序都是 rpc service，分别实现不同的功能，启动它们时每个都需要向 rpcbind 进行登记注册。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl start nfs.service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpcinfo -p localhost</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   program vers proto   port  </span><span class="token function" style="color:rgb(0, 0, 255)">service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   tcp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   tcp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   tcp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   udp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   udp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   udp    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">  portmapper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100024</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   udp  </span><span class="token number" style="color:rgb(9, 134, 88)">56416</span><span class="token plain">  status</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100024</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   tcp  </span><span class="token number" style="color:rgb(9, 134, 88)">53771</span><span class="token plain">  status</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100005</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   udp  </span><span class="token number" style="color:rgb(9, 134, 88)">20048</span><span class="token plain">  mountd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100005</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   tcp  </span><span class="token number" style="color:rgb(9, 134, 88)">20048</span><span class="token plain">  mountd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100005</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   udp  </span><span class="token number" style="color:rgb(9, 134, 88)">20048</span><span class="token plain">  mountd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100005</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   tcp  </span><span class="token number" style="color:rgb(9, 134, 88)">20048</span><span class="token plain">  mountd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100005</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   udp  </span><span class="token number" style="color:rgb(9, 134, 88)">20048</span><span class="token plain">  mountd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100005</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   tcp  </span><span class="token number" style="color:rgb(9, 134, 88)">20048</span><span class="token plain">  mountd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100003</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   tcp   </span><span class="token number" style="color:rgb(9, 134, 88)">2049</span><span class="token plain">  nfs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100003</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   tcp   </span><span class="token number" style="color:rgb(9, 134, 88)">2049</span><span class="token plain">  nfs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100227</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   tcp   </span><span class="token number" style="color:rgb(9, 134, 88)">2049</span><span class="token plain">  nfs_acl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100003</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   udp   </span><span class="token number" style="color:rgb(9, 134, 88)">2049</span><span class="token plain">  nfs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100227</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   udp   </span><span class="token number" style="color:rgb(9, 134, 88)">2049</span><span class="token plain">  nfs_acl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100021</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   udp  </span><span class="token number" style="color:rgb(9, 134, 88)">54716</span><span class="token plain">  nlockmgr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100021</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   udp  </span><span class="token number" style="color:rgb(9, 134, 88)">54716</span><span class="token plain">  nlockmgr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100021</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   udp  </span><span class="token number" style="color:rgb(9, 134, 88)">54716</span><span class="token plain">  nlockmgr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100021</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   tcp  </span><span class="token number" style="color:rgb(9, 134, 88)">36983</span><span class="token plain">  nlockmgr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100021</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   tcp  </span><span class="token number" style="color:rgb(9, 134, 88)">36983</span><span class="token plain">  nlockmgr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">100021</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   tcp  </span><span class="token number" style="color:rgb(9, 134, 88)">36983</span><span class="token plain">  nlockmgr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>可以看到，每个 program 都启动了不同版本的功能。其中 nfs program 为 rpc.nfsd 对应的 program，为 nfs 服务的主进程，端口号为 2049。</li><li>mountd 对应的 program 为 rpc.mountd，它为客户端的 mount 和 umount 命令提供服务，即挂载和卸载 NFS 文件系统时会联系 mountd 服务，由 mountd 维护相关挂载信息。</li><li>nlockmgr 对应的 program 为 rpc.statd，用于维护文件锁和文件委托相关功能，在 NFSv4 以前，称之为 NSM(network status manager)。</li><li>nfs<!-- -->_<!-- -->acl 和 status，很显然，它们是访问控制列表和状态信息维护的 program。</li></ul><p>再看看启动的相关进程信息。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ps aux | grep -E &quot;[n]fs|[r]pc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root       </span><span class="token number" style="color:rgb(9, 134, 88)">649</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> ?        I</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:44   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">rpciod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rpc        </span><span class="token number" style="color:rgb(9, 134, 88)">679</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">9848</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">3324</span><span class="token plain"> ?        Ss   </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:44   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 /sbin/rpcbind -w</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rpcuser   </span><span class="token number" style="color:rgb(9, 134, 88)">1477</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.1</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">6964</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">3120</span><span class="token plain"> ?        Ss   </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 /usr/sbin/rpc.statd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">1483</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">6264</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">1652</span><span class="token plain"> ?        Ss   </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 /usr/sbin/rpc.idmapd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">1485</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">6976</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">1728</span><span class="token plain"> ?        Ss   </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 /usr/sbin/rpc.mountd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">1495</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> ?        S    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">nfsd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">1496</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> ?        S    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">nfsd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">1497</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> ?        S    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">nfsd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">1498</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> ?        S    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">nfsd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">1499</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> ?        S    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">nfsd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">1500</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> ?        S    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">nfsd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">1501</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> ?        S    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">nfsd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root      </span><span class="token number" style="color:rgb(9, 134, 88)">1502</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> ?        S    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:50   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">nfsd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其中有一项 /usr/sbin/rpc.idmapd 进程，该进程是提供服务端的 <code>uid/gid &lt;==&gt; username/groupname</code> 的映射翻译服务。客户端的 <code>uid/gid &lt;==&gt; username/groupname</code> 的映射翻译服务则由 &quot;nfsidmap&quot; 工具实现，详细说明见下文。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="33配置导出目录和挂载使用">3.3、配置导出目录和挂载使用<a class="hash-link" href="#33配置导出目录和挂载使用" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="331配置-nfs-导出目录">3.3.1、配置 nfs 导出目录<a class="hash-link" href="#331配置-nfs-导出目录" title="Direct link to heading">​</a></h3><p>在将服务端的目录共享(share)或者说导出(export)给客户端之前，需要先配置好要导出的目录。比如何人可访问该目录，该目录是否可写，以何人身份访问导出目录等。</p><p>配置导出目录的配置文件为 /etc/exports 或 /etc/exports.d/<!-- -->*<!-- -->.exports 文件，在 nfs 服务启动时，会自动加载这些配置文件中的所有导出项。以下是导出示例：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">/www    </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.0.0/16</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">rw,async,no_root_squash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其中 /www 是导出目录，即共享给客户端的目录；172.16.0.0/16 是访问控制列表 ACL，只有该网段的客户端主机才能访问该导出目录，即挂载该导出目录；</li><li>紧跟在主机列表后的括号及括号中定义的是该导出目录对该主机的导出选项，例如(rw, async, no<!-- -->_<!-- -->root<!-- -->_<!-- -->squash)表示客户端挂载 /www 后，该目录可读写、异步、可保留 root 用户的权限，具体的导出选项稍后列出。</li></ul><p>以下是可接收的几种导出方式：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">/www1    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">rw,async,no_root_squash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">                                  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 导出给所有主机，此时称为导出给world</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/www2    </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.1.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">rw,async</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">                                       </span><span class="token comment" style="color:rgb(0, 128, 0)"># 仅导出给单台主机172.16.1.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/www3    </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.0.0/16</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">rw,async</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.10.3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">rw,no_root_squash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 导出给网段172.16.0.0/16，还导出给单台</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                                    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 主机192.168.10.3，且它们的导出选项不同</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/www4    www.a.com</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">rw,async</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">                                        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 导出给单台主机www.a.com主机，但要求能解析该主机名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/www     *.b.com</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">rw,async</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">                                          </span><span class="token comment" style="color:rgb(0, 128, 0)"># 导出给b.com下的所有主机，要求能解析对应主机名</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以下是常用的一些导出选项说明，更多的导出选项见 man exports：常见的默认项是：ro, sync, root<!-- -->_<!-- -->squash, no<!-- -->_<!-- -->all<!-- -->_<!-- -->squash, wdelay。</p><table><thead><tr><th>导出选项</th><th>选项说明</th></tr></thead><tbody><tr><td>rw、<strong>ro</strong></td><td>导出目录可读写还是只读(read-only)。</td></tr><tr><td><strong>sync</strong>、async</td><td>同步共享还是异步共享。</td></tr></tbody></table><p>异步时，客户端提交要写入的数据到服务端，服务端接收数据后直接响应客户端，但此时数据并不一定已经写入磁盘中；<br>
<!-- -->同步则是必须等待服务端已将数据写入磁盘后才响应客户端。<br>
<!-- -->也就是说，给定异步导出选项时，虽然能提升一些性能，但在服务端突然故障或重启时有丢失一部分数据的风险。<br>
<!-- -->当然，对于只读(ro)的导出目录，设置 sync 或 async 是没有任何差别的。 |
| anonuid<br>
<!-- -->anongid | 此为匿名用户(anonymous)的 uid 和 gid 值，默认都为 65534，在 /etc/passwd 和 /etc/shadow 中它们对应的用户名为 nfsnobody。<br>
<!-- -->该选项指定的值用于身份映射被压缩时。 |
| <strong>root<!-- -->_<!-- -->squash</strong><br>
<!-- -->no<!-- -->_<!-- -->root<!-- -->_<!-- -->squash | 是否将发起请求(即客户端进行访问时)的 uid/gid=0 的 root 用户映射为 anonymous 用户。即是否压缩 root 用户的权限。 |
| all<!-- -->_<!-- -->squash<br>
<strong>no<!-- -->_<!-- -->all<!-- -->_<!-- -->squash</strong> | 是否将发起请求(即客户端进行访问时)的所有用户都映射为 anonymous 用户，即是否压缩所有用户的权限。 |</p><p>对于 root 用户，将取 <code>(no_)root_squash</code> 和 <code>(no_)all_squash</code> 的交集。例如，<code>no_root_squash</code> 和 <code>all_squash</code> 同时设置时，root 仍被压缩，<code>root_squash</code> 和 <code>no_all_squash</code> 同时设置时，root 也被压缩。</p><p>有些导出选项需要配合其他设置。例如，导出选项设置为 rw，但如果目录本身没有 w 权限，或者 mount 时指定了 ro 挂载选项，则同样不允许写操作。</p><p>在配置文件写好要导出的目录后，直接重启 nfs 服务即可，它会读取这些配置文件。随后就可以在客户端执行 mount 命令进行挂载。</p><p>例如，exports 文件内容如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">/vol/vol0       *</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">rw,no_root_squash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/vol/vol2       *</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">rw,no_root_squash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/backup/archive *</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">rw,no_root_squash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="332挂载-nfs-文件系统">3.3.2、挂载 nfs 文件系统<a class="hash-link" href="#332挂载-nfs-文件系统" title="Direct link to heading">​</a></h3><p>然后去客户端上挂载它们。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@KylinV10 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mount -t nfs 10.1.1.2:/vol/vol0 /mp1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@KylinV10 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mount 10.1.1.2:/vol/vol2 /mp2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@KylinV10 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mount 10.1.1.2:/backup/archive /mp3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@KylinV10 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>挂载时 &quot;-t nfs&quot; 可以省略，因为对于 mount 而言，只有挂载 nfs 文件系统才会写成 host:/path 格式。当然，除了 mount 命令，nfs-utils 包还提供了独立的 mount.nfs 命令，它其实和 &quot;mount -t nfs&quot; 命令是一样的。</li></ul><p>mount 挂载时可以指定挂载选项，其中包括 mount 通用挂载选项，如 rw/ro，atime/noatime，async/sync，auto/noauto 等，也包括针对 nfs 文件系统的挂载选项。以下列出几个常见的，更多的内容查看 man nfs 和 man mount。</p><table><thead><tr><th>选项</th><th>参数意义</th><th>默认值</th></tr></thead></table><p>| <strong>suid</strong><br>
<strong>nosuid</strong> | 如果挂载的文件系统上有设置了 suid 的二进制程序，使用 nosuid 可以取消它的 suid | <strong>suid</strong> |
| <strong>rw</strong><br>
<strong>ro</strong> | 尽管服务端提供了 rw 权限，但是挂载时设定 ro，则还是 ro 权限<br>
<strong>权限取交集</strong> | <strong>rw</strong> |
| <strong>exec</strong><br>
<strong>noexec</strong> | 是否可执行挂载的文件系统里的二进制文件 | <strong>exec</strong> |
| <strong>user</strong><br>
<strong>nouser</strong> | 是否运行普通用户进行档案的挂载和卸载 | <strong>nouser</strong> |
| <strong>auto</strong><br>
<strong>noauto</strong> | auto 等价于 mount -a，意思是将 /etc/fstab 里设定的全部重挂一遍 | <strong>auto</strong> |
| <strong>sync</strong><br>
<strong>nosync</strong> | 同步挂载还是异步挂载 | <strong>async</strong> |
| <strong>atime</strong><br>
<strong>noatime</strong> | 是否修改 atime，对于 nfs 而言，该选项是无效的，理由见下文 |  |
| <strong>diratime</strong><br>
<strong>nodiratime</strong> | 是否修改目录 atime，对于 nfs 而言，该挂载选项是无效的，理由见下文 |  |
| <strong>remount</strong> | 重新挂载 |  |</p><p>以下是针对 nfs 文件系统的挂载选项。其中没有给出关于缓存选项(ac/noac、cto/nocto、lookupcache)的说明，它们可以直接采用默认值，如果想要了解缓存相关内容，可以查看 man nfs。</p><table><thead><tr><th>选项</th><th>功能</th><th>默认值</th></tr></thead></table><p>| <strong>fg</strong><br>
<strong>bg</strong> | <strong>挂载失败后</strong> mount 命令的行为。默认为 fg，表示挂载失败时将直接报错退出。<br>
<!-- -->如果是 bg，挂载失败后会创建一个子进程不断在后台挂载，而父进程 mount 自身则立即退出并返回 0 状态码。 | <strong>fg</strong> |
| <strong>timeo</strong> | NFS 客户端等待下一次重发 NFS 请求的时间间隔，单位为十分之一秒。<br>
<!-- -->基于 TCP 的 NFS 的默认 timeo 的值为 600(60秒)。 |  |
| <strong>hard</strong><br>
<strong>soft</strong> | 决定 NFS 客户端当 NFS 请求超时时的恢复行为方式。如果是 hard，将无限重新发送 NFS 请求。<br>
<!-- -->例如在客户端使用 df -h 查看文件系统时就会不断等待。<br>
<!-- -->设置 soft，当 retrans 次数耗尽时，NFS 客户端将认为 NFS 请求失败，从而使得 NFS 客户端返回一个错误给调用它的程序。 | <strong>hard</strong> |
| <strong>retrans</strong> | NFS 客户端最多发送的请求次数，次数耗尽后将报错表示连接失败。如果 hard 挂载选项生效，则会进一步尝试恢复连接。 | <strong>3</strong> |
| <strong>rsize</strong><br>
<strong>wsize</strong> | 一次读出(rsize)和写入(wsize)的区块大小。如果网络带宽大，这两个值设置大一点能提升传输能力。最好设置到带宽的临界值。<br>
<!-- -->单位为字节，大小只能为 1024 的倍数，且最大只能设置为 1M。 |  |</p><p>注意三点：</p><ol><li><p>所谓的 soft 在特定的环境下超时后会导致静态数据中断。因此，<strong>仅当客户端响应速度比数据完整性更重要时才使用 soft 选项。</strong></p><p>使用基于 TCP 的 NFS(除非显示指定使用 UDP，否则现在总是默认使用 TCP)或增加 retrans 重试次数可以降低使用 soft 选项带来的风险。</p><p>如果真的出现 NFS 服务端下线，导致 NFS 客户端无限等待的情况，可以强制将 NFS 文件系统卸载，卸载方法：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">umount</span><span class="token plain"> -f -l MOUNT_POINT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 &quot;-f&quot; 是强制卸载，&quot;-l&quot; 是 lazy umount，表示将该文件系统从当前目录树中剥离，让所有对该文件系统内的文件引用都强制失效。对于丢失了 NFS 服务端的文件系统，卸载时 &quot;-l&quot; 选项是必须的。</p></li><li><p>由于 nfs 的客户端挂载后会缓存文件的属性信息，其中包括各种文件时间戳，所以 <strong>mount 指定时间相关的挂载选项是没有意义的</strong>，它们不会有任何效果，包括 <strong>atime/noatime，diratime/nodiratime</strong>，relatime/norelatime 以及 strictatime/nostrictatime 等。具体可见 man nfs 中 &quot;DATA AND METADATA COHERENCE&quot; 段的 &quot;File timestamp maintainence&quot; 说明。</p></li><li><p>如果是要开机挂载 NFS 文件系统，方式自然是写入到 /etc/fstab 文件或将 mount 命令放入 rc.local 文件中。</p><p>如果是将 /etc/fstab 中，那么在系统环境初始化(exec /etc/rc.d/rc.sysinit)的时候会加载 fstab 中的内容，如果挂载 fstab 中的文件系统出错，则会导致系统环境初始化失败，结果是系统开机失败。</p><p>所以，要开机挂载 nfs 文件系统，则需要在 /etc/fstab 中加入一个挂载选项 <code>&quot;_rnetdev&quot;</code> 或 <code>&quot;_netdev&quot;</code>(centos 7 中已经没有 <code>&quot;_rnetdev&quot;</code>)，防止无法联系 nfs 服务端时导致开机启动失败。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2:/www    /mnt    nfs    defaults,_rnetdev    </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>当导出目录后，将在 /var/lib/nfs/etab 文件中写入一条对应的导出记录，这是 nfs 维护的导出表，该表的内容会交给 rpc.mountd 进程，并在必要的时候(mountd 接受到客户端的 mount 请求时)，将此导出表中的内容加载到内核中，内核也单独维护一张导出表。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="333nfs-伪文件系统">3.3.3、nfs 伪文件系统<a class="hash-link" href="#333nfs-伪文件系统" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="nfs pseudo filesystem" src="/en/assets/images/nfs pseudo filesystem-b682c5b995c4eaf74916ddf4c9be004b.png" width="980" height="486" class="img_ev3q"></p><p>服务端导出 /vol/vol0、/vol/vol2 和 /backup/archive 后，其中 vol0 和 vol2 是连在一个目录下的，但它们和 archive 目录没有连在一起，nfs 采用伪文件系统的方式来桥接这些不连接的导出目录。桥接的方式是创建那些未导出的连接目录，如伪 vol 目录，伪 backup 目录以及顶级的伪根。</p><p>当客户端挂载后，每次访问导出目录时，其实都是通过找到伪文件系统(文件系统都有 id，在 nfs 上伪文件系统的 id 称为 fsid)并定位到导出目录的。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="34showmount-命令">3.4、showmount 命令<a class="hash-link" href="#34showmount-命令" title="Direct link to heading">​</a></h2><p>使用 showmount 命令可以查看某一台主机的导出目录情况。因为涉及到 rpc 请求，所以如果 rpc 出问题，showmount 一样会傻傻地等待。</p><p>主要有 3 个选项：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">showmount </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -ade</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-a：以host:dir格式列出客户端名称/IP以及所挂载的目录。但注意该选项是读取NFS服务端/var/lib/nfs/rmtab文件，</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ：而该文件很多时候并不准确，所以showmount -a的输出信息很可能并非准确无误的</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-e：显示NFS服务端所有导出列表。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-d：仅列出已被客户端挂载的导出目录。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另外 showmount 的结果是排序过的，所以和实际的导出目录顺序可能并不一致。</p><p>例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># showmount -e</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Export list </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> arm64v8:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/backup/archive *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/vol/vol2       *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/vol/vol0       *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="35nfs-身份映射">3.5、nfs 身份映射<a class="hash-link" href="#35nfs-身份映射" title="Direct link to heading">​</a></h2><p>NFS 的目的是导出目录给各客户端，因此导出目录中的文件在服务端和客户端上必然有两套属性、权限集。</p><ul><li>例如，服务端导出目录中某 a 文件的所有者和所属组都为 A，但在客户端上不存在 A，那么在客户端上如何显示 a 文件的所有者等属性？
</li><li>例如，在客户端上，以用户 B 在导出目录中创建了一个文件 b，如果服务端上没有用户 B，在服务端上该如何决定文件 b 的所有者等属性？
</li></ul><p>NFS 采用 <code>uid/gid &lt;==&gt; username/groupname</code> 映射的方式解决客户端和服务端两套属性问题。由于服务端只能控制它自己一端的身份映射，所以客户端也同样需要身份映射组件。也就是说，服务端和客户端两端都需要对导出的所有文件的所有者和所属组进行映射。</p><p><em>注意：服务端的身份映射组件为 rpc.idmapd，它以守护进程方式工作。而客户端使用 nfsidmap 工具进行身份映射。</em></p><p><strong>服务端映射时以 uid/gid 为基准，</strong>意味着客户端以身份 B(假设对应 uid=Xb，gid=Yb) 创建的文件或修改了文件的所有者属性时，在服务端将从 /etc/passwd(此处不考虑其他用户验证方式)文件中搜索 uid=Xb，gid=Yb 的用户，如果能搜索到，则设置该文件的所有者和所属组为此 uid/gid 对应的 username/groupname，如果搜索不到，则文件所有者和所属组直接显示为 uid/gid 的值。</p><p><strong>客户端映射时以 username/groupname 为基准，</strong>意味着服务端上文件所有者为 A 时，则在客户端上搜索 A 用户名，如果搜索到，则文件所有者显示为 A，否则都将显示为 nobody。注意，客户端不涉及任何 uid/gid 转换翻译过程，即使客户端上 A 用户的 uid 和服务端上 A 用户的 uid 不同，也仍显示为用户 A。也就是说，客户端上文件所有者只有两种结果，要么和服务端用户同名，要么显示为 nobody。</p><p>综上考虑，强烈建议客户端和服务端的用户身份要统一，且尽量让各 uid、gid 能对应上。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="36使用-exportfs-命令导出目录">3.6、使用 exportfs 命令导出目录<a class="hash-link" href="#36使用-exportfs-命令导出目录" title="Direct link to heading">​</a></h2><p>除了启动 nfs 服务加载配置文件 /etc/exports 来导出目录，使用 exportfs 命令也可以直接导出目录，它无需加载配置文件 /etc/exports，当然 exportfs 也可以加载 /etc/exports 文件来导出目录。实际上，nfs 服务启动脚本中就是使用 exportfs 命令来导出 /etc/exports 中内容的。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep exportfs /usr/lib/systemd/system/nfs.service </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ExecStartPre</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">-/usr/sbin/exportfs -r</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ExecStopPost</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/sbin/exportfs -au</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ExecStopPost</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/sbin/exportfs -f</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ExecReload</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">-/usr/sbin/exportfs -r</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然，无论如何，nfsd 等守护进程是必须已经运行好的。</p><p>以下是 CentOS 7 上 exportfs 命令的用法。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-a     导出或卸载所有目录。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-o options,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       指定一系列导出选项</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">如rw,async,root_squash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">，这些导出选项在exports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">的man文档中有记录。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-i     忽略/etc/exports和/etc/exports.d目录下文件。此时只有命令行中给定选项和默认选项会生效。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r     重新导出所有目录，并同步修改/var/lib/nfs/etab文件中关于/etc/exports和/etc/exports.d/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       *.exports的信息</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">即还会重新导出/etc/exports和/etc/exports.d/*等导出配置文件中的项</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">。该</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       选项会移除/var/lib/nfs/etab中已经被删除和无效的导出项。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-u     卸载</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">即不再导出</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">一个或多个导出目录。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f     如果/prof/fs/nfsd或/proc/fs/nfs已被挂载，即工作在新模式下，该选项将清空内核中导出表中</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       的所有导出项。客户端下一次请求挂载导出项时会通过rpc.mountd将其添加到内核的导出表中。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v     输出详细信息。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s     显示适用于/etc/exports的当前导出目录列表。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><p><strong>导出 /www 目录给客户端 10.1.1.3。</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># exportfs 10.1.1.3:/www</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># showmount -e</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Export list </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> arm64v8:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/backup/archive *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/vol/vol2       *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/vol/vol0       *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/www            </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>导出 /www 目录给所有人，并指定导出选项。</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># exportfs :/www -o rw,no_root_squash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># showmount -e</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Export list </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> arm64v8:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/backup/archive *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/vol/vol2       *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/vol/vol0       *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/www            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">everyone</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>导出 exports 文件中的内容。</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># exportfs -a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>重新导出所有已导出的目录。包括 exports 文件中和 exportfs 单独导出的目录。</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># exportfs -ar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>卸载所有已导出的目录，包括 exports 文件中的内容和 exportfs 单独导出的内容。即其本质为清空内核维护的导出表。</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># exportfs -au</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># showmount -e</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Export list </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> arm64v8:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>只卸载某一个导出目录。</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># exportfs -u 10.1.1.3:/www</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="37rpcdebug-命令">3.7、rpcdebug 命令<a class="hash-link" href="#37rpcdebug-命令" title="Direct link to heading">​</a></h2><p>在很多时候 NFS 客户端或者服务端出现异常，例如连接不上、锁状态丢失、连接非常慢等等问题，都可以对 NFS 进行调试来发现问题出在哪个环节。</p><p>NFS 有不少进程都可以直接支持调试选项，但最直接的调试方式是调试 rpc，因为 NFS 的每个请求和响应都会经过 RPC 去封装。但显然，调试 RPC 比直接调试 NFS 时更难分析出问题所在。以下只介绍如何调试 RPC。</p><p>rpc 单独提供一个调试工具 rpcdebug。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpcdebug -vh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">usage: rpcdebug </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-v</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-h</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-m module</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-s flags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-c flags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> or cancel debug flags.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Module     Valid flags</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rpc        xprt call debug nfs auth </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">bind</span><span class="token plain"> sched trans svcsock svcdsp misc cache all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nfs        vfs dircache lookupcache pagecache proc xdr </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> root callback client </span><span class="token function" style="color:rgb(0, 0, 255)">mount</span><span class="token plain"> fscache pnfs pnfs_ld state all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nfsd       sock fh </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> svc proc fileop auth repcache xdr lockd all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nlm        svc client clntlock svclock monitor clntsubs svcsubs hostcache xdr all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v：显示更详细信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-h：显示帮助信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-m：指定调试模块，有rpc/nfs/nfsd/nlm共4个模块可调试。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ：顾名思义，调试rpc模块就是直接调试rpc的问题，将记录rpc相关的日志信息；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ：调试nfs是调试nfs客户端的问题，将记录nfs客户端随之产生的日志信息；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ：nfsd是调试nfs服务端问题，将记录nfsd随之产生的日志信息；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ：nlm是调试nfs锁管理器相关问题，将只记录锁相关信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s：指定调试的修饰符，每个模块都有不同的修饰符，见上面的usage中</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Valid flags&quot;</span><span class="token plain">列的信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-c：清除或清空已设置的调试flage</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>例如设置调试 nfs 客户端的信息。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpcdebug -m nfs -s all</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nfs        vfs dircache lookupcache pagecache proc xdr </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> root callback client </span><span class="token function" style="color:rgb(0, 0, 255)">mount</span><span class="token plain"> fscache pnfs pnfs_ld state</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>当有信息出现时，将记录到 syslog 中。</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/linux-advanced-2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">第 2 章 Linux 防火墙</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/linux-advanced-4"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">第 4 章 Linux DHCP 服务</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#31rpc-框架" class="table-of-contents__link toc-highlight">3.1、RPC 框架</a><ul><li><a href="#311rpc-原理" class="table-of-contents__link toc-highlight">3.1.1、RPC 原理</a></li><li><a href="#312rpc-工具介绍" class="table-of-contents__link toc-highlight">3.1.2、RPC 工具介绍</a></li></ul></li><li><a href="#32启动-nfs" class="table-of-contents__link toc-highlight">3.2、启动 NFS</a></li><li><a href="#33配置导出目录和挂载使用" class="table-of-contents__link toc-highlight">3.3、配置导出目录和挂载使用</a><ul><li><a href="#331配置-nfs-导出目录" class="table-of-contents__link toc-highlight">3.3.1、配置 nfs 导出目录</a></li><li><a href="#332挂载-nfs-文件系统" class="table-of-contents__link toc-highlight">3.3.2、挂载 nfs 文件系统</a></li><li><a href="#333nfs-伪文件系统" class="table-of-contents__link toc-highlight">3.3.3、nfs 伪文件系统</a></li></ul></li><li><a href="#34showmount-命令" class="table-of-contents__link toc-highlight">3.4、showmount 命令</a></li><li><a href="#35nfs-身份映射" class="table-of-contents__link toc-highlight">3.5、nfs 身份映射</a></li><li><a href="#36使用-exportfs-命令导出目录" class="table-of-contents__link toc-highlight">3.6、使用 exportfs 命令导出目录</a></li><li><a href="#37rpcdebug-命令" class="table-of-contents__link toc-highlight">3.7、rpcdebug 命令</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Study</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/en/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/skill">Notes</a></li><li class="footer__item"><a class="footer__link-item" href="/en/project">Projects</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/linux">Linux</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/about">About Me</a></li><li class="footer__item"><a href="https://github.com/zqingfa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Juejin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/en/friends">Friends</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/en/website">Links</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">浙ICP备20024502号-1</a></p><p>Copyright © 2022 – PRESENT zhangqf Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.9e6f80ce.js"></script>
<script src="/en/assets/js/main.77e89f19.js"></script>
</body>
</html>