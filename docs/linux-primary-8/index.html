<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-linux/primary/linux-primary-8">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">第 8 章 Linux 包管理 - Linux技术分享</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://zhangqf.com/docs/linux-primary-8"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="第 8 章 Linux 包管理 - Linux技术分享"><meta data-rh="true" name="description" content="8.1、包基础知识"><meta data-rh="true" property="og:description" content="8.1、包基础知识"><meta data-rh="true" name="keywords" content="linux,Package"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhangqf.com/docs/linux-primary-8"><link data-rh="true" rel="alternate" href="https://zhangqf.com/en/docs/linux-primary-8" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-primary-8" hreflang="zh"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-primary-8" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9B0V5WT2X8-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Linux技术分享" href="/opensearch.xml">
<link rel="preconnect" href="https://zhangqf.com/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://zhangqf.com/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?77dc6b24cf1d939292e9fe13be271a96",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="zhangqf RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="zhangqf Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="zhangqf JSON Feed">

<link rel="icon" href="/img/logo.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><link rel="stylesheet" href="/assets/css/styles.86c9ae18.css">
<link rel="preload" href="/assets/js/runtime~main.9e73f1b3.js" as="script">
<link rel="preload" href="/assets/js/main.39d37d57.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>更新 <a href="/website">网址导航</a> 带你发现感兴趣的技术</span></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">zhangqf</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/linux">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/category/Linux基础">Linux 基础</a></li><li><a class="dropdown__link" href="/docs/category/Linux进阶">Linux 进阶</a></li><li><a class="dropdown__link" href="/docs/category/Linux测试">Linux 测试</a></li><li><a class="dropdown__link" href="/docs/category/LinuxCICD">Linux CICD研发</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Blog</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags">标签</a></li><li><a class="dropdown__link" href="/archive">归档</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/skill/">笔记</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">工具</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/tools/">工具推荐</a></li><li><a href="https://api.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">API服务</a></li><li><a href="https://js-de-obfuscator.vercel.app" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS代码还原</a></li><li><a href="https://cipher.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">CyberChef加密</a></li></ul></div><a class="navbar__item navbar__link" href="/website">导航</a><a class="navbar__item navbar__link" href="/project">项目</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/en/docs/linux-primary-8" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-GB">English</a></li><li><a href="/docs/linux-primary-8" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"><b>zhangqf</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/linux基础">Linux基础</a><button aria-label="打开/收起侧边栏菜单「Linux基础」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-1">第 1 章 Linux 基础命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-2">第 2 章 Linux 系统用户</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-3">第 3 章 Linux 文件权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-4">第 4 章 Linux ext 文件系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-5">第 5 章 Linux 磁盘管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-6">第 6 章 Linux LVM 存储管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-7">第 7 章 Linux Raid 存储管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/linux-primary-8">第 8 章 Linux 包管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-9">第 9 章 Linux 进程和信号</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-10">第 10 章 Linux 系统资源监控</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-11">第 11 章 Linux 服务管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-12">第 12 章 Linux 定时任务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-13">第 13 章 Linux 网络管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-primary-14">第 14 章 Linux 开机启动流程(UEFI+systemd)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux进阶">Linux进阶</a><button aria-label="打开/收起侧边栏菜单「Linux进阶」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux测试">Linux测试</a><button aria-label="打开/收起侧边栏菜单「Linux测试」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linuxcicd">Linux CICD研发</a><button aria-label="打开/收起侧边栏菜单「Linux CICD研发」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/linux基础"><span itemprop="name">Linux基础</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第 8 章 Linux 包管理</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>第 8 章 Linux 包管理</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="81包基础知识">8.1、包基础知识<a class="hash-link" href="#81包基础知识" title="标题的直接链接">​</a></h2><p>当今 Linux 的发行版本使用最广泛的有两大主流阵营，一个是 Red Hat 系列，一个是 Debian 系列。</p><p>Red Hat 系列包的名称以 rpm 结尾，分为二进制包和源码包。源码包以 &quot;.src.rpm&quot; 结尾，它是未编译过的包，可以自行进行编译或者用其制作自己的二进制 rpm 包，非 &quot;.src.rpm&quot; 结尾的包都是二进制包，都是已经编译完成的。</p><p>Debian 系列包的名称以 deb 结尾，一般官方提供的 deb 包都是二进制包，直接安装使用即可。</p><p>安装 rpm、deb 包的过程实际上就是将包中的文件复制到 Linux 上，有可能还会在复制文件的前后执行一些命令，如创建一个必要的用户，删除非必要文件等。</p><p>通过 Alien 工具，可以将 deb 包和 rpm 包进行相互转换。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="82rpm-包">8.2、rpm 包<a class="hash-link" href="#82rpm-包" title="标题的直接链接">​</a></h2><p>一个 rpm 包的名称分为包全名和包名，包全名如 httpd-2.4.6-97.el7.centos.aarch64.rpm，包全名中各部分的意义如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">httpd       包名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2.4</span><span class="token plain">.6       版本号，版本号格式</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> 主版本号.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> 次版本号.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> 修正号 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">97</span><span class="token plain">          软件发布次数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">el7.centos  适合的操作系统平台以及适合的操作系统版本</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aarch64     适合的硬件平台，硬件平台根据 cpu 来决定，有 aarch64、x86_64、MIPS、PowerPC、noarch 或者省略，noarch 或省略表示不区分硬件平台</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">rpm</span><span class="token plain">         软件包后缀扩展名</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于一个程序而言，在制作 rpm 包时，很多时候都将其按功能分割成多个子包，如客户端程序包、服务端程序包等。</p><p>以 mariadb 这个程序来说，它分有以下几个包：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">mariadb-server.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 提供 MariaDB 服务的主包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 客户端主包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-bench.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 对 MariaDB 进行压力测试的包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-devel.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 开发 MariaDB 所需的头文件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-embedded.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> MariaDB 作为一个可植入的库包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-embedded-devel.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> MariaDB 作为一个可植入的库开发所需的头文件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-libs.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> MariaDB/MySQL 客户端所需的共享库</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-test.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> The </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">test</span><span class="token plain"> suite distributed with MariaD</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>如果是源码编译安装的包，会包含所有功能包，也就是说编译安装一个程序后，它的客户端工具、服务提供程序、库文件、头文件等等都已经安装了。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="821rpm-安装升级卸载">8.2.1、rpm 安装、升级、卸载<a class="hash-link" href="#821rpm-安装升级卸载" title="标题的直接链接">​</a></h3><p>rpm 工具安装、升级和卸载的功能都很少使用。对于安装或升级来说，它需要人为解决包的依赖关系，这是一件令人抓狂的事，基本上都会使用 yum 工具进行安装和升级，而卸载行为在 Linux 上很少出现，大不了直接覆盖重装。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">rpm</span><span class="token plain"> -ivhUe --nodeps --test --force --prefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-i:             表示安装，install的意思</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v:             显示安装信息，还可以</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-vv&quot;</span><span class="token plain">、</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-vvv&quot;</span><span class="token plain">，v提供的越多显示信息越多</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-h:             显示安装进度，以</span><span class="token comment" style="color:rgb(0, 128, 0)">#显示安装的进度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-U:             升级或升级包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-F:             只升级已安装的包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-e:             卸载包，卸载也有依赖性,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--erase&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--nodeps:       忽略依赖性强制安装或卸载</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">no dependencies</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--test:         测试是否能够成功安装指定的rpm包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--prefix:       新路径 自行指定安装路径而不是使用默认路径，基本上都不支持该功能，功能极其简单的软件估计才支持重定位安装路径</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--force:        强制动作</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--replacepkgs:  替换安装，即重新覆盖安装。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>注意：不要对内核进行升级；多版本的内核可以并存，因此可以执行安装操作。</em></p><p>rpm 包被安装后，会在 /var/lib/rpm 下会建立已装 rpm 数据库，以后有任何 rpm 的升级、查询、版本比较等包的操作都是从这个目录下获取信息并完成相应操作的。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls /var/lib/rpm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Basenames     __db.002  Group       Obsoletename  Requirename  Triggername</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Conflictname  __db.003  Installtid  Packages      Sha1header</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">__db.001      Dirnames  Name        Providename   Sigmd5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>rpm 安装完成后，相关的文件会复制到多个目录下(具体复制的路径是在制作 rpm 包时指定的)。一般来说，分布形式差不多如下表。</p><table><thead><tr><th>目录</th><th>描述</th></tr></thead><tbody><tr><td>/etc</td><td>放置配置文件的目录</td></tr><tr><td>/bin、/sbin、/usr/bin 或 /usr/sbin</td><td>一些可执行文件</td></tr><tr><td>/lib、/lib64、/usr/lib(/usr/lib64)</td><td>一些库文件</td></tr><tr><td>/usr/include</td><td>一些头文件</td></tr><tr><td>/usr/share/doc</td><td>一些基本的软件使用手册与帮助文件</td></tr><tr><td>/usr/share/man</td><td>一些 man page 档案</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="822rpm-查询">8.2.2、rpm 查询<a class="hash-link" href="#822rpm-查询" title="标题的直接链接">​</a></h3><p>rpm 工具的安装功能很少使用，毕竟解决依赖关系不是件容易的事。但是 rpm 的查询功能则非常实用。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-q</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:  -q 查询已安装的包，-qp 查询未安装的包。它们都可接下面的参数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            -a 查询所有已安装的包，也可以指定通配符名称进行查询</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            -i 查询指定包的信息（版本、开发商、安装时间等）。从这里面可以查看到软件包属于哪个包组。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            -l 查询包的文件列表和目录（包在生产的时候就指定了文件路径，因此可查未装包）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            -R 查询包的依赖性（Required）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            -c 查询安装后包生成的配置文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            -d 查询安装后包生成的帮助文档</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            -f 查询系统文件属于哪个已安装的包（接的是文件而不是包）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            --scripts 查询包相关的脚本文档。脚本文档分四类：安装前运行、安装后运行、卸载前运行、卸载后运行</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>举几个例子：</p><ol><li><p>查询文件 /etc/yum.conf 是通过哪个包安装的。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpm -qf /etc/yum.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">yum-3.4.3-158.el7.centos.noarch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>查询安装 httpd 时生成了哪些目录和文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 packages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpm -qpl httpd-2.4.6-97.el7.centos.aarch64.rpm | wc -l</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">warning: httpd-2.4.6-97.el7.centos.aarch64.rpm: Header V3 RSA/SHA256 Signature, key ID 305d49d6: NOKEY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">496</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 packages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>查询某个未安装包的依赖性如 httpd-2.4.6-97.el7.centos.aarch64.rpm 的依赖性。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 packages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpm -qpR httpd-2.4.6-97.el7.centos.aarch64.rpm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">warning: httpd-2.4.6-97.el7.centos.aarch64.rpm: Header V3 RSA/SHA256 Signature, key ID 305d49d6: NOKEY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/mime.types</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">system-logos </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">7.92</span><span class="token plain">.1-1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">httpd-tools </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2.4</span><span class="token plain">.6-97.el7.centos</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/useradd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/groupadd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemd-units</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">libsystemd-daemon.so.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">64bit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">libsystemd-daemon.so.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">LIBSYSTEMD_DAEMON_31</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">64bit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">libz.so.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">64bit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rtld</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">GNU_HASH</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rpmlib</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">PayloadIsXz</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5.2</span><span class="token plain">-1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 packages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>实际上，查看包的依赖性时，使用 yum-utils 包中的 repoquery 工具更好，&quot;repoquery -R pkg<!-- -->_<!-- -->name&quot; 会更简洁。yum-utils 中包含了好几个非常实用的包管理工具，可以大致都了解下。</li></ul></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="823rpm-提取包文件">8.2.3、rpm 提取包文件<a class="hash-link" href="#823rpm-提取包文件" title="标题的直接链接">​</a></h3><p>安装 rpm 包会安装 rpm 中所有文件，如果将某个文件删除了，除了重装 rpm，还可以通过从 rpm 包提取缺失文件的方式来修复。</p><p>在 win 上安装个万能压缩工具 &quot;好压&quot;，可以直接打开 rpm 包，然后从中解压需要的文件出来。但是在 Linux 上，过程还是有点小复杂的，其中涉及了 cpio 归档工具。</p><p>rpm2cpio 是将 rpm 转换为 cpio 格式归档文件的命令，有了 cpio 文件，就可以使用 cpio 命令对其进行相关的操作。</p><p>cpio 命令是从归档文件中提取文件或向归档文件中写入文件的工具，一般都从标准输入或输出操作归档文件，所以都使用管道或重定向符号。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cpio 选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-i： 运行在copy-in模式，即从归档文件中将文件copy出来，即提取文件（提取）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-o： 运行在copy-out模式，将文件copy到归档文件中，即将文件拷贝到归档文件中（写入）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-d： 需要目录时自动建立目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v： 显示信息</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>提取 rpm 包文件的一般格式为：rpm2cpio package<!-- -->_<!-- -->full<!-- -->_<!-- -->name | cpio -idv dir<!-- -->_<!-- -->name</p><p>举个小例子：</p><ol><li><p>确认一下 cat 命令来自于哪个软件包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># which cat</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/bin/cat</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpm -qf /usr/bin/cat</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">coreutils-8.22-21.el7.aarch64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>如果 /usr/bin/cat 文件丢失，模拟从 coreutils-8.22-21.el7.aarch64 提取 /usr/bin/cat 填充丢失文件</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rm -rf /usr/bin/cat</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/passwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-bash: cat: </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">command</span><span class="token plain"> not found</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpm2cpio coreutils-8.22-24.el7_9.2.aarch64.rpm | cpio -id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">34315</span><span class="token plain"> blocks</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">coreutils-8.22-24.el7_9.2.aarch64.rpm  etc  usr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls usr/bin/cat </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">usr/bin/cat</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp usr/bin/cat /usr/bin/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/passwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root:x:0:0:root:/root:/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bin:x:1:1:bin:/bin:/sbin/nologin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="824yum-工具">8.2.4、yum 工具<a class="hash-link" href="#824yum-工具" title="标题的直接链接">​</a></h3><p>yum 是 Yellowdog update Modified 的简称，yum 的宗旨是自动化的升级、安装/移除 rpm 安装包，收集 rmp 的相关信息，检查依赖性，并提示用户解决。</p><p><strong>yum 工作原理分析</strong></p><p>Server 端先对程序包进行分类后存储到不同 repository 中；再通过收集到大量的 rpm 的数据库文件中程序包之间的依赖关系数据，计算对应的依赖关系和所需文件，构造出关键性 xml 说明文件, 存放在本地的 repodata 目录下，下面对这些 xml 说明文件进行一下解释。</p><ol><li>repomd.xml：本质上是一个索引，它包含下面列出的其他 XML 元数据文件的位置、校验和和时间戳。</li><li>repomd.xml.asc：只有当 repository 创建者使用 GPG 对 repomd.xml 文件进行签名时，才会生成此文件，如果用户安装了pygpgme 包，Yum 将下载并验证这个签名。</li><li>primary.xml.gz：包含关于 repository 中每个包的详细信息。您将发现诸如名称、版本、许可、依赖关系信息、时间戳、大小等信息。</li><li>filelists.xml.gz：包含关于 repository 中每个包中的每个文件和目录的信息。</li><li>other.xml.gz：包含在 RPM SPEC 文件中为存储库中的每个包找到的变更日志条目。</li><li>comps.xml：包含软件包组的列表，控制软件包组安装。</li></ol><p>Cilent 端通过 yum 命令安装软件时发现缺少某些依赖性程序包，Client 会根据本地的配置文件 /etc/yum.repos.d/<!-- -->*<!-- -->.repo 找到指定的 Server 端，从 Server 端 repodata 目录下获取说明文件 xxx.xml 后存储在本地 /var/cache/yum 中方便以后读取，通过 xxx.xml 文件查找到需要安装的依赖性程序包在 Server 端的存放位置, 再进入 Server 端 yum 库中的指定 repository 中获取所需程序包，下载完成后在本地实现安装。</p><p><img loading="lazy" alt="yum" src="/assets/images/yum-9092d865d935c88125e29ba2bc8e6f22.png" width="611" height="593" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8241yum-配置文件">8.2.4.1、yum 配置文件<a class="hash-link" href="#8241yum-配置文件" title="标题的直接链接">​</a></h4><p>/etc/yum.conf 是 yum 的默认文件，里面配置的也是全局默认项。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/yum.conf </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">cachedir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/var/cache/yum/</span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain">/</span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 缓存目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">keepcache</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">                                     </span><span class="token comment" style="color:rgb(0, 128, 0)"># 是否保留缓存，设置为1时，安装包时所下载的包将不会被删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">debuglevel</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">                                    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 调试信息的级别</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">logfile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/var/log/yum.log                        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 日志文件位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">exactarch</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">                                     </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置为1将只会安装和系统架构完全匹配的包</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">obsoletes</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">                                     </span><span class="token comment" style="color:rgb(0, 128, 0)"># 是否允许更新旧的包</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">                                      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 是否要进行gpg check</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">plugins</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">                                       </span><span class="token comment" style="color:rgb(0, 128, 0)"># 是否允许使用yum插件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">installonly_limit</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">bugtracker_url</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://bugs.centos.org/set_project.php?project_id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ref</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://bugs.centos.org/bug_report_page.php?category</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">yum</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">distroverpkg</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">centos-release                     </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定基准包，yum会根据这个包判断发行版本</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8242配置-yum-仓库">8.2.4.2、配置 yum 仓库<a class="hash-link" href="#8242配置-yum-仓库" title="标题的直接链接">​</a></h4><p>首先配置 yum 仓库，配置文件为 /etc/yum.conf 和 /etc/yum.repos.d/ 中的 &quot;.repo&quot; 文件，其中 /etc/yum.conf 配置的是仓库的默认项，一般配置 yum 源都是在 /etc/yum.repos.d/<!-- -->*<!-- -->.repo 中配置。注意，该目录中任意 repo 文件都会被读取。</p><p>默认 /etc/yum.repos.d/ 下会有以下几个仓库文件，除了 CentOS-Base.repo，其他的都可以删掉，基本没用。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls /etc/yum.repos.d/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CentOS-Base.repo       CentOS-fasttrack.repo  CentOS-Vault.repo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CentOS-Debuginfo.repo  CentOS-Media.repo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>repo 文件的配置格式如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">base</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 仓库ID，ID必须保证唯一性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">name        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 仓库名称，可随意命名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mirrorlist  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 该地址下包含了仓库地址列表，包含一个或多个镜像站点，和baseurl使用一个就可以了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#baseurl    # 仓库地址。网络上的地址则写网络地址，本地地址则写本地地址，格式为“file://”后接路径，如file:///mnt/cdrom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gpgcheck    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定是否需要签名，1表示需要，0表示不需要</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gpgkey      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 签名文件的路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">enable</span><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 该仓库是否生效，enable=1表示生效，enable=0表示不生效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cost        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 开销越高，优先级越低</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">repo配置文件中可用的宏：</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain">：    程序的版本，对Yum而言指的是redhat-relrase版本。只替换为主版本号，如Redhat6.5 则替换为6</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$arch</span><span class="token plain">：          系统架构</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$basharch</span><span class="token plain">：      系统基本架构，如i686，i586等的基本架构为i386</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$YUM0</span><span class="token plain">-9：        在系统定义的环境变量，可以在yum中使用</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8243配置-epel-仓库">8.2.4.3、配置 epel 仓库<a class="hash-link" href="#8243配置-epel-仓库" title="标题的直接链接">​</a></h4><p>系统发行商在系统中放置的 rpm 包一般版本都较老，可能有些包有较大的延后性。而 epel 是由 fedora 社区维护的高质量高可靠性的安装源，有很多包是比系统包更新的，且多出很多系统没有的包。总之，用到 epel 的机会很多，所以就拿来当配置示例了。</p><p>有两种方式可以使用 epel 源：</p><ol><li><p>安装 epel-release.noarch 包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls /etc/yum.repos.d/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CentOS-Base.repo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum search epel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">epel-release.noarch </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> Extra Packages </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> Enterprise Linux repository configuration</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install epel-release</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Installed:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> epel-release.noarch </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:7-11                                                               </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Complete</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls /etc/yum.repos.d/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CentOS-Base.repo  epel.repo  epel-testing.repo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>手动在 /etc/yum.repos.d/ 下面建一个 xxx.repo，复制国内 epel 源</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/yum.repos.d/epel.repo </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">epel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">Extra Packages </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> Enterprise Linux </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> - </span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">baseurl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https://repo.huaweicloud.com/epel/7/</span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#metalink=https://mirrors.fedoraproject.org/#metalink?repo=epel-7&amp;arch=$basearch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">failovermethod</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">priority</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">epel-debuginfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">Extra Packages </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> Enterprise Linux </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> - </span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain"> - Debug</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">baseurl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https://repo.huaweicloud.com/epel/7/</span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain">/debug</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#metalink=https://mirrors.fedoraproject.org/#metalink?repo=epel-debug-7&amp;arch=$basearch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">failovermethod</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">priority</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">epel-source</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">Extra Packages </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> Enterprise Linux </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> - </span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain"> - Source</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">baseurl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https://repo.huaweicloud.com/epel/7/SRPMS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#metalink=https://mirrors.fedoraproject.org/#metalink?repo=epel-source-7&amp;arch=$basearch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">failovermethod</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">priority</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8244yum-命令">8.2.4.4、yum 命令<a class="hash-link" href="#8244yum-命令" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Usage: yum </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> COMMAND</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">List of Commands:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">check                           检查 RPM 数据库问题</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">check-update                    检查是否有可用的软件包更新</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">clean                           删除缓存数据</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deplist                         列出软件包的依赖关系</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">distribution-synchronization    已同步软件包到最新可用版本</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">downgrade                       降级软件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">erase                           从系统中移除一个或多个软件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fs                              作用于主机的文件系统数据，主要用于为最小的主机删除docs/lanuages。  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fssnapshot                      创建文件系统快照，列出/删除当前快照。  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">groups</span><span class="token plain">                          显示或使用、组信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">help</span><span class="token plain">                            显示用法提示</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">history</span><span class="token plain">                         显示或使用事务历史</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">info                            显示关于软件包或组的详细信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain">                         向系统中安装一个或多个软件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">list                            列出一个或一组软件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">load-transaction                从文件名中加载一个已存事务</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">makecache                       创建元数据缓存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">provides                        查找提供指定内容的软件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">reinstall                       覆盖安装软件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">repo-pkgs                       将一个源当作一个软件包组，这样我们就可以一次性安装/移除全部软件包。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">repolist                        显示已配置的源</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">search                          在软件包详细信息中搜索指定字符串</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">shell                           运行交互式的 yum shell</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">swap                            交换包的简单方法，而不是使用shell  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">update                          更新系统中的一个或多个软件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">update-minimal                  跟升级差不多，但是升级到最新的匹配包解决影响系统的问题</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">updateinfo                      在 repository 上更新信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">upgrade                         更新软件包同时考虑软件包取代关系</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version                         显示机器可用的源版本。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -h, --help                                        显示此帮助消息并退出</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -t, --tolerant                                    忽略错误</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -C, --cacheonly                                   完全从系统缓存运行，不升级缓存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -c </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">config file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, --config</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">config file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">          配置文件路径</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -R </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">minutes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, --randomwait</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">minutes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">              命令最长等待时间</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -d </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">debug level</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, --debuglevel</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">debug level</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">      调试输出级别</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --showduplicates                                  在 list/search 命令下，显示源里重复的条目</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -e </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">error level</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, --errorlevel</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">error level</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">      错误输出级别</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --rpmverbosity</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">debug level name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                 RPM 调试输出级别</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -q, --quiet                                       静默执行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -v, --verbose                                     详尽的操作过程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -y, --assumeyes                                   回答全部问题为是</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --assumeno                                        回答全部问题为否</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --version                                         显示 Yum 版本然后退出</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --installroot</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                              设置安装根目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enablerepo</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">repo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                               启用一个或多个软件源</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">支持通配符</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --disablerepo</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">repo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                              禁用一个或多个软件源</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">支持通配符</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -x </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">package</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, --exclude</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">package</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                 采用全名或通配符排除软件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --disableexcludes</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">repo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                          禁止从主配置，从源或者从任何位置排除</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --disableincludes</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">repo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                          禁用指定的 repo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --obsoletes                                       更新时处理软件包取代关系</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --noplugins                                       禁用 Yum 插件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --nogpgcheck                                      禁用 GPG 签名检查</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --disableplugin</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">plugin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                          禁用指定名称的插件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enableplugin</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">plugin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                           启用指定名称的插件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --skip-broken                                     忽略存在依赖关系问题的软件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --color</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">COLOR                                     配置是否使用颜色</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --releasever</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">RELEASEVER                           在 yum 配置和 repo 文件里设置 </span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain"> 的值</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --downloadonly                                    仅下载而不更新</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --downloaddir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DLDIR                               指定一个其他文件夹用于保存软件包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --setopt</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">SETOPTS                                  设置任意配置和源选项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --bugfix                                          在更新中包含bug修复相关的包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --security                                        在更新中包含安全相关的包  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --advisory</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ADVS, --advisories</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ADVS                在更新中包含修复给定建议所需的包  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --bzs</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">BZS                                         在更新中包含修复给定BZ所需的包  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --cves</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">CVES                                       在更新中包含修复给定CVE所需的包  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --sec-severity</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">SEVS, --secseverity</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">SEVS           在更新中包含匹配严重性的安全相关包  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>常用的一些例子：</p><ol><li><p>安装或卸载 tree 软件包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install tree -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum remove tree -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>有时候想用一个命令，比如 pstree，但是不知道安装哪个软件包才能提供这个命令，使用 yum provides</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum provides pstree</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Loaded plugins: fastestmirror</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Loading mirror speeds from cached hostfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">base/aarch64/filelists_db                                                                                                                                             </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6.2</span><span class="token plain"> MB  00:00:00   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">extras/aarch64/filelists_db                                                                                                                                           </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">289</span><span class="token plain"> kB  00:00:00   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">updates/aarch64/filelists_db                                                                                                                                          </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1.7</span><span class="token plain"> MB  00:00:00   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">psmisc-22.20-17.el7.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> Utilities </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> managing processes on your system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Repo        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> base</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Matched from:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Filename    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> /usr/bin/pstree</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install psmisc -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>有时候只记得一个软件包名字大概，没法正确安装这个包，可以使用 yum search 模糊查找定位到想要安装的包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum search mariadb</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Loaded plugins: fastestmirror</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Loading mirror speeds from cached hostfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> N/S matched: mariadb </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-bench.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> MariaDB benchmark scripts and data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-devel.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> Files </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> development of MariaDB/MySQL applications</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-embedded.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> MariaDB as an embeddable library</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-embedded-devel.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> Development files </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> MariaDB as an embeddable library</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-libs.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> The shared libraries required </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> MariaDB/MySQL clients</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-server.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> The MariaDB server and related files</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> A community developed branch of MySQL</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mariadb-test.aarch64 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> The </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">test</span><span class="token plain"> suite distributed with MariaD</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Name and summary matches only, use </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;search all&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> everything.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>安装图形化界面时，不可能一个个软件去装，借用 yum groups 包组管理方式安装</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 查看有哪些包组</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum groups list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Loaded plugins: fastestmirror</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">There is no installed </span><span class="token function" style="color:rgb(0, 0, 255)">groups</span><span class="token plain"> file.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Maybe run: yum </span><span class="token function" style="color:rgb(0, 0, 255)">groups</span><span class="token plain"> mark convert </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">see </span><span class="token function" style="color:rgb(0, 0, 255)">man</span><span class="token plain"> yum</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Loading mirror speeds from cached hostfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Available Environment Groups:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Minimal Install</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Compute Node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Infrastructure Server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  File and Print Server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Basic Web Server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Virtualization Host</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Server with GUI</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  GNOME Desktop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  KDE Plasma Workspaces</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Development and Creative Workstation</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Available Groups:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Compatibility Libraries</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Console Internet Tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Development Tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Graphical Administration Tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Legacy UNIX Compatibility</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Scientific Support</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Security Tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Smart Card Support</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  System Administration Tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  System Management</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Done</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 定位到&quot;GNOME Desktop&quot;，这个组下面就是图形化界面所需的所有软件包，一起安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum groups install &quot;GNOME Desktop&quot; -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="83deb-包">8.3、deb 包<a class="hash-link" href="#83deb-包" title="标题的直接链接">​</a></h2><p>deb 是 Unix 系统（其实主要是 Linux）下的安装包，基于 tar 包，因此本身会记录文件的权限（读/写/可执行）以及所有者/用户组。由于 Unix 类系统对权限、所有者、组的严格要求，而 deb 格式安装包又经常会涉及到系统比较底层的操作，所以权限等的设置尤其重要。</p><p>deb 包本身有三部分组成：</p><ol><li>数据包，包含实际安装的程序数据，文件名为 data.tar.XXX；data.tar.XXX 包含的是实际安装的程序数据，而在安装过程中，该包里的数据会被直接解压到根目录（即 / ），因此在打包之前需要根据文件所在位置设置好相应的文件/目录树。</li><li>安装信息及控制脚本包，包含 deb 的安装说明，标识，脚本等，文件名为 control.tar.gz；而 control.tar.gz 则包含了一个 deb 安装的时候所需要的控制信息。一般有 5 个文件：<ul><li>control 用了记录软件标识，版本号，平台，依赖信息等数据；</li><li>preinst 在解包data.tar.gz 前运行的脚本；</li><li>postinst 在解包数据后运行的脚本；</li><li>prerm 卸载时，在删除文件之前运行的脚本；</li><li>postrm 在删除文件之后运行的脚本；</li></ul></li><li>deb 文件的一些二进制数据，包括文件头等信息，一般看不到，在某些软件中打开可以看到；</li></ol><p><em>注意：deb 本身可以使用不同的压缩方式。tar 格式并不是一种压缩格式，而是直接把分散的文件和目录集合在一起，并记录其权限等数据信息。之前提到过的 data.tar.XXX，这里 XXX 就是经过压缩后的后缀名。deb 默认使用的压缩格式为 gzip 格式，所以最常见的就是 data.tar.gz。常有的压缩格式还有 bzip2 和 lzma，其中 lzma 压缩率最高，但压缩需要的 CPU 资源和时间都比较长。</em></p><p>deb 软件包名格式为：Package<!-- -->_<!-- -->Version-Build<!-- -->_<!-- -->Architecture.deb</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">vim_8.2.2434-3ubuntu1_arm64.deb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>软件包名称(Package Name)：vim</li><li>版本(Version Number)：8.2.2434</li><li>修订号(Build Number)：3ubuntu1</li><li>平台(Architecture)：arm64</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="831dpkg-工具简介">8.3.1、dpkg 工具简介<a class="hash-link" href="#831dpkg-工具简介" title="标题的直接链接">​</a></h3><p>dpkg 是 Debian 的一个底层包管理工具，主要用于对已下载到本地和已安装的软件包进行管理。</p><p>dpkg 软件包相关的文件：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">/etc/dpkg/dpkg.cfg dpkg:    包管理软件的配置文件</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Configuration </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> with default options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/var/log/dpkg.log dpkg:     包管理软件的日志文件</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Default log </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">see /etc/dpkg/dpkg.cfg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> and option --log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/var/lib/dpkg/available:    存放系统所有安装过的软件包信息</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">List of available packages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/var/lib/dpkg/status:       存放系统现在所有安装软件的状态信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/var/lib/dpkg/info:         记安装软件包控制目录的控制信息文件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>dpkg 数据库：</p><ul><li>dpkg 使用文本文件作为数据库来维护系统中软件，包括文件清单、依赖关系、软件状态等详细的内容，通常在 /var/lib/dpkg 目录下。</li><li>通常在 status 文件中存储软件状态和控制信息。</li><li>在 info/ 目录下备份控制文件， 并在其下的 .list 文件中记录安装文件清单， 其下的 .mdasums 保存文件的 MD5 编码。</li></ul><p>查询 dpkg 数据库（显示所有已安装的Deb包）：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># dpkg -l | more</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Desired</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">Unknown/Install/Remove/Purge/Hold</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Status</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">/ Err?</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">none</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">/Reinst-required </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Status,Err: </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">uppercase</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">bad</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain">/ Name                                  Version                            Architecture Description</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++-</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">-</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain">-</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain">-</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  accountsservice                       </span><span class="token number" style="color:rgb(9, 134, 88)">0.6</span><span class="token plain">.45-1ubuntu1                    arm64        query and manipulate user account information</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  acl                                   </span><span class="token number" style="color:rgb(9, 134, 88)">2.2</span><span class="token plain">.52-3build1                     arm64        Access control list utilities</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  acpid                                 </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">:2.0.28-1ubuntu1                  arm64        Advanced Configuration and Power Interface event daemon</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  adduser                               </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">.116ubuntu1                       all          </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> and remove </span><span class="token function" style="color:rgb(0, 0, 255)">users</span><span class="token plain"> and </span><span class="token function" style="color:rgb(0, 0, 255)">groups</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  apparmor                              </span><span class="token number" style="color:rgb(9, 134, 88)">2.12</span><span class="token plain">-4ubuntu5.1                    arm64        user-space parser utility </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> AppArmor</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  apport                                </span><span class="token number" style="color:rgb(9, 134, 88)">2.20</span><span class="token plain">.9-0ubuntu7.5                  all          automatically generate crash reports </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> debugging</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  apport-symptoms                       </span><span class="token number" style="color:rgb(9, 134, 88)">0.20</span><span class="token plain">                               all          symptom scripts </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> apport</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  </span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain">                                   </span><span class="token number" style="color:rgb(9, 134, 88)">1.6</span><span class="token plain">.8                              arm64        commandline package manager</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  apt-utils                             </span><span class="token number" style="color:rgb(9, 134, 88)">1.6</span><span class="token plain">.8                              arm64        package management related utility programs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  </span><span class="token function" style="color:rgb(0, 0, 255)">aptitude</span><span class="token plain">                              </span><span class="token number" style="color:rgb(9, 134, 88)">0.8</span><span class="token plain">.10-6ubuntu1                    arm64        terminal-based package manager</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  aptitude-common                       </span><span class="token number" style="color:rgb(9, 134, 88)">0.8</span><span class="token plain">.10-6ubuntu1                    all          architecture independent files </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the </span><span class="token function" style="color:rgb(0, 0, 255)">aptitude</span><span class="token plain"> package manager</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如上代码，每条记录对应一个软件包，注意每条记录的第一、二、三个字符，这就是软件包的状态标识，后边依此是软件包名称、版本号和简单描述。</p><ol><li>第一字符为期望值(Desired=Unknown/Install/Remove/Purge/Hold)，它包括：<ul><li>u Unknown 状态未知，这意味着软件包未安装，并且用户也未发出安装请求。</li><li>i Install 用户请求安装软件包。</li><li>r Remove 用户请求卸载软件包。</li><li>p Purge 用户请求清除软件包。</li><li>h Hold 用户请求保持软件包版本锁定。</li></ul></li><li>第二列，是软件包的当前状态(Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend)<ul><li>n Not 软件包未安装。</li><li>i Inst 软件包安装并完成配置。</li><li>c Conf-files 软件包以前安装过，现在删除了，但是它的配置文件还留在系统中。</li><li>u Unpacked 软件包被解包，但还未配置。</li><li>f halF-conf 试图配置软件包,但是失败了。</li><li>h Half-inst 软件包安装，但是没有成功。</li><li>h Half-inst 软件包安装，但是没有成功。</li><li>t Trig-pend 触发器未决。</li></ul></li><li>第三列标识错误状态，第一种状态标识没有问题，为空。其它符号则标识相应问题(Err?=(none)/Reinst-required (Status,Err: uppercase=bad))。<ul><li>h 软件包被强制保持，因为有其它软件包依赖需求，无法升级。</li><li>r Reinst-required 软件包被破坏，可能需要重新安装才能正常使用(包括删除)。</li><li>x 软包件被破坏，并且被强制保持。</li></ul></li></ol><p>常见的几种情况：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ii      表示系统正常安装了该软件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pn      表示安装了该软件，后来又清除了</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">un      表示从未安装过该软件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iu      表示安装了该软件，但是未配置</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rc      表示该软件已被删除，但配置文件仍在</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="832dpkg-安装">8.3.2、dpkg 安装<a class="hash-link" href="#832dpkg-安装" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 安装软件包，必须是deb包的完整名称。（软件的安装可被拆分为两个独立的过程“解包”和“配置”）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg -i package-name.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># “解包”：解开软件包到系统目录但不配置,如果和-R一起使用，参数可以是一个目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg --unpack package-name.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># “配置”：配置软件包</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg --configure package-name.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 列出 deb 包的内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg -c package-name.deb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># zsh 依赖 zsh-common，所以两个包要一起装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># dpkg -i zsh-common_5.4.2-3ubuntu3.1_all.deb zsh_5.4.2-3ubuntu3.1_arm64.deb </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Selecting previously unselected package zsh-common.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Reading database </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. </span><span class="token number" style="color:rgb(9, 134, 88)">67232</span><span class="token plain"> files and directories currently installed.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Preparing to unpack zsh-common_5.4.2-3ubuntu3.1_all.deb </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Unpacking zsh-common </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token plain">.2-3ubuntu3.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Preparing to unpack zsh_5.4.2-3ubuntu3.1_arm64.deb </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Unpacking </span><span class="token function" style="color:rgb(0, 0, 255)">zsh</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token plain">.2-3ubuntu3.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> over </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token plain">.2-3ubuntu3.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Setting up zsh-common </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token plain">.2-3ubuntu3.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Setting up </span><span class="token function" style="color:rgb(0, 0, 255)">zsh</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token plain">.2-3ubuntu3.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Processing triggers </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> man-db </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2.8</span><span class="token plain">.3-2ubuntu0.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="833dpkg-移除软件包">8.3.3、dpkg 移除软件包<a class="hash-link" href="#833dpkg-移除软件包" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 移除软件包，但保留其配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg -r/--remove package-name </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 清除软件包的所有文件（removes everything,including conffiles）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg -P/--purge package-name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># dpkg -P zsh zsh-common</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Reading database </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. </span><span class="token number" style="color:rgb(9, 134, 88)">68526</span><span class="token plain"> files and directories currently installed.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Removing </span><span class="token function" style="color:rgb(0, 0, 255)">zsh</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token plain">.2-3ubuntu3.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Purging configuration files </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">zsh</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token plain">.2-3ubuntu3.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Removing zsh-common </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token plain">.2-3ubuntu3.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Purging configuration files </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> zsh-common </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token plain">.2-3ubuntu3.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rmdir: failed to remove </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;/usr/local/share/zsh/site-functions&#x27;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> No such </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> or directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Processing triggers </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> man-db </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2.8</span><span class="token plain">.3-2ubuntu0.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="834dpkg-查询">8.3.4、dpkg 查询<a class="hash-link" href="#834dpkg-查询" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 查看系统中软件包名符合pattern模式的软件包</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg -l/--list package-name-pattern</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 查看package-name对应的软件包安装的文件及目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg -L/--listfiles package-name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 显示包的具体信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg -p/--print-avail package-name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 查看package-name（已安装）对应的软件包信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg -s/--status package-name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 从已经安装的软件包中查找包含filename的软件包名称 （Tip：也可使用子命令dpkg-query来进行查询操作）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dpkg -S/--search filename-search-pattern</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>举几个小例子：</p><ol><li><p>列出系统上安装的与 dpkg 相关的软件包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># dpkg -l *dpkg*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Desired</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">Unknown/Install/Remove/Purge/Hold</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Status</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">/ Err?</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">none</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">/Reinst-required </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Status,Err: </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">uppercase</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">bad</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain">/ Name              Version       Architecture  Description</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++-</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">-</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">-</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">-</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ii  dpkg              </span><span class="token number" style="color:rgb(9, 134, 88)">1.19</span><span class="token plain">.0.5ubunt arm64         Debian package management system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">un  dpkg-dev                          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">no description available</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">un  libdpkg-perl                      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">no description available</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>查看 dpkg 软件包安装到系统中的文件</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># dpkg -L dpkg | more</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/alternatives</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/alternatives/README</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/cron.daily</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/cron.daily/dpkg</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/dpkg</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/dpkg/dpkg.cfg</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/dpkg/dpkg.cfg.d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/logrotate.d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p><em>说明：这里只是列出了 dpkg 命令几个最常用的用法，dpkg 其实还有别的选项和子命令，这里不再多说，因为大多数情况用不上，而是使用功能更加强大的前端工具 apt。</em></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="835apt-工具">8.3.5、apt 工具<a class="hash-link" href="#835apt-工具" title="标题的直接链接">​</a></h3><p>APT 全称为 &quot;Advanced Package Tool&quot; 即高级软件包工具，这是现今最成熟的软件包管理系统。</p><p>虽然我们在使用 dpkg 时，已经解决掉了软件安装过程中的大量问题，但是当依赖关系不满足时，仍然需要手动解决，而 apt 可以自动检测软件依赖问题，下载和安装所有文件；甚至只需要一条命令，就可以更新整个系统上所有的软件包。</p><p>APT 最初被设计运行于 Debian 系统上，只支持 .deb 格式的软件包文件。如今，APT 已经被移植到使用 PRM 软件包机制的发行版上。可以从 apt-rpm.org 获得 APT 的 RPM 版本。</p><p><strong>apt 工作原理分析</strong></p><p>apt 的 repository 定义在 /etc/apt/sources.list 这个文件当中，包源的格式如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">deb uri distribution </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">component1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">component2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>比如说：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">deb https://deb.debian.org/debian stable main contrib non-free</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这里的 deb 指向的是二进制包的源，如果是 deb-src 则指向源码包的源。一个文件可以同时定义 deb 和 deb-src，但是要分开指定。</li><li>这里的 uri <code>https://deb.debian.org/debian</code> 指的是归档根目录，通常情况下 Debian 归档目录在服务器上的 debian/ 目录下，当然也可以定义在任何地方。</li><li>这里的 stable 指的是 <code>$ARCHIVE_ROOT/dists</code> 下的一个子目录，也就是 Debian 归档根目录下发行版本下的一个稳定版本，而 stable 下面也组织了很多子目录和文件 main、contrib、non-free、InRelease、Release等；而所谓的版本 <strong>distribution</strong> 是关联 <strong>Suite</strong> 和 <strong>Codename</strong>，这在 <strong>Release</strong> 文件中清楚地定义了。再往深走，比如 main 下面就是不同的 CPU 架构，然后再往下就是二进制包索引文件 Packages.gz 等。</li></ul><p><em>提示：分析到这里，不难发现，Debian 作为 Linux 操作系统的发行版，有自己的一套版本管理系统，涉及到发布的版本、自由和非自由二进制包管理集、不同的 CPU 架构管理集等；实际上，几乎所有的 Debian 系操作系统都采用类似的版本管理策略，即便组织方式略有不同，但是核心思想是一样的。</em></p><p>为了从 repository 下载软件包，apt 将会从 <code>$ARCHIVE_ROOT/dists/$DISTRIBUTION</code> 目录下载一个 <strong>InRelease</strong> 或者 <strong>Release</strong> 文件</p><ul><li>InRelease 文件是自带签名密钥行的，而 Release 文件专门有一个附带的 Release.gpg 密钥文件。</li><li>Release 文件列出了 distribution 的 index 文件和它们的 hash 值(列出的 index 文件是相对于 Release 文件位置来说的)</li></ul><p>为了下载 main 组件的索引 Packages.gz，apt 将会在 main 目录下面为文件的 hash 值扫描 Release 文件。</p><p>比如说：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">https://deb.debian.org/debian/dists/testing/main/binary-arm64/Packages.gz </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">就应该存在于</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">https://deb.debian.org/debian/dists/testing/Release</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">作为</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">main/binary-arm64/Packages.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Packages.gz 包含每个包的名称、版本、大小、长短描述和依赖关系，以及一些我们不感兴趣的附加信息。所有这些信息都被列出(并被 Debian 包管理器使用)，比如 dselect 或 aptitude。</li></ul><p>二进制包索引在组件 component 目录的子目录 <strong>binary-$arch</strong>，同理源码包在源码子目录；无论是二进制包或是源码包，具体位置都跟归档根目录有关。</p><p>为了避免文件重复，二进制包和源码包通常保存在归档根目录 <strong>archive root</strong> 的 pool 子目录中。Packages 和 Sources 索引可以列出相对于 <strong>archive root</strong> 的任何路径，然而，我们建议把包放在 <strong>archive root</strong> 的子目录下，不是 <strong>dists</strong> 目录下，也不应该直接放在 <strong>archive root</strong> 目录下。</p><p>Contents 和 Translation 索引不是特定于架构的就直接放在 <code>dists/$DISTRIBUTION/$COMPONENT</code> 目录下，不需要放在架构的子目录。</p><p>一个标准的 Debian Repository：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">your repository root</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+-dists</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-stable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-alpha </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-arm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> +-source </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-contrib</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-alpha </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-arm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> +-source </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> +-non-free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-alpha</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-arm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   +-source</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-testing </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-alpha </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-arm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> +-source </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-contrib</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-alpha </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-arm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> +-source </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> +-non-free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-alpha</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-arm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   +-source</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  +-unstable </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-alpha </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-arm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> +-source </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-contrib</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-alpha </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-arm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> +-source </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    +-non-free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-alpha</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-arm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-binary-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      +-source</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>自由的包在 main 里面，非自由的包在 non-free 里面，自由的依赖于非自由的在 contrib 里面；Debian目前支持 11 个架构；为了简洁，我省略了大部分。</li><li>每个 binary-<!-- -->*<!-- --> 目录包含一个 Packages.gz 和一个可选的 Release 文件；每个 source 目录包含一个 Sources.gz 和一个可选的 Release 文件。请注意，包不必与索引文件在同一个目录中，因为索引文件包含了各个包的路径；实际上，它们可以在存储库中的任何其他地方。这使得创建 pool 成为可能。</li><li>你可以自由地创建任意多的发行版和组件，并按你的意愿调用它们；我在示例中使用的只是 Debian 中使用的。例如，你可以创建发行版 current 和 beta(而不是 stable、testing 和 instability)，以及组件 foo、bar、baz 和 qux(而不是 main、contrib 和 non-free)。</li><li>虽然您可以随意调用组件，但使用标准 Debian 发行版通常是个好主意，因为这是 Debian 用户所期望的。</li></ul><p><em>提示：通过以上原理分析，相信 deb 包的组织方式基本上搞清楚了，还有很多细节这里没有办法一一说明，如果想搞得更加清楚，可以参考官方文档 <code>https://wiki.debian.org/PackageManagement</code> <code>https://wiki.debian.org/DebianRepository/Format</code>。另外如果对于 Debian 发行版感兴趣，可以参考中文官方文档 <code>https://www.debian.org/doc/manuals/debian-reference/index.zh-cn.html</code></em></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8351apt-更新元数据">8.3.5.1、apt 更新元数据<a class="hash-link" href="#8351apt-更新元数据" title="标题的直接链接">​</a></h4><p>当使用 APT 工具时，如 <code>aptitude</code>, <code>apt-get</code>, <code>synaptic</code>, <code>apt-file</code>, <code>auto-apt</code>，我们需要更新包含 Debian 档案库信息元数据的本地拷贝。这些本地拷贝的文件名称，和在 &quot;<code>/etc/apt/sources.list</code>&quot; 文件里面的 <code>distribution</code>, <code>area</code>, <code>architecture</code> 相应名称一致。</p><ul><li>&quot;<code>/var/lib/apt/lists/deb.debian.org_debian_dists_&lt;distribution&gt;_Release</code>&quot;</li><li>&quot;<code>/var/lib/apt/lists/deb.debian.org_debian_dists_&lt;distribution&gt;_Release.gpg</code>&quot;</li><li>&quot;<code>/var/lib/apt/lists/deb.debian.org_debian_dists_&lt;distribution&gt;_&lt;area&gt;_binary-&lt;architecture&gt;_Packages</code>&quot;</li><li>&quot;<code>/var/lib/apt/lists/deb.debian.org_debian_dists_&lt;distribution&gt;_&lt;area&gt;_source_Sources</code>&quot;</li><li>&quot;<code>/var/cache/apt/apt-file/deb.debian.org_debian_dists_&lt;distribution&gt;_Contents-&lt;architecture&gt;.gz</code>&quot; (<code>apt-file</code>)</li></ul><p>前 4 种类型的文件是所有相关的 APT 命令共享的，并且可以通过 “<code>apt-get update</code>” 或 “<code>aptitude update</code>” 在命令行中进行更新。</p><p>如果在 “<code>/etc/apt/sources.list</code>” 中有相应的 “<code>deb</code>” 行，则 “<code>软件包</code>” 元数据会进行更新。如果在 “<code>/etc/apt/sources.list</code>” 中有相应的 “<code>deb-src</code>” 行，则 “<code>源代码</code>” 元数据会进行更新。</p><p>&quot;<code>Packages</code>&quot; 和 &quot;<code>Sources</code>&quot; 的元数据文件包含有“<code>Filename:</code>”字段，指向二进制和源代码包文件的位置。目前，这些软件包都统一放在&quot;<code>pool/</code>&quot;目录树下，这样可以改善跨版本发布的传输。</p><p>“<code>软件包</code>”元数据的本地副本可以使用 <code>aptitude</code> 来进行交互式的搜索。专门的搜索命令 grep-dctrl(1) 可以搜索“<code>软件包</code>”和“<code>源代码</code>”元数据的本地副本。</p><p>&quot;<code>Contents-&lt;architecture&gt;</code>&quot;元数据的本地拷贝，能够被&quot;<code>apt-file update</code>&quot;更新，它的位置和其它 4 个不同。参见 apt-file(1). (<code>auto-apt</code> 的 &quot;<code>Contents-&lt;architecture&gt;.gz</code>&quot;文件的本地拷贝默认也使用不同的位置。)</p><p><em>说明：学习是有一个过程的，我花了大量的时间研究官方文档，有时不得不研究英文文档，有时会有官方中文文档，有时英文文档和中文文档内容有穿插重合，所以我会进行一些必要的整合并提炼出来。推荐一个不错的中文文档 <code>https://www.debian.org/doc/manuals/debian-reference/ch02.zh-cn.html</code></em></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># aptitude update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic InRelease </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">242</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security InRelease </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">88.7</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates InRelease </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">88.7</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-backports InRelease </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">74.6</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/restricted Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">5,324</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/universe Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">9,051</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/main Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">829</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/multiverse Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">181</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/main arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">975</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/main Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">516</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/restricted arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">664</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/restricted Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3,584</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/universe arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">8,316</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/universe Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4,941</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/multiverse arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">126</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic/multiverse Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">108</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/restricted Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">19.2</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/multiverse Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">5,240</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/universe Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">279</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/main Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">255</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/main arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">997</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/main Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">329</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/restricted arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2,852</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/restricted Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">48.9</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/universe arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">994</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">26</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/universe Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">256</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/multiverse arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2,732</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-security/multiverse Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4,412</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">29</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/restricted Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">22.1</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/main Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">514</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">31</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/multiverse Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">14.5</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">32</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/universe Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">451</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">33</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/main arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1,298</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">34</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/main Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">422</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">35</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/restricted arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3,404</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">36</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/restricted Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">52.8</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">37</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/universe arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1,536</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">38</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/universe Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">371</span><span class="token plain"> kB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">39</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/multiverse arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4,920</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-updates/multiverse Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">6,792</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">41</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-backports/main Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">5,440</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">42</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-backports/universe Sources </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">5,360</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">43</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-backports/main arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">9,992</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">44</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-backports/main Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4,764</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">45</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-backports/universe arm64 Packages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">9,932</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Get: </span><span class="token number" style="color:rgb(9, 134, 88)">46</span><span class="token plain"> https://repo.huaweicloud.com/ubuntu-ports bionic-backports/universe Translation-en </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4,588</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Fetched </span><span class="token number" style="color:rgb(9, 134, 88)">33.5</span><span class="token plain"> MB </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> 11s </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">3,176</span><span class="token plain"> kB/s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Current status: </span><span class="token number" style="color:rgb(9, 134, 88)">257</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">+257</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> upgradable, </span><span class="token number" style="color:rgb(9, 134, 88)">62330</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">+62330</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> new.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>从 update 的输出信息可以感受到 repository 元数据的下载过程。</li><li>除了远程获取元数据，<code>aptitude</code> 命令还会将它在本地产生的安装状态信息保存在 “<code>/var/lib/aptitude/pkgstates</code>” 中，这些信息只能被 aptitude 使用。</li><li><code>aptitude</code> 的这个缓存文件清理策略，能够在&quot;<code>Options</code>&quot; → &quot;<code>Preferences</code>&quot;下设置，也可以通过它的菜单，&quot;<code>Actions</code>&quot;下的&quot;<code>Clean package cache</code>&quot; 或 &quot;<code>Clean obsolete files</code>&quot; 来执行强制清理。</li><li>另外需要说明的是，如果是使用 apt 工具，所有通过 APT 机制远程获取的软件包都被保存在 “<code>/var/cache/apt/archives</code>” 中，直到它们被清除。除了远程获取元数据，<code>lenny</code> 之后的 APT 工具还会将它在本地产生的安装状态信息保存在 “<code>/var/lib/apt/extended_states</code>” 中，APT 会使用它们来追踪自动安装的所有软件包。</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8352apt-实用命令">8.3.5.2、apt 实用命令<a class="hash-link" href="#8352apt-实用命令" title="标题的直接链接">​</a></h4><p>在 Debian 系统中有许多基于 APT 的软件包管理工具可以在 Debian 系统上进行基于仓库的软件包管理操作。在这里，我们将介绍 3 种基本的软件包管理工具：<code>apt</code>,<code>apt-get</code> / <code>apt-cache</code> 和 <code>aptitude</code> 。</p><p>对于涉及软件包安装或更新软件包元数据的软件包管理操作，你必须有 root 权限。</p><blockquote><p><code>apt</code> vs <code>apt-get</code> 或者 <code>apt-cache</code> vs <code>aptitude</code></p></blockquote><p>尽管 <code>aptitude</code> 是作者主要使用的一个非常好的可互动工具，但你应该知道下列警示：</p><ol><li>不建议在新版本发布后在 <code>stable</code> Debian 系统上使用 <code>aptitude</code> 命令来进行跨版本的系统升级。<ul><li>建议使用&quot;<code>apt full-upgrade</code>&quot;或“<code>apt-get dist-upgrade</code>” 来进行这个操作。</li></ul></li><li><code>aptitude</code>命令有时候会为了 <code>testing</code> 或 <code>unstable</code> Debian 系统升级清除大量软件包。<ul><li>这个情况吓坏了许多的系统管理员。请不要惊慌。</li><li>这似乎大多数是由元软件包的依赖或推荐的软件包版本偏差造成的，例如 <code>gnome-core</code>。</li><li>要解决这个问题，可以在 <code>aptitude</code> 命令菜单中选择 “取消待执行的动作” ，退出 <code>aptitude</code>，并使用 “<code>apt full-upgrade</code>”。</li></ul></li></ol><p><code>apt-get</code> 和 <code>apt-cache</code> 是最 <strong>基础</strong> 的基于 APT 的软件包管理工具。</p><ol><li><code>apt-get</code> 和 <code>apt-cache</code> 只提供命令行用户界面。</li><li><code>apt-get</code> 是进行跨版本的 <strong>主系统升级</strong> 等操作的最合适工具。</li><li><code>apt-get</code> 提供了一个 <strong>强大</strong> 的软件包依赖解析器。</li><li><code>apt-get</code> 对硬件资源的要求不高。它消耗更少的内存并且运行速度更快。</li><li><code>apt-cache</code> 提供了一个 <strong>标准的</strong> 正则表达式来搜索软件包名称和描述。</li><li><code>apt-get</code> 和 <code>apt-cache</code> 可以使用 <code>/etc/apt/preferences</code> 来管理软件包的多个版本，但这非常繁琐。</li></ol><p><code>apt</code> 命令是一个用于软件包管理的高级命令行界面。它基本上是 <code>apt-get</code>、<code>apt-cache</code> 和类似命令的一个封装，被设计为针对终端用户交互的界面，它默认启用了某些适合交互式使用的选项。</p><ol><li><code>apt</code> 工具在用户使用 <code>apt install</code> 安装软件包时提供了一个友好的进度条。</li><li>在成功安装下载的软件包后，<code>apt</code> 将默认 <strong>删除</strong> 缓存的 <code>.deb</code> 软件包。</li></ol><p><em>提示：建议用户使用新的 apt(8) 命令用于 <strong>交互式</strong> 的使用场景，而在 shell 脚本中使用 apt-get(8) 和 apt-cache(8) 命令。</em></p><p><code>aptitude</code> 命令是最 <strong>通用的</strong> 基于 APT 的软件包管理工具。</p><ol><li><code>aptitude</code> 提供了一个全屏的交互式文本用户界面。</li><li><code>aptitude</code> 同样也提供了一个命令用户界面。</li><li><code>aptitude</code> 是用于 <strong>日常软件包管理</strong>（例如检查已安装的软件包和搜索可用的软件包）的最合适工具。</li><li><code>aptitude</code> 对硬件资源的要求更高。它消耗更多的内存并且运行速度更慢。</li><li><code>aptitude</code> 提供一个 <strong>增强的</strong> 正则表达式来搜索所有的软件包元数据。</li><li><code>aptitude</code> 可以管理软件包的多个版本，并且不使用 <code>/etc/apt/preferences</code>，这会十分直观。</li></ol><blockquote><p>命令行中的基础软件包管理操作</p></blockquote><table><thead><tr><th>apt 语法</th><th>aptitude 语法</th><th>apt-get / apt-cache 语法</th><th>说明</th></tr></thead><tbody><tr><td>apt update</td><td>aptitude update</td><td>apt-get update</td><td>更新软件包档案库元数据</td></tr><tr><td>apt install foo</td><td>aptitude install foo</td><td>apt-get install foo</td><td>安装 foo 软件包的候选版本以及它的依赖</td></tr><tr><td>apt upgrade</td><td>aptitude safe-upgrade</td><td>apt-get upgrade</td><td>安装已安装的软件包的候选版本并且不移除任</td></tr><tr><td>何其它的软件包</td><td></td><td></td><td></td></tr><tr><td>apt full-upgrade</td><td>aptitude full-upgrade</td><td>apt-get dist-upgrade</td><td>安装已安装的软件包的候选版本，并且需要的</td></tr><tr><td>话会移除其它的软件包</td><td></td><td></td><td></td></tr><tr><td>apt remove foo</td><td>aptitude remove foo</td><td>apt-get remove foo</td><td>移除 foo 软件包，但留下配置文件</td></tr><tr><td>apt autoremove</td><td>N/A</td><td>apt-get autoremove</td><td>移除不再需要的自动安装的软件包</td></tr><tr><td>apt purge foo</td><td>aptitude purge foo</td><td>apt-get purge foo</td><td>清除 foo 软件包的配置文件</td></tr><tr><td>apt clean</td><td>aptitude clean</td><td>apt-get clean</td><td>完全清除本地仓库的软件包检索文件</td></tr><tr><td>apt autoclean</td><td>aptitude autoclean</td><td>apt-get autoclean</td><td>清除本地仓库中过时软件包的软件包检索文件</td></tr><tr><td>apt show foo</td><td>aptitude show foo</td><td>apt-cache show foo</td><td>显示 foo 软件包的详细信息</td></tr><tr><td>apt search &lt;正则表达式&gt;</td><td>aptitude search &lt;正则表达式&gt;<!-- -->|<!-- --> apt-cache search &lt;正则表达式&gt; <!-- -->|<!-- --> 搜索匹配 &lt;正则表达式&gt; 的软件包 <!-- -->|</td><td></td><td></td></tr><tr><td>N/A</td><td>aptitude why &lt;正则表达式&gt;</td><td>N/A</td><td>解释匹配 &lt;正则表达式&gt; 的软件包必须被安装的原因</td></tr><tr><td>N/A</td><td>aptitude why-not &lt;正则表达式&gt;</td><td>N/A</td><td>解释匹配 &lt;正则表达式&gt; 的软件包不必安装的原因</td></tr><tr><td>N/A</td><td>aptitude search &#x27;~i!~M&#x27;</td><td>apt-mark showmanual</td><td>列出手动安装的软件包</td></tr></tbody></table><ul><li>虽然 <code>aptitude</code> 命令提供了丰富的功能，例如增强的软件包解析器，但它的复杂程度导致了（或可能导致）一些退步，例如 <a href="https://bugs.debian.org/411123" target="_blank" rel="noopener noreferrer">Bug #411123</a>、<a href="https://bugs.debian.org/514930" target="_blank" rel="noopener noreferrer">Bug #514930</a> 及 <a href="https://bugs.debian.org/570377" target="_blank" rel="noopener noreferrer">Bug #570377</a>。如有疑问，请使用 <code>apt</code>,<code>apt-get</code> 和 <code>apt-cache</code> 命令来替代 <code>aptitude</code> 命令。</li><li>因为在 <code>lenny</code> 版本之后的 Debian 系统中， <code>apt</code>、<code>apt-get</code> 和 <code>aptitude</code> 会共享自动安装的软件包的状态（参见<a href="https://www.debian.org/doc/manuals/debian-reference/ch02.zh-cn.html#_the_package_state_for_apt" target="_blank" rel="noopener noreferrer">第 2.5.5 节 “APT 的软件包状态”</a>），因此你可以混合使用这些工具而不会出现严重的麻烦（参见 <a href="https://bugs.debian.org/594490" target="_blank" rel="noopener noreferrer">Bug #594490</a>）。</li></ul><p><em>提示：更多详细的内容请参考 <code>https://www.debian.org/doc/manuals/debian-reference/ch02.zh-cn.html#_basic_package_management_operations</code></em></p><p>举几个小例子：</p><ol><li><p>查看 apache2 包的详细信息</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># apt-cache show apache2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Package: apache2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Architecture: arm64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Version: </span><span class="token number" style="color:rgb(9, 134, 88)">2.4</span><span class="token plain">.29-1ubuntu4.16</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Priority: optional</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Section: web</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Origin: Ubuntu</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Maintainer: Ubuntu Developers </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Original-Maintainer: Debian Apache Maintainers </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Bugs: https://bugs.launchpad.net/ubuntu/+filebug</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Installed-Size: </span><span class="token number" style="color:rgb(9, 134, 88)">523</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Package: apache2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Architecture: arm64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Version: </span><span class="token number" style="color:rgb(9, 134, 88)">2.4</span><span class="token plain">.29-1ubuntu4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Priority: optional</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Section: web</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Origin: Ubuntu</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Maintainer: Ubuntu Developers </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Original-Maintainer: Debian Apache Maintainers </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Bugs: https://bugs.launchpad.net/ubuntu/+filebug</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Installed-Size: </span><span class="token number" style="color:rgb(9, 134, 88)">520</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>使用 install -d 下载 apache2 安装时的所有依赖包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># tree /tmp/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/tmp/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> directories, </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> files</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># apt install -d -y -o dir::cache=/tmp apache2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Reading package lists</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. Done</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Building dependency tree     </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Reading state information</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. Done</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The following additional packages will be installed:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> apache2-bin apache2-data apache2-utils libapr1 libaprutil1 libaprutil1-dbd-sqlite3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> libaprutil1-ldap liblua5.2-0 libssl1.1 ssl-cert</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Suggested packages:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> www-browser apache2-doc apache2-suexec-pristine </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> apache2-suexec-custom openssl-blacklist</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The following NEW packages will be installed:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> apache2 apache2-bin apache2-data apache2-utils libapr1 libaprutil1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> libaprutil1-dbd-sqlite3 libaprutil1-ldap liblua5.2-0 ssl-cert</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The following packages will be upgraded:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> libssl1.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> upgraded, </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> newly installed, </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> to remove and </span><span class="token number" style="color:rgb(9, 134, 88)">256</span><span class="token plain"> not upgraded.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Need to get </span><span class="token number" style="color:rgb(9, 134, 88)">2,579</span><span class="token plain"> kB of archives.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">After this operation, </span><span class="token number" style="color:rgb(9, 134, 88)">7,012</span><span class="token plain"> kB of additional disk space will be used.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Fetched </span><span class="token number" style="color:rgb(9, 134, 88)">2,579</span><span class="token plain"> kB </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> 1s </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">3,135</span><span class="token plain"> kB/s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Download complete and </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> download only mode</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># tree /tmp/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/tmp/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── archives</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── apache2_2.4.29-1ubuntu4.16_arm64.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── apache2-bin_2.4.29-1ubuntu4.16_arm64.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── apache2-data_2.4.29-1ubuntu4.16_all.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── apache2-utils_2.4.29-1ubuntu4.16_arm64.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── libapr1_1.6.3-2_arm64.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── libaprutil1_1.6.1-2_arm64.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── libaprutil1-dbd-sqlite3_1.6.1-2_arm64.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── libaprutil1-ldap_1.6.1-2_arm64.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── liblua5.2-0_5.2.4-1.1build1_arm64.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── libssl1.1_1.1.1-1ubuntu2.1~18.04.9_arm64.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── lock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── partial</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   └── ssl-cert_1.0.39_all.deb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── pkgcache.bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└── srcpkgcache.bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> directories, </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain"> files</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="84yum-和-apt-对比">8.4、yum 和 apt 对比<a class="hash-link" href="#84yum-和-apt-对比" title="标题的直接链接">​</a></h2><p>下面是在 Debian/Ubuntu 和 Red Hat/Fedora 系统上用于包管理的等价命令表：</p><table><thead><tr><th>任务</th><th>Redhat/Fedora</th><th>Debian/Ubuntu</th></tr></thead><tbody><tr><td>Refresh list of available packages</td><td>Yum refreshes each time it&#x27;s used</td><td>apt-get update</td></tr><tr><td>Install a package from a repository</td><td>yum install package<!-- -->_<!-- -->name</td><td>apt-get install package<!-- -->_<!-- -->name</td></tr><tr><td>Install a package file</td><td>yum install package.rpm</td><td></td></tr><tr><td>rpm -i package.rpm</td><td>dpkg --install package.deb</td><td></td></tr><tr><td>Remove a package</td><td>yum remove package<!-- -->_<!-- -->name</td><td></td></tr><tr><td>rpm -e package<!-- -->_<!-- -->name</td><td>apt-get remove package<!-- -->_<!-- -->name</td><td></td></tr><tr><td>Check for package upgrades</td><td>yum check-update</td><td>apt-get -s upgrade</td></tr><tr><td>apt-get -s dist-upgrade</td><td></td><td></td></tr><tr><td>Upgrade packages</td><td>yum update</td><td></td></tr><tr><td>rpm -Uvh<!-- -->[<!-- -->args<!-- -->]</td><td>apt-get upgrade</td><td></td></tr><tr><td>Upgrade the entire system</td><td>yum upgrade</td><td>apt-get dist-upgrade</td></tr><tr><td>Get information about an available package</td><td>yum search package<!-- -->_<!-- -->name</td><td>apt-cache search package<!-- -->_<!-- -->name</td></tr><tr><td>Show available packages</td><td>yum list available</td><td>apt-cache dumpavail</td></tr><tr><td>List all installed packages</td><td>yum list installed</td><td></td></tr><tr><td>rpm -qa</td><td>dpkg --list</td><td></td></tr><tr><td>Get information about a package</td><td>yum info package<!-- -->_<!-- -->name</td><td>apt-cache show package<!-- -->_<!-- -->name</td></tr><tr><td>Get information about an installed package</td><td>rpm -qi package<!-- -->_<!-- -->name</td><td>dpkg --status package<!-- -->_<!-- -->name</td></tr><tr><td>List files in an installed package</td><td>rpm -ql package<!-- -->_<!-- -->name</td><td>dpkg --listfiles package<!-- -->_<!-- -->name</td></tr><tr><td>List documentation files in an installed package</td><td>rpm -qd package<!-- -->_<!-- -->name</td><td>-</td></tr><tr><td>List configuration files in an installed package</td><td>rpm -qc package<!-- -->_<!-- -->name</td><td>dpkg-query --show -f &#x27;${Conffiles}<!-- -->\<!-- -->n&#x27; package<!-- -->_<!-- -->name</td></tr><tr><td>Show the packages a given package depends on</td><td>rpm -qR package<!-- -->_<!-- -->name</td><td>apt-cache depends</td></tr><tr><td>Show other packages that depend on a given</td><td></td><td></td></tr><tr><td>package (reverse dependency)</td><td>rpm -q -whatrequires<!-- -->[<!-- -->args<!-- -->]</td><td>apt-cache rdepends</td></tr><tr><td>Get information about a package file</td><td>rpm -qpi package.rpm</td><td>dpkg --info package.deb</td></tr><tr><td>List files in a package file</td><td>rpm -qpl package.rpm</td><td>dpkg --contents package.deb</td></tr><tr><td>List documentation files in a package file</td><td>rpm -qpd package.rpm</td><td>-</td></tr><tr><td>List configuration files in a package file</td><td>rpm -qpc package.rpm</td><td>-</td></tr><tr><td>Extract files in a package</td><td>rpm2cpio package.rpm</td><td>cpio -vid</td></tr><tr><td>Find package that installed a file</td><td>rpm -qf filename</td><td>dpkg --search filename</td></tr><tr><td>Find package that provides a particular file</td><td>yum provides filename</td><td>apt-file search filename</td></tr><tr><td>Show stats about the package cache</td><td>-</td><td>apt-cache stats</td></tr><tr><td>Verify all installed packages</td><td>rpm -Va</td><td>debsums</td></tr><tr><td>Remove packages from the local cache directory</td><td>yum clean packages</td><td>apt-get clean</td></tr><tr><td>Remove only obsolete packages from the local</td><td></td><td></td></tr><tr><td>cache directory</td><td>-</td><td>apt-get autoclean</td></tr><tr><td>Remove header files from the local cache</td><td></td><td></td></tr><tr><td>directory</td><td>yum clean headers</td><td>apt-file purge</td></tr><tr><td>Package file extension</td><td>*<!-- -->.rpm</td><td>*<!-- -->.deb</td></tr><tr><td>Repository location configuration</td><td>/etc/yum.conf</td><td>/etc/apt/sources.list</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="85yum-和-apt-本地源制作">8.5、yum 和 apt 本地源制作<a class="hash-link" href="#85yum-和-apt-本地源制作" title="标题的直接链接">​</a></h2><p>前面我们说过，Redhat 系和 Debian 系操作系统是当今两天主流，所以很多商业公司为了节约成本，会选择这两个开源分支，特别是一些初创公司。</p><p>为了节约成本，小公司不会选择购买昂贵的企业网络，而是组建维持公司正常运作的必要内网。这种情况下，大多数开发工作会受到限制，因为没法通过外网获取开发依赖的软件包。搭建本地源就显得很关键，根据经验，当一个公司只有一到两个运维的时候，撑握该技术不可避免。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="851centos-安装源制作">8.5.1、CentOS 安装源制作<a class="hash-link" href="#851centos-安装源制作" title="标题的直接链接">​</a></h3><p>作为 Redhat 系最受欢迎的操作系统当然是 CentOS，因为 Redhat 是一家商业公司，直接使用 Redhat 操作系统难免要支付一部分服务费才能用得很顺畅。而 CentOS 作为 Redhat 旗下全开源的操作系统自然成为一众公司的不二之选。</p><p>下面就以 CentOS 7.6 版本为例，搭建本地源。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8511环境准备">8.5.1.1、环境准备<a class="hash-link" href="#8511环境准备" title="标题的直接链接">​</a></h4><ol><li><p>操作系统准备</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/redhat-release </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CentOS Linux release </span><span class="token number" style="color:rgb(9, 134, 88)">7.6</span><span class="token plain">.1810 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">AltArch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>操作系统的安装是比较基础的能力，这里不打算介绍，可以参考 CentOS 官方文档 <code>https://docs.centos.org/en-US/centos/install-guide/Simple_Installation/</code></li></ul></li><li><p>配置好操作系统的 YUM 源</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/yum.repos.d/CentOS-Base.repo | grep -v &quot;^$&quot; | grep -v &quot;^#&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">base</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">CentOS-</span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain"> - Base</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">baseurl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https://mirrors.aliyun.com/centos-altarch/</span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain">/os/</span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain">/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://archive.kernel.org/centos-vault/altarch/7.6.1810/os/aarch64/RPM-GPG-KEY-CentOS-7-aarch64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">updates</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">CentOS-</span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain"> - Updates</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">baseurl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https://mirrors.aliyun.com/centos-altarch/</span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain">/updates/</span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain">/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://archive.kernel.org/centos-vault/altarch/7.6.1810/os/aarch64/RPM-GPG-KEY-CentOS-7-aarch64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">extras</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">CentOS-</span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain"> - Extras</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">baseurl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https://mirrors.aliyun.com/centos-altarch/</span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain">/extras/</span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain">/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://archive.kernel.org/centos-vault/altarch/7.6.1810/os/aarch64/RPM-GPG-KEY-CentOS-7-aarch64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">centosplus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">CentOS-</span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain"> - Plus</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">baseurl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https://mirrors.aliyun.com/centos-altarch/</span><span class="token variable" style="color:rgb(9, 134, 88)">$releasever</span><span class="token plain">/centosplus/</span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain">/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://archive.kernel.org/centos-vault/altarch/7.6.1810/os/aarch64/RPM-GPG-KEY-CentOS-7-aarch64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这里复制的是阿里云的源，我们需要通过阿里云的镜像源把所有的 centos7.6 相关软件下载到本地。</li><li>注意这里的 gpgkey 借用了 Centos 官方的 gpgkey，直接用阿里的源 gpgkey 是错误的。</li></ul></li><li><p>补充 epel 源</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install epel-release.noarch  -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>前面我们有介绍 epel 源，如果有不明白的地方可以回顾。</li></ul></li><li><p>确认当前可以同步的 repository。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum repolist</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">repo </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">base/7/aarch64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">epel/aarch64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">extras/7/aarch64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">updates/7/aarch64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">repolist: </span><span class="token number" style="color:rgb(9, 134, 88)">22,035</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8512安装相关软件">8.5.1.2、安装相关软件<a class="hash-link" href="#8512安装相关软件" title="标题的直接链接">​</a></h4><p>制作 rpm 源，我们需要借用一个命令工具 createrepo，此工具使用起来既简单又强大。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install yum-utils -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>该软件包可以提供 createrepo 命令，利用此命令就可以为 rpm 包创建元数据索引</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8513制作源">8.5.1.3、制作源<a class="hash-link" href="#8513制作源" title="标题的直接链接">​</a></h4><ol><li><p>准备好下载 rpm 包的目录，一般情况下官方发布的 centos7 版本源大约 12GB，epel 源大约 15GB，另外还有一些不停更新的包，总共大约 30GB。我当前生产环境中的本地 centos7.6 源达到了 33GB，此生产环境已经不间断运行了 2 年，有了这些数据，您应该可以规划自已的存储空间了。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># fdisk -l | grep sda</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Disk /dev/sda: </span><span class="token number" style="color:rgb(9, 134, 88)">1099.5</span><span class="token plain"> GB, </span><span class="token number" style="color:rgb(9, 134, 88)">1099511627776</span><span class="token plain"> bytes, </span><span class="token number" style="color:rgb(9, 134, 88)">2147483648</span><span class="token plain"> sectors</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mkdir /mirrors/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mount /dev/sda /mirrors/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># df -h |grep mirror</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/dev/sda                1008G   28G  930G   </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">% /mirrors</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mkdir /mirrors/c76</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>我的生产环境规划的是 1 TB 存储，使用的是 lvm，保证了存储的可扩展性，底层存储使用的是 arm64 版本的商业 ceph 存储，性能还不错。</li></ul></li><li><p>开始同步</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># reposync -p /mirrors/c76/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>reposync 会把 centos 当前 yum.repos.d 下的所有源都同步下来，-p 指定下载存放的目录。可以指定 repoid 下载，reposync -r base -p /mirror/c76，同步 base 目录到本地。</li></ul></li><li><p>创建包索引</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># createrepo -po /mirrors/c76/base/ /mirrors/c76/base/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># createrepo -po /mirrors/c76/updates/ /mirrors/c76/updates/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># createrepo -po /mirrors/c76/extras/ /mirrors/c76/extras/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># createrepo -po /mirrors/c76/epel/ /mirrors/c76/epel/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>createrepo 会把指定目录中所有的 rpm 包建立一个 repodata，repodata 的作用本章前面有详细介绍。</li><li>-<!-- -->p 是美化 xml 元数据文件的格式，-o 是指把 repodata 输出到哪个目录。</li></ul></li><li><p>创建包组索引</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># wget http://archive.kernel.org/centos-vault/altarch/7.6.1810/os/aarch64/repodata/aced7d22b338fdf7c0a71ffcf32614e058f4422c42476d1f4b9e9364d567702f-c7-x86_64-comps.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mv aced7d22b338fdf7c0a71ffcf32614e058f4422c42476d1f4b9e9364d567702f-c7-x86_64-comps.xml /mirrors/c76/base/base-aarch64-comps.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># createrepo -g /mirrors/c76/base/base-aarch64-comps.xml /mirrors/c76/base/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>aarch64 centos7.5 包组元数据文件官方命名为 xxx-c7-aarch64-comps.xml，aarch64 centos7.6 官方命名为 xxx-c7-x86<!-- -->_<!-- -->64-comps.xml，由此可见包组元数据文件是 x86 aarch64 或者其它架构都是通用的。</li></ul></li><li><p>更新 rpm 包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># reposync -np /mirrors/c76/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>CentOS 的每一个版本在生命周期内都是在不停发展的，所以 rpm 包也在不停地更新当中。</li><li>reposync 用法同第 2 步，-n 则是 newest-only 也就是只同步最新的包。</li></ul></li><li><p>更新源数据</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># createrepo --update /mirrors/c76/base/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># createrepo --update /mirrors/c76/extras/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># createrepo --update /mirrors/c76/updates/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># createrepo --update /mirrors/c76/epel/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># createrepo --update -g /mirrors/c76/base/base-aarch64-comps.xml /mirrors/c76/base</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>rpm 包更新完了，repodata 元数据当然也得跟着更新。</li></ul></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8514自动化">8.5.1.4、自动化<a class="hash-link" href="#8514自动化" title="标题的直接链接">​</a></h4><p>由于 CentOS 的每一个版本在生命周期内都是在不停地发展，为了能让生产环境中的 CentOS 软件包可以正常的更新迭代，我们可以配置任务计划，进行周期性地更新。</p><ol><li><p>创建同步脚本</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /mirrors/script/c76_yum_update.sh </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Updating Aliyun Yum Sources&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Datetime</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">date +%F_%T</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /var/log/updateAliyunRepo_</span><span class="token variable" style="color:rgb(9, 134, 88)">$Datetime</span><span class="token plain">.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   reposync -np /mirrors/c76/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"> -eq </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   createrepo --update /mirrors/c76/base</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   createrepo --update /mirrors/c76/extras</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   createrepo --update /mirrors/c76/updates</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   createrepo --update /mirrors/c76/epel</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   createrepo --update -g base-aarch64-comps.xml /mirrors/c76/base</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Success: </span><span class="token string variable" style="color:rgb(9, 134, 88)">$Datetime</span><span class="token string" style="color:rgb(163, 21, 21)"> updateAliyunRepo successful!!!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Error: </span><span class="token string variable" style="color:rgb(9, 134, 88)">$Datetime</span><span class="token string" style="color:rgb(163, 21, 21)"> updateAliyunRepo failed!!!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod u+x /mirrors/script/c76_yum_update.sh </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>脚本执行的时候，如果没有 /bin/bash 解析，则脚本本身必须要有执行权限。</li></ul></li><li><p>制作任务计划</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># crontab -l</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Update AliyunRepo Sources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 每月第一个周六的23点更新阿里云yum源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> * * </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">date</span><span class="token plain"> +%d -eq </span><span class="token function" style="color:rgb(0, 0, 255)">cal</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;NR==3{print $NF}&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> /bin/bash /mirrors/script/c76_yum_update.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8515发布源">8.5.1.5、发布源<a class="hash-link" href="#8515发布源" title="标题的直接链接">​</a></h4><p>发布源的方式有很多，常用的是 http 协议或者 ftp 协议，我们这里选择 http 协议，搭建一个 nginx 服务器将源发布出去。</p><ol><li><p>配置 nginx 发布自制 yum 源</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># groupadd nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># useradd -r -g nginx -s /bin/false -M nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install nginx -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/nginx/nginx.conf | grep -v &quot;^#&quot; | grep -v &quot;^$&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">user nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">worker_processes auto</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">error_log /var/log/nginx/error.log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pid /run/nginx.pid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include /usr/share/nginx/modules/*.conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">events </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   worker_connections </span><span class="token number" style="color:rgb(9, 134, 88)">1024</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">http </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   log_format  main  </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                     </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                     </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   access_log  /var/log/nginx/access.log  main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   sendfile            on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   tcp_nopush          on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   tcp_nodelay         on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   keepalive_timeout   </span><span class="token number" style="color:rgb(9, 134, 88)">65</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   types_hash_max_size </span><span class="token number" style="color:rgb(9, 134, 88)">2048</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   include             /etc/nginx/mime.types</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   default_type        application/octet-stream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># Load modular configuration files from the /etc/nginx/conf.d directory.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># See http://nginx.org/en/docs/ngx_core_module.html#include</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># for more information.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   include /etc/nginx/conf.d/*.conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   server </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       listen       </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> default_server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       listen       </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">::</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:80 default_server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       server_name  _</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       root         /mirrors/c76/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token comment" style="color:rgb(0, 128, 0)"># Load configuration files for the default server block.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       include /etc/nginx/default.d/*.conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       location / </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       autoindex on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       autoindex_exact_size off</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       autoindex_localtime on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       charset utf-8,gbk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       index index.html</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       error_page </span><span class="token number" style="color:rgb(9, 134, 88)">404</span><span class="token plain"> /404.html</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           location </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> /40x.html </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       error_page </span><span class="token number" style="color:rgb(9, 134, 88)">500</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">502</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">503</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">504</span><span class="token plain"> /50x.html</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           location </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> /50x.html </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl enable nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl start nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>nginx 服务器的地址是 192.168.100.10，客户端打开浏览器输入 <a href="http://192.168.100.xn--10%2C-ij2ep27bk7dg6g7wgj2f644bykwdhb417i/" target="_blank" rel="noopener noreferrer">http://192.168.100.10，效果就跟利用网络打开</a> <code>https://archive.kernel.org/centos-vault/altarch/7.5.1804/os/aarch64/</code> 是一样的。客户端直接配置 yum 源即可。</p></li><li><p>[<!-- -->可选<!-- -->]<!-- --> 公司内部可以搭建一个 DNS 服务器，设计一个主机域名比如 mirrors.brinnatt.com，A 记录指向 192.168.100.10，如此，客户端配置 yum 源时就可以使用 <a href="http://mirrors.brinnatt.com/" target="_blank" rel="noopener noreferrer">http://mirrors.brinnatt.com</a>。</p></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="852ubuntu-安装源制作">8.5.2、Ubuntu 安装源制作<a class="hash-link" href="#852ubuntu-安装源制作" title="标题的直接链接">​</a></h3><p>作为 Debian 系最受欢迎的操作系统当属 Ubuntu，桌面非常美观，使用简单且功能强大，有庞大的受众群体。使用过程中如果遇到任何困难，只要一 google，基本上都迎刃而解。</p><p>相比较而言，Ubuntu 背后没有像 Redhat 那样强大的商业公司，但凭借着自身的优势加之完全开源，在开源社区发挥着举足轻重的作用。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8521环境准备">8.5.2.1、环境准备<a class="hash-link" href="#8521环境准备" title="标题的直接链接">​</a></h4><ol><li><p>操作系统准备</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> lsb_release -a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">No LSB modules are available.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Distributor ID:  Ubuntu</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Description: Ubuntu </span><span class="token number" style="color:rgb(9, 134, 88)">18.04</span><span class="token plain">.2 LTS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Release: </span><span class="token number" style="color:rgb(9, 134, 88)">18.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Codename:    bionic</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>ubuntu 操作系统的安装属于比较基础的能力，这里不作介绍，可以参见官方文档 <code>https://ubuntu.com/tutorials/install-ubuntu-desktop#1-overview</code></li></ul></li><li><p>配置好操作系统的 APT 源</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cat</span><span class="token plain"> /etc/apt/sources.list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic main restricted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-updates main restricted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic universe</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-updates universe</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic multiverse</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-updates multiverse</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-backports main restricted universe multiverse</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-security main restricted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-security universe</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-security multiverse</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这里配置的是阿里云的镜像源，用来安装同步镜像所需的工具。</li><li>如果想要了解 apt 源背后的原理，可以参考本章中对 apt 详解的部分。</li></ul></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8522安装相关软件">8.5.2.2、安装相关软件<a class="hash-link" href="#8522安装相关软件" title="标题的直接链接">​</a></h4><ol><li><p>安装 apt-mirror 工具</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> apt-mirror -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>apt-mirror 工具会按照 /etc/apt/mirror.list 配置文件把指定 repository 中的所有软件包都下载到本地</li></ul></li><li><p>配置 /etc/apt/mirror.list</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cat</span><span class="token plain"> /etc/apt/mirror.list </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">############# config ##################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> base_path    /mirrors/1804/apt-mirror        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置数据存放基目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> mirror_path  </span><span class="token variable" style="color:rgb(9, 134, 88)">$base_path</span><span class="token plain">/mirror               </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置镜像存储位置  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> skel_path    </span><span class="token variable" style="color:rgb(9, 134, 88)">$base_path</span><span class="token plain">/skel             </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置临时下载索引位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> var_path     </span><span class="token variable" style="color:rgb(9, 134, 88)">$base_path</span><span class="token plain">/var                  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置日志,URLs和MD5校验信息存储位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> cleanscript </span><span class="token variable" style="color:rgb(9, 134, 88)">$var_path</span><span class="token plain">/clean.sh               </span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置删除过期源脚本位置（默认不删除，方便安装旧版本软件）    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># set defaultarch     # 设置默认架构， 可填： amd64 或 i386，默认是和本机一个架构</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> postmirror_script </span><span class="token variable" style="color:rgb(9, 134, 88)">$var_path</span><span class="token plain">/postmirror.sh    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设定下载后运行的脚本位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> run_postmirror </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">                         </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置是否执行下载后的脚本操作，默认是1(但是默认没有postmirror.sh脚本）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> nthreads     </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">                              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置下载线程数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> _tilde </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">                                 </span><span class="token comment" style="color:rgb(0, 128, 0)"># 是否替换URL中的波浪线，替换成%7E（HTML代码），否则会跳过不进行下载                                  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">############# end config ##############</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置 Ubuntu bionic 源，apt-mirror 会把该源下的所有软件包同步到本地</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic main restricted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-updates main restricted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic universe</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-updates universe</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic multiverse</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-updates multiverse</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-backports main restricted universe multiverse</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-security main restricted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-security universe</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http://mirrors.aliyun.com/ubuntu-ports bionic-security multiverse</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">clean http://mirrors.aliyun.com/ubuntu-ports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8523制作源">8.5.2.3、制作源<a class="hash-link" href="#8523制作源" title="标题的直接链接">​</a></h4><ol><li><p>准备好存放源的目录</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">mkdir</span><span class="token plain"> /mirrors -pv</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">fdisk</span><span class="token plain"> -l </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> sda</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Disk /dev/sda: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> TiB, </span><span class="token number" style="color:rgb(9, 134, 88)">1099511627776</span><span class="token plain"> bytes, </span><span class="token number" style="color:rgb(9, 134, 88)">2147483648</span><span class="token plain"> sectors</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">mount</span><span class="token plain"> /dev/sda /mirrors</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">df</span><span class="token plain"> -h </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> sda</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/dev/sda       1007G  219G  737G  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">% /mirrors</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">mkdir</span><span class="token plain"> /mirrors/1804</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>通过调研，官方发布的 ubuntu 18.04 版本的软件包总共有 100GB 左右。这是我的生产环境，配置了 1TB 的大小。这个环境已经不间断生产了 2 年，目前的软件包共有 102GB。有了这些数据，您应该可以规划自已的存储空间了。</li><li>注意：apt-mirror 在同步软件包的时候需要访问数据目录，一定要注意数据目录的权限，有的人会选择创建 apt-mirror 用户，专门用来通步软件包，此时数据目录的属主属组应该改成 apt-mirror。我这里用的是 root 用户来同步软件包。</li></ul></li><li><p>开始同步</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> apt-mirror</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>验收同步的源</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> tree /mirrors/1804/ -d -L </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/mirrors/1804/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└── apt-mirror</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   ├── mirror</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │   └── mirrors.aliyun.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │       └── ubuntu-ports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │           ├── dists</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │           │   ├── bionic</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │           │   ├── bionic-backports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │           │   ├── bionic-security</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │           │   └── bionic-updates</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │           └── pool</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │               ├── main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │               ├── multiverse</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │               ├── restricted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │               └── universe</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   ├── skel</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │   └── mirrors.aliyun.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │       └── ubuntu-ports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │           └── dists</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │               ├── bionic</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │               ├── bionic-backports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │               ├── bionic-security</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   │               └── bionic-updates</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   └── var</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> directories</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8524自动化">8.5.2.4、自动化<a class="hash-link" href="#8524自动化" title="标题的直接链接">​</a></h4><p>由于 Ubuntu 的每一个版本在生命周期内都是在不停地发展，为了能让生产环境中的 Ubuntu 软件包可以正常的更新迭代，我们可以配置任务计划，进行周期性地更新。</p><ol><li><p>创建同步脚本</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cat</span><span class="token plain"> /usr/local/bin/apt_update.sh </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Updating Aliyun APT Sources&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Datetime</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">date +%F_%T</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exec</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /var/spool/apt-mirror/var/updateAliyunAPT_</span><span class="token variable" style="color:rgb(9, 134, 88)">$Datetime</span><span class="token plain">.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   /usr/bin/apt-mirror</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"> -eq </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Success: </span><span class="token string variable" style="color:rgb(9, 134, 88)">$Datetime</span><span class="token string" style="color:rgb(163, 21, 21)"> updateAliyunAPT successful!!!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Error: </span><span class="token string variable" style="color:rgb(9, 134, 88)">$Datetime</span><span class="token string" style="color:rgb(163, 21, 21)"> updateAliyunAPT failed!!!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>制作任务计划</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">crontab</span><span class="token plain"> -l </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">tail</span><span class="token plain"> -3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Update AliyunAPT Sources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 每月第一个周六的23点更新阿里云apt源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> * * </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">date</span><span class="token plain"> +%d -eq </span><span class="token function" style="color:rgb(0, 0, 255)">cal</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;NR==3{print $NF}&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> /bin/bash /usr/local/bin/apt_update.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8525发布源">8.5.2.5、发布源<a class="hash-link" href="#8525发布源" title="标题的直接链接">​</a></h4><p>发布源的方式有很多，常用的是 http 协议或者 ftp 协议，我们这里选择 http 协议，搭建一个 nginx 服务器将源发布出去。</p><ol><li><p>配置 nginx 发布自制 apt 源</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> nginx -y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cat</span><span class="token plain"> /etc/nginx/nginx.conf </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">user www-data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">worker_processes auto</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pid /run/nginx.pid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include /etc/nginx/modules-enabled/*.conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">events </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">worker_connections </span><span class="token number" style="color:rgb(9, 134, 88)">768</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># multi_accept on;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">http </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sendfile on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcp_nopush on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcp_nodelay on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">keepalive_timeout </span><span class="token number" style="color:rgb(9, 134, 88)">65</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">types_hash_max_size </span><span class="token number" style="color:rgb(9, 134, 88)">2048</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include /etc/nginx/mime.types</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">default_type application/octet-stream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   server </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       listen          </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       server_name     </span><span class="token number" style="color:rgb(9, 134, 88)">1804</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       root  /mirrors/1804/apt-mirror/mirror/mirrors.aliyun.com/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       location / </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           autoindex on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           autoindex_exact_size off</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           autoindex_localtime on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           charset utf-8,gbk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           index index.html</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ systemctl </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">enable</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ly@ubuntu:~$ systemctl restart nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>nginx 服务器的地址是 192.168.100.11，客户端打开浏览器输入 <a href="http://192.168.100.xn--11%2C-ij2ep27bk7dg6g7wgj2f644bykwdhb417i/" target="_blank" rel="noopener noreferrer">http://192.168.100.11，效果就跟利用网络打开</a> <code>http://ports.ubuntu.com/ubuntu-ports/</code> 是一样的。客户端直接配置 apt 源即可。</p></li><li><p>[<!-- -->可选<!-- -->]<!-- --> 公司内部可以搭建一个 DNS 服务器，设计一个主机域名比如 mirrors.kuber.com，A 记录指向 192.168.100.11，如此，客户端配置 apt 源时就可以使用 <a href="http://mirrors.kuber.com/" target="_blank" rel="noopener noreferrer">http://mirrors.kuber.com</a>。</p></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="86源码编译">8.6、源码编译<a class="hash-link" href="#86源码编译" title="标题的直接链接">​</a></h2><p>这里说的源码编译是指使用 GNU gcc 编译器编译的源码或者项目，也就是通常使用 C 或 C++ 开发的程序。使用其它语言开发的程序不一定在这里实用，所以读者一定要搞清楚的是，决定源码如何编译成二进制程序的关键是程序设计者使用了什么样的管理方式。</p><p>因此，编译源码之前要阅读解压目录中的 INSTALL/README 文件，这是程序设计者对源码做的相关说明，其中包括如何安装。大多数情况下，这些开发者都有约定俗成的套路，减少程序的使用难度。下面介绍一下源码编译约定俗成的套路。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="861通用步骤">8.6.1、通用步骤<a class="hash-link" href="#861通用步骤" title="标题的直接链接">​</a></h3><ol><li><p>准备好编译环境，比如 CentOS 首先就应该安装 &quot;Development Tools&quot; 和 &quot;Development Libraries&quot; 。</p></li><li><p>下载源码包，一般是 xxx.tar.gz、xxx.tar.bz2 或者 xxx.tar.xz 等压缩格式的源码包。</p></li><li><p>解压源码包，源码中一般有一个 configure，执行 ./configure -h 获取帮助，根据自己的需求，定制配置选项，比如启用哪些功能、禁用哪些功能、安装路径定义在哪等。执行 ./configure 过程中会检查系统环境是否符合满足安装要求，并将定义好的安装配置和系统环境信息写入Makefile文件中。</p><ul><li><p>configure 一般都会接受以下几个编译选项</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">          ：指定安装的路径</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--sysconfdir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">      ：指定配置文件目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-feature   ：启用某个特性</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--disable-fecture  ：禁用特性</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-function    ：启用某功能</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--without-function ：禁用某功能</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>一般情况下源文件自带的是 makefile.in 文件，执行 configure 后，makefile.in 转换成 makefile。</p></li><li><p>configure 和 makefile.in 虽然由源文件自带，但是并非是由作者自己写的，由两个命令生成。</p><ul><li>automake 命令生成 makefile.in，绝大多数情况源码中已经生成 makefile.in。</li><li>autoconf 命令生成 configure，所以如果源码没有 configure，也不要㤺，使用 autoconf 生成即可。</li></ul></li></ul></li><li><p>执行 make 命令进行编译。make 命令会根据 Makefile 文件进行编译。编译工作主要是调用编译器(如gcc g++)将源码编译为可执行文件，通常需要一些函数库才能产生一个完整的可执行文件。</p></li><li><p>make install 将上一步所编译的数据复制到指定的目录下。</p></li></ol><p>上面的每一个步骤都不能出错，否则无法达到预想的效果。所有的步骤都正常进行完成，需要做一些后续操作，虽非必须，但是都是个性化定制，方便以后的操作。个性化定制大致包括以下几项：</p><ol><li><p>将安装路径下的命令路径加入到环境变量。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;export PATH=/usr/local/apache/bin:$PATH&quot; &gt; /etc/profile.d/apache.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod +x /etc/profile.d/apache.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># source /etc/profile.d/apache.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>按需求定制服务启动脚本，并考虑是否加入开机启动项。</p></li><li><p>输出头文件和库文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 输出头文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># ln -s /usr/local/apache/include /usr/include/apache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 输出库文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;/usr/local/apache/lib&quot; &gt; /etc/ld.so.conf.d/apache.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># ldconfig</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>头文件库文件很多时候只是为其他程序提供的，所以可能不输出它们的路径也不会影响该程序的运行。</li></ul></li><li><p>导出 man 路径</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;MANPATH /usr/local/apache/man&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> /etc/man.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>卸载时，只需删除安装目录即可。如果安装的路径比较分散，不方便直接删除，那么也可回到源码目录(如果删除了需要重新下载并解压)，执行 make uninstall。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="87打补丁">8.7、打补丁<a class="hash-link" href="#87打补丁" title="标题的直接链接">​</a></h2><p>在 ARM64 架构下无论是操作系统，还是应用程序，打补丁的可能性还是比较大的。因为在服务器市场 ARM64 架构还不够成熟，很多厂商使用的操作系统改了一部分内核源代码，这就会造成一些不稳定因素，所以很有可能会涉及到修改内核或者应用程序的源代码，使用打补丁的方式比较简单。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="871命令简介">8.7.1、命令简介<a class="hash-link" href="#871命令简介" title="标题的直接链接">​</a></h3><p>制作补丁和应用补丁会涉及到两个命令，一个 diff 命令，一个 patch 命令。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8711diff-命令">8.7.1.1、diff 命令<a class="hash-link" href="#8711diff-命令" title="标题的直接链接">​</a></h4><p>diff 可以比较两个对象，并可同时记录下二者的区别。制作补丁时的一般用法和常见选项为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">diff</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">选项</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> 源文件（夹） 目的文件（夹）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r: 递归。设置后diff会将两个不同版本源代码目录中的所有对应文件全部都进行一次比较，包括子目录文件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-N: 选项确保补丁文件将正确地处理已经创建或删除文件的情况。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-u: 输出每个修改前后的3行，也可以用-u5等指定输出更多上下文。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-E, -b, -w, -B, --strip-trailing-cr: 忽略各种空白，可参见文档，按需选用。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>由于历史原因，diff 的输出格式经历过几个变种，正常格式（normal diff）、上下文格式（context diff）、合并格式（unified diff）；</p><ul><li>正常格式（normal diff）：<code>diff file1 file2</code> 这种方式可以得到二者的正常格式对比结果。</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;1\n2\n3\n4\n5\n6\n7&quot; &gt; file1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;1\n2\n3\na\n5\n6\n7&quot; &gt; file2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># diff file1 file2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">4c4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>4c4 分成三个部分：前面的 &quot;4&quot;，表示 file1 的第 4 行有变化；中间的 &quot;c&quot; 表示变动的模式是内容改变（change），其他模式还有 &quot;增加&quot;（a，代表addition）和 &quot;删除&quot;（d，代表deletion）；后面的 &quot;4&quot;，表示变动后变成 file2 的第 4 行。</li><li>&lt; 4 前面的小于号，表示要从 file1 当中去除该行（也就是第 4 行），后面的 &quot;4&quot; 表示该行的内容。</li><li>-<!-- -->-- 用来分割 file1 和 file2</li><li>&gt;<!-- --> a 前面的大于号表示 file2 增加了该行，后面的 &quot;a&quot; 表示该行的内容。</li><li>上下文格式（context diff）：<code>diff -c file1 file2</code> 这种方式可以得到二者的上下文格式对比结果。</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;1\n2\n3\n4\n5\n6\n7&quot; &gt; file1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;1\n2\n3\na\n5\n6\n7&quot; &gt; file2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># diff -c file1 file2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*** file1   </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 02:41:09.442080211 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--- file2   </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 02:41:13.142045812 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">***************</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*** </span><span class="token number" style="color:rgb(9, 134, 88)">1,7</span><span class="token plain"> ****</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--- </span><span class="token number" style="color:rgb(9, 134, 88)">1,7</span><span class="token plain"> ----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>diff 结果输出部分前两行显示两个文件的基本情况：文件名和时间信息。&quot;<!-- -->*<!-- -->*<!-- -->*<!-- -->&quot; 表示变动前的文件，&quot;---&quot; 表示变动后的文件。</li><li>diff 结果输出部分第三行是15个星号，将文件的基本情况与变动内容分割开。</li><li><code>*** 1,7 ****</code> 以下 7 行是 file1 显示变动前的文件，这时不仅显示发生变化的第 4 行，还显示第 4 行的前面三行和后面三行，因此一共显示 7 行。所以，前面的 <code>&quot;*** 1,7 ****&quot;</code> 就表示，从第 1 行开始连续 7 行。另外，文件内容的每一行最前面，还有一个标记位。如果为空，表示该行无变化；如果是感叹号（!），表示该行有改动；如果是减号（-），表示该行被删除；如果是加号（+），表示该行为新增。</li><li><code>--- 1,7 ----</code> 以下 7 行是 file2 显示变动前的文件，除了变动行（第 4 行）以外，也是上下文各显示三行，总共显示 7 行。</li><li>合并格式（unified diff）：<code>diff -u file1 file2</code> 这种方式可以得到二者的合并格式对比结果。</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;1\n2\n3\n4\n5\n6\n7&quot; &gt; file1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;1\n2\n3\na\n5\n6\n7&quot; &gt; file2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># diff -u file1 file2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--- file1   </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 02:53:45.395052106 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++ file2   </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 02:53:51.222997923 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@@ -1,7 +1,7 @@</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>diff 结果输出部分 <code>--- file1</code> 表示变动前的文件，<code>+++ file2</code> 表示变动后的文件。</li><li><code>@@ -1,7 +1,7 @@</code> 表示变动的位置用两个@作为起首和结束。前面的 &quot;-1,7&quot; 分成三个部分：减号表示第一个文件（即file1），&quot;1&quot; 表示第 1 行，&quot;7&quot; 表示连续 7 行。合在一起，就表示下面是第一个文件从第 1 行开始的连续 7 行。同样的，&quot;+1,7&quot; 表示变动后，成为第二个文件从第 1 行开始的连续 7 行。</li><li>接着 <code>@@ -1,7 +1,7 @@</code> 下面的 8 行是变动的具体内容。除了有变动的那些行以外，也是上下文各显示 3 行。它将两个文件的上下文，合并显示在一起，所以叫做 &quot;合并格式&quot;。每一行最前面的标志位，空表示无变动，减号表示第一个文件删除的行，加号表示第二个文件新增的行。</li></ul></li><li><p>我们这里介绍的 diff 以当今大家通用最多的 &quot;合并格式&quot; 为主，将来使用 diff 甚至是 git diff，只要没有加以特殊说明，我们都认为是 &quot;合并格式&quot; 的 diff。</p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8712patch-命令">8.7.1.2、patch 命令<a class="hash-link" href="#8712patch-命令" title="标题的直接链接">​</a></h4><p>patch 的作用则是将 diff 记录的结果（即补丁）应用到相应文件（夹）上。最常见的用法为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">patch -pNUM </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">patchfile</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-p Num: 忽略几层文件夹，随后详解。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-E:     选项说明如果发现了空文件，那么就删除它</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-R:     取消打过的补丁。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为了解释 -p 参数，需要看看如下 patch 文件片段：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--- old/modules/pcitable       Mon Sep </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain">:03:56 </span><span class="token number" style="color:rgb(9, 134, 88)">1999</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++ new/modules/pcitable       Tue Dec </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:05:41 </span><span class="token number" style="color:rgb(9, 134, 88)">2000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>如果使用参数 <strong>-<!-- -->p0</strong>，那就表示从当前目录找一个叫做 old 的文件夹，再在它下面寻找 <em>modules/pcitable</em> 文件来执行 patch 操作。</li><li>而如果使用参数 <strong>-<!-- -->p1</strong>，那就表示忽略第一层目录（即不管old），从当前目录寻找 <em>modules</em> 的文件夹，再在它下面找 <em>pcitable</em>。</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8713应用">8.7.1.3、应用<a class="hash-link" href="#8713应用" title="标题的直接链接">​</a></h4><p>利用以上命令，处理单个文件补丁的方法：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 产生补丁</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">diff</span><span class="token plain"> -uN from-file to-file </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> to-file.patch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 打补丁</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patch -p0 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> to-file.patch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 取消补丁</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patch -RE -p0 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> to-file.patch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对整个文件夹打补丁的情况：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 产生补丁</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">diff</span><span class="token plain"> -uNr from-docu to-docu </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> to-docu.patch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 打补丁</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">cd</span><span class="token plain"> to-docu</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patch -p1 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> to-docu.patch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 取消补丁</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patch -R -p1 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> to-docu.patch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另外，使用版本控制工具时，可以直接用 <em>svn diff</em> 或 <em>git diff</em> 生成补丁文件。</p><p>值得一提的是，由于应用补丁时的目标代码和生成补丁时的代码未必相同，打补丁操作可能失败。补丁失败的文件会以 .rej 结尾，下面命令可以找出所有 rej 文件：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">find</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"> -name </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;*.rej&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>举一个小例子：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;111111\n111111\n111111&quot; &gt; file1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;222222\n111111\n222222\n111111&quot; &gt; file2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># diff -uN file1 file2 &gt; file.patch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat file.patch </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--- file1   </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 03:43:07.219515984 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++ file2   </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 03:43:30.475299775 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@@ -1,3 +1,4 @@</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+222222</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-111111</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+222222</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="872patch-文件构成">8.7.2、patch 文件构成<a class="hash-link" href="#872patch-文件构成" title="标题的直接链接">​</a></h3><p>补丁文件里到底存储了哪些信息呢？看看下面例子：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--- file1   </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 03:43:07.219515984 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++ file2   </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 03:43:30.475299775 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@@ -1,3 +1,4 @@</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+222222</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-111111</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+222222</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>补丁头</strong><ul><li>补丁头是分别由 ---/+++ 开头的两行，用来表示要打补丁的文件。--- 开头表示旧文件，+++ 开头表示新文件。</li></ul></li><li><strong>一个补丁文件中的多个补丁</strong><ul><li>一个补丁文件中可能包含以 ---/+++ 开头的很多节，每一节用来打一个补丁。所以在一个补丁文件中可以包含好多个补丁。</li></ul></li><li><strong>块</strong><ul><li>块是补丁中要修改的地方。它通常由一部分不用修改的东西开始和结束。他们只是用来表示要修改的位置。他们通常以 @@ 开始，结束于另一个块的开始或者一个新的补丁头。&#x27;-&#x27; 后的数字代表该块在旧文件的行号，修改前该块总行数；&#x27;+&#x27; 后的数字代表该块在新文件的行号，修改后该块总行数。</li></ul></li><li><strong>块的缩进</strong><ul><li>块会缩进一列，而这一列是用来表示这一行是要增加还是要删除的。</li></ul></li><li><strong>块的第一列</strong><ul><li>+<!-- --> 号表示这一行是要加上的。- 号表示这一行是要删除的。没有加号也没有减号表示这里只是引用的而不需要修改。</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="873实例分析">8.7.3、实例分析<a class="hash-link" href="#873实例分析" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8731单文件补丁">8.7.3.1、单文件补丁<a class="hash-link" href="#8731单文件补丁" title="标题的直接链接">​</a></h4><p>设当前目录有文件 file1：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;111111\n111111\n111111&quot; &gt; file1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat file1 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建文件 file2：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;222222\n111111\n222222\n111111&quot; &gt; file2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat file2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">222222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">222222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 diff 创建补丁<strong>file.patch</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># diff -uN file1 file2 &gt; file.patch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">file1  file2  file.patch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为是单个文件，故不需要 -r 选项。此命令得到如下补丁：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat file.patch </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--- file1   </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 03:54:40.973066148 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++ file2   </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 03:55:37.724538529 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@@ -1,3 +1,4 @@</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+222222</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-111111</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+222222</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>要应用补丁</strong>，只需：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># patch -p0 &lt; file.patch </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patching </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> file1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">file1  file2  file.patch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat file1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">222222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">222222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat file2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">222222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">222222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>应用补丁后，file1 和 file2 变成一样的了。</li></ul><p>如果要<strong>取消补丁</strong>做出的更改，恢复旧版本：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># patch -RE -p0 &lt; file.patch </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patching </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> file1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat file1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat file2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">222222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">222222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8732文件夹补丁">8.7.3.2、文件夹补丁<a class="hash-link" href="#8732文件夹补丁" title="标题的直接链接">​</a></h4><p>准备如下环境：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;--------\nproject1/name1\n--------&quot; &gt; project1/project1_name1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;--------\nproject2/name2\n--------&quot; &gt; project2/project2_name2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># tree</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── project1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── file1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   └── project1_name1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└── project2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ├── file2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    └── project2_name2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> directories, </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> files</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat project1/file1 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat project1/project1_name1 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">project1/name1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat project2/file2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">222222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">222222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat project2/project2_name2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">project2/name2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 <em>diff -uNr</em> 创建补丁</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># diff -uNr project1 project2 &gt; project.patch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat project.patch </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">diff</span><span class="token plain"> -uNr project1/file1 project2/file1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--- project1/file1  </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 04:00:57.905561801 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++ project2/file1  </span><span class="token number" style="color:rgb(9, 134, 88)">1969</span><span class="token plain">-12-31 </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain">:00:00.000000000 -0500</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@@ -1,3 +0,0 @@</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-111111</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-111111</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-111111</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">diff</span><span class="token plain"> -uNr project1/file2 project2/file2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--- project1/file2  </span><span class="token number" style="color:rgb(9, 134, 88)">1969</span><span class="token plain">-12-31 </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain">:00:00.000000000 -0500</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++ project2/file2  </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 03:55:37.724538529 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@@ -0,0 +1,4 @@</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+222222</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+111111</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+222222</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+111111</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">diff</span><span class="token plain"> -uNr project1/project1_name1 project2/project1_name1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--- project1/project1_name1 </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 04:10:38.048168208 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++ project2/project1_name1 </span><span class="token number" style="color:rgb(9, 134, 88)">1969</span><span class="token plain">-12-31 </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain">:00:00.000000000 -0500</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@@ -1,3 +0,0 @@</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">---------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-project1/name1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">---------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">diff</span><span class="token plain"> -uNr project1/project2_name2 project2/project2_name2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--- project1/project2_name2 </span><span class="token number" style="color:rgb(9, 134, 88)">1969</span><span class="token plain">-12-31 </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain">:00:00.000000000 -0500</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+++ project2/project2_name2 </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-07-12 04:11:03.451932029 -0400</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@@ -0,0 +1,3 @@</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+--------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+project2/name2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+--------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果要应用此补丁：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">project1  project2  project.patch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd project1/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~/project1</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~/project1</span><span class="token comment" style="color:rgb(0, 128, 0)"># patch -p1 &lt; ../project.patch </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patching </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> file1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patching </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> file2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patching </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> project1_name1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patching </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> project2_name2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~/project1</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时可以看到打补丁后的结果：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># tree </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── project1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── file2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   └── project2_name2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── project2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── file2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   └── project2_name2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└── project.patch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> directories, </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> files</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>类似的，如果要回滚补丁操作：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd project1/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~/project1</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~/project1</span><span class="token comment" style="color:rgb(0, 128, 0)"># patch -R -p1 &lt; ../project.patch </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patching </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> file1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patching </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> file2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patching </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> project1_name1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">patching </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> project2_name2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~/project1</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~/project1</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd ..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)"># tree </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── project1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── file1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   └── project1_name1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── project2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── file2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   └── project2_name2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└── project.patch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> directories, </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> files</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@arm64v8:~</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/linux-primary-7"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">第 7 章 Linux Raid 存储管理</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux-primary-9"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">第 9 章 Linux 进程和信号</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#81包基础知识" class="table-of-contents__link toc-highlight">8.1、包基础知识</a></li><li><a href="#82rpm-包" class="table-of-contents__link toc-highlight">8.2、rpm 包</a><ul><li><a href="#821rpm-安装升级卸载" class="table-of-contents__link toc-highlight">8.2.1、rpm 安装、升级、卸载</a></li><li><a href="#822rpm-查询" class="table-of-contents__link toc-highlight">8.2.2、rpm 查询</a></li><li><a href="#823rpm-提取包文件" class="table-of-contents__link toc-highlight">8.2.3、rpm 提取包文件</a></li><li><a href="#824yum-工具" class="table-of-contents__link toc-highlight">8.2.4、yum 工具</a><ul><li><a href="#8241yum-配置文件" class="table-of-contents__link toc-highlight">8.2.4.1、yum 配置文件</a></li><li><a href="#8242配置-yum-仓库" class="table-of-contents__link toc-highlight">8.2.4.2、配置 yum 仓库</a></li><li><a href="#8243配置-epel-仓库" class="table-of-contents__link toc-highlight">8.2.4.3、配置 epel 仓库</a></li><li><a href="#8244yum-命令" class="table-of-contents__link toc-highlight">8.2.4.4、yum 命令</a></li></ul></li></ul></li><li><a href="#83deb-包" class="table-of-contents__link toc-highlight">8.3、deb 包</a><ul><li><a href="#831dpkg-工具简介" class="table-of-contents__link toc-highlight">8.3.1、dpkg 工具简介</a></li><li><a href="#832dpkg-安装" class="table-of-contents__link toc-highlight">8.3.2、dpkg 安装</a></li><li><a href="#833dpkg-移除软件包" class="table-of-contents__link toc-highlight">8.3.3、dpkg 移除软件包</a></li><li><a href="#834dpkg-查询" class="table-of-contents__link toc-highlight">8.3.4、dpkg 查询</a></li><li><a href="#835apt-工具" class="table-of-contents__link toc-highlight">8.3.5、apt 工具</a><ul><li><a href="#8351apt-更新元数据" class="table-of-contents__link toc-highlight">8.3.5.1、apt 更新元数据</a></li><li><a href="#8352apt-实用命令" class="table-of-contents__link toc-highlight">8.3.5.2、apt 实用命令</a></li></ul></li></ul></li><li><a href="#84yum-和-apt-对比" class="table-of-contents__link toc-highlight">8.4、yum 和 apt 对比</a></li><li><a href="#85yum-和-apt-本地源制作" class="table-of-contents__link toc-highlight">8.5、yum 和 apt 本地源制作</a><ul><li><a href="#851centos-安装源制作" class="table-of-contents__link toc-highlight">8.5.1、CentOS 安装源制作</a><ul><li><a href="#8511环境准备" class="table-of-contents__link toc-highlight">8.5.1.1、环境准备</a></li><li><a href="#8512安装相关软件" class="table-of-contents__link toc-highlight">8.5.1.2、安装相关软件</a></li><li><a href="#8513制作源" class="table-of-contents__link toc-highlight">8.5.1.3、制作源</a></li><li><a href="#8514自动化" class="table-of-contents__link toc-highlight">8.5.1.4、自动化</a></li><li><a href="#8515发布源" class="table-of-contents__link toc-highlight">8.5.1.5、发布源</a></li></ul></li><li><a href="#852ubuntu-安装源制作" class="table-of-contents__link toc-highlight">8.5.2、Ubuntu 安装源制作</a><ul><li><a href="#8521环境准备" class="table-of-contents__link toc-highlight">8.5.2.1、环境准备</a></li><li><a href="#8522安装相关软件" class="table-of-contents__link toc-highlight">8.5.2.2、安装相关软件</a></li><li><a href="#8523制作源" class="table-of-contents__link toc-highlight">8.5.2.3、制作源</a></li><li><a href="#8524自动化" class="table-of-contents__link toc-highlight">8.5.2.4、自动化</a></li><li><a href="#8525发布源" class="table-of-contents__link toc-highlight">8.5.2.5、发布源</a></li></ul></li></ul></li><li><a href="#86源码编译" class="table-of-contents__link toc-highlight">8.6、源码编译</a><ul><li><a href="#861通用步骤" class="table-of-contents__link toc-highlight">8.6.1、通用步骤</a></li></ul></li><li><a href="#87打补丁" class="table-of-contents__link toc-highlight">8.7、打补丁</a><ul><li><a href="#871命令简介" class="table-of-contents__link toc-highlight">8.7.1、命令简介</a><ul><li><a href="#8711diff-命令" class="table-of-contents__link toc-highlight">8.7.1.1、diff 命令</a></li><li><a href="#8712patch-命令" class="table-of-contents__link toc-highlight">8.7.1.2、patch 命令</a></li><li><a href="#8713应用" class="table-of-contents__link toc-highlight">8.7.1.3、应用</a></li></ul></li><li><a href="#872patch-文件构成" class="table-of-contents__link toc-highlight">8.7.2、patch 文件构成</a></li><li><a href="#873实例分析" class="table-of-contents__link toc-highlight">8.7.3、实例分析</a><ul><li><a href="#8731单文件补丁" class="table-of-contents__link toc-highlight">8.7.3.1、单文件补丁</a></li><li><a href="#8732文件夹补丁" class="table-of-contents__link toc-highlight">8.7.3.2、文件夹补丁</a></li></ul></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">学习</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/skill">技术笔记</a></li><li class="footer__item"><a class="footer__link-item" href="/project">实战项目</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/linux">Linux</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/zqingfa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/website">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">浙ICP备20024502号-1</a></p><p>Copyright © 2022 - PRESENT zhangqf Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.9e73f1b3.js"></script>
<script src="/assets/js/main.39d37d57.js"></script>
</body>
</html>