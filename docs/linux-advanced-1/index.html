<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-linux/advanced/linux-advanced-1">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">第 1 章 Linux 进阶命令 - Linux技术分享</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://zhangqf.com/docs/linux-advanced-1"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="第 1 章 Linux 进阶命令 - Linux技术分享"><meta data-rh="true" name="description" content="在 Primary School 篇，我们详细介绍了很多基础命令，也涉及很多系统层级的基础知识，都可以算作入门篇章。从这里开始，我们继续深入探索应用层面的相关知识，主要从工作中经常应用这个角度出发，总结一些宝贵经验。同样的，在没有特别说明情况下，所有的操作都是在 ARM64 架构服务器下完成。"><meta data-rh="true" property="og:description" content="在 Primary School 篇，我们详细介绍了很多基础命令，也涉及很多系统层级的基础知识，都可以算作入门篇章。从这里开始，我们继续深入探索应用层面的相关知识，主要从工作中经常应用这个角度出发，总结一些宝贵经验。同样的，在没有特别说明情况下，所有的操作都是在 ARM64 架构服务器下完成。"><meta data-rh="true" name="keywords" content="linux,command"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhangqf.com/docs/linux-advanced-1"><link data-rh="true" rel="alternate" href="https://zhangqf.com/en/docs/linux-advanced-1" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-1" hreflang="zh"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-1" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9B0V5WT2X8-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Linux技术分享" href="/opensearch.xml">
<link rel="preconnect" href="https://zhangqf.com/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://zhangqf.com/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c9a3849aa75f9c4a4e65f846cd1a5155",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="zhangqf RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="zhangqf Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="zhangqf JSON Feed">

<link rel="icon" href="/img/logo.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><link rel="stylesheet" href="/assets/css/styles.86c9ae18.css">
<link rel="preload" href="/assets/js/runtime~main.9b8cde08.js" as="script">
<link rel="preload" href="/assets/js/main.98aacc98.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>更新 <a href="/website">网址导航</a> 带你发现感兴趣的技术</span></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">zhangqf</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/linux">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/category/Linux基础">Linux 基础</a></li><li><a class="dropdown__link" href="/docs/category/Linux进阶">Linux 进阶</a></li><li><a class="dropdown__link" href="/docs/category/Linux测试">Linux 测试</a></li><li><a class="dropdown__link" href="/docs/category/LinuxCICD">Linux CICD研发</a></li><li><a class="dropdown__link" href="/docs/skill/">笔记</a></li><li><a class="dropdown__link" href="/docs/tools/">工具推荐</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Blog</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags">标签</a></li><li><a class="dropdown__link" href="/archive">归档</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">工具</a><ul class="dropdown__menu"><li><a href="https://api.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">API服务</a></li><li><a href="https://js-de-obfuscator.vercel.app" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS代码还原</a></li><li><a href="https://cipher.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">CyberChef加密</a></li></ul></div><a class="navbar__item navbar__link" href="/website">导航</a><a class="navbar__item navbar__link" href="/project">项目</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"><b>zhangqf</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux基础">Linux基础</a><button aria-label="打开/收起侧边栏菜单「Linux基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/linux进阶">Linux进阶</a><button aria-label="打开/收起侧边栏菜单「Linux进阶」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/linux-advanced-1">第 1 章 Linux 进阶命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-2">第 2 章 Linux 防火墙</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-3">第 3 章 Linux NFS 网络文件系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-4">第 4 章 Linux DHCP 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-5">第 5 章 Linux DNS 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-6">第 6 章 Linux httpd 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-7">第 7 章 Linux httpd 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-8">第 8 章 Linux httpd 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-9">第 9 章 Linux Nginx 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-10">第 10 章 Linux Tomcat 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-11">第 11 章 Linux Tomcat 服务实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-12">第 12 章 Linux haproxy 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-13">第 13 章 Linux haproxy 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-14">第 14 章 Linux haproxy 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-15">第 15 章 Linux LVS 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-16">第 16 章 Linux Keepalived 服务配置</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux测试">Linux测试</a><button aria-label="打开/收起侧边栏菜单「Linux测试」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linuxcicd">Linux CICD研发</a><button aria-label="打开/收起侧边栏菜单「Linux CICD研发」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/linux进阶"><span itemprop="name">Linux进阶</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第 1 章 Linux 进阶命令</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>第 1 章 Linux 进阶命令</h1></header><p>在 Primary School 篇，我们详细介绍了很多基础命令，也涉及很多系统层级的基础知识，都可以算作入门篇章。从这里开始，我们继续深入探索应用层面的相关知识，主要从工作中经常应用这个角度出发，总结一些宝贵经验。同样的，在没有特别说明情况下，所有的操作都是在 ARM64 架构服务器下完成。</p><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-高效处理文本">1.1 高效处理文本<a class="hash-link" href="#11-高效处理文本" title="标题的直接链接">​</a></h2><p>在工作当中，涉及到文本处理，最先想到的就是 grep、sed、awk 三个命令，俗称文本三剑客；这三个工具实际上借用正则表达式对文本进行匹配，然后进行动作处理。</p><p>即便是在编程领域，正则表达式用起来也有一定难度，所以下面我会介绍这三个工具的常规用法，如果满足不了需求，不防使用 python 编程，没有必要在一个工具上花费太多时间。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="111grep-命令">1.1.1、grep 命令<a class="hash-link" href="#111grep-命令" title="标题的直接链接">​</a></h3><p>grep 全称是 Global Regular Expression Print，表示全局正则表达式版本，它的使用权限是所有用户。</p><p>grep 的工作方式是这样的，它在一个或多个文件中搜索字符串模板。如果模板包括空格，则必须被引用，模板后的所有字符串被看作文件名。搜索的结果被送到标准输出，不影响原文件内容。</p><p>grep 可用于 shell 脚本，因为 grep 通过返回一个状态值来说明搜索的状态，如果模板搜索成功，则返回 0，如果搜索不成功，则返回 1，如果搜索的文件不存在，则返回 2。我们利用这些返回值就可进行一些自动化的文本处理工作。</p><p><strong>egrep = grep -E：扩展的正则表达式</strong>( 除了 <strong>\<!-- -->&lt; , <!-- -->\<!-- -->&gt; , <!-- -->\<!-- -->b</strong> 使用其他正则表达式都可以去掉转义符 <!-- -->\<!-- --> )</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1111grep-语法格式">1.1.1.1、grep 语法格式<a class="hash-link" href="#1111grep-语法格式" title="标题的直接链接">​</a></h4><p>命令格式：grep <!-- -->[<!-- -->options<!-- -->]<!-- --> pattern file</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1112options-选项">1.1.1.2、options 选项<a class="hash-link" href="#1112options-选项" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-A</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:            除了显示符合 pattern 的那一列之外，并显示该行之后的 num 行。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-B</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:            除了显示符合 pattern 的那一行之外，并显示该行之前的 num 行。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-C</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:            除了显示符合 pattern 的那一行之外，并显示该行之前后的 num 行。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-c:                 统计匹配的行数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-e:                 实现多个选项间的逻辑 or 关系</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-E:                 扩展的正则表达式</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f FILE:            从 FILE 获取 PATTERN 匹配</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-F:                 相当于 </span><span class="token function" style="color:rgb(0, 0, 255)">fgrep</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-i --ignore-case:   忽略字符大小写的差别。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-n:                 显示匹配的行号</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-o:                 仅显示匹配到的字符串</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-q:                 静默模式，不输出任何信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s:                 不显示错误信息。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v:                 显示不被 pattern 匹配到的行，相当于 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">^</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> 反向匹配</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-w:                 匹配整个单词</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aaaaa</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bbbbb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ccccc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AAAbb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">DDDDCCCBBB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep -A2 &quot;b&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bbbbb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ccccc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AAAbb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">DDDDCCCBBB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep -e &quot;AAA&quot; -e &quot;BBB&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AAAbb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">DDDDCCCBBB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep -in &quot;b&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">:bbbbb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">:AAAbb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">:DDDDCCCBBB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep -wn &quot;aaaaa&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">:aaaaa</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat pattern.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">DDDDC</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep -n -f pattern.txt test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">:DDDDCCCBBB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1113pattern-模式">1.1.1.3、pattern 模式<a class="hash-link" href="#1113pattern-模式" title="标题的直接链接">​</a></h4><blockquote><p>基本正则表达式</p></blockquote><p>匹配字符</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">                           匹配任意单个字符，不能匹配空行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                          匹配指定范围内的任意单个字符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">^</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                         取反</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:alnum:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> or </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">-9a-zA-Z</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">    匹配大小写字母和数字集</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:alpha:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> or </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">a-zA-Z</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">       匹配大小写字母集</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:upper:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> or </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">A-Z</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">          匹配大写字母集</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:lower:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> or </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">a-z</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">          匹配小写字母集</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:blank:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                   匹配空白字符集</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">空格和制表符</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:space:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                   匹配空格字符集</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">空格、制表符、垂直制表符、换行符、回车符和分页符</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:cntrl:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                   匹配控制字符集</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ASCII中，这些字符的八进制代码从000到037，还包括177</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">DEL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:digit:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                   匹配数字字符集</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">-9</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:xdigit:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                  匹配十六进制集</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">-9A-Fa-f</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:graph:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                   匹配绘图集</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">大小写字母、数字和标点符号</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:print:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                   匹配打印字符集</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">大小写字母、数字、标点符号和空格</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:punct:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">                   匹配标点符号集 </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;! &quot; # $ % &amp; &#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> * + , - </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"> / </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> ? @ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> ^ _ </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27; { | } ~&#x27;</span><span class="token plain">。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aaa</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a1a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">b//cd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cc44AA</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep . test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aaa</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a1a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">b//cd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cc44AA</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep &quot;[a/]&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aaa</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a1a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">b//cd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep [[:punct:]] test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">b//cd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>匹配次数</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">*           匹配前面的字符任意次，包括0次，贪婪模式：尽可能长的匹配</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">.*          匹配任意长度的任意字符，不包括0次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">?          匹配其前面的字符0 或 </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">+          匹配其前面的字符至少1次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">       匹配前面的字符n次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">m,n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">     匹配前面的字符至少m 次，至多n次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">,n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">      匹配前面的字符至多n次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">n,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">      匹配前面的字符至少n次</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ggle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">google</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gooooooooooooogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gagle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep &quot;g[o]*gle&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ggle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">google</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gooooooooooooogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep &quot;g[o].*gle&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">google</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gooooooooooooogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep &quot;g[o]\?gle&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ggle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep &quot;g[o]\+gle&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">google</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gooooooooooooogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep &quot;g[o]\{1,2\}gle&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">google</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep -E &quot;g[o]{10,}gle&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gooooooooooooogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># egrep &quot;g[o]{,10}gle&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ggle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gogle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">google</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>位置锚定：定位出现的位置</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">^                   行首锚定，用于模式的最左侧</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$                   行尾锚定，用于模式的最右侧</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">^PATTERN$           用于模式匹配整行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">^$                  空行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> or </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">b             词首锚定，用于单词模式的左侧</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> or </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">b             词尾锚定；用于单词模式的右侧</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">PATTERN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">           匹配整个PATTERN</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aaa</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bbb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">abcd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep ^a test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aaa</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">abcd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep b$ test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bbb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep ^$ test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep &quot;\&lt;a.*d\&gt;&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">abcd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>分组和后向引用</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">. 分组：</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> 将一个或多个字符捆绑在一起，当作一个整体进行处理</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部的变量中，这些变量的命名方式为: </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">. 后向引用</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   引用前面的分组括号中的模式所匹配字符，而非模式本身</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> 表示从左侧起第一个左括号以及与之配对右括号之间的模式所匹配到的字符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> 表示从左侧起第2个左括号以及与之配对右括号之间的模式所匹配到的字符，以此类推</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"> 表示前面的分组中所有字符</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">He beautifies his beauty.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">She beautifies her pretty.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep &quot;\(beau\).*\1&quot; test.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">He beautifies his beauty.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>扩展正则表达式</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">（1）字符匹配：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">  任意单个字符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">  指定范围的字符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">^</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> 不在指定范围的字符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   次数匹配：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> * ：匹配前面字符任意次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> ?  </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> 或1次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> + ：1 次或多次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> ：匹配m次 次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">m,n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> ：至少m ，至多n次</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">（2）位置锚定：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> ^ </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 行首</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> $ </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 行尾</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">b </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 语首</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">b </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 语尾</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   分组：</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> 后向引用：</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">（3）总结</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">　　除了</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">b </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 语首、</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">b </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> 语尾；使用其他正则都可以去掉</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">；上面有演示案例，不再进行演示</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="112sed-命令">1.1.2、sed 命令<a class="hash-link" href="#112sed-命令" title="标题的直接链接">​</a></h3><p>sed 是一个流式编辑器程序，其工作路线大致如下：</p><ol><li>它读取输入流(可以是文件、标准输入)的每一行放进模式空间(pattern space)，同时将此行行号通过 sed 行号计数器记录在内存中；</li><li>然后对模式空间中的行进行模式匹配，如果能匹配上则使用 sed 程序内部的命令进行处理，处理结束后，从模式空间中输出(默认)出去，并清空模式空间；</li><li>随后再从输入流中读取下一行到模式空间中进行相同的操作，直到输入流中的所有行都处理完成。由此可见，sed 是一个循环一个循环处理内容的。</li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1121sed-语法格式">1.1.2.1、sed 语法格式<a class="hash-link" href="#1121sed-语法格式" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> OPTIONS SCRIPT INPUT_STREAM</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其中 SCRIPT 部分就是所谓的 sed 脚本，它是 sed 内部命令的集合，sed 中的命令有些奇特，它包含行匹配以及要执行的命令。<ul><li>格式为 <code>ADDR1[,ADDR2]cmd_list</code></li><li>例如，要对第 2 行执行删除命令，其命令为 <code>sed 2d filename</code>，只输出第 4 行到 6 行，其命令为 <code>sed -n 4,6p</code>。</li></ul></li><li>既然 SCRIPT 是命令的集合，于是 sed 循环过程可以修改为如下：<ol><li>读取输入流的一行到模式空间</li><li>对模式空间中内容执行 SCRIPT(包括上面示例中的 &quot;2d&quot; 和 &quot;4,6p&quot;)</li><li>读取输入流的下一行到模式空间</li><li>对模式空间中内容执行 SCRIPT</li></ol></li></ul><p>其中 SCRIPT 部分包含了 sed 命令行中的内部命令，<strong>还包括两个特殊动作：自动输出和清空模式空间内容。这两个动作是一定会执行的</strong>，只不过有些时候通过某些命令可以使其输出空内容、使其清空不了模式空间。</p><p>如果使用编程结构来描述，则大致过程如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable number" style="color:rgb(9, 134, 88)">1</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token variable" style="color:rgb(9, 134, 88)">last_line_num</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable operator" style="color:rgb(0, 0, 0)">++</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$line</span><span class="token plain"> to pattern_space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> pattern_space is not null</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        execute cmd1 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        execute cmd2 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        execute cmd3 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        ……</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        auto_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        remove_pattern_space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>其中 while 循环执行的正是 SCRIPT 中的所有命令，只不过一般情况下，while 循环只执行一轮就退出并进入外层的 for 循环。</p></li><li><p>于是，外层的 for 循环称之为 &quot;sed循环&quot;，内层的 while 循环称之为 &quot;SCRIPT&quot; 循环。所以，for 循环只包含了两个动作：读取下一行和执行 SCRIPT 循环。</p></li><li><p>其实 while 循环中是有 continue、break 甚至是 exit 的，分别表示回到 SCRIPT 的顶端(即进入下一个 SCRIPT 循环)、退出当前 SCRIPT 循环回到外层 sed 循环以及退出整个 sed 循环。</p></li><li><p>最后，说明下 sed 命令行如何书写，其实就是写 SCRIPT 部分，这部分的写法比较灵活，大致有以下几种：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 一行式，多个命令使用分号分隔</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> Address</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">cmd1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">cmd2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">cmd3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 多个表达式时，可以使用&quot;-e&quot;选项，也可以不用，但使用分号分隔</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> Address1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">cmd1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">cmd2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">cmd3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">Address2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">cmd1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">cmd2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">cmd3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain">  -e </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;Address1{cmd1;cmd2;cmd3}&#x27;</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;Address2{cmd1;cmd2;cmd3}&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 分行写时</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> Address1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  cmd1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  cmd2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  cmd3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Address2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  cmd1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  cmd2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  cmd3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>如果是写在文件中，即 sed 脚本，以文件名为 a.sed 为例。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token shebang important">#!/usr/bin/sed -f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#注释行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Address1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">cmd1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">cmd2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Address2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">cmd1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">cmd2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其中 cmd 部分还可以进行模式匹配，也即类似于 &quot;Address{{pattern1}cmd1;{pattern2}cmd2}&quot; 的写法。例如，<code>/^abc/{2d;p}</code>。</li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1122options-选项">1.1.2.2、options 选项<a class="hash-link" href="#1122options-选项" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-n:             默认情况下，sed将在每轮script循环结束时自动输出模式空间中的内容。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                使用该选项后可以使得这次自动输出动作输出空内容，而不是当前模式空间中的内容。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                注意，</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-n&quot;</span><span class="token plain">是输出空内容而不是禁用输出动作，有些依赖于输出动作和输出流的地方，它们的区别是很大的。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-e SCRIPT       可以指定多个</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-e&quot;</span><span class="token plain">选项向SCRIPT中添加命令。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                可以省略</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-e&quot;</span><span class="token plain">选项，但如果命令行容易产生歧义，则使用</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-e&quot;</span><span class="token plain">选项可明确说明这部分是SCRIPT中的命令。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f SCRIPT-FILE  指定包含命令集合的SCRIPT文件，让sed根据SCRIPT文件中的命令集处理输入流。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">SUFFIX</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">      该选项指定要将sed的输出结果保存</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">覆盖的方式</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">到当前编辑的文件中。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                sed是通过创建一个临时文件并将处理后的结果写入到该临时文件，然后重命名为源文件来实现的。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                如果还提供了SUFFIX，则在重命名临时文件之前，先使用该SUFFIX修改源文件名，从而生成一个源文件的备份文件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                如果SUFFIX中包含了一个或多个字符</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;*&quot;</span><span class="token plain">，则每个</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;*&quot;</span><span class="token plain">都替换为原文件名</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">参见实例3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                该选项隐含了</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-s&quot;</span><span class="token plain">选项。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r              使用扩展正则表达式，而不是使用默认的基础正则表达式。sed所支持的扩展正则表达式和egrep一样。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s              默认情况下，如果为sed指定了多个输入文件，如sed OPTIONS SCRIPT file1 file2 file3，</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                则多个文件会被sed当作一个长的输入流，也就是说所有文件被当成一个大文件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                指定该选项后，sed将认为命令行中给定的每个文件都是独立的输入流。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>制作实验样本文件</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep -v &quot;^$&quot; /etc/fstab | grep -v &quot;^#$&quot; &gt; fstab.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">7d2ddfd1-f735-4176-b2a8-cf64cc13ffa0 /                       ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>实例 1：只输出 fstab.txt 第 4 行。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -n 4p fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这里使用了 &quot;-n&quot; 选项，使得读取到模式空间的每一行都无法被输出，只有明确使用了 &quot;p&quot; 选项才能被 &quot;p&quot; 动作输出。</li><li>上面的命令和 <code>sed -n -e 4p fstab.txt</code> 是完全一样的，因为 &quot;4p&quot; 在 sed 解析命令行时不会产生歧义，所以可以省略 &quot;-e&quot; 选项。</li></ul><p>实例 2：输出 fstab.txt，并输出每行的行号。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed &quot;=&quot; fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">7d2ddfd1-f735-4176-b2a8-cf64cc13ffa0 /                       ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>由于要输出 fstab.txt 的内容，所以不使用 &quot;-n&quot; 选项，同时 &quot;=&quot; 命令会输出每行行号。</li></ul><p>实例 3：输出 fstab.txt 第 4 行，并以 &quot;.bak&quot; 后缀备份源文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">7d2ddfd1-f735-4176-b2a8-cf64cc13ffa0 /                       ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -i&#x27;.bak&#x27; -n &#x27;4p&#x27; fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fstab.txt  fstab.txt.bak</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat fstab.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fstab.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -i&#x27;*-*.bak&#x27; -n &#x27;4p&#x27; fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fstab.txt  fstab.txt-fstab.txt.bak</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat fstab.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat fstab.txt-fstab.txt.bak </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">7d2ddfd1-f735-4176-b2a8-cf64cc13ffa0 /                       ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>实例 4：使用扩展正则表达式，输出 fstab.txt 包含连续 4 个以上大写字母的行。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">7d2ddfd1-f735-4176-b2a8-cf64cc13ffa0 /                       ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -r -n &quot;/[[:upper:]]{4,}/p&quot; fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">7d2ddfd1-f735-4176-b2a8-cf64cc13ffa0 /                       ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1123address-定址表达式">1.1.2.3、address 定址表达式<a class="hash-link" href="#1123address-定址表达式" title="标题的直接链接">​</a></h4><p>当 sed 将输入流中的行读取到模式空间后，就需要对模式空间中的内容进行匹配，如果能匹配就能执行对应的命令，如果不能匹配就直接输出、清空模式空间并进入下一个 sed 循环读取下一行。</p><p>匹配的过程称为定址。定址表达式有多种，但总的来说，其格式为 <code>[ADDR1][,ADDR2]</code>。这可以分为 3 种方式：</p><ol><li>ADDR1 和 ADDR2 都省略时，表示所有行都能被匹配上。</li><li>省略 ADDR2 时，表示只有被 ADDR1 表达式匹配上的行才符合条件。</li><li>不省略 ADDR2 时，是范围地址。表示从 ADDR1 匹配成功的行开始，到 ADDR2 匹配成功的行结束。</li></ol><p>无论是 ADDR1 还是 ADDR2，都可以使用两种方式进行匹配：行号和正则表达式。如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">N:              指定一个行号，sed将只匹配该行。</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-s&quot;</span><span class="token plain">或</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-i&quot;</span><span class="token plain">选项将对多个文件的行连续计数</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FIRST~STEP:     表示从第FIRST行开始，每隔STEP行就再取一次。也就是取行号满足FIRST+</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">N*STEP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">其中N</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">的行。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                因此，要选择所有奇数行，使用</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1~2&quot;</span><span class="token plain">；要从第2行开始每隔3行取一次，使用</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;2~3&quot;</span><span class="token plain">；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                要从第10行开始每隔5行取一次，使用</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;10~5&quot;</span><span class="token plain">；而</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;50~0&quot;</span><span class="token plain">则表示只取第50行。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$:              默认该符号匹配的是最后一个文件的最后一行。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                如果指定了</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-i&quot;</span><span class="token plain">或</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-s&quot;</span><span class="token plain">，则匹配的是每个文件的最后一行。总之，</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;$&quot;</span><span class="token plain">匹配的是每个输入流的最后一行。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/REGEXP/        将选择能被正则表达式REGEXP匹配的所有行。如果REGEXP中自身包含了字符</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/&quot;</span><span class="token plain">，则必须使用反斜线转义，即</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;\/&quot;</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/REGEXP/I       和</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/REGEXP/&quot;</span><span class="token plain">是一样的，只不过匹配的时候不区分大小写。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">%REGEXP%       这和上一个定址表达式的作用是一样的，只不过是使用符号</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;%&quot;</span><span class="token plain">替换了符号</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/&quot;</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                当REGEXP中包含</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/&quot;</span><span class="token plain">符号时，使用该定址表达式就无需对</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/&quot;</span><span class="token plain">使用反斜线</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">转义。</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">                但如果此时REGEXP中包含了&quot;</span><span class="token plain">%</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;符号时，该符号需要使用&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">&quot;转义。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ADDR1,+N        匹配ADDR1和其后的N行。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ADDR1,~N        匹配ADDR1和其后的行直到出现N的倍数行。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                倍数可为随意整数倍，只要N的倍数是最接近且大于ADDR1的即可。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                如ADDR1</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">,N</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">匹配1-3行，ADDR1</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">,N</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">匹配5-8行。而</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1,+3&quot;</span><span class="token plain">匹配的是第一行和其后的3行即1-4行。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在定址表达式的后面加&quot;!&quot;符号表示反转匹配的含义。也就是说那些匹配的行将不被选择，而是不匹配的行被选择。</li></ul><p>举几个实例：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">7d2ddfd1-f735-4176-b2a8-cf64cc13ffa0 /                       ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -n &#x27;3p&#x27; fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -n &#x27;3,5!p&#x27; fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -n &#x27;2,/^#.*/p&#x27; fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -n &#x27;2,/^#.*/!p&#x27; fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">7d2ddfd1-f735-4176-b2a8-cf64cc13ffa0 /                       ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1124command-功能命令">1.1.2.4、command 功能命令<a class="hash-link" href="#1124command-功能命令" title="标题的直接链接">​</a></h4><ol><li><p>强制输出命令 &quot;p&quot;</p><p>该命令能强制输出当前模式空间的内容。即使使用了 &quot;-n&quot; 选项。</p><p>事实上，它们本就不冲突，因为循环过程如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable number" style="color:rgb(9, 134, 88)">1</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token variable" style="color:rgb(9, 134, 88)">last_line_num</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable operator" style="color:rgb(0, 0, 0)">++</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$line</span><span class="token plain"> to pattern_space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> pattern_space is not null</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       execute cmd1 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       execute cmd2 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       ADDR1,ADDR2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># &quot;p&quot; command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       ……</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       auto_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       remove_pattern_space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>在 sed 处理的过程中，&quot;p&quot; 和 &quot;auto<!-- -->_<!-- -->print&quot; 是两个输出动作，都是输出当前模式空间的内容，只不过 auto<!-- -->_<!-- -->print 是隐含动作。</p></li><li><p>使用了 &quot;-n&quot; 选项，其所影响的动作仅是 &quot;auto<!-- -->_<!-- -->print&quot;，使其输出空内容。也因此，当没有使用 &quot;-n&quot; 选项时，模式空间的内容会被输出两次。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;abc\nxyz&quot; | sed -n 2p</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;abc\nxyz&quot; | sed 2p</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">abc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xyz    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 这是p命令输出的结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xyz    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 这是自动输出的结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>删除命令 &quot;d&quot;</p><p>命令 &quot;d&quot; 用于删除整个模式空间中的内容，并立即退出当前 SCRIPT 循环，进入下一个 sed 循环，即读取下一行。</p><p>循环大致格式如下:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable number" style="color:rgb(9, 134, 88)">1</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token variable" style="color:rgb(9, 134, 88)">last_line_num</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable operator" style="color:rgb(0, 0, 0)">++</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$line</span><span class="token plain"> to pattern_space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> pattern_space is not null</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       execute cmd1 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       execute cmd2 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       ADDR1,ADDR2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">delete</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">break</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)"># &quot;d&quot; command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       ……</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       auto_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       remove_pattern_space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>唯一需要注意的一点是立即退出当前 SCRIPT 循环，这意味着如果 &quot;d&quot; 命令后面还有其他的命令，则这些命令都不会执行。</p><p>举几个实例：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 删除fstab.txt中的第5行，并保存到原文件中，并备份原fstab.txt为fstab.txt.bak</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">7d2ddfd1-f735-4176-b2a8-cf64cc13ffa0 /                       ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -i&#x27;.bak&#x27; &#x27;5d&#x27; fstab.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat fstab.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 删除fstab.txt中包含&quot;#&quot;开头的注释行，但第一行的# /etc/fstab不删除。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat fstab.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Created by anaconda on Tue Aug 24 08:30:54 2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed &#x27;/^#/{1!d}&#x27; fstab.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">02d21f87-4742-4e2f-92c1-e8df1001a781 /boot                   ext4    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">67D1-D2C2          /boot/efi               vfat    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">umask</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0077,shortname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">winnt </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">UUID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">8272fd7c-6bfa-47d2-af97-429aa83ab510 swap                    swap    defaults        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 如果&quot;d&quot;后面还有命令，在删除模式空间后，这些命令不会执行，因为会立即退出当前SCRIPT循环。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;abc\nxyz&quot; | sed &#x27;{/abc/d;=}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其中 &quot;=&quot; 这个命令用于输出行号，但是结果并没有输出被 &quot;abc&quot; 匹配的行的行号。</li></ul></li><li><p>退出 sed 程序命令 &quot;q&quot; 和 &quot;Q&quot;</p><p>使用 &quot;q&quot; 和 &quot;Q&quot; 命令的作用是立即退出当前 sed 程序，使其不再执行后面的命令，也不再读取后面的行。因此，在处理大文件或大量文件时，使用 &quot;q&quot; 或 &quot;Q&quot; 命令能提高很大效率。</p><p>它们之间的不同之处在于 &quot;q&quot; 命令被执行后还会使用自动输出动作输出模式空间的内容，除非使用了 &quot;-n&quot; 选项。而 &quot;Q&quot; 命令则会立即退出，不会输出模式空间内容。另外，可以为它们指定退出状态码，例如 &quot;q 1&quot;。</p><p>使用了 &quot;q&quot; 和 &quot;Q&quot; 的 sed 循环结构大致如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># &quot;q&quot;命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable number" style="color:rgb(9, 134, 88)">1</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token variable" style="color:rgb(9, 134, 88)">last_line_num</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable operator" style="color:rgb(0, 0, 0)">++</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$line</span><span class="token plain"> to pattern_space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> pattern_space is not null</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       execute cmd1 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       execute cmd2 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       ADDR1,ADDR2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">auto_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">exit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)"># &quot;q&quot; command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       ……</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       auto_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       remove_pattern_space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># &quot;Q&quot;命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable number" style="color:rgb(9, 134, 88)">1</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token variable" style="color:rgb(9, 134, 88)">last_line_num</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable operator" style="color:rgb(0, 0, 0)">++</span><span class="token variable" style="color:rgb(9, 134, 88)">line</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$line</span><span class="token plain"> to pattern_space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> pattern_space is not null</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       execute cmd1 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       execute cmd2 </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> SCRIPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       ADDR1,ADDR2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">exit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># &quot;Q&quot; command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       ……</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       auto_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       remove_pattern_space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>举个例子：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 搜索脚本source.txt，当搜索到使用了&quot;.&quot;或&quot;source&quot;命令加载环境配置脚本时就输出并立即退出。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat source.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">source</span><span class="token plain"> /etc/profile.d/bash_completions</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"> /etc/init.d/functions</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ls</span><span class="token plain"> /etc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">cat</span><span class="token plain"> ~/.bashrc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -n -r &quot;/^[ \t]*(\.|source) /{p;q}&quot; source.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">source</span><span class="token plain"> /etc/profile.d/bash_completions</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -n -r &quot;/^[ \t]*(\.|source) /{p}&quot; source.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">source</span><span class="token plain"> /etc/profile.d/bash_completions</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"> /etc/init.d/functions</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>输出行号命令 &quot;=&quot;</p><p>&quot;=&quot; 命令用于输出最近被读取行的行号。在 sed 内部，使用行号计数器进行行号计数，每读取一行，行号计数器加 1。</p><p>计数器的值存储在内存中，在要求输出行号时，直接插入在输出流中的指定位置。由于值是存在于内存中，而非模式空间中，因此不受 &quot;-n&quot; 选项的影响。</p><p>这是一个依赖于输出流的命令，只要有输出动作就会追加在该输出流的尾部。</p><p>举个例子：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 搜索出httpd.conf中&quot;DocumentRoot&quot;开头的行的行号，允许有前导空白字符。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -n &#x27;/^[ \t]*DocumentRoot/{p;=}&#x27; httpd.conf </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">DocumentRoot </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/www/html&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">119</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>如果 &quot;=&quot; 命令前没有 &quot;p&quot; 输出命令，且没有使用 &quot;-n&quot; 选项，则行号输出在 Document 所在行的前一行，因为 SCRIPT 最后的自动输出动作也有输出流。</li></ul></li><li><p>字符一一对应替换命令 &quot;y&quot;</p><p>该命令和 &quot;tr&quot; 命令的映射功能一样，都是将字符进行一一替换。</p><p>举个例子：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 仔细观察，什么是一一映射替换，什么是整体替换，这个y命令和后面要讲的s命令要区分开</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;YESYesyEs&quot; | sed &#x27;y/YES/yes/&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">yesyesyes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;YESYesyEs&quot; | sed &#x27;s/YES/yes/&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">yesYesyEs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>替换命令 &quot;s&quot;</p><p>这是 sed 用的最多的命令。两个字就能概括其功能：替换。将匹配到的内容替换成指定的内容。</p><p>&quot;s&quot; 命令的语法格式为：其中 &quot;/&quot; 可以替换成任意其他单个字符。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">s/REGEXP/REPLACEMENT/FLAGS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>它使用 REGEXP 去匹配行，将匹配到的那部分字符替换成 REPLACEMENT。FLAGS 是 &quot;s&quot; 命令的修饰符，常见的有 &quot;g&quot;、&quot;p&quot; 和 &quot;i&quot; 或 &quot;I&quot;。</p><ul><li>&quot;g&quot;：表示替换行中所有能被 REGEXP 匹配的部分。不使用 g 时，默认只替换行中的第一个匹配内容。此外，&quot;g&quot; 还可以替换成一个数值 N，表示只替换行中第 N 个被匹配的内容。</li><li>&quot;p&quot;：输出替换后模式空间中的内容。</li><li>&quot;i&quot; 或 &quot;I&quot;：REGEXP 匹配时不区分大小写。</li></ul><p>REPLACEMENT 中可以使用 &quot;<!-- -->\<!-- -->N&quot;(N 是从 1 到 9 的整数) 进行后向引用，所代表的是 REGEXP 第 N 个括号 (...) 中匹配的内容。</p><p>举几个例子：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 删除sysctl.conf中所有&quot;#&quot;开头(可以包括前导空白)的注释符号&quot;#&quot;，第一行不处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat sysctl.conf </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># sysctl settings are defined through files in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Vendors settings live in /usr/lib/sysctl.d/.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># To override a whole file, create a new file with the same in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/sysctl.d/ and put new settings there. To override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># only specific settings, add a file with a lexically later</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># name in /etc/sysctl.d/ and put new settings there.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># For more information, see sysctl.conf(5) and sysctl.d(5).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed &#x27;2,$s/^[ \t]*#//&#x27; sysctl.conf </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># sysctl settings are defined through files in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Vendors settings live </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> /usr/lib/sysctl.d/.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">To override a whole file, create a new </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> with the same </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/sysctl.d/ and put new settings there. To override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">only specific settings, </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> a </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> with a lexically later</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">name </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> /etc/sysctl.d/ and put new settings there.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">For </span><span class="token function" style="color:rgb(0, 0, 255)">more</span><span class="token plain"> information, see sysctl.conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> and sysctl.d</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 为sysctl.conf文件中的第2行到最后一行的行首加上注释符号&quot;#&quot;。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat sysctl.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># sysctl settings are defined through files in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Vendors settings live </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> /usr/lib/sysctl.d/.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">To override a whole file, create a new </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> with the same </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/sysctl.d/ and put new settings there. To override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">only specific settings, </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> a </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> with a lexically later</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">name </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> /etc/sysctl.d/ and put new settings there.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">For </span><span class="token function" style="color:rgb(0, 0, 255)">more</span><span class="token plain"> information, see sysctl.conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> and sysctl.d</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed &#x27;2,$s/^/#/&#x27; sysctl.conf </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># sysctl settings are defined through files in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Vendors settings live in /usr/lib/sysctl.d/.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># To override a whole file, create a new file with the same in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/sysctl.d/ and put new settings there. To override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># only specific settings, add a file with a lexically later</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># name in /etc/sysctl.d/ and put new settings there.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># For more information, see sysctl.conf(5) and sysctl.d(5).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 将string.test中的love替换成like，对比思考</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat string.test </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">I love China love you love Country love you</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed &#x27;s/\blove\b/like/&#x27; string.test </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">I like China love you love Country love you</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed &#x27;s/\blove\b/like/g&#x27; string.test </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">I like China like you like Country like you</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 偿试将cmd2和cmd3位置对调</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;cmd1 &amp;&amp; cmd2 || cmd3&quot; | sed &#x27;s%&amp;&amp;\(.*\) || \(.*\)%%&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cmd1 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;cmd1 &amp;&amp; cmd2 || cmd3&quot; | sed &#x27;s%&amp;&amp;\(.*\) || \(.*\)%&amp;%&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cmd1 </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> cmd2 </span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"> cmd3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;cmd1 &amp;&amp; cmd2 || cmd3&quot; | sed &#x27;s%&amp;&amp;\(.*\) || \(.*\)%\&amp;\&amp; \2 ||\1%&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cmd1 </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> cmd3 </span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"> cmd2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这里使用了 &quot;%&quot; 代替 &quot;/&quot;，且第三句在 REPLACEMENT 部分对 &quot;&amp;&quot; 进行了转义，因为该符号在 REPLACEMENT 中表示的是引用 REGEXP 所匹配的所有内容。</li></ul></li><li><p>追加、插入和修改命令 &quot;a&quot;、&quot;i&quot;、&quot;c&quot;</p><p>这 3 个命令的格式是 &quot;<!-- -->[<!-- -->a|i|c<!-- -->]<!-- --> TEXT&quot;，表示将 TEXT 内容队列化到内存中，当有输出流或者说有输出动作的时候，半路追上输出流，分别追加、插入和替换到该输出流然后输出。</p><p>追加是指追加在输出流的尾部，插入是指插入在输出流的首部，替换是指将整个输出流替换掉。</p><p>&quot;c&quot; 命令和 &quot;a&quot;、&quot;i&quot; 命令有一丝不同，它替换结束后立即退出当前 SCRIPT 循环，并进入下一个 sed 循环，因此 &quot;c&quot; 命令后的命令都不会被执行。</p><p>举几个例子：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo -e &quot;you\nare\nsomething&quot; | sed &#x27;/you/a really&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">you</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">really</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">are</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">something</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其实 &quot;a&quot;、&quot;i&quot; 和 &quot;c&quot; 命令的 TEXT 部分写法是比较复杂的，如果TEXT只是几个简单字符，如上即可。</li><li>但如果要 TEXT 是分行文本，或者包含了引号，或者这几个命令是写在 &quot;{}&quot; 中的，则上面的写法就无法实现。</li><li>需要使用符号 &quot;<!-- -->\<!-- -->&quot; 来转义行尾符号，这表示开启一个新行，此后输入的内容都是 TEXT，直到遇到引号或者 &quot;;&quot; 开头的行时。</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 在#!/bin/bash后行追加# Script filename: bash.sh和空行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat bash.sh </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed &#x27;\@^#!/bin/bash@a\# Script filename: bash.sh\n&#x27; bash.sh </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Script filename: bash.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>使用 @ 替代 / 表述正则表达式，但是 @ 符号需要转义 <!-- -->\<!-- -->@。</p></li><li><p>&quot;a&quot; 命令后的第一个反斜线用于标记 TEXT 的开始，&quot;<!-- -->\<!-- -->n&quot; 用于添加空白行。如果分行写，或者 &quot;a&quot; 命令写在大括号 &quot;{}&quot; 中，则格式如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;\@^#!/bin/bash@a\</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)"># Script filename: bash.sh\n</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><span class="token plain"> bash.sh </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><em>说明：这 3 个命令的 TEXT 是存放在内存中的，不会进入模式空间，因此不受 &quot;-n&quot; 选项或某些命令的影响。此外，这 3 个命令依赖于输出流，只要有输出动作，不管是空输出流还是非空的输出流，只要有输出，这几个命令就会半路 &quot;劫杀&quot;。</em></p></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113awk-命令">1.1.3、awk 命令<a class="hash-link" href="#113awk-命令" title="标题的直接链接">​</a></h3><p>awk 是一种编程语言，用于在 linux/unix 下对文本和数据进行处理。数据可以来自标准输入(stdin)、一个或多个文件，或其它命令的输出。</p><p>它支持用户自定义函数和动态正则表达式等先进功能，是 linux/unix 下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。<strong>awk 有很多内建的功能</strong>，比如数组、函数等，这是它和 C 语言的相同之处，灵活性是 awk 最大的优势。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1131安装新版本-gawk">1.1.3.1、安装新版本 gawk<a class="hash-link" href="#1131安装新版本-gawk" title="标题的直接链接">​</a></h4><p>awk 有很多种版本，例如 nawk、gawk。gawk 是 GNU awk，它的功能很丰富。</p><p>本教程采用的是 gawk 4.2.0 版本，4.2.0 版本的 gawk 是一个比较大的改版，新支持的一些特性非常好用，而在低于 4.2.0 版本时这些语法可能会报错。所以，请先安装 4.2.0 版本或更高版本的 gawk。</p><p>查看系统自带 awk 版本</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk --version | grep &quot;GNU Awk&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">GNU Awk </span><span class="token number" style="color:rgb(9, 134, 88)">4.0</span><span class="token plain">.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里以安装 gawk 4.2.0 为例</p><ol><li><p>下载</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># wget --no-check-certificate https://mirrors.tuna.tsinghua.edu.cn/gnu/gawk/gawk-4.2.0.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>解压、进入解压后目录</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf gawk-4.2.0.tar.gz </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd gawk-4.2.0/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 gawk-4.2.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>编译，并执行安装目录为 /usr/local/gawk4.2</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 gawk-4.2.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./configure --prefix=/usr/local/gawk4.2 &amp;&amp; make &amp;&amp; make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>创建一个软链接：让 awk 指向刚新装的 gawk 版本</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 gawk-4.2.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ln -fsv /usr/local/gawk4.2/bin/gawk /usr/bin/awk</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">‘/usr/bin/awk’ -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> ‘/usr/local/gawk4.2/bin/gawk’</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 gawk-4.2.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>此时，调用 awk 将调用新版本的 gawk，调用 gawk 将调用旧版本的 gawk</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk --version | grep &quot;GNU Awk&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">GNU Awk </span><span class="token number" style="color:rgb(9, 134, 88)">4.2</span><span class="token plain">.0, API: </span><span class="token number" style="color:rgb(9, 134, 88)">2.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># gawk --version | grep &quot;GNU Awk&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">GNU Awk </span><span class="token number" style="color:rgb(9, 134, 88)">4.0</span><span class="token plain">.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1132awk-用例文件">1.1.3.2、awk 用例文件<a class="hash-link" href="#1132awk-用例文件" title="标题的直接链接">​</a></h4><p>整个 awk 的讲解都会用到如下示例文件 a.txt</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1133awk-用法入门">1.1.3.3、awk 用法入门<a class="hash-link" href="#1133awk-用法入门" title="标题的直接链接">​</a></h4><p>简单来说，awk 的语法格式如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;awk_program&#x27;</span><span class="token plain"> a.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>单引号包围的是 awk 代码，也称为 awk 程序。<ul><li>最好使用单引号，因为在 awk 中经常使用 <code>$</code> 符号，<code>$</code> 既可以被 shell 解析，也可以被 awk 解析，而双引号属于弱引用，单引号属于强引用，这里必须使用强引用的单引号，使得 <code>$</code> 仅被 awk 解析。</li></ul></li><li>a.txt 是 awk 要读取的文件，可以是 0 个文件或一个文件，也可以是多个文件。<ul><li>不给定文件则可以从标准输入读取</li></ul></li><li>awk 程序中，大量使用大括号，大括号表示代码块，多个代码块之间可以连用，代码块内部的多个语句需要使用 &quot;;&quot; 分隔。</li></ul><p>awk 示例：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 输出a.txt中的每一行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{print $0}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 多个代码块，代码块中多个语句</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 输出每行之后还输出两行：hello行和world行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{print $0}{print &quot;hello&quot;;print &quot;world&quot;}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">world</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>对于 <code>awk &#x27;{print $0}&#x27; a.txt</code> ，它类似于 shell 的 while 循环 <code>while read line;do echo &quot;$line&quot;;done &lt;a.txt</code>。</li></ul><p>下面再分析该 awk 命令的执行过程：</p><ol><li>读取文件第一行( awk 默认按行读取文件 )。</li><li>将所读取的行赋值给 awk 的变量 <code>$0</code>，于是 <code>$0</code> 中保存的就是本次所读取的行数据。</li><li>进入代码块 <code>print $0</code> 并执行其中代码 <code>print $0</code>，即输出 <code>$0</code>，也即输出当前所读取的行。</li><li>执行完本次代码之后，进入下一轮 awk 循环：继续读取下一行(第二行)<ul><li>将第二行赋值给变量 <code>$0</code></li><li>进入代码块执行 <code>print $0</code></li><li>执行完代码块后再次进入下一轮 awk 循环，即读取第三行，然后赋值给 <code>$0</code>，再执行代码块</li><li>…不断循环，直到读完文件所有数据…</li></ul></li><li>退出 awk</li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1134begin-和-end-语句块">1.1.3.4、BEGIN 和 END 语句块<a class="hash-link" href="#1134begin-和-end-语句块" title="标题的直接链接">​</a></h4><p>awk 的所有代码( 目前这么认为 )都是写在语句块中的。</p><p>例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;{print $0}&#x27;</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;{print $0}{print $0;print $0}&#x27;</span><span class="token plain"> a.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>每个语句块前面可以有 pattern，所以格式为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">pattern1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">statement1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">pattern2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">statement3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">statement4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>语句块可分为 3 类：BEGIN 语句块、END 语句块和 main 语句块。<ul><li>其中 BEGIN 语句块和 END 语句块格式分别为 BEGIN{...} 和 END{...}，而 main 语句块是一种统称，它的 pattern 部分没有固定格式，也可以省略，main 代码块是在读取文件的每一行的时候都执行的代码块。</li></ul></li></ul><p>分析下面三个 awk 命令的执行结果：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print &quot;我在前面&quot;}{print $0}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">我在前面</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;END{print &quot;我在后面&quot;}{print $0}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">我在后面</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print &quot;我在前面&quot;}{print $0}END{print &quot;我在后面&quot;}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">我在前面</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">我在后面</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>根据上面 3 行命令的执行结果，可总结出如下有关于 BEGIN、END 和 main 代码块的特性：</p><ul><li>BEGIN 代码块：<ul><li>在读取文件<strong>之前</strong>执行，且执行一次</li><li>在 BEGIN 代码块中，无法使用 <code>$0</code> 或其它一些特殊变量</li></ul></li><li>main 代码块：<ul><li>读取文件时循环执行，(默认情况)每读取一行，就执行一次 main 代码块</li><li>main 代码块可有多个</li></ul></li><li>END 代码块：<ul><li>在读取文件完成<strong>之后</strong>执行，且执行一次</li><li>有 END 代码块，必须要有读取的数据(可以是标准输入)</li><li>END 代码块中可以使用 <code>$0</code> 等一些特殊变量，只不过这些特殊变量保存的是最后一轮 awk 循环的数据</li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1135awk-命令行结构和语法结构">1.1.3.5、awk 命令行结构和语法结构<a class="hash-link" href="#1135awk-命令行结构和语法结构" title="标题的直接链接">​</a></h4><blockquote><p>awk 命令行结构</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -- </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> program-text </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> -f program-file </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -- </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> -e program-text </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -- </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>program-text 即 awk 命令行中的 awk 代码部分，一般使用单引号包围</li><li>-<!-- -->f program-file 表示将 awk 代码部分写在文件中，然后使用 -f 选项去引用这个文件</li><li>-<!-- -->e program-text 也用于指定 awk 代码，但是既要 -f 指定代码文件，又要用命令行 awk 代码，则必须同时使用 -f 和 -e，即 <code>awk -f file -e &#x27;awk_code&#x27;</code>。</li></ul><blockquote><p>awk 语法结构</p></blockquote><p>awk 语法结构即 awk 代码部分的结构。</p><p>awk 的语法充斥着 <code>pattern{action}</code> 的模式，它们称为 awk rule。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{n=3} /^[0-9]/&amp;&amp;$1&gt;5{print $1} /Alice/{print &quot;Alice&quot;} END{print &quot;hello&quot;}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Alice</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hello</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>上面示例中，有 BEGIN 语句块，有 END 语句块，还有 2 个 main 代码块，两个 main 代码块都使用了正则表达式作为 pattern。</li></ul><p>关于 awk 的语法：</p><ul><li>多个 <code>pattern{action}</code> 可以直接连用</li><li>action 中多个语句如果写在同一行，则需使用分号分隔</li><li>pattern 部分用于筛选行，action 表示在筛选通过后执行的操作</li><li>pattern 和 action 都可以省略<ul><li>省略 pattern，等价于对每一行数据都执行 action</li><li>例如：<code>awk &#x27;{print $0}&#x27; a.txt</code></li><li>省略代码块 <code>action</code>，等价于 <code>print</code> 即输出所有行</li><li>例如：<code>awk &#x27;/Alice/&#x27; a.txt</code> 等价于 <code>awk &#x27;/Alice/{print $0}&#x27; a.txt</code></li><li>省略代码块中的 <code>action</code>，表示对筛选的行什么都不做</li><li>例如：<code>awk &#x27;/Alice/{}&#x27; a.txt</code></li><li><code>pattern{action}</code> 任何一部分都可以省略</li><li>例如：<code>awk &#x27;&#x27; a.txt</code></li></ul></li></ul><blockquote><p>pattern 和 action</p></blockquote><p>对于 <code>pattern{action}</code> 语句结构(都称之为语句块)，其中的 pattern 部分可以使用下面列出的模式：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 特殊pattern</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">END</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 布尔pattern</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/regular expression/            </span><span class="token comment" style="color:rgb(0, 128, 0)"># 正则匹配成功与否 /a.*ef/{action}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">relational expression           </span><span class="token comment" style="color:rgb(0, 128, 0)"># 即等值比较、大小比较 3&gt;2{action}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pattern </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> pattern              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 逻辑与 3&gt;2 &amp;&amp; 3&gt;1 {action}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pattern </span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"> pattern              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 逻辑或 3&gt;2 || 3&lt;1 {action}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"> pattern                       </span><span class="token comment" style="color:rgb(0, 128, 0)"># 逻辑取反 !/a.*ef/{action}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">pattern</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">                       </span><span class="token comment" style="color:rgb(0, 128, 0)"># 改变优先级</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pattern ? pattern </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> pattern     </span><span class="token comment" style="color:rgb(0, 128, 0)"># 三目运算符决定的布尔值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 范围pattern，非布尔代码块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pattern1, pattern2              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 范围，pat1打开、pat2关闭，即flip,flop模式</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>action 部分，可以是任何语句，例如 print。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1136awk-读取行的细节">1.1.3.6、awk 读取行的细节<a class="hash-link" href="#1136awk-读取行的细节" title="标题的直接链接">​</a></h4><p>awk 读取输入文件时，每次读取一条记录(record)(默认情况下按行读取，所以此时记录就是行)。每读取一条记录，将其保存到 <code>$0</code> 中，然后执行一次 main 代码段。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;{print $0}&#x27;</span><span class="token plain"> a.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果是空文件，则因为无法读取到任何一条记录，将导致直接关闭文件，而不会进入 main 代码段。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># touch x.log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{print &quot;hello world&quot;}&#x27; x.log </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可设置表示输入记录分隔符的预定义变量 RS(Record Separator) 来改变每次读取的记录模式。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># RS=&quot;\n&quot; 、 RS=&quot;m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;BEGIN{RS=&quot;\n&quot;}{print $0}&#x27;</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;BEGIN{RS=&quot;m&quot;}{print $0}&#x27;</span><span class="token plain"> a.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>RS 通常设置在 BEGIN 代码块中，因为要先于读取文件确定好 RS 分隔符。</p><p>RS 指定输入记录分隔符时，所读取的记录中是不包含分隔符字符的。例如 RS=&quot;a&quot;，则 $0 中一定不可能出现字符 a。</p><p>RS 两种可能情况：</p><ul><li>RS 为单个字符：直接使用该字符来分割记录。</li><li>RS 为多个字符：将其当作正则表达式，只要匹配正则表达式的符号，都用来分割记录。<ul><li>设置预定义变量 IGNORECASE 为非零值，正则表达式匹配时表示忽略大小写。</li><li>兼容模式下，只有首字符才生效，不会使用正则模式去分割记录。</li></ul></li></ul><p>特殊的 RS 值用来解决特殊读取需求：</p><ul><li><code>RS=&quot;&quot;</code>：按段落读取</li><li><code>RS=&quot;\0&quot;</code>：一次性读取所有数据，但有些特殊文件中包含了空字符 <code>\0</code></li><li><code>RS=&quot;^$&quot;</code>：真正的一次性读取所有数据，因为非空文件不可能匹配成功</li><li><code>RS=&quot;\n+&quot;</code>：按行读取，但忽略所有空行</li></ul><p>示例：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 按段落读取：RS=&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{RS=&quot;&quot;}{print $0&quot;------&quot;}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain">------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 一次性读取所有数据：RS=&#x27;\0&#x27; RS=&quot;^$&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{RS=&#x27;\0&#x27;}{print $0&quot;------&quot;}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{RS=&quot;^$&quot;}{print $0&quot;------&quot;}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 忽略空行：RS=&#x27;\n+&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{RS=&quot;\n+&quot;}{print $0&quot;-------&quot;}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 忽略大小写：预定义变量IGNORECASE设置为非0值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{IGNORECASE=1}{print $0&quot;-------&quot;}&#x27; RS=&#x27;[ab]&#x27; a.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>预定义变量 RT：</p><ul><li><p>在 awk 每次读完一条记录时，会设置一个称为 RT 的预定义变量，表示 Record Termination。</p></li><li><p>当 RS 为单个字符时，RT 的值和 RS 的值是相同的。</p></li><li><p>当 RS 为多个字符(正则表达式)时，则 RT 设置为正则匹配到记录分隔符之后，真正用于划分记录时的字符。</p></li><li><p>当无法匹配到记录分隔符时，RT 设置为控制空字符串(即默认的初始值)。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{RS=&quot;(fe)?male&quot;}{print RT}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><blockquote><p>两种行号：NR 和 FNR</p></blockquote><p>在读取每条记录之后，将其赋值给 $0，同时还会设置 NR、FNR、RT。</p><ul><li>NR：所有文件的行号计数器</li><li>FNR：是各个文件的行号计数器</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{print NR}&#x27; a.txt a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{print FNR}&#x27; a.txt a.txt </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1137awk-划分字段">1.1.3.7、awk 划分字段<a class="hash-link" href="#1137awk-划分字段" title="标题的直接链接">​</a></h4><p>awk 读取每一条记录之后，会将其赋值给 <code>$0</code>，同时还会对这条记录按照 <code>预定义变量 FS</code> 划分字段，将划分好的各个字段分别赋值给 <code>$1 $2 $3 $4...$N</code>，同时将划分的字段数量赋值给 <code>预定义变量NF</code>。</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11371引用字段的方式">1.1.3.7.1、引用字段的方式<a class="hash-link" href="#11371引用字段的方式" title="标题的直接链接">​</a></h5><p><code>$N</code> 引用字段：</p><ul><li><code>N=0</code>：即 <code>$0</code>，引用记录本身</li><li><code>0&lt;N&lt;=NF</code>：引用对应字段</li><li><code>N&gt;NF</code>：表示引用不存在的字段，返回空字符串</li><li><code>N&lt;0</code>：报错</li></ul><p>可使用变量或计算的方式指定要获取的字段序号。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{n=5;print $5}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">email</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">abc@qq.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">def@gmail.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aaa@163.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bbb@189.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ccc@xyz.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ddd@139.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">exdsa@189.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bax@qq.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bc@sohu.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bcbd@139.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{print $(2+2)}&#x27; a.txt  # 括号必不可少，用于改变优先级</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">age</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{print $(NF-3)}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gender</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11372分割字段的方式">1.1.3.7.2、分割字段的方式<a class="hash-link" href="#11372分割字段的方式" title="标题的直接链接">​</a></h5><p>读取 record 之后，将使用预定义变量 FS、FIELDWIDTHS 或 FPAT 中的一种来分割字段。分割完成之后，再进入 main 代码段(所以，在 main 中设置 FS 对本次已经读取的 record 是没有影响的，但会影响下次读取)。</p><blockquote><p>划分字段方式(一)：FS 或 -F</p></blockquote><p><code>FS</code> 或者 <code>-F</code>：字段分隔符</p><ul><li>FS 为单个字符时，该字符即为字段分隔符</li><li>FS 为多个字符时，则采用正则表达式模式作为字段分隔符</li><li>特殊的，也是 FS 默认的情况，FS 为单个空格时，将以连续的空白（空格、制表符、换行符）作为字段分隔符</li><li>特殊的，FS 为空字符串 ”” 时，将对每个字符都进行分隔，即每个字符都作为一个字段</li><li>设置预定义变量 IGNORECASE 为非零值，正则匹配时表示忽略大小写(只影响正则，所以 FS 为单字时无影响)</li><li>如果 record 中无法找到 FS 指定的分隔符(例如将 FS 设置为 &quot;<!-- -->\<!-- -->n&quot;)，则整个记录作为一个字段，即 <code>$1</code> 和 <code>$0</code> 相等</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 字段分隔符指定为单个字符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk -F&quot;:&quot; &#x27;{print $1}&#x27; /etc/passwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{FS=&quot;:&quot;}{print $1}&#x27; /etc/passwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 字段分隔符指定为正则表达式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{FS=&quot; +|@&quot;}{print $1,$2,$3,$4,$5,$6}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID name gender age email phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> Bob male </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain"> abc qq.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> Alice female </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> def gmail.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> Tony male </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"> aaa </span><span class="token number" style="color:rgb(9, 134, 88)">163</span><span class="token plain">.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> Kevin male </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"> bbb </span><span class="token number" style="color:rgb(9, 134, 88)">189</span><span class="token plain">.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> Alex male </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> ccc xyz.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> Andy female </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> ddd </span><span class="token number" style="color:rgb(9, 134, 88)">139</span><span class="token plain">.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> Jerry female </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain"> exdsa </span><span class="token number" style="color:rgb(9, 134, 88)">189</span><span class="token plain">.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> Peter male </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"> bax qq.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"> Steven female </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bc</span><span class="token plain"> sohu.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> Bruce female </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain"> bcbd </span><span class="token number" style="color:rgb(9, 134, 88)">139</span><span class="token plain">.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>划分字段方式(二)：FIELDWIDTHS</p></blockquote><p>指定预定义变量 FIELDWIDTHS 按字符宽度分割字段，这是 gawk 提供的高级功能。在处理某字段缺失时非常好用。</p><ul><li>FIELDWIDTHS=&quot;3 5 6 9&quot; 表示第一个字段读 3 个字符，第二个字段 5 字符...</li><li>FIELDWIDTHS=&quot;8 1:5 6 2:33&quot; 表示：<ul><li>第一个字段读 8 个字符</li><li>然后跳过 1 个字符再读 5 个字符作为第二个字段</li><li>然后读 6 个字符作为第三个字段</li><li>然后跳过 2 个字符，再读 33 个字符作为第四个字段(不足 33 个字符，读到结尾)</li></ul></li><li>FIELDWIDTHS=&quot;2 3 <!-- -->*<!-- -->&quot;:<ul><li>第一个字段 2 个字符</li><li>第二个字段 3 个字符</li><li>剩余所有字符作为第三个字段</li><li>星号只能放在最后，且只能单独使用，表示剩余所有</li></ul></li></ul><p>实例 1：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 没取完的字符串DDD被丢弃，且NF=3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{FIELDWIDTHS=&quot;2 3 2&quot;}{print $1,$2,$3,$4}&#x27; &lt;&lt;&lt; &quot;AABBBCCDDDD&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AA BBB CC </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 字符串不够长度时无视</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{FIELDWIDTHS=&quot;2 3 2 100&quot;}{print $1,$2,$3,$4&quot;-&quot;}&#x27; &lt;&lt;&lt;&quot;AABBBCCDDDD&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AA BBB CC DDDD-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># *号取剩余所有，NF=3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{FIELDWIDTHS=&quot;2 3 *&quot;}{print $1,$2,$3}&#x27; &lt;&lt;&lt;&quot;AABBBCCDDDD&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AA BBB CCDDDD</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 字段数多了，则取完字符串即可，NF=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{FIELDWIDTHS=&quot;2 30 *&quot;}{print $1,$2,NF}&#x27; &lt;&lt;&lt;&quot;AABBBCCDDDD&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AA BBBCCDDDD </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>实例 2：处理某些字段缺失的数据</p><p>如果按照常规的 FS 进行字段分割，则对于缺失字段的行和没有缺失字段的行很难统一处理，但使用 FIELDWIDTHS 则非常方便。</p><p>假设 a.txt 文本内容如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">                  </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为 email 字段有的是空字段，所以直接用 FS 划分字段不便处理。可使用 FIELDWIDTHS。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 字段1：4字符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 字段2：8字符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 字段3：8字符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 字段4：2字符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 字段5：先跳过3字符，再读13字符，该字段13字符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 字段6：先跳过2字符，再读11字符，该字段11字符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">FIELDWIDTHS</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;4 8 8 2 3:13 2:11&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NR</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&lt;&quot;</span><span class="token variable" style="color:rgb(9, 134, 88)">$1</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&gt;&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&lt;&quot;</span><span class="token variable" style="color:rgb(9, 134, 88)">$2</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&gt;&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&lt;&quot;</span><span class="token variable" style="color:rgb(9, 134, 88)">$3</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&gt;&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&lt;&quot;</span><span class="token variable" style="color:rgb(9, 134, 88)">$4</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&gt;&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&lt;&quot;</span><span class="token variable" style="color:rgb(9, 134, 88)">$5</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&gt;&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&lt;&quot;</span><span class="token variable" style="color:rgb(9, 134, 88)">$6</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27; a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&lt;1   &gt; &lt;Bob     &gt; &lt;male    &gt; &lt;28&gt; &lt;abc@qq.com   &gt; &lt;18023394012&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&lt;2   &gt; &lt;Alice   &gt; &lt;female  &gt; &lt;24&gt; &lt;def@gmail.com&gt; &lt;18084925203&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&lt;3   &gt; &lt;Tony    &gt; &lt;male    &gt; &lt;21&gt; &lt;aaa@163.com  &gt; &lt;17048792503&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&lt;4   &gt; &lt;Kevin   &gt; &lt;male    &gt; &lt;21&gt; &lt;bbb@189.com  &gt; &lt;17023929033&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&lt;5   &gt; &lt;Alex    &gt; &lt;male    &gt; &lt;18&gt; &lt;             &gt; &lt;18185904230&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&lt;6   &gt; &lt;Andy    &gt; &lt;female  &gt; &lt;22&gt; &lt;ddd@139.com  &gt; &lt;18923902352&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&lt;7   &gt; &lt;Jerry   &gt; &lt;female  &gt; &lt;25&gt; &lt;exdsa@189.com&gt; &lt;18785234906&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&lt;8   &gt; &lt;Peter   &gt; &lt;male    &gt; &lt;20&gt; &lt;bax@qq.com   &gt; &lt;17729348758&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&lt;9   &gt; &lt;Steven  &gt; &lt;female  &gt; &lt;23&gt; &lt;bc@sohu.com  &gt; &lt;15947893212&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&lt;10  &gt; &lt;Bruce   &gt; &lt;female  &gt; &lt;27&gt; &lt;bcbd@139.com &gt; &lt;13942943905&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">[root@arm64v8 ~]#</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)"># 如果email为空，则输出它</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">[root@arm64v8 ~]# awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">FIELDWIDTHS</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;4 8 8 2 3:13 2:11&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> NR</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token variable" style="color:rgb(9, 134, 88)">$5</span><span class="token plain"> ~ /^ +$/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">print </span><span class="token variable" style="color:rgb(9, 134, 88)">$0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27; a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">                  </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>划分字段方式(三)：FPAT</p></blockquote><p>FS 是指定字段分隔符，来取得除分隔符外的部分作为字段。</p><p>FPAT 是取得匹配的字符部分作为字段。它是 gawk 提供的一个高级功能。</p><p>FPAT 根据指定的正则来全局匹配 record，然后将所有匹配成功的部分组成 <code>$1、$2...</code>，不会修改 <code>$0</code>。</p><ul><li><code>awk &#x27;BEGIN{FPAT=&quot;[0-9]+&quot;}{print $3&quot;-&quot;}&#x27; a.txt</code></li><li>之后再设置 FS 或 FPAT，该变量将失效</li></ul><p>FPAT 常用于字段中包含了字段分隔符的场景。例如，CSV 文件中的一行数据如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Robbins,Arnold,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1234 A Pretty Street, NE&quot;</span><span class="token plain">,MyTown,MyState,12345-6789,USA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中逗号分隔每个字段，但双引号包围的是一个字段整体，即使其中有逗号。</p><p>这时使用 FPAT 来划分各字段比使用 FS 要方便的多。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27;Robbins,Arnold,&quot;1234 A Pretty Street, NE&quot;,MyTown,MyState,12345-6789,USA&#x27; | awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">FPAT</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;[^,]*|(</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">[^</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">]*</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">)&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">NF+1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">i++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&lt;&quot;</span><span class="token variable" style="color:rgb(9, 134, 88)">$i</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Robbins</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Arnold</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1234 A Pretty Street, NE&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">MyTown</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">MyState</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token number" style="color:rgb(9, 134, 88)">12345</span><span class="token plain">-678</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">9</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">USA</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后，patsplit() 函数和 FPAT 的功能一样。</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11373检查字段划分的方式">1.1.3.7.3、检查字段划分的方式<a class="hash-link" href="#11373检查字段划分的方式" title="标题的直接链接">​</a></h5><p>有 FS、FIELDWIDTHS、FPAT 三种获取字段的方式，可使用 PROCINFO 数组来确定本次使用何种方式获得字段。</p><p>PROCINFO 是一个数组，记录了 awk 进程工作时的状态信息。</p><ul><li><code>PROCINFO[&quot;FS&quot;]==&quot;FS&quot;</code>，表示使用 FS 分割获取字段</li><li><code>PROCINFO[&quot;FPAT&quot;]==&quot;FPAT&quot;</code>，表示使用FPAT匹配获取字段</li><li><code>PROCINFO[&quot;FIELDWIDTHS&quot;]==&quot;FIELDWIDTHS&quot;</code>，表示使用 FIELDWIDTHS 分割获取字段</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">PROCINFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;FS&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;FS&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.FS spliting</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">PROCINFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;FPAT&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;FPAT&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.FPAT spliting</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">PROCINFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;FIELDWIDTHS&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;FIELDWIDTHS&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.FIELDWIDTHS spliting</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11380-重新计算">1.1.3.8、$0 重新计算<a class="hash-link" href="#11380-重新计算" title="标题的直接链接">​</a></h4><blockquote><p>修改字段或 NF 值的联动效应</p></blockquote><p>注意下面的分割和计算两词：分割表示使用 FS（field Separator），计算表示使用预定义变量 OFS（Output Field Separator）。</p><ul><li><p>修改 <code>$0</code>，将使用 FS 重新分割字段，所以会影响 <code>$1、$2...</code></p></li><li><p>修改 <code>$1、$2</code>，将根据 <code>$1</code> 到 <code>$NF</code> 等各字段来重新计算 <code>$0</code></p><ul><li>即使是 <code>$1 = $1</code> 这样的原值不变的修改，也一样会重新计算 <code>$0</code></li></ul></li><li><p>为不存在的字段赋值，将新增字段按需使用空字符串填充中间的字段，并使用 <code>OFS</code> 重新计算 <code>$0</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{OFS=&quot;-&quot;}{$(NF+2)=5;print $0}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID-name-gender-age-email-phone--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">-Bob-male-28-abc@qq.com-18023394012--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">-Alice-female-24-def@gmail.com-18084925203--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">-Tony-male-21-aaa@163.com-17048792503--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">-Kevin-male-21-bbb@189.com-17023929033--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">-Alex-male-18-ccc@xyz.com-18185904230--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">-Andy-female-22-ddd@139.com-18923902352--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">-Jerry-female-25-exdsa@189.com-18785234906--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">-Peter-male-20-bax@qq.com-17729348758--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">-Steven-female-23-bc@sohu.com-15947893212--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">-Bruce-female-27-bcbd@139.com-13942943905--5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>注意后面的 <code>--5</code>，原本 a.txt 文件每行只有 6 个字段，通过 <code>$(NF+2)=5</code> 重新计算后，共 8 个字段，第 7 个字段为空。</li></ul></li><li><p>增加 NF 值，将使用空字符串新增字段，并使用 <code>OFS</code> 重新计算 <code>$0</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{OFS=&quot;-&quot;}{NF+=3;print $0}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID-name-gender-age-email-phone---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">-Bob-male-28-abc@qq.com-18023394012---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">-Alice-female-24-def@gmail.com-18084925203---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">-Tony-male-21-aaa@163.com-17048792503---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">-Kevin-male-21-bbb@189.com-17023929033---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">-Alex-male-18-ccc@xyz.com-18185904230---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">-Andy-female-22-ddd@139.com-18923902352---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">-Jerry-female-25-exdsa@189.com-18785234906---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">-Peter-male-20-bax@qq.com-17729348758---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">-Steven-female-23-bc@sohu.com-15947893212---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">-Bruce-female-27-bcbd@139.com-13942943905---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>通过 <code>NF+=3</code>，重新计算后最终共 9 个字段，最后三个字段为空。</li></ul></li><li><p>减小 NF 值，将丢弃一定数量的尾部字段，并使用 <code>OFS</code> 重新计算 <code>$0</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{OFS=&quot;-&quot;}{NF-=3;print $0}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID-name-gender</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">-Bob-male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">-Alice-female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">-Tony-male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">-Kevin-male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">-Alex-male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">-Andy-female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">-Jerry-female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">-Peter-male</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">-Steven-female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">-Bruce-female</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>通过 <code>NF -=3</code>，重新计算后最终共 3 个字段。</li></ul></li></ul><blockquote><p>关于$0</p></blockquote><p>当读取一条 record 之后，将原原本本地被保存到 <code>$0</code> 当中。但是，只要出现了上面所说的任何一种导致 <code>$0</code> 重新计算的操作，都会立即使用 OFS 去重建 <code>$0</code>。</p><p>换句话说，没有导致 <code>$0</code> 重建，<code>$0</code> 就一直是原原本本的数据，所以指定 OFS 也无效。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;BEGIN{OFS=&quot;-&quot;}{print $0}&#x27;</span><span class="token plain"> a.txt  </span><span class="token comment" style="color:rgb(0, 128, 0)"># OFS此处无效</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当 <code>$0</code> 重建后，将自动使用 OFS 重建，所以即使没有指定 OFS，它也会采用默认值(空格)进行重建。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{$1=$1; print $0}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID name gender age email phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> Bob male </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain"> abc@qq.com </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> Alice female </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> def@gmail.com </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> Tony male </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"> aaa@163.com </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> Kevin male </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"> bbb@189.com </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> Alex male </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> ccc@xyz.com </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> Andy female </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> ddd@139.com </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> Jerry female </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain"> exdsa@189.com </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> Peter male </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"> bax@qq.com </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"> Steven female </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> bc@sohu.com </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> Bruce female </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain"> bcbd@139.com </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{print $0; $1=$1; print $0}&#x27; OFS=&quot;-&quot; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID-name-gender-age-email-phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">-Bob-male-28-abc@qq.com-18023394012</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">-Alice-female-24-def@gmail.com-18084925203</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">-Tony-male-21-aaa@163.com-17048792503</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">-Kevin-male-21-bbb@189.com-17023929033</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">-Alex-male-18-ccc@xyz.com-18185904230</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">-Andy-female-22-ddd@139.com-18923902352</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">-Jerry-female-25-exdsa@189.com-18785234906</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">-Peter-male-20-bax@qq.com-17729348758</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">-Steven-female-23-bc@sohu.com-15947893212</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">-Bruce-female-27-bcbd@139.com-13942943905</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果重建 <code>$0</code> 之后，再去修改 OFS，将对当前行无效，但对之后的行有效。所以如果也要对当前行生效，需要再次重建。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># OFS对第一行无效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{$4+=10;OFS=&quot;-&quot;;print $0}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID name gender </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> email phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">-Bob-male-38-abc@qq.com-18023394012</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">-Alice-female-34-def@gmail.com-18084925203</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">-Tony-male-31-aaa@163.com-17048792503</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">-Kevin-male-31-bbb@189.com-17023929033</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">-Alex-male-28-ccc@xyz.com-18185904230</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">-Andy-female-32-ddd@139.com-18923902352</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">-Jerry-female-35-exdsa@189.com-18785234906</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">-Peter-male-30-bax@qq.com-17729348758</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">-Steven-female-33-bc@sohu.com-15947893212</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">-Bruce-female-37-bcbd@139.com-13942943905</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 对所有行有效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{$4+=10;OFS=&quot;-&quot;;$1=$1;print $0}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID-name-gender-10-email-phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">-Bob-male-38-abc@qq.com-18023394012</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">-Alice-female-34-def@gmail.com-18084925203</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">-Tony-male-31-aaa@163.com-17048792503</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">-Kevin-male-31-bbb@189.com-17023929033</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">-Alex-male-28-ccc@xyz.com-18185904230</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">-Andy-female-32-ddd@139.com-18923902352</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">-Jerry-female-35-exdsa@189.com-18785234906</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">-Peter-male-30-bax@qq.com-17729348758</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">-Steven-female-33-bc@sohu.com-15947893212</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">-Bruce-female-37-bcbd@139.com-13942943905</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>关注 <code>$0</code> 重建是一个非常有用的技巧。</p><p>例如，下面通过重建 <code>$0</code> 的技巧来实现去除行首行尾空格并压缩中间空格：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;   a b    c   d&quot; | awk &#x27;{$1=$1;print}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a b c d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;    a   b c   d&quot; | awk &#x27;{$1=$1;print}&#x27; OFS=&quot;-&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a-b-c-d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1139awk-数据筛选示例">1.1.3.9、awk 数据筛选示例<a class="hash-link" href="#1139awk-数据筛选示例" title="标题的直接链接">​</a></h4><blockquote><p>筛选行</p></blockquote><ol><li><p>根据行号筛选</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;NR==2&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;NR&gt;=2&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>根据正则表达式筛选整行</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/qq.com/&#x27; a.txt           # 输出带有qq.com的行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;$0 ~ /qq.com/&#x27; a.txt      # 等价于上面命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/^[^@]+$/&#x27; a.txt      # 输出不包含@符号的行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;!/@/&#x27; a.txt               # 输出不包含@符号的行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>根据字段来筛选行</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 输出第4字段大于24的行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;($4+0) &gt; 24{print $0}&#x27; a.txt  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 输出第5字段包含qq.com的行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;$5 ~ /qq.com/&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>将多个筛选条件结合起来进行筛选</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;NR&gt;=2 &amp;&amp; NR&lt;=7&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;$3==&quot;male&quot; &amp;&amp; $6 ~ /^170/&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;$3==&quot;male&quot; || $6 ~ /^170/&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>按照范围进行筛选 flip flop</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># pattern1,pattern2{action}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;NR==2, NR==7&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;NR==2, $6 ~ /^170/&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><blockquote><p>处理字段</p></blockquote><p>修改字段时，一定要注意，可能带来的联动效应：即使用 OFS 重建 <code>$0</code>。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;NR&gt;1{$4=$4+5;print $0}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> Bob male </span><span class="token number" style="color:rgb(9, 134, 88)">33</span><span class="token plain"> abc@qq.com </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> Alice female </span><span class="token number" style="color:rgb(9, 134, 88)">29</span><span class="token plain"> def@gmail.com </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> Tony male </span><span class="token number" style="color:rgb(9, 134, 88)">26</span><span class="token plain"> aaa@163.com </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> Kevin male </span><span class="token number" style="color:rgb(9, 134, 88)">26</span><span class="token plain"> bbb@189.com </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> Alex male </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> ccc@xyz.com </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> Andy female </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain"> ddd@139.com </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> Jerry female </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> exdsa@189.com </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> Peter male </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain"> bax@qq.com </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"> Steven female </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain"> bc@sohu.com </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> Bruce female </span><span class="token number" style="color:rgb(9, 134, 88)">32</span><span class="token plain"> bcbd@139.com </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{OFS=&quot;-&quot;}NR&gt;1{$4=$4+5;print $0}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">-Bob-male-33-abc@qq.com-18023394012</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">-Alice-female-29-def@gmail.com-18084925203</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">-Tony-male-26-aaa@163.com-17048792503</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">-Kevin-male-26-bbb@189.com-17023929033</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">-Alex-male-23-ccc@xyz.com-18185904230</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">-Andy-female-27-ddd@139.com-18923902352</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">-Jerry-female-30-exdsa@189.com-18785234906</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">-Peter-male-25-bax@qq.com-17729348758</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">-Steven-female-28-bc@sohu.com-15947893212</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">-Bruce-female-32-bcbd@139.com-13942943905</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;NR&gt;1{$6=$6&quot;*&quot;;print $0}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> Bob male </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain"> abc@qq.com </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> Alice female </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain"> def@gmail.com </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> Tony male </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"> aaa@163.com </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> Kevin male </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"> bbb@189.com </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> Alex male </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> ccc@xyz.com </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> Andy female </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> ddd@139.com </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> Jerry female </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain"> exdsa@189.com </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> Peter male </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"> bax@qq.com </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"> Steven female </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> bc@sohu.com </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> Bruce female </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain"> bcbd@139.com </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>综合实例</p></blockquote><p>从 ifconfig 命令的结果中筛选出除了 lo 网卡外的所有 IPv4 地址。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ifconfig | awk &#x27;/\&lt;inet\&gt;/ &amp;&amp; !($2 ~ /^127/){print $2}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.181</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11310awk-工作流程">1.1.3.10、awk 工作流程<a class="hash-link" href="#11310awk-工作流程" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># man --pager=&#x27;less -p ^&quot;AWK PROGRAM EXECUTION&quot;&#x27; awk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>解析 -v var=val... 选项中的变量赋值。</li><li>编译 awk 源代码为 awk 可解释的内部格式，包括 -v 的变量。</li><li>执行 BEGIN 代码段。</li><li>根据输入记录分隔符 RS 读取文件(根据 ARGV 数组的元素决定要读取的文件)，如果没有指定文件，则从标准输入中读取文件，同时执行 main 代码段。<ul><li>如果文件名部分指定为 var=val 格式，则声明并创建变量，此阶段的变量在 BEGIN 之后声明，所以 BEGIN 中不可用， main 代码段可用。</li><li>每读取一条记录：<ul><li>都将设置 NR、FNR、RT、$0 等变量。</li><li>默认根据输入字段分隔符 FS 切割字段，将各字段保存到 $1, $2，... 中。</li><li>测试 main 代码段的 pattern 部分，如果测试成功则执行 action 部分。</li></ul></li></ul></li><li>执行 END 代码段。</li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11311getline-用法详解">1.1.3.11、getline 用法详解<a class="hash-link" href="#11311getline-用法详解" title="标题的直接链接">​</a></h4><p>除了可以从标准输入或非选项型参数所指定的文件中读取数据，还可以使用 getline 从其它各种渠道获取需要处理的数据，它的用法有很多种。</p><p>getline 的返回值：</p><ul><li>如果可以读取到数据，返回 1</li><li>如果遇到了 EOF，返回 0</li><li>如果遇到了错误，返回负数。如 -1 表示文件无法打开，-2 表示 IO 操作需要重试(retry)。在遇到错误的同时，还会设置 ERRNO 变量来描述错误</li></ul><p>为了健壮性，getline 时强烈建议进行判断。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">getline</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">getline</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">getline</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的 getline 的括号尽量加上，因为 <code>getline &lt; 0</code> 表示的是输入重定向，而不是和数值 0 进行小于号的比较。</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113111无参数的-getline">1.1.3.11.1、无参数的 getline<a class="hash-link" href="#113111无参数的-getline" title="标题的直接链接">​</a></h5><p>getline 无参数时，表示从当前正在处理的文件中立即读取下一条记录保存到 <code>$0</code> 中，并进行字段分割，然后继续执行后续代码逻辑。</p><p>此时的 getline 会设置 NF、RT、NR、FNR、$0 和 $N。</p><p>next 也可以读取下一行。</p><ul><li>getline：读取下一行之后，继续执行 getline 后面的代码</li><li>next：读取下一行，立即回头 awk 循环的头部，不会再执行 next 后面的代码</li></ul><p>例如，匹配到某行之后，再读一行就退出：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/^1/{print;getline;print;exit}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/^1/{print;next;print;exit}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为了更健壮，应当对 getline 的返回值进行判断。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/^1/{print;if((getline)&lt;=0){exit};print}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113112一个参数的-getline">1.1.3.11.2、一个参数的 getline<a class="hash-link" href="#113112一个参数的-getline" title="标题的直接链接">​</a></h5><p>没有参数的 getline 是读取下一条记录之后将记录保存到 <code>$0</code> 中，并对该记录进行字段的分割。</p><p>一个参数的 getline 是将读取的记录保存到指定的变量当中，并且不会对其进行分割。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/^1/{print;getline var;print;exit}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/^1/{print;getline var;print var;exit}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时的 getline 只会设置 RT、NR、FNR 变量和指定的变量 var。因此 <code>$0</code> 和 <code>$N</code> 以及 <code>NF</code> 保持不变。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /^1/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token plain">getline var</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">exit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   print var</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   print </span><span class="token variable" style="color:rgb(9, 134, 88)">$0</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--&quot;</span><span class="token variable" style="color:rgb(9, 134, 88)">$2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27; a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain">--Bob</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113113从指定文件中读取数据">1.1.3.11.3、从指定文件中读取数据<a class="hash-link" href="#113113从指定文件中读取数据" title="标题的直接链接">​</a></h5><ol><li>getline &lt; filename：从指定文件 filename 中读取一条记录并保存到 $0 中<ul><li>会进行字段的划分，会设置变量 <code>$0 $N NF</code>，不会设置变量 <code>NR FNR</code></li></ul></li><li>getline var &lt; filename：从指定文件 filename 中读取一条记录并保存到指定变量 var 中<ul><li>不会划分字段，不会设置变量 <code>NR FNR NF $0 $N</code></li></ul></li></ol><p>filename 需使用双引号包围表示文件名字符串，否则会当作变量解析 <code>getline &lt; &quot;a.txt&quot;</code>。此外，如果路径是使用变量构建的，则应该使用括号包围路径部分。</p><p>例如 <code>getline &lt; dir &quot;/&quot; filename</code> 中使用了两个变量构建路径，这会产生歧义，应当写成 <code>getline &lt;(dir &quot;/&quot; filename)</code>。</p><p>注意，每次从 filename 读取之后都会做好位置偏移标记，下次再从该文件读取时将根据这个位置标记继续向后读取。</p><p>例如，每次行首以 1 开头时就读取 a.txt 文件的所有行。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/^1/{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> while</span><span class="token punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token plain">getline </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;a.txt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;a.txt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27; a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的 <code>close(&quot;a.txt&quot;)</code> 表示在 <code>while(getline)</code> 读取完文件之后关掉，以便后面再次读取，如果不关掉，则文件偏移指针将一直在文件结尾处，使得下次读取时直接遇到 EOF。</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113114从-shell-命令输出结果中读取数据">1.1.3.11.4、从 Shell 命令输出结果中读取数据<a class="hash-link" href="#113114从-shell-命令输出结果中读取数据" title="标题的直接链接">​</a></h5><ol><li><code>cmd | getline</code>：从 Shell 命令 cmd 的输出结果中读取一条记录保存到 <code>$0</code> 中<ul><li>会进行字段划分，设置变量 <code>$0 NF $N RT</code>，不会修改变量 <code>NR FNR</code></li></ul></li><li><code>cmd | getline var</code>：从 Shell 命令 cmd 的输出结果中读取数据保存到 var 中<ul><li>除了 var 和 RT，其它变量都不会设置</li></ul></li></ol><p>如果要再次执行 cmd 并读取其输出数据，则需要 close 关闭该命令。例如 <code>close(&quot;seq 1 5&quot;)</code>，参见下面的示例。</p><p>例如：每次遇到以 1 开头的行都输出 seq 命令产生的 <code>1 2 3 4 5</code>。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/^1/{print;while((&quot;seq 1 5&quot;|getline)&gt;0){print};close(&quot;seq 1 5&quot;)}&#x27; a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再例如，调用 Shell 的 date 命令生成时间，然后保存到 awk 变量 cur<!-- -->_<!-- -->date 中：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/^1/{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> print</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;date +</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%F %T</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">getline cur_date</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> print cur_date</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;date +</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">%F %T</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27; a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-09-12 </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain">:02:24</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-09-12 </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain">:02:24</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>可以将 cmd 保存成一个字符串变量。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{get_date=&quot;date +\&quot;%F %T\&quot;&quot;}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /^1/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> print</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> get_date </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> getline cur_date</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> print cur_date</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">get_date</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27; a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-09-12 </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain">:06:12</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-09-12 </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain">:06:12</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p>更为复杂一点的，cmd 中可以包含 Shell 的其它特殊字符，例如管道、重定向符号等：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   /^1/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;seq 1 5 | xargs -i echo x{}y 2&gt;/dev/null&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">getline</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       print</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;seq 1 5 | xargs -i echo x{}y 2&gt;/dev/null&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27; a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">x1y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">x1y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113115awk-中的-coprocess">1.1.3.11.5、awk 中的 coprocess<a class="hash-link" href="#113115awk-中的-coprocess" title="标题的直接链接">​</a></h5><p>awk 虽然强大，但是有些数据仍然不方便处理，这时可将数据交给 Shell 命令去帮助处理，然后再从 Shell 命令的执行结果中取回处理后的数据继续 awk 处理。</p><p>awk 通过 <code>|&amp;</code> 符号来支持 coproc。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">awk_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;something&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|&amp;</span><span class="token plain"> Shell_Cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Shell_Cmd </span><span class="token operator" style="color:rgb(0, 0, 0)">|&amp;</span><span class="token plain"> getline </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">var</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这表示 awk 通过 print 输出的数据将传递给 Shell 的命令 Shell<!-- -->_<!-- -->Cmd 去执行，然后 awk 再从 Shell<!-- -->_<!-- -->Cmd 的执行结果中取回 Shell<!-- -->_<!-- -->Cmd 产生的数据。</p><p>例如，不想使用 awk 的 substr() 来取子串，而是使用 sed 命令来替换。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">CMD</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;sed -nr </span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">s/.*@(.*)$/</span><span class="token string entity" style="color:rgb(163, 21, 21)">\\</span><span class="token string" style="color:rgb(163, 21, 21)">1/p</span><span class="token string entity" style="color:rgb(163, 21, 21)">\&quot;</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     NR</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print </span><span class="token variable" style="color:rgb(9, 134, 88)">$5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print </span><span class="token variable" style="color:rgb(9, 134, 88)">$5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|&amp;</span><span class="token plain"> CMD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">CMD,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;to&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         CMD </span><span class="token operator" style="color:rgb(0, 0, 0)">|&amp;</span><span class="token plain"> getline email_domain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">CMD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print email_domain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27; a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">abc@qq.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">qq.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">def@gmail.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gmail.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aaa@163.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">163</span><span class="token plain">.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bbb@189.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">189</span><span class="token plain">.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ccc@xyz.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xyz.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ddd@139.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">139</span><span class="token plain">.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">exdsa@189.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">189</span><span class="token plain">.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bax@qq.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">qq.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bc@sohu.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sohu.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bcbd@139.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">139</span><span class="token plain">.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于 <code>awk_print |&amp; cmd; cmd |&amp; getline</code> 的使用，须注意的是：</p><ul><li><code>awk_print |&amp; cmd</code> 会直接将数据写进管道，cmd 可以从中获取数据</li><li>强烈建议在 awk<!-- -->_<!-- -->print 写完数据之后加上 <code>close(cmd,&quot;to&quot;)</code>，这样表示向管道中写入一个 EOF 标记，避免某些要求读完所有数据再执行的 cmd 命令被永久阻塞</li><li>如果 cmd 是按块缓冲的，则 getline 可能会陷入阻塞。这时可将 cmd 部分改写成 stdbuf -oL cmd 以强制其按行缓冲输出数据<ul><li><code>CMD=&quot;stdbuf -oL cmdline&quot;;awk_print |&amp; CMD;close(CMD,&quot;to&quot;);CMD |&amp; getline</code></li></ul></li></ul><p>对于那些要求读完所有数据再执行的命令，例如 sort 命令，它们有可能需要等待数据已经完成后（遇到 EOF 标记）才开始执行任务，对于这些命令，可以多次向 coprocess 中写入数据，最后 <code>close(CMD,&quot;to&quot;)</code> 让 coprocess 运行起来。</p><p>例如，对 age 字段(即 $4)使用 sort 命令按数值大小进行排序：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">CMD</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;sort -k4n&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)"># 将所有行都写进管道</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     NR</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       print </span><span class="token variable" style="color:rgb(9, 134, 88)">$0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|&amp;</span><span class="token plain"> CMD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     END</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">CMD,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;to&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 关闭管道通知sort开始排序</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       while</span><span class="token punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token plain">CMD </span><span class="token operator" style="color:rgb(0, 0, 0)">|&amp;</span><span class="token plain"> getline</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">CMD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> &#x27; a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   Alice   female  </span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token plain">   def@gmail.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18084925203</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113116close">1.1.3.11.6、close()<a class="hash-link" href="#113116close" title="标题的直接链接">​</a></h5><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">cmd,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">from </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> to</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># to参数只用于coprocess的第一个阶段</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果 close() 关闭的对象不存在，awk 不会报错，仅仅只是让其返回一个负数返回值。</p><p>close() 有两个基本作用：</p><ol><li>关闭文件，丢弃已有的文件偏移指针<ul><li>下次再读取文件，将只能重新打开文件，重新打开文件会从文件最开头开始读取</li></ul></li><li>发送 EOF 标记</li></ol><p>awk 中任何文件都只会在第一次使用时打开，之后都不会再重新打开。只有关闭之后，再使用才会重新打开。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat x.log </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">I am an interpreter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/^1/{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     while</span><span class="token punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token plain">getline var </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;x.log&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print var</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;x.log&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27; a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">I am an interpreter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">I am an interpreter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>本例需求是只要在 a.txt 中匹配到 1 开头的行就输出另一个文件 x.log 的所有内容；</li><li>那么在第一次输出 x.log 文件内容之后，文件偏移指针将在 x.log 文件的结尾处，如果不关闭该文件，则后续所有读取 x.log 的文件操作都从结尾处继续读取，但是显然总是得到 EOF 异常，所以 getline 返回值为 0，而且也读取不到任何数据。</li><li>所以，必须关闭它才能在下次匹配成功时再次从头读取该文件。</li></ul><p>在处理 Coprocess 的时候，close() 可以指定第二个参数 &quot;from&quot; 或 &quot;to&quot; ，它们都针对于 coproc 而言，from 时表示关闭 <code>coproc |&amp; getline</code> 的管道，使用 to 时，表示关闭 <code>print something |&amp; coproc</code> 的管道。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">BEGIN{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  CMD=&quot;sed -nr \&quot;s/.*@(.*)$/\\1/p\&quot;&quot;;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">}</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">NR&gt;1{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print $5;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print $5 |&amp; CMD;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    close(CMD,&quot;to&quot;);   # 本次close()是必须的</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    CMD |&amp; getline email_domain;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    close(CMD);</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print email_domain;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">}&#x27;</span><span class="token plain"> a.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>上面的第一个 close 是必须的，否则 sed 会一直阻塞。因为 sed 一直认为还有数据可读，只有关闭管道发送一个 EOF，sed 才会开始处理。</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11312awk-变量">1.1.3.12、awk 变量<a class="hash-link" href="#11312awk-变量" title="标题的直接链接">​</a></h4><p>awk 的变量是动态变量，在使用时声明。</p><p>所以 awk 变量有 3 种状态：</p><ul><li>未声明状态：称为 untyped 类型</li><li>引用过但未赋值状态：unassigned 类型</li><li>已赋值状态</li></ul><p>引用未赋值的变量，其默认初始值为空字符串或数值 0。</p><p>在 awk 中未声明的变量称为 untyped，声明了但未赋值(只要引用了就声明了)的变量其类型为 unassigned。</p><p>gawk 4.2版提供了 <code>typeof()</code> 函数，可以测试变量的数据类型，包括测试变量是否声明。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">typeof</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">))</span><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># untyped</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">b</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">typeof</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(4, 81, 165)">))</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># unassigned</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">untyped</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">unassigned</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>除了 <code>typeof()</code>，还可以使用下面的技巧进行检测：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">a</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 未赋值时，两个都true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;untyped or unassigned&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;assigned&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">untyped or unassigned</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113121变量赋值">1.1.3.12.1、变量赋值<a class="hash-link" href="#113121变量赋值" title="标题的直接链接">​</a></h5><p>awk 中的变量赋值语句也可以看作是一个有返回值的表达式。</p><p>例如，<code>a=3</code> 赋值完成后返回 3，同时变量 a 也被设置为 3。</p><p>基于这个特点，有两点用法：</p><ul><li>可以 <code>x=y=z=5</code>，等价于 <code>z=5 y=5 x=5</code></li><li>可以将赋值语句放在任意允许使用表达式的地方<ul><li><code>x != (y = 1)</code></li><li><code>awk &#x27;BEGIN{print (a=4);print a}&#x27;</code></li></ul></li></ul><p>问题：<code>a=1;arr[a+=2] = (a=a+6)</code> 是怎么赋值的，对应元素结果等于？<code>arr[3]=7</code>。但不要这么做，因为不同 awk 的赋值语句左右两边的评估顺序有可能不同。</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113122awk-中声明变量的位置">1.1.3.12.2、awk 中声明变量的位置<a class="hash-link" href="#113122awk-中声明变量的位置" title="标题的直接链接">​</a></h5><ol><li>在 BEGIN 或 main 或 END 代码段中直接引用或赋值</li><li>使用 <code>-v var=val</code> 选项，可定义多个，必须放在 awk 代码的前面<ul><li>它的变量声明早于 BEGIN 块</li><li>普通变量：<code>awk -v age=123 &#x27;BEGIN{print age}&#x27;</code></li><li>使用 shell 变量赋值：<code>awk -v age=$age &#x27;BEGIN{print age}&#x27;</code></li></ul></li><li>在 awk 代码后面使用 var=val 参数<ul><li>它的变量声明在 BEGIN 之后</li><li><code>awk &#x27;{print n}&#x27; n=3 a.txt n=4 b.txt</code></li><li><code>awk &#x27;{print $1}&#x27; FS=&#x27; &#x27; a.txt FS=&quot;:&quot; /etc/passwd</code></li><li>使用 Shell 变量赋值：<code>awk &#x27;{print age}&#x27; age=$age a.txt</code></li></ul></li></ol><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113123awk-中使用-shell-变量">1.1.3.12.3、awk 中使用 Shell 变量<a class="hash-link" href="#113123awk-中使用-shell-变量" title="标题的直接链接">​</a></h5><p>要在 awk 中使用 Shell 变量，有三种方式：</p><ol><li><p>在 -v 选项中将 Shell 变量赋值给 awk 变量</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># num=$(cat a.txt | wc -l)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk -v n=$num &#x27;BEGIN{print n}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>-<!-- -->v 选项是在 awk 工作流程的第一阶段解析的，所以 -v 选项声明的变量在 BEGIN{}、END{} 和 main 代码段中都能直接使用。</li></ul></li><li><p>在非选项型参数位置处使用 <code>var=value</code> 格式将 Shell 变量赋值给 awk 变量</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># num=$(cat a.txt | wc -l)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;{print n}&#x27; n=$num a.txt </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>非选项型参数设置的变量不能在 BEGIN 代码段中使用。</li></ul></li><li><p>直接在 awk 代码部分暴露 Shell 变量，交给 Shell 解析进行 Shell 的变量替换</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># num=$(cat a.txt | wc -l)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print &#x27;&quot;$num&quot;&#x27;}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这种方式最灵活，但可读性最差，可能会出现大量的引号。</li></ul></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11313数据类型和字面量">1.1.3.13、数据类型和字面量<a class="hash-link" href="#11313数据类型和字面量" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113131数据类型">1.1.3.13.1、数据类型<a class="hash-link" href="#113131数据类型" title="标题的直接链接">​</a></h5><p>gawk 有两种基本的数据类型：数值和字符串。在 gawk 4.2.0 版本中，还支持第三种基本的数据类型：正则表达式类型。</p><p>数据是什么类型在使用它的上下文中决定：在字符串操作环境下将转换为字符串，在数值操作环境下将转换为数值。这和自然语言中的一个词语、一个单词在不同句子内的不同语义是一样的。</p><p>隐式转换：</p><ul><li>算术加 0 操作可转换为数值类型<ul><li><code>&quot;123&quot; + 0</code> 返回数值 123</li><li><code>&quot; 123abc&quot; + 0</code> 转换为数值时为 123</li><li>无效字符串将转换成 0，例如 <code>&quot;abc&quot;+3</code> 返回 3</li></ul></li><li>连接空字符串可转换为字符串类型<ul><li><code>123&quot;&quot;</code> 转换为字符串 ”123”</li></ul></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=&quot;123&quot;;print typeof(a+0)}&#x27; # number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">number</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=123;print typeof(a&quot;&quot;)}&#x27;   # string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">string</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=2;b=3;print(a b)+4}&#x27; # 27</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>显式转换：</p><ul><li><p>数值-&gt;字符串：</p><ul><li>CONVFMT 或 sprintf()：功能等价。都是指定数值转换为字符串时的格式</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=123.4567;CONVFMT=&quot;%.2f&quot;;print a&quot;&quot;}&#x27; #123.46</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">123.46</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=123.4567;print sprintf(&quot;%.2f&quot;, a)}&#x27; #123.46</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">123.46</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=123.4567;printf(&quot;%.2f&quot;,a)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">123.46</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>字符串-&gt;数值：strtonum()</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># gawk &#x27;BEGIN{a=&quot;123.4567&quot;;print strtonum(a)}&#x27; # 123.457</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">123.457</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113132awk-字面量">1.1.3.13.2、awk 字面量<a class="hash-link" href="#113132awk-字面量" title="标题的直接链接">​</a></h5><p>awk 中有 3 种字面量：字符串字面量、数值字面量和正则表达式字面量。</p><blockquote><p>数值字面量</p></blockquote><p>整数、浮点数、科学计数</p><ul><li>105、105.0、1.05e+2、1050e-1</li></ul><p>awk 内部总是使用浮点数方式保存所有数值，但用户在使用可以转换成整数的数值时总会去掉小数点</p><ul><li>数值 12.0 面向用户的值为 12，12 面向 awk 内部的值是 12.00000...0</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 结果是123而非123.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=123.0;print a}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>算术运算</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">++ --    自增、自减，支持i++和++i或--i或i--  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">^        幂运算</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">**也用于幂运算</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+ -      一元运算符</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">正负数符号</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* / %    乘除取模运算</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+ -      加减法运算</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 注：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 1.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 2.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>++ 和 -- 既可以当作独立语句，也可以作为表达式，如:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=3;a++;a=++a;print a}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>**</code> 或 <code>^</code> 幂运算是从右向左计算的：<code>print 2**1**3</code> 得到 2 而不是 8</p></li></ul><p>赋值操作(优先级最低)：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> *</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> /</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> %</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ^</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> **</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>疑惑：<code>b = 6;print b += b++</code> 输出结果？可能是 12 或 13。不同的 awk 的实现在评估顺序上不同，所以不要用这种可能产生歧义的语句。</li></ul><blockquote><p>字符串字面量</p></blockquote><p>awk 中的字符串都以双引号包围，不能以单引号包围。</p><ul><li><code>&quot;abc&quot;</code></li><li><code>&quot;&quot;</code></li><li><code>&quot;\0&quot;</code>、<code>&quot;\n&quot;</code></li></ul><p>字符串连接（串联）：awk 没有为字符串的串联操作提供运算符，可以直接连接或使用空格连接。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print (&quot;one&quot; &quot;two&quot;)}&#x27;  # &quot;onetwo&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">onetwo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print (&quot;one&quot;&quot;two&quot;)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">onetwo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=&quot;one&quot;;b=&quot;two&quot;;print (a b)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">onetwo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意：字符串串联虽然方便，但是要考虑串联的优先级。例如下面的：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 下面第一个串联成功，第二个串联失败，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 因为串联优先级低于加减运算，等价于`12 (&quot; &quot; -23)`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 即：先转为数值0-23，再转为字符串12-23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=&quot;one&quot;;b=&quot;two&quot;;print (12 &quot; &quot; 23)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=&quot;one&quot;;b=&quot;two&quot;;print (12 &quot; &quot; -23)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain">-23</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>正则表达式字面量</p></blockquote><p>普通正则：</p><ul><li><code>/[0-9]+/</code></li><li>匹配方式：<code>&quot;str&quot; ~ /pattern/</code> 或 <code>&quot;str&quot; !~ /pattern/</code></li><li>匹配结果返回值为 0(匹配失败) 或 1(匹配成功)</li><li>任何单独出现的 <code>/pattern/</code> 都等价于 <code>$0 ~ /pattern/</code><ul><li><code>if(/pattern/)</code> 等价于 <code>if($0 ~ /pattern/)</code></li></ul></li></ul><p>强类型的正则字面量(gawk 4.2.0 才支持)</p><ul><li><code>@/pattern/</code> 作为独立的一种数据类型：正则表达式类型</li><li>在使用正则字面量变量进行匹配的时候，不能简写 <code>a=@/Alice/;a{print}</code>，只能写完整的匹配 <code>a=@/Alice/;$0 ~ a{print}</code></li><li>可使用 <code>typeof()</code>(也是 4.2 才支持的)检查类型，得到的结果将是 <code>regexp</code><ul><li><code>awk &#x27;BEGIN{re=@/abc/;print typeof(re)}&#x27;</code></li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11314gawk-支持的正则表达式">1.1.3.14、gawk 支持的正则表达式<a class="hash-link" href="#11314gawk-支持的正则表达式" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">       </span><span class="token comment" style="color:rgb(0, 128, 0)"># 匹配任意字符，包括换行符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">^</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">^</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">?</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">m,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">m,n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">,n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:lower:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:upper:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:alpha:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:digit:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:alnum:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:xdigit:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:blank:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:space:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:punct:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:graph:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:print:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">:cntrl:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">以下是gawk支持的：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">y    匹配单词左右边界部分的空字符位置 </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;hello world&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">B    和</span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">y相反，匹配单词内部的空字符位置，例如</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;crate&quot;</span><span class="token plain"> ~ </span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token variable" style="color:rgb(9, 134, 88)">/c</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token variable" style="color:rgb(9, 134, 88)">Brat</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token variable" style="color:rgb(9, 134, 88)">Be/</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token plain">成功</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">    匹配单词左边界</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">    匹配单词右边界</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">s    匹配空白字符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">S    匹配非空白字符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">w    匹配单词组成字符</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">大小写字母、数字、下划线</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">W    匹配非单词组成字符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">`    匹配字符串的绝对行首  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;abc</span><span class="token string entity" style="color:rgb(163, 21, 21)">\n</span><span class="token string" style="color:rgb(163, 21, 21)">def&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">&#x27;    匹配字符串的绝对行尾</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>gawk 不支持正则修饰符，所以无法直接指定忽略大小写的匹配。</p><p>如果想要实现忽略大小写匹配，则可以将字符串先转换为大写、小写再进行匹配。或者设置预定义变量 IGNORECASE 为非 0 值。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 转换为小写</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;tolower($0) ~ /bob/{print $0}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置IGNORECASE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;/BOB/{print $0}&#x27; IGNORECASE=1 a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11315awk-布尔值比较和逻辑运算">1.1.3.15、awk 布尔值、比较和逻辑运算<a class="hash-link" href="#11315awk-布尔值比较和逻辑运算" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113151awk-布尔值">1.1.3.15.1、awk 布尔值<a class="hash-link" href="#113151awk-布尔值" title="标题的直接链接">​</a></h5><p>在 awk 中，没有像其它语言一样专门提供 true、false 这样的关键字。</p><p>但它的布尔值逻辑非常简单：</p><ul><li>数值 0 表示布尔假</li><li>空字符串表示布尔假</li><li>其余所有均为布尔真<ul><li>字符串 ”0” 也是真，因为它是字符串</li></ul></li><li>awk 中，正则匹配也有返回值，匹配成功则返回 1，匹配失败则返回 0</li><li>awk 中，所有的布尔运算也有返回值，布尔真返回值 1，布尔假返回值为 0</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;haha&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;0&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;hehe&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;hoho&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># if(3){print &quot;hoho&quot;}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;aoao&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">/root/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;heihei&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># $0 ~ /root/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">haha</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hehe</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hoho</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aoao</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113152awk-中比较操作">1.1.3.15.2、awk 中比较操作<a class="hash-link" href="#113152awk-中比较操作" title="标题的直接链接">​</a></h5><blockquote><p>strnum 类型</p></blockquote><p>awk 最基本的数据类型只有 string 和 number(gawk 4.2.0版本之后支持正则表达式类型)。但是，对于用户输入数据(例如从文件中读取的各个字段值)，它们理应属于 string 类型，但有时候它们看上去可能像是数值(例如 $2=37)，而有时候有需要这些值是数值类型。</p><p>awk 的数据来源：</p><ol><li>awk 内部产生的，包括变量的赋值、表达式或函数的返回值。</li><li>从其它来源获取到的数据，都是外部数据，也是用户输入数据，这些数据理应全部都是 string 类型的数据。</li></ol><p>所以 POSIX 定义了一个名为 ”numeric string” 的 ”墙头草” 类型，gawk 中则称为 strnum 类型。当获取到的用户数据看上去是数字时，那么它就是 strnum 类型。strnum 类型在被使用时会被当作数值类型。</p><p>注意，strnum类型只针对于awk中除数值常量、字符串常量、表达式计算结果外的数据。例如从文件中读取的字段 $1、$2、ARGV 数组中的元素等等。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;30&quot; | awk &#x27;{print typeof($0) &quot; &quot; typeof($1)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">strnum strnum</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;+30&quot; | awk &#x27;{print typeof($1)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">strnum</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;30a&quot; | awk &#x27;{print typeof($1)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">string</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;30 a&quot; | awk &#x27;{print typeof($0) &quot; &quot; typeof($1)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">string strnum</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot; +30 &quot; | awk &#x27;{print typeof($0) &quot; &quot; typeof($1)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">strnum strnum</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>大小比较操作</p></blockquote><p>比较操作符：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">!=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain">  大小、等值比较</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain">     数组成员测试</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>比较规则：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">STRING NUMERIC STRNUM</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-------</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">-----------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">STRING </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">string string  string</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NUMERIC</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">string numeric numeric</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">STRNUM </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">string numeric numeric</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>简单来说，string 优先级最高，只要 string 类型参与比较，就都按照 string 的比较方式，所以可能会进行隐式的类型转换。</p><p>其它时候都采用 num 类型比较。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27; +3.14&#x27; | awk &#x27;{print typeof($0) &quot; &quot; typeof($1)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">strnum strnum</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27; +3.14&#x27; | awk &#x27;{print($0 == &quot; +3.14&quot;)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27; +3.14&#x27; | awk &#x27;{print($0 == &quot;+3.14&quot;)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27; +3.14&#x27; | awk &#x27;{print($0 == &quot;3.14&quot;)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27; +3.14&#x27; | awk &#x27;{print($0 == 3.14)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27; +3.14&#x27; | awk &#x27;{print($1 == 3.14)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27; +3.14&#x27; | awk &#x27;{print($1 == &quot; +3.14&quot;)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27; +3.14&#x27; | awk &#x27;{print($1 == &quot;+3.14&quot;)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27; +3.14&#x27; | awk &#x27;{print($1 == &quot;3.14&quot;)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo 1e2 3|awk &#x27;{print ($1&lt;$2)?&quot;true&quot;:&quot;false&quot;}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>采用字符串比较时需注意，它是逐字符逐字符比较的。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&quot;11&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;9&quot;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">&quot;ab&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">99</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113153逻辑运算">1.1.3.15.3、逻辑运算<a class="hash-link" href="#113153逻辑运算" title="标题的直接链接">​</a></h5><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print(!99)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print(!&quot;ab&quot;)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print(!0)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print(!ab)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print(!!99)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print(!!&quot;ab&quot;)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print(!!0)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{print(!!ab)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于 awk 中的变量未赋值时默认初始化为空字符串或数值 0，也就是布尔值为假。那么可以直接对一个未赋值的变量执行 <code>!</code> 操作。</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="113154运算符优先级">1.1.3.15.4、运算符优先级<a class="hash-link" href="#113154运算符优先级" title="标题的直接链接">​</a></h5><p>优先级从高到低：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$                       </span><span class="token comment" style="color:rgb(0, 128, 0)"># $(2+2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">++ --</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">^ **</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+ - </span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain">                   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 一元运算符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* / %</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">+ -</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">space                   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 这是字符连接操作 `12 &quot; &quot; 23`  `12 &quot; &quot; -23`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">!=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain">         </span><span class="token comment" style="color:rgb(0, 128, 0)"># 注意&gt;即是大于号，也是print/printf的重定向符号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">~ </span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain">~</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">?:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> *</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> /</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> %</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ^</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于相同优先级的运算符，通常都是从左开始运算，但下面 2 种例外，它们都从右向左运算：</p><ul><li>赋值运算：如 <code>= += -= *=</code></li><li>幂运算</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">a - b + c  </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a - b</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> + c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> c  </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">  a </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">b </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">**2**3    </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">**</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">**3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再者，注意 print 和 printf 中出现的 <code>&gt;</code> 符号，这时候它表示的是重定向符号，不能再出现优先级比它低的运算符，这时可以使用括号改变优先级。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;BEGIN{print &quot;foo&quot; &gt; a &lt; 3 ? 2 : 1)&#x27;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 语法错误</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;BEGIN{print &quot;foo&quot; &gt; (a &lt; 3 ? 2 : 1)}&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 正确</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11316awk-流程控制">1.1.3.16、awk 流程控制<a class="hash-link" href="#11316awk-流程控制" title="标题的直接链接">​</a></h4><blockquote><p>if…else</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 单独的if</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">cond</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statements</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># if...else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">cond1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statements1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statements2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># if...else if...else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">cond1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statements1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">cond2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statements2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">cond3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statements3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> else</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statements4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     mark </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">999</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">mark </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> mark </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">60</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;学渣&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">mark </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">60</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> mark </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">90</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;还不错&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">mark </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">90</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> mark </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;学霸&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;错误分数&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">错误分数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>三目运算符?:</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">expr1 ? expr2 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> expr3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">expr1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    expr2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    expr3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=50;b=(a&gt;60) ? &quot;及格&quot; : &quot;不及格&quot;;print(b)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">不及格</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{a=50; a&gt;60 ? b=&quot;及格&quot; : b=&quot;不及格&quot;;print(b)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">不及格</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>switch…case</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">switch </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> value1</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">regex1 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> statements1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> value2</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">regex2 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> statements2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> value3</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">regex3 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> statements3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> default: statement </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>awk 中的 switch 分支语句功能较弱，只能进行等值比较或正则匹配。</p><p>各分支结尾需使用 break 来终止。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    switch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token variable" style="color:rgb(9, 134, 88)">$1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Monday&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Tuesday&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Wednesday&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Thursday&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Friday&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Saturday&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Sunday&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        default:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;What day?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>分支穿透：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    switch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token variable" style="color:rgb(9, 134, 88)">$1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Weekday&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Weekend&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        default:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;What day?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>while 和 do…while</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">while</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statements</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statements</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> while</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">condition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>while 先判断条件再决定是否执行 statements，do…while 先执行 statements 再判断条件决定下次是否再执行 statements。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{i=0;while(i&lt;5){print i;i++}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{i=0;do {print i;i++} while(i&lt;5)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>多数时候，while 和 do…while 是等价的，但如果第一次条件判断失败，则 do…while 和 while 不同。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{i=0;while(i == 2){print i;i++}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{i=0;do {print i;i++} while(i ==2 )}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所以，while 可能一次也不会执行，do…while 至少会执行一次。一般用 while，do…while 相比 while 来说，用的频率非常低。</p><blockquote><p>for 循环</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">expr1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expr2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expr3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statement</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">idx </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> array</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    statement</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>break 和 continue</p></blockquote><p>break 可退出 for、while、do…while、switch 语句。continue 可让 for、while、do…while 进入下一轮循环。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">BEGIN{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  for(i=0;i&lt;10;i++){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    if(i==5){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">      break</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print(i)</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  # continue</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  for(i=0;i&lt;10;i++){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    if(i==5)continue</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print(i)</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>next 和 nextfile</p></blockquote><p>next 会在当前语句处立即停止后续操作，并读取下一行，进入循环顶部。</p><p>例如，输出除第 3 行外的所有行。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;NR==3{next}{print}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;NR==3{getline}{print}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">   Tony    male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   aaa@163.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17048792503</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">   Kevin   male    </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">   bbb@189.com    </span><span class="token number" style="color:rgb(9, 134, 88)">17023929033</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">   Alex    male    </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">   ccc@xyz.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18185904230</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">   Andy    female  </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">   ddd@139.com    </span><span class="token number" style="color:rgb(9, 134, 88)">18923902352</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">   Jerry   female  </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">   exdsa@189.com  </span><span class="token number" style="color:rgb(9, 134, 88)">18785234906</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">   Peter   male    </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">   bax@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">17729348758</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">   Steven  female  </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">   bc@sohu.com    </span><span class="token number" style="color:rgb(9, 134, 88)">15947893212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">  Bruce   female  </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain">   bcbd@139.com   </span><span class="token number" style="color:rgb(9, 134, 88)">13942943905</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>nextfile 会在当前语句处立即停止后续操作，并直接读取下一个文件，并进入循环顶部。</p><p>例如，每个文件只输出前 2 行：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;FNR==3{nextfile}{print}&#x27; a.txt a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ID  name    gender  age  email          phone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">   Bob     male    </span><span class="token number" style="color:rgb(9, 134, 88)">28</span><span class="token plain">   abc@qq.com     </span><span class="token number" style="color:rgb(9, 134, 88)">18023394012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>exit</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">exit_code</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>直接退出 awk 程序。注意，END 语句块也是 exit 操作的一部分，所以在 BEGIN 或 main 段中执行 exit 操作，也会执行 END 语句块。如果 exit 在 END 语句块中执行，则立即退出。</p><p>所以，如果真的想直接退出整个 awk，则可以先设置一个 flag 变量，然后在 END 语句块的开头检查这个变量再 exit。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.code</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">cond</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">flag</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">END</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">flag</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.code</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    BEGIN{print &quot;begin&quot;;flag=1;exit}</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    {}</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    END{if(flag){exit};print &quot;end2&quot;}</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>exit 可以指定退出状态码，如果触发了两次 exit 操作，即 BEGIN 或 main 中的 exit 触发了 END 中的 exit，且 END 中的 exit 没有指定退出状态码时，则采取前一个退出状态码。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{flag=1;exit 2}{}END{if(flag){exit 1}}&#x27; </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo $?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{flag=1;exit 2}{}END{if(flag){exit}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo $?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11317awk-数组">1.1.3.17、awk 数组<a class="hash-link" href="#11317awk-数组" title="标题的直接链接">​</a></h4><p>awk 数组特性：</p><ul><li>awk 的数组是关联数组(即 key/value 方式的 hash 数据结构)，索引下标可为数值(甚至是负数、小数等)，也可为字符串<ul><li>在内部，awk 数组的索引全都是字符串，即使是数值索引在使用时内部也会转换成字符串</li><li>awk 的数组元素的顺序和元素插入时的顺序很可能是不相同的</li></ul></li><li>awk 数组支持数组的数组</li></ul><blockquote><p>awk 访问、赋值数组元素</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> value</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>索引可以是整数、负数、0、小数、字符串。如果是数值索引，会按照 CONVFMT 变量指定的格式先转换成字符串。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;aa&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> -11</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4.3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4.33</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4.3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">aa</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-11</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4.33</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过索引的方式访问数组中不存在的元素时，会返回空字符串，同时会创建这个元素并将其值设置为空字符串。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 数组长度</p></blockquote><p>awk 提供了 <code>length()</code> 函数来获取数组的元素个数，它也可以用于获取字符串的字符数量。还可以获取数值转换成字符串后的字符数量。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{arr[1]=1;arr[2]=2;print length(arr);print length(&quot;hello&quot;)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 删除数组元素</p></blockquote><ul><li><code>delete arr[idx]</code>：删除数组 <code>arr[idx]</code> 元素<ul><li>删除不存在的元素不会报错</li></ul></li><li><code>delete arr</code>：删除数组所有元素</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{arr[1]=1;arr[2]=2;arr[3]=3;delete arr[2];print length(arr)}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 检测是否是数组</p></blockquote><p><code>isarray(arr)</code> 可用于检测 arr 是否是数组，如果是数组则返回 1，否则返回 0。</p><p><code>typeof(arr)</code> 可返回数据类型，如果 arr 是数组，则其返回 &quot;array&quot;。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print isarray</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">typeof</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;array&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 测试元素是否在数组中</p></blockquote><p>不要使用下面的方式来测试元素是否在数组中：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>如果不存在 <code>arr[“x”]</code>，则会立即创建该元素，并将其值设置为空字符串</li><li>有些元素的值本身就是空字符串</li></ul><p>应当使用数组成员测试操作符 in 来测试：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 注意，idx不要使用index，它是一个内置函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">idx </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>它会测试索引 idx 是否在数组中，如果存在则返回 1，不存在则返回 0。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         delete arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 遍历数组</p></blockquote><p>awk 提供了一种 for 变体来遍历数组：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">for</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">idx </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">print arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为 awk 数组是关联数组，元素是不连续的，也就是说没有顺序。遍历 awk 数组时，顺序是不可预测的。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;one&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;two&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;three&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;four&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;five&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         for</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">             print i </span><span class="token string" style="color:rgb(163, 21, 21)">&quot; -&gt; &quot;</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">three -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">two -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">five -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">four -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">one -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此外，不要随意使用 <code>for(i=0;i&lt;length(arr);i++)</code> 来遍历数组，因为 awk 数组是关联数组。但如果已经明确知道数组的所有元素索引都位于某个数值范围内，则可以使用该方式进行遍历。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;one&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;two&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;three&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;four&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;five&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;ten&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         for</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">i++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">             if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">                 print arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">             </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">one</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">two</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">three</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">four</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">five</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ten</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 子数组</p></blockquote><p>子数组是指数组中的元素也是一个数组，即 Array of Array，它也称为子数组(subarray)。</p><p>awk 也支持子数组，在效果上即是嵌套数组或多维数组。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">241</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">242</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">241</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">243</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过如下方式遍历二维数组：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> for</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">j </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">isarray</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">))</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">             </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 指定数组遍历顺序</p></blockquote><p>由于 awk 数组是关联数组，默认情况下，<code>for(idx in arr)</code> 遍历数组时顺序是不可预测的。</p><p>但是 gawk 提供了 <code>PROCINFO[&quot;sorted_in&quot;]</code> 来指定遍历的元素顺序。它可以设置为两种类型的值：</p><ul><li>设置为用户自定义函数</li><li>设置为下面这些 awk 预定义好的值：<ul><li><code>@unsorted</code>：默认值，遍历时无序</li><li><code>@ind_str_asc</code>：索引按字符串比较方式升序遍历</li><li><code>@ind_str_desc</code>：索引按字符串比较方式降序遍历</li><li><code>@ind_num_asc</code>：索引强制按照数值比较方式升序遍历。所以无法转换为数值的字符串索引将当作数值 0 进行比较</li><li><code>@ind_num_desc</code>：索引强制按照数值比较方式降序遍历。所以无法转换为数值的字符串索引将当作数值 0 进行比较</li><li><code>@val_type_asc</code>：按值升序比较，此外数值类型出现在前面，接着是字符串类型，最后是数组类(即认为 <code>num&lt;str&lt;arr</code>)</li><li><code>@val_type_desc</code>：按值降序比较，此外数组类型出现在前面，接着是字符串类型，最后是数值型(即认为 <code>num&lt;str&lt;arr</code>)</li><li><code>@val_str_asc</code>：按值升序比较，数值转换成字符串再比较，而数组出现在尾部(即认 <code>str&lt;arr</code>)</li><li><code>@val_str_desc</code>：按值降序比较，数值转换成字符串再比较，而数组出现在头部(即认 <code>str&lt;arr</code>)</li><li><code>@val_num_asc</code>：按值升序比较，字符串转换成数值再比较，而数组出现在尾部(即认 <code>num&lt;arr</code>)</li><li><code>@val_num_desc</code>：按值降序比较，字符串转换成数值再比较，而数组出现在头部(即认为 <code>num&lt;arr</code>)</li></ul></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;one&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;two&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;three&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;aa&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;b&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;bb&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;ten&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)">#PROCINFO[&quot;sorted_in&quot;] = &quot;@ind_num_asc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)">#PROCINFO[&quot;sorted_in&quot;] = &quot;@ind_str_asc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     PROCINFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;sorted_in&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;@val_str_asc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     for</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">idx </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       print idx </span><span class="token string" style="color:rgb(163, 21, 21)">&quot; -&gt; &quot;</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> aa</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">b -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> bb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> one</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> ten</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> three</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> two</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11318awk-argc-和-argv">1.1.3.18、awk ARGC 和 ARGV<a class="hash-link" href="#11318awk-argc-和-argv" title="标题的直接链接">​</a></h4><p>预定义变量 ARGV 是一个数组，包含了所有的命令行参数。该数组使用从 0 开始的数值作为索引。</p><p>预定义变量 ARGC 初始时是 ARGV 数组的长度，即命令行参数的数量。</p><p>ARGV 数组的数量和 ARGC 的值只有在 awk 刚开始运行的时候是保证相等的。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk -va=1 -F: &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print ARGC</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     for</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">       print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;ARGV[&quot;</span><span class="token plain"> i </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;]= &quot;</span><span class="token plain"> ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">&#x27; </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">b</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> a.txt b.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">b</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> b.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>awk 读取文件是根据 ARGC 的值来进行的，有点类似于如下伪代码形式：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">while</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">ARGC</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">i++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> from ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认情况下，awk 在读完 ARGV 中的一个文件时，会自动从它的下一个元素开始读取，直到读完所有文件。</p><p>直接减小 ARGC 的值，会导致 awk 不会读取尾部的一些文件。此外，增减 ARGC 的值，都不会影响 ARGV 数组，仅仅只是影响 awk 读取文件的数量。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 不会读取b.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{ARGC=2}{print}&#x27; a.txt b.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 读完b.txt后自动退出</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{ARGC=5}{print}&#x27; a.txt b.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以将 ARGV 中某个元素赋值为空字符串 &quot;&quot;，awk 在选择下一个要读取的文件时，会自动忽略 ARGV 中的空字符串元素。也可以 <code>delete ARGV[i]</code> 的方式来删除 ARGV 中的某元素。</p><p>用户手动增、删 ARGV 元素时，不会自动修改 ARGC，而 awk 读取文件时是根据 ARGC 值来确定的。所以，在增加 ARGV 元素之后，要手动的去增加 ARGC 的值。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 不会读取b.txt文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{ARGV[2]=&quot;b.txt&quot;}{print}&#x27; a.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 会读取b.txt文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;BEGIN{ARGV[2]=&quot;b.txt&quot;;ARGC++}{print}&#x27; a.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 判断命令行中给定文件是否可读</p></blockquote><p>awk 命令行中可能会给出一些不存在或无权限或其它原因而无法被 awk 读取的文件名，这时可以判断并从中剔除掉不可读取的文件。</p><ul><li>排除命令行尾部(非选项型参数)的 <code>var=val</code>、<code>-</code>、和 <code>/dev/stdin</code> 这 3 种特殊情况</li><li>如果不可读，则从 <code>ARGV</code> 中删除该参数</li><li>剩下的都是可在 <code>main</code> 代码段正常读取的文件</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  for</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">ARGC</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">i++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> ~ /</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">a-zA-Z_</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">a-zA-Z0-9_</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">*</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">.*/ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"> ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"> ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/dev/stdin&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">((</span><span class="token plain">getline var </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      delete ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> else</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      close</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ARGV</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11319awk-自定义函数">1.1.3.19、awk 自定义函数<a class="hash-link" href="#11319awk-自定义函数" title="标题的直接链接">​</a></h4><p>可以定义一个函数将多个操作整合在一起。函数定义之后，可以到处多次调用，从而方便复用。</p><p>使用 function 关键字来定义函数：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> func_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">parameters</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    function_body</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于 gawk 来说，也支持 func 关键字来定义函数。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">func </span><span class="token function-name function" style="color:rgb(0, 0, 255)">func_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>函数可以定义在下面使用下划线的地方：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;_ BEGIN{} _ MAIN{} _ END{} _&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>无论函数定义在哪里，都能在任何地方调用，因为 awk 在 BEGIN 之前，会先编译 awk 代码为内部格式，在这个阶段会将所有函数都预定义好。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    BEGIN{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        f()</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        f()</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        f()</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    function f(){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        print &quot;星期一&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        print &quot;星期二&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        print &quot;星期三&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        print &quot;星期四&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        print &quot;星期五&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        print &quot;星期六&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        print &quot;星期日&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 函数的 return 语句</p></blockquote><p>如果想要让函数有返回值，那么需要在函数中使用 return 语句。return 语句也可以用来立即结束函数的执行。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(0, 0, 255)">add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         res </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print res</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果不使用 return 或 return 没有参数，则返回值为空，即空字符串。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(0, 0, 255)">f1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(0, 0, 255)">f2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">return  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(0, 0, 255)">f3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">return </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain">f1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain">f2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain">f3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-3-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 函数参数</p></blockquote><p>为了让函数和调用者能够进行数据的交互，可以使用参数。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a,b</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print b</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">return</span><span class="token plain"> a+b</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">x</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">y</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     res </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x,y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print res</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     print f</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x,y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>例如，实现一个重复某字符串指定次数的函数：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># awk &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> repeat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">str,cnt  ,res_str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         for</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">cnt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">i++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">             res_str </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> res_str</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token plain">str</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">return</span><span class="token plain"> res_str</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     BEGIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print repeat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;abc&quot;</span><span class="token plain">,3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         print repeat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain">,30</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">abcabcabc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>调用函数时，实参数量可以比形参数量少，也可以比形参数量多。但是，在多于形参数量时会给出警告信息。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  function f(a,b){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print a</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print b</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    return a+b</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  BEGIN{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    x=10</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    y=20</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print &quot;---1----&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print &quot;-&quot;f()&quot;-&quot;          # 不传递参数</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print &quot;---2----&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print &quot;-&quot;f(30)&quot;-&quot;        # 传递1个参数</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print &quot;---3----&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print &quot;-&quot;f(10,20,30)&quot;-&quot;  # 传递多个参数</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 函数参数数据类型冲突问题</p></blockquote><p>如果函数内部使用参数的类型和函数外部变量的类型不一致，会出现数据类型不同而导致报错。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    function f(a){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        a[1]=30</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    BEGIN{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        a=&quot;hello world&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        f(a)   # 报错</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        f(x)</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">        x=10   # 报错</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>函数内部参数对应的是数组，那么外面对应的也必须是数组类型。</p><blockquote><p>awk 参数按值传递还是按引用传递</p></blockquote><p>在调用函数时，将数据作为函数参数传递给函数时，有两种传递方式：</p><ul><li>传递普通变量时，是按值拷贝传递<ul><li>直接拷贝普通变量的值到函数中</li><li>函数内部修改不会影响到外部</li></ul></li><li>传递数组时，是按引用传递<ul><li>函数内部修改会影响到外部</li></ul></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 传递普通变量：按值拷贝</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  function modify(a){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    a=30</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print a</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  BEGIN{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    a=40</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    modify(a)</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print a</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 传递数组：按引用拷贝</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  function modify(a){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    a[1]=20</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  BEGIN{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    a[1]=10</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    modify(a)</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print a[1]</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>awk 作用域问题</p></blockquote><p>awk 只有在函数参数中才是局部变量，其它地方定义的变量均为全局变量。</p><p>函数内部新增的变量是全局变量，会影响到全局，所以在函数退出后仍然能访问。例如上面的 e 变量。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  function f(){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    a=30  # 新增的变量，是全局变量</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print &quot;in f: &quot; a</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  BEGIN{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    a=40</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    f()</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print a  # 30</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>函数参数会遮掩全局同名变量，所以在函数执行时，无法访问到或操作与参数同名的全局变量，函数退出时会自动撤掉遮掩，这时才能访问全局变量。所以，参数具有局部效果。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  function f(a){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print a    # 50，按值拷贝，和全局a已经没有关系</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    a=40</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print a    # 40</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  BEGIN{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    a=50</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    f(a)</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print a     # 50，函数退出，重新访问全局变量</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于函数内部新增变量均为全局变量，awk 也没有提供关键字来修饰一个变量使其成为局部变量。所以，awk 只能将本该出现在函数体内的局部变量放在参数列表中，只要调用函数时不要为这些参数传递数据即可，从而实现局部变量的效果。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  function f(a,b       ,c,d){</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    # a,b是参数，调用时需传递两个参数</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    # c,d是局部变量，调用时不要给c和d传递数据</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    a=30</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    b=40</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    c=50</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    d=60</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    e=70  # 全局变量</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print a,b,c,d,e  # 30 40 50 60 70</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  BEGIN{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    a=31</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    b=41</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    c=51</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    d=61</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    f(a,b)  # 调用函数时值传递两个参数</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    print a,b,c,d,e  # 31 41 51 61 70</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所以，awk 对函数参数列表做了两类区分：</p><ul><li>arguments：调用函数时传递的参数</li><li>local variables：调用函数时省略的参数</li></ul><p>为了区分 arguments 和 local variables，约定俗成的，将 local variables 放在一大堆空格后面来提示用户。例如 <code>function name(a,b, c,d)</code> 表示调用函数时，应当传递两个参数，c 和 d 是本函数内部使用的局部变量，不要传递对应的参数。</p><p>区分参数和局部变量：</p><ul><li>参数提供了函数和它调用者进行数据交互的方式</li><li>局部变量是临时存放数据的地方</li></ul><p>arguments 部分体现的是函数调用时传递的参数，这些参数在函数内部会遮掩全局同名变量。例如上面示例中，函数内部访问不了全局的 a 和 b，所有对 a 和 b 的操作都是函数内部的，函数退出后才能重新访问全局 a 和 b。因此，arguments 也有局部特性。</p><p>local variables 是 awk 实现真正局部变量的技巧，只是因为函数内部新增的变量都是全局变量，所以退而求其次将其放在参数列表上来实现局部变量。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11320awk-选项内置变量">1.1.3.20、awk 选项、内置变量<a class="hash-link" href="#11320awk-选项内置变量" title="标题的直接链接">​</a></h4><blockquote><p>选项</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-e program-text</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--source program-text</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">指定awk程序表达式，可结合-f选项同时使用</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">在使用了-f选项后，如果不使用-e，awk program是不会执行的，它会被当作ARGV的一个参数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-f program-file</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--file program-file</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">从文件中读取awk源代码来执行，可指定多个-f选项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-F fs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--field-separator fs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">指定输入字段分隔符</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">FS预定义变量也可设置</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-n</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--non-decimal-data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">识别文件输入中的8进制数</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">开头</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">和16进制数</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">0x开头</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;030&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> -n </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;{print $1+0}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-o </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">filename</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">格式化awk代码。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">不指定filename时，则默认保存到awkprof.out</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">指定为</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token variable" style="color:rgb(9, 134, 88)">-</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token plain">时，表示输出到标准输出</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">val</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--assign </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">val</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">在BEGIN之前，声明并赋值变量var，变量可在BEGIN中使用</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>预定义变量</p></blockquote><p>预定义变量分为两类：控制 awk 工作的变量和携带信息的变量。</p><p>第一类：控制 AWK 工作的预定义变量</p><ul><li><code>RS</code>：输入记录分隔符，默认为换行符 <code>\n</code></li><li><code>IGNORECASE</code>：默认值为 0，表示所有的正则匹配不忽略大小写。设置为非 0 值（例如 1），之后的匹配将忽略大小写。例如在 BEGIN 块中将其设置为 1，将使 FS、RS 都以忽略大小写的方式分隔字段或分隔 record</li><li><code>FS</code>：读取记录后，划分为字段的字段分隔符。</li><li><code>FIELDWIDTHS</code>：以指定宽度切割字段而非按照 FS。</li><li><code>FPAT</code>：以正则匹配匹配到的结果作为字段，而非按照 FS 划分。</li><li><code>OFS</code>：print 命令输出各字段列表时的输出字段分隔符，默认为空格 &quot; &quot;</li><li><code>ORS</code>：print 命令输出数据时在尾部自动添加的记录分隔符，默认为换行符 <code>\n</code></li><li><code>CONVFMT</code>：在 awk 中数值隐式转换为字符串时，将根据 CONVFMT 的格式按照 sprintf() 的方式自动转换为字符串。</li><li><code>OFMT</code>：在 print 中，数值会根据 OFMT 的格式按照 sprintf() 的方式自动转换为字符串。</li></ul><p>第二类：携带信息的预定义变量</p><ul><li><code>ARGC</code> 和 <code>ARGV</code>：awk 命令行参数的数量、命令参数的数组。</li><li><code>ARGIND</code>：awk 当前正在处理的文件在 ARGV 中的索引位置。所以，如果 awk 正在处理命令行参数中的某文件，则 <code>ARGV[ARGIND] == FILENAME</code> 为真</li><li><code>FILENAME</code>：awk 当前正在处理的文件(命令行中指定的文件)，所以在 BEGIN 中该变量值为空</li><li><code>ENVIRON</code>：保存了 Shell 的环境变量的数组。例如 <code>ENVIRON[&quot;HOME&quot;]</code> 将返回当前用户的家目录</li><li><code>NR</code>:当前已读总记录数，多个文件从不会重置为 0，所以它是一直叠加的<ul><li>可以直接修改 NR，下次读取记录时将在此修改值上自增</li></ul></li><li><code>FNR</code>:当前正在读取文件的第几条记录，每次打开新文件会重置为 0<ul><li>可以直接修改 FNR，下次读取记录时将在此修改值上自增</li></ul></li><li><code>NF</code>：当前记录的字段数</li><li><code>RT</code>：在读取记录时真正的记录分隔符</li><li><code>RLENGTH</code>：match() 函数正则匹配成功时，所匹配到的字符串长度，如果匹配失败，该变量值为 -1</li><li><code>RSTART</code>：match() 函数匹配成功时，其首字符的索引位置，如果匹配失败，该变量值为 0</li><li><code>SUBSEP</code>：<code>arr[x,y]</code> 中下标分隔符构建成索引时对应的字符，默认值为 <code>\034</code>，是一个不太可能出现在字符串中的不可打印字符。</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11321综合案例">1.1.3.21、综合案例<a class="hash-link" href="#11321综合案例" title="标题的直接链接">​</a></h4><p>请参见 <a href="https://www.brinnatt.com/addons/%e7%ac%ac-a-1-%e7%ab%a0-awk-examples/" target="_blank" rel="noopener noreferrer">Awk Examples</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12网络抓包和扫描">1.2、网络抓包和扫描<a class="hash-link" href="#12网络抓包和扫描" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="121tcpdump-命令">1.2.1、tcpdump 命令<a class="hash-link" href="#121tcpdump-命令" title="标题的直接链接">​</a></h3><p>tcpdump 采用命令行方式对接口的数据包进行筛选抓取，其丰富特性表现在灵活的表达式上。不带任何选项的 tcpdump，默认会抓取第一个网络接口，且只有将 tcpdump 进程终止才会停止抓包。</p><blockquote><p>tcpdump 选项</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">tcpdump </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -DenNqvX </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -c count </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -F </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -i interface </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -r </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -s snaplen </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -w </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> expression </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">抓包选项：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-c:             指定要抓取的包数量。注意，是最终要获取这么多个包。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                例如，指定</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-c 10&quot;</span><span class="token plain">将获取10个包，但可能已经处理了100个包，只不过只有10个包是满足条件的包。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-i interface:   指定tcpdump需要监听的接口。若未指定该选项，将从系统接口列表中搜寻编号最小的已配置好的接口，</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                不包括loopback接口，要抓取loopback接口使用tcpdump -i lo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                一旦找到第一个符合条件的接口，搜寻马上结束。可以使用</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;any&#x27;</span><span class="token plain">关键字表示所有网络接口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-n:             对地址以数字方式显式，否则显式为主机名，也就是说-n选项不做主机名解析。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-nn:            除了-n的作用外，还把端口显示为数值，否则显示端口服务名。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-N:             不打印出host的域名部分。例如tcpdump将会打印</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;nic&#x27;</span><span class="token plain">而不是</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;nic.ddn.mil&#x27;</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-P:             指定要抓取的包是流入还是流出的包。可以给定的值为</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;in&quot;</span><span class="token plain">、</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;out&quot;</span><span class="token plain">和</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;inout&quot;</span><span class="token plain">，默认为</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;inout&quot;</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-s len:         设置tcpdump的数据包抓取长度为len，如果不设置默认将会是65535字节。对于要抓取的数据包较大时，</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                长度设置不够可能会产生包截断，若出现包截断，输出行中会出现</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;[|proto]&quot;</span><span class="token plain">的标志</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">proto实际会显示为协议名</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                但是抓取len越长，包的处理时间越长，并且会减少tcpdump可缓存的数据包的数量，从而会导致数据包的丢失，</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                所以在能抓取我们想要的包的前提下，抓取长度越小越好。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">输出选项：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-e:             输出的每行中都将包括数据链路层头部信息，例如源MAC和目标MAC。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-q:             快速打印输出。即打印很少的协议相关信息，从而输出行都比较简短。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-X:             输出包的头部数据，会以16进制和ASCII两种方式同时输出。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-XX:            输出包的头部数据，会以16进制和ASCII两种方式同时输出，更详细。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v:             当分析和打印的时候，产生详细的输出。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-vv:            产生比-v更详细的输出。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-vvv:           产生比-vv更详细的输出。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">其他功能性选项：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-D:             列出可用于抓包的接口。将会列出接口的数值编号和接口名，它们都可以用于</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-i&quot;</span><span class="token plain">后。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-F:             从文件中读取抓包的表达式。若使用该选项，则命令行中给定的其他表达式都将失效。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-w:             将抓包数据输出到文件中而不是标准输出。可以同时配合</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-G time&quot;</span><span class="token plain">选项使得输出文件每time秒就自动切换到另一个文件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                可通过</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-r&quot;</span><span class="token plain">选项载入这些文件以进行分析和打印。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-r:             从给定的数据包文件中读取数据。使用</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain">表示从标准输入中读取。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所以常用的选项也就这几个：</p><ul><li>tcpdump -D</li><li>tcpdump -c num -i int -nn -XX -vvv</li></ul><blockquote><p>tcpdump 表达式</p></blockquote><p>表达式用于筛选输出哪些类型的数据包，如果没有给定表达式，所有的数据包都将输出，否则只输出表达式为 true 的包。在表达式中出现的 shell 元字符建议使用单引号包围。</p><p>tcpdump 的表达式由一个或多个 &quot;单元&quot; 组成，每个单元一般包含 ID 的修饰符和一个 ID(数字或名称)。有三种修饰符：</p><ol><li>type：指定 ID 的类型。<ul><li>可以给定的值有 host/net/port/portrange。</li><li>例如 &quot;host foo&quot;，&quot;net 128.3&quot;，&quot;port 20&quot;，&quot;portrange 6000-6008&quot;。默认的 type 为 host。</li></ul></li><li>dir：指定 ID 的方向。<ul><li>可以给定的值包括 src/dst/src or dst/src and dst，默认为 src or dst。</li><li>例如，&quot;src foo&quot; 表示源主机为 foo 的数据包，&quot;dst net 128.3&quot; 表示目标网络为 128.3 的数据包，&quot;src or dst port 22&quot; 表示源或目的端口为 22 的数据包。</li></ul></li><li>proto：通过给定协议限定匹配的数据包类型。<ul><li>常用的协议有 tcp/udp/arp/ip/ether/icmp 等，若未给定协议类型，则匹配所有可能的类型。</li><li>例如 &quot;tcp port 21&quot;，&quot;udp portrange 7000-7009&quot;。</li></ul></li></ol><p>所以，一个基本的表达式单元格式为 &quot;proto dir type ID&quot;</p><p><img loading="lazy" alt="tcpdump" src="/assets/images/tcpdump-9ba0c8e214d6339e0184a9512559ed85.png" width="1011" height="374" class="img_ev3q"></p><p>除了使用修饰符和 ID 组成的表达式单元，还有关键字表达式单元：gateway，broadcast，less，greater 以及算术表达式。表达式单元之间可以使用操作符 <code>&quot; and / &amp;&amp; / or / || / not / ! &quot;</code> 进行连接，从而组成复杂的条件表达式。</p><blockquote><p>tcpdump 示例</p></blockquote><ol><li><p>默认启动</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>注意，tcpdump 只能抓取<strong>流经本机</strong>的数据包。</li><li>默认情况下，直接启动 tcpdump 将监视第一个网络接口(非 lo 口)上所有流通的数据包。这样抓取的结果会非常多，滚动非常快。</li></ul></li><li><p>监视指定网络接口的数据包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump -i eth0 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>如果不指定网卡，默认 tcpdump 只会监视第一个网络接口，如 eth0。</li></ul></li><li><p>监视指定主机的数据包，例如所有进入或离开 arm64v8 的数据包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump host arm64v8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>打印 arm64v8&lt;--&gt;brinnatt 或 arm64v8&lt;--&gt;printer 之间通信的数据包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump host arm64v8 and \( brinnatt or printer \)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>打印 arm64v8 与任何其他主机之间通信的 IP 数据包,但不包括与 brinnatt 之间的数据包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump ip host arm64v8 and not brinnatt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>截获主机 arm64v8 发送的所有数据</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump src host arm64v8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>监视指定主机和端口的数据包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump tcp port 22 and host arm64v8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>监视指定网络的数据包，如本机与 10.51.111 网段通信的数据包，&quot;-c 10&quot; 表示只抓取 10 个包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump -c 10 net 10.51.111</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>抓取 ping 包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump -c 5 -nn -i eth0 icmp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcpdump: verbose output suppressed, use -v or -vv </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> full protocol decode</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">listening on eth0, link-type EN10MB </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Ethernet</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">, capture size </span><span class="token number" style="color:rgb(9, 134, 88)">262144</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:43:47.202288 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.1: ICMP </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> request, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5327</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">seq</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:43:47.203538 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.1 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142: ICMP </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> reply, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5327</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">seq</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:43:48.203592 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.1: ICMP </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> request, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5327</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">seq</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:43:48.204751 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.1 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142: ICMP </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> reply, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5327</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">seq</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:43:49.204790 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.1: ICMP </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> request, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5327</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">seq</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> packets captured</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> packets received by filter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> packets dropped by kernel</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果明确要抓取主机为 10.51.111.52 对本机的 ping，则使用 and 操作符。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump -c 5 -nn -i eth0 icmp and src 10.51.111.52</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcpdump: verbose output suppressed, use -v or -vv </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> full protocol decode</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">listening on eth0, link-type EN10MB </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Ethernet</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">, capture size </span><span class="token number" style="color:rgb(9, 134, 88)">262144</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:45:59.686057 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142: ICMP </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> request, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">seq</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">92</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:46:00.692499 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142: ICMP </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> request, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">seq</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">93</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:46:01.727462 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142: ICMP </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> request, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">seq</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">94</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:46:03.000676 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142: ICMP </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> request, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">seq</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">95</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:46:03.748285 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142: ICMP </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> request, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">seq</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">96</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> packets captured</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> packets received by filter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> packets dropped by kernel</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>注意不能直接写 icmp src 10.51.111.52，因为 icmp 协议不支持直接应用 host 这个 type。</li></ul></li><li><p>抓取到本机 22 端口包</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump -c 5 -nn -i eth0 tcp dst port 22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcpdump: verbose output suppressed, use -v or -vv </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> full protocol decode</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">listening on eth0, link-type EN10MB </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Ethernet</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">, capture size </span><span class="token number" style="color:rgb(9, 134, 88)">262144</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:48:51.781168 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52.5679 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142.22: Flags </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, ack </span><span class="token number" style="color:rgb(9, 134, 88)">3276621926</span><span class="token plain">, win </span><span class="token number" style="color:rgb(9, 134, 88)">510</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:48:51.781182 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52.2414 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142.22: Flags </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, ack </span><span class="token number" style="color:rgb(9, 134, 88)">319842498</span><span class="token plain">, win </span><span class="token number" style="color:rgb(9, 134, 88)">509</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:48:51.783513 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52.2414 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142.22: Flags </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, ack </span><span class="token number" style="color:rgb(9, 134, 88)">329</span><span class="token plain">, win </span><span class="token number" style="color:rgb(9, 134, 88)">508</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:48:51.851711 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52.2414 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142.22: Flags </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, ack </span><span class="token number" style="color:rgb(9, 134, 88)">477</span><span class="token plain">, win </span><span class="token number" style="color:rgb(9, 134, 88)">507</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:48:52.332314 IP </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52.2414 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142.22: Flags </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, ack </span><span class="token number" style="color:rgb(9, 134, 88)">625</span><span class="token plain">, win </span><span class="token number" style="color:rgb(9, 134, 88)">513</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> packets captured</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> packets received by filter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> packets dropped by kernel</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>解析包数据</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tcpdump -c 2 -q -XX -vvv -nn -i eth0 tcp dst port 22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcpdump: listening on eth0, link-type EN10MB </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Ethernet</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">, capture size </span><span class="token number" style="color:rgb(9, 134, 88)">262144</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:49:36.623578 IP </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tos 0x0, ttl </span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14045</span><span class="token plain">, offset </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">DF</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, proto TCP </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52.2414 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142.22: tcp </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    0x0000:  0007 3e9b 155a e4a4 71bf b661 0800 </span><span class="token number" style="color:rgb(9, 134, 88)">4500</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">Z</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">q</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">E.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    0x0010:  0028 36dd </span><span class="token number" style="color:rgb(9, 134, 88)">4000</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4006</span><span class="token plain"> 10cb 0a33 6f34 0a33  .</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">.@.@</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">3o4.3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    0x0020:  6f8e 096e 0016 fbf5 a621 </span><span class="token number" style="color:rgb(9, 134, 88)">1310</span><span class="token plain"> 815e </span><span class="token number" style="color:rgb(9, 134, 88)">5010</span><span class="token plain">  o</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.^P.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    0x0030:  0200 7aa2 0000 0000 0000 0000            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">02:49:36.628549 IP </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tos 0x0, ttl </span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain">, </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14046</span><span class="token plain">, offset </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">DF</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, proto TCP </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">, length </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52.2414 </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.142.22: tcp </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    0x0000:  0007 3e9b 155a e4a4 71bf b661 0800 </span><span class="token number" style="color:rgb(9, 134, 88)">4500</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">Z</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">q</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">E.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    0x0010:  0028 36de </span><span class="token number" style="color:rgb(9, 134, 88)">4000</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4006</span><span class="token plain"> 10ca 0a33 6f34 0a33  .</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">.@.@</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">3o4.3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    0x0020:  6f8e 096e 0016 fbf5 a621 </span><span class="token number" style="color:rgb(9, 134, 88)">1310</span><span class="token plain"> 83de </span><span class="token number" style="color:rgb(9, 134, 88)">5010</span><span class="token plain">  o</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">P.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    0x0030:  01fe </span><span class="token number" style="color:rgb(9, 134, 88)">7824</span><span class="token plain"> 0000 0000 0000 0000            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">x$</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> packets captured</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> packets received by filter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> packets dropped by kernel</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="122nmap-命令">1.2.2、nmap 命令<a class="hash-link" href="#122nmap-命令" title="标题的直接链接">​</a></h3><blockquote><p>安装</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install nmap -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Loaded plugins: fastestmirror, langpacks</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Loading mirror speeds from cached hostfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Package </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">:nmap-6.40-19.axs7.aarch64 already installed and latest version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Nothing to </span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>nmap 命令语法</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">nmap </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Scan Type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">target specification</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-iL </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">inputfilename</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:  从输入文件中读取主机或者IP列表作为探测目标</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-sn:                    PING扫描，但是禁止端口扫描。默认总是会扫描端口。禁用端口扫描可以加速扫描主机</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-n/-R:                  永远不要/总是进行DNS解析，默认情况下有时会解析</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-PE/PP/PM:              分别是基于echo/timestamp/netmask的ICMP探测报文方式。使用echo最快</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-sS/sT/sA/sW:           TCP SYN/Connect</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">/ACK/Window，其中sT扫描表示TCP扫描</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-sU:                    UDP扫描</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-sO:                    IP扫描</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-p </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">port ranges</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:     指定扫描端口</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-v:                     显示详细信息，使用-vv或者更多的v显示更详细的信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-oN/-oX/ </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">file</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      输出扫描结果到普通文件或XML文件中。输入到XML文件中的结果是格式化的结果</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--min-hostgroup/max-hostgroup </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">size</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:             对目标主机进行分组然后组之间并行扫描</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--min-parallelism/max-parallelism </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">numprobes</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:        设置并行扫描的探针数量</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>尝试一次扫描</p></blockquote><p>nmap 扫描一般会比较慢，特别是扫描非本机的时候。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># nmap 127.0.0.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Starting Nmap </span><span class="token number" style="color:rgb(9, 134, 88)">6.40</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> http://nmap.org </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> at </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-09-24 03:05 CST</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Nmap scan report </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> localhost </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Host is up </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">.0000090s latency</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Not shown: </span><span class="token number" style="color:rgb(9, 134, 88)">996</span><span class="token plain"> closed ports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PORT    STATE SERVICE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">/tcp  </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">/tcp  </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  smtp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">/tcp </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  rpcbind</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">631</span><span class="token plain">/tcp </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  ipp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Nmap done: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> IP address </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">host</span><span class="token plain"> up</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> scanned </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1.74</span><span class="token plain"> seconds</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>只扫描出了 4 个端口，但是不代表真的只开了 4 个端口，这样不加任何参数的 nmap 将自动决定扫描 1000 个高危端口，但哪些是高危端口由 nmap 决定。</li><li>从结果中也能看出来，&quot;NOT shown:996 closed ports&quot; 表示 996 个关闭的端口未显示出来，随后又显示了 4 个 open 端口，正好 1000 个。虽说默认只扫描 1000 个，但常见的端口都能扫描出来。</li></ul><p>从 arm64 台式机扫描 x86 windows 看看。可以感受到，扫描速度明显降低了。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># nmap 10.51.111.52</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Starting Nmap </span><span class="token number" style="color:rgb(9, 134, 88)">6.40</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> http://nmap.org </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> at </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain">-09-24 03:08 CST</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Nmap scan report </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.52</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Host is up </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">.014s latency</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Not shown: </span><span class="token number" style="color:rgb(9, 134, 88)">992</span><span class="token plain"> filtered ports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PORT     STATE SERVICE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">135</span><span class="token plain">/tcp  </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  msrpc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">139</span><span class="token plain">/tcp  </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  netbios-ssn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain">/tcp  </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  https</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">445</span><span class="token plain">/tcp  </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  microsoft-ds</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">902</span><span class="token plain">/tcp  </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  iss-realsecure</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">912</span><span class="token plain">/tcp  </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  apex-mesh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1031</span><span class="token plain">/tcp </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  iad2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5357</span><span class="token plain">/tcp </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  wsdapi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">MAC Address: E4:A4:71:BF:B6:61 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Unknown</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Nmap done: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> IP address </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">host</span><span class="token plain"> up</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> scanned </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">33.28</span><span class="token plain"> seconds</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>可以指定 &quot;-p <!-- -->[<!-- -->1-65535<!-- -->]<!-- -->&quot; 来扫描所有端口，或者使用 &quot;-p-&quot; 选项也是全面扫描。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># nmap -p- 127.0.0.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>nmap 默认总是会扫描端口，可以使用 -sn 选项禁止扫描端口，以加速扫描主机是否存活。</p></li></ul><blockquote><p>扫描目标说明</p></blockquote><p>Nmap 支持 CIDR 风格的地址，Nmap 将会扫描所有和<strong>该参考 IP 地址</strong>具有相同 cidr 位数的所有 IP 地址或主机。</p><p>CIDR 标志位很简洁但有时候不够灵活。可以用逗号分开的数字或范围列表为 IP 地址指定它的范围。例如 &quot;192.168.0-255.1-254&quot; 将略过该范围内以 &quot;.0&quot; 和 &quot;.255&quot; 结束的地址。</p><p>Nmap 命令行接受多个主机说明，它们不必是相同类型。如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">nmap www.hostname.com </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.0.0/8 </span><span class="token number" style="color:rgb(9, 134, 88)">10.0</span><span class="token plain">.0,1,3-7.0-255</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>虽然目标通常在命令行指定，下列选项也可用来控制目标的选择：</p><ul><li><code>-iL &lt;inputfilename&gt;</code> ：从列表中输入</li><li><code>--exclude &lt;host1[，host2][，host3]，...&gt;</code>：排除主机/网络</li><li><code>--excludefile &lt;excludefile&gt;</code>：排除文件中的列表，这和 --exclude 的功能一样，只是所排除的目标是用 <code>&lt;excludefile&gt;</code> 提供的。</li></ul><blockquote><p>范围扫描</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># nmap 10.51.111.0/24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Nmap scan report </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Host is up </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">.0018s latency</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Not shown: </span><span class="token number" style="color:rgb(9, 134, 88)">998</span><span class="token plain"> closed ports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PORT   STATE    SERVICE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">/tcp </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">     </span><span class="token function" style="color:rgb(0, 0, 255)">ftp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">/tcp filtered </span><span class="token function" style="color:rgb(0, 0, 255)">ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">MAC Address: 00:00:5E:00:01:6F </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">USC Information Sciences Inst</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Nmap scan report </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.51</span><span class="token plain">.111.10</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Host is up </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">.0022s latency</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Not shown: </span><span class="token number" style="color:rgb(9, 134, 88)">999</span><span class="token plain"> closed ports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PORT   STATE SERVICE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain">/tcp </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain">  telnet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">MAC Address: CC:D8:1F:1C:A0:F1 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Unknown</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Nmap done: </span><span class="token number" style="color:rgb(9, 134, 88)">256</span><span class="token plain"> IP addresses </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">57</span><span class="token plain"> hosts up</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> scanned </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6898.00</span><span class="token plain"> seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>总共花了 6898s，时间很漫长。</li><li>该局域网下面，有很多种设备，计算机、路由器、交换机和虚拟网卡等，所以可能有的设备只有一个 IP 地址和 MAC 地址，没有打开的端口号。</li></ul><blockquote><p>端口状态说明</p></blockquote><p>Nmap 功能越来越多，但它赖以成名的是它的核心功能——端口扫描。</p><p>Nmap 把端口分成六个状态：open(开放的)，closed(关闭的)，filtered(被过滤的)，unfiltered(未被过滤的)，open|filtered(开放或者被过滤的)，或者 closed|filtered(关闭或者被过滤的)。</p><p>这些状态并非端口本身的性质，而是描述 Nmap 怎样看待它们。例如，对于同样的目标机器的 135/tcp 端口，从同网络扫描显示它是开放的，而跨网络做完全相同的扫描则可能显示它是 filtered(被过滤的)。</p><ol><li>open：(开放的)有程序正在该端口接收 TCP 或者 UDP 报文。它常常是端口扫描的主要目标。</li><li>closed：(关闭的)关闭的端口对于 Nmap 也是可访问的(它接受 Nmap 的探测报文并作出响应)，但没有应用程序在其上监听。</li><li>filtered：(被过滤的)由于目标上设置了包过滤(如防火墙设备)，使得探测报文被阻止到达端口，Nmap 无法确定该端口是否开放。过滤可能来自专业的防火墙设备，路由器规则或者主机上的软件防火墙。</li><li>unfiltered：(未被过滤的)未被过滤状态意味着端口可访问，但 Nmap 不能确定它是开放还是关闭。用其它类型的扫描如窗口扫描、SYN 扫描、FIN 扫描来扫描这些未被过滤的端口可以帮助确定端口是否开放。</li><li>open|filtered：(开放或被过滤的)当无法确定端口是开放还是被过滤的，Nmap 就把该端口划分成这种状态。开放的端口不响应就是一个例子。没有响应也可能意味着目标主机上报文过滤器丢弃了探测报文或者它引发的任何响应。因此 Nmap 无法确定该端口是开放的还是被过滤的。</li><li>closed|filtered：(关闭或被过滤的)该状态用于 Nmap 不能确定端口是关闭的还是被过滤的。它只可能出现在 IPID Idle 扫描中。</li></ol><blockquote><p>时间参数优化</p></blockquote><p>改善扫描时间的技术有：忽略非关键的检测、升级最新版本的 Nmap(文档中说 nmap 版本越高性能越好)等。</p><ol><li><p>-<!-- -->T&lt;0-5&gt;：这表示直接使用 namp 提供的扫描模板，不同的模板适用于不同的环境下，默认的模板为 &quot;-T 3&quot;，具体的看 man 文档，其实用的很少。</p></li><li><p>-<!-- -->-min-hostgroup <!-- -->\<code>&lt;milliseconds&gt;</code>; --max-hostgroup <!-- -->\<code>&lt;milliseconds&gt;</code>：调整并行扫描组的大小。</p><ul><li>Nmap 具有并行扫描多主机端口的能力，实现方法是将所有给定的目标 IP 按空间分成组，然后一次扫描一个组。</li><li>通常组分的越大效率越高，但分组的缺点是只有当整个组扫描结束后才会返回该组中主机扫描结果。例如，组的大小定义为 50，则只有前 50 个主机扫描结束后才能得到这 50 个 IP 内的结果。</li><li>默认方式下，Nmap 采取折衷的方法。开始扫描时的组较小，默认值为 5，这样便于尽快产生结果，随后增长组的大小，默认最大为 1024。但最小和最大确切的值则依赖于所给定的选项。</li><li>-<!-- -->-max-hostgroup 选项用于说明使用最大的组，Nmap 不会超出这个大小。</li><li>-<!-- -->-min-hostgroup 选项说明最小的组，Nmap 会保持组大于这个值。如果在指定的接口上没有足够的目标主机来满足所指定的最小值，Nmap 可能会采用比所指定的值小的组。</li></ul></li><li><p>-<!-- -->-min-parallelism <!-- -->\<code>&lt;milliseconds&gt;</code>; --max-parallelism <!-- -->\<code>&lt;milliseconds&gt;</code>：调整探测报文的并行度，即探针数。</p><ul><li>这些选项用于控制主机组的探测报文数量，可用于<strong>端口扫描和主机发现</strong>。</li><li>默认状态下，Nmap 基于网络性能计算一个理想的并行度，这个值经常改变。如果报文被丢弃，Nmap 降低速度，探测报文数量减少。随着网络性能的改善，理想的探测报文数量会缓慢增加。默认状态下，当网络不可靠时，理想的并行度值可能为 1，在好的条件下，可能会增长至几百。</li><li>最常见的应用是 --min-parallelism 值大于 1，以加快性能不佳的主机或网络的扫描。这个选项具有风险，如果过高则影响准确度，同时也会降低 Nmap 基于网络条件动态控制并行度的能力。一般说来，这个值要设置的和 --min-hostgroup 的值相等或大于它性能才会提升。</li></ul></li></ol><blockquote><p>扫描操作系统类型</p></blockquote><p>扫描操作系统。操作系统的扫描有可能会出现误报。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># nmap -O 127.0.0.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>快速扫描存活的主机</p></blockquote><p>要快速扫描存活的主机，需要使用的几个重要选项</p><ul><li>-<!-- -->n：永远不要 DNS 解析。这个不管是给定地址扫描还是给定网址扫描，加上它速度都会极速提升</li><li>-<!-- -->sn：禁止端口扫描</li><li>-<!-- -->PE：只根据 echo 回显判断主机在线，这种类型的选项使用越多，速度越慢，如 -PM -PP 选项都是类似的，但他们速度要慢的多的多，PE 有个缺点，不能穿透防火墙</li><li>-<!-- -->-min-hostgroup N：当 IP 太多时，nmap 需要分组，然后并扫描，使用该选项可以指定多少个 IP 一组</li><li>-<!-- -->-min-parallelism N：这个参数非常关键，为了充分利用系统和网络资源，设置好合理的探针数。一般来说，设置的越大速度越快，且和 min-hostgroup 的值相等或大于它性能才会提升</li></ul><p>示例一：扫描 10.51.111.0/24 网段存活的机器</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># nmap -sn -n -PE --min-hostgroup 1024 --min-parallelism 1024 10.51.111.0/24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Nmap done: </span><span class="token number" style="color:rgb(9, 134, 88)">256</span><span class="token plain"> IP addresses </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token plain"> hosts up</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> scanned </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0.74</span><span class="token plain"> seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>256 个 IP 地址，0.74s 完成，非常快</li></ul><p>示例二：再测试扫描下以 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 作为参考地址的地址空间。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># nmap -sn -PE -n --min-hostgroup 1024 --min-parallelism 1024 -oX nmap_output.xml www.baidu.com/16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Nmap done: </span><span class="token number" style="color:rgb(9, 134, 88)">65536</span><span class="token plain"> IP addresses </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">13160</span><span class="token plain"> hosts up</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> scanned </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">28.28</span><span class="token plain"> seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>65536 个 IP 地址，28.28s 完成，非常快</li></ul><blockquote><p>快速扫描端口</p></blockquote><p>既然是扫描端口，就不能使用 -sn 选项，也不能使用 -PE，否则不会返回端口状态，只会返回哪些主机。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># nmap -n -p 20-2000 --min-hostgroup 1024 --min-parallelism 1024 10.51.111.0/24</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/linux进阶"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Linux进阶</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux-advanced-2"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">第 2 章 Linux 防火墙</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#11-高效处理文本" class="table-of-contents__link toc-highlight">1.1 高效处理文本</a><ul><li><a href="#111grep-命令" class="table-of-contents__link toc-highlight">1.1.1、grep 命令</a><ul><li><a href="#1111grep-语法格式" class="table-of-contents__link toc-highlight">1.1.1.1、grep 语法格式</a></li><li><a href="#1112options-选项" class="table-of-contents__link toc-highlight">1.1.1.2、options 选项</a></li><li><a href="#1113pattern-模式" class="table-of-contents__link toc-highlight">1.1.1.3、pattern 模式</a></li></ul></li><li><a href="#112sed-命令" class="table-of-contents__link toc-highlight">1.1.2、sed 命令</a><ul><li><a href="#1121sed-语法格式" class="table-of-contents__link toc-highlight">1.1.2.1、sed 语法格式</a></li><li><a href="#1122options-选项" class="table-of-contents__link toc-highlight">1.1.2.2、options 选项</a></li><li><a href="#1123address-定址表达式" class="table-of-contents__link toc-highlight">1.1.2.3、address 定址表达式</a></li><li><a href="#1124command-功能命令" class="table-of-contents__link toc-highlight">1.1.2.4、command 功能命令</a></li></ul></li><li><a href="#113awk-命令" class="table-of-contents__link toc-highlight">1.1.3、awk 命令</a><ul><li><a href="#1131安装新版本-gawk" class="table-of-contents__link toc-highlight">1.1.3.1、安装新版本 gawk</a></li><li><a href="#1132awk-用例文件" class="table-of-contents__link toc-highlight">1.1.3.2、awk 用例文件</a></li><li><a href="#1133awk-用法入门" class="table-of-contents__link toc-highlight">1.1.3.3、awk 用法入门</a></li><li><a href="#1134begin-和-end-语句块" class="table-of-contents__link toc-highlight">1.1.3.4、BEGIN 和 END 语句块</a></li><li><a href="#1135awk-命令行结构和语法结构" class="table-of-contents__link toc-highlight">1.1.3.5、awk 命令行结构和语法结构</a></li><li><a href="#1136awk-读取行的细节" class="table-of-contents__link toc-highlight">1.1.3.6、awk 读取行的细节</a></li><li><a href="#1137awk-划分字段" class="table-of-contents__link toc-highlight">1.1.3.7、awk 划分字段</a></li><li><a href="#11380-重新计算" class="table-of-contents__link toc-highlight">1.1.3.8、$0 重新计算</a></li><li><a href="#1139awk-数据筛选示例" class="table-of-contents__link toc-highlight">1.1.3.9、awk 数据筛选示例</a></li><li><a href="#11310awk-工作流程" class="table-of-contents__link toc-highlight">1.1.3.10、awk 工作流程</a></li><li><a href="#11311getline-用法详解" class="table-of-contents__link toc-highlight">1.1.3.11、getline 用法详解</a></li><li><a href="#11312awk-变量" class="table-of-contents__link toc-highlight">1.1.3.12、awk 变量</a></li><li><a href="#11313数据类型和字面量" class="table-of-contents__link toc-highlight">1.1.3.13、数据类型和字面量</a></li><li><a href="#11314gawk-支持的正则表达式" class="table-of-contents__link toc-highlight">1.1.3.14、gawk 支持的正则表达式</a></li><li><a href="#11315awk-布尔值比较和逻辑运算" class="table-of-contents__link toc-highlight">1.1.3.15、awk 布尔值、比较和逻辑运算</a></li><li><a href="#11316awk-流程控制" class="table-of-contents__link toc-highlight">1.1.3.16、awk 流程控制</a></li><li><a href="#11317awk-数组" class="table-of-contents__link toc-highlight">1.1.3.17、awk 数组</a></li><li><a href="#11318awk-argc-和-argv" class="table-of-contents__link toc-highlight">1.1.3.18、awk ARGC 和 ARGV</a></li><li><a href="#11319awk-自定义函数" class="table-of-contents__link toc-highlight">1.1.3.19、awk 自定义函数</a></li><li><a href="#11320awk-选项内置变量" class="table-of-contents__link toc-highlight">1.1.3.20、awk 选项、内置变量</a></li><li><a href="#11321综合案例" class="table-of-contents__link toc-highlight">1.1.3.21、综合案例</a></li></ul></li></ul></li><li><a href="#12网络抓包和扫描" class="table-of-contents__link toc-highlight">1.2、网络抓包和扫描</a><ul><li><a href="#121tcpdump-命令" class="table-of-contents__link toc-highlight">1.2.1、tcpdump 命令</a></li><li><a href="#122nmap-命令" class="table-of-contents__link toc-highlight">1.2.2、nmap 命令</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">学习</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/skill">技术笔记</a></li><li class="footer__item"><a class="footer__link-item" href="/project">实战项目</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/linux">Linux</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/zqingfa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/website">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">浙ICP备20024502号-1</a></p><p>Copyright © 2022 - PRESENT zhangqf Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.9b8cde08.js"></script>
<script src="/assets/js/main.98aacc98.js"></script>
</body>
</html>