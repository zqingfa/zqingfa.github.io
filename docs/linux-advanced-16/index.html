<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-linux/advanced/linux-advanced-16">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">第 16 章 Linux Keepalived 服务配置 - Linux技术分享</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://zhangqf.com/docs/linux-advanced-16"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="第 16 章 Linux Keepalived 服务配置 - Linux技术分享"><meta data-rh="true" name="description" content="KeepAlived 主要有两个功能："><meta data-rh="true" property="og:description" content="KeepAlived 主要有两个功能："><meta data-rh="true" name="keywords" content="linux,keepalived"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhangqf.com/docs/linux-advanced-16"><link data-rh="true" rel="alternate" href="https://zhangqf.com/en/docs/linux-advanced-16" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-16" hreflang="zh"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-16" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9B0V5WT2X8-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Linux技术分享" href="/opensearch.xml">
<link rel="preconnect" href="https://zhangqf.com/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://zhangqf.com/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c9a3849aa75f9c4a4e65f846cd1a5155",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="zhangqf RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="zhangqf Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="zhangqf JSON Feed">

<link rel="icon" href="/img/logo.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><link rel="stylesheet" href="/assets/css/styles.86c9ae18.css">
<link rel="preload" href="/assets/js/runtime~main.9b8cde08.js" as="script">
<link rel="preload" href="/assets/js/main.98aacc98.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>更新 <a href="/website">网址导航</a> 带你发现感兴趣的技术</span></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">zhangqf</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/linux">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/category/Linux基础">Linux 基础</a></li><li><a class="dropdown__link" href="/docs/category/Linux进阶">Linux 进阶</a></li><li><a class="dropdown__link" href="/docs/category/Linux测试">Linux 测试</a></li><li><a class="dropdown__link" href="/docs/category/LinuxCICD">Linux CICD研发</a></li><li><a class="dropdown__link" href="/docs/skill/">笔记</a></li><li><a class="dropdown__link" href="/docs/tools/">工具推荐</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Blog</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags">标签</a></li><li><a class="dropdown__link" href="/archive">归档</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">工具</a><ul class="dropdown__menu"><li><a href="https://api.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">API服务</a></li><li><a href="https://js-de-obfuscator.vercel.app" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS代码还原</a></li><li><a href="https://cipher.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">CyberChef加密</a></li></ul></div><a class="navbar__item navbar__link" href="/website">导航</a><a class="navbar__item navbar__link" href="/project">项目</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"><b>zhangqf</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux基础">Linux基础</a><button aria-label="打开/收起侧边栏菜单「Linux基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/linux进阶">Linux进阶</a><button aria-label="打开/收起侧边栏菜单「Linux进阶」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-1">第 1 章 Linux 进阶命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-2">第 2 章 Linux 防火墙</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-3">第 3 章 Linux NFS 网络文件系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-4">第 4 章 Linux DHCP 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-5">第 5 章 Linux DNS 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-6">第 6 章 Linux httpd 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-7">第 7 章 Linux httpd 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-8">第 8 章 Linux httpd 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-9">第 9 章 Linux Nginx 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-10">第 10 章 Linux Tomcat 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-11">第 11 章 Linux Tomcat 服务实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-12">第 12 章 Linux haproxy 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-13">第 13 章 Linux haproxy 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-14">第 14 章 Linux haproxy 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-15">第 15 章 Linux LVS 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/linux-advanced-16">第 16 章 Linux Keepalived 服务配置</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux测试">Linux测试</a><button aria-label="打开/收起侧边栏菜单「Linux测试」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linuxcicd">Linux CICD研发</a><button aria-label="打开/收起侧边栏菜单「Linux CICD研发」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/linux进阶"><span itemprop="name">Linux进阶</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第 16 章 Linux Keepalived 服务配置</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>第 16 章 Linux Keepalived 服务配置</h1></header><p>KeepAlived 主要有两个功能：</p><ol><li>能够对 RealServer 进行健康状况检查，支持 4 层、5 层和 7 层协议进行健康检查；</li><li>对负载均衡调度器实现高可用，防止 Director 单点故障。</li></ol><p>在 keepalived 设计之初，它只是 LVS 周边的一个辅助工具，用于 LVS 的监控状况检查，因此它和 LVS 的兼容性非常好。</p><ul><li>如果某一个 realserver 节点宕了，keepalived 会将此节点从管理列表中踢出去，当此节点恢复后又将此节点加回管理列表，这样能够让 realserver 负载均衡变的智能化。</li><li>但是，此时的调度器存在单点故障的可能性，因此有必要对其实现高可用。</li></ul><p>实现 LVS 高可用可以使用多种软件来实现，如 heartbeat，但是 heartbeat 本身不能实现 ipvs 的健康状况检查，需要搭配 Ldirectord(安装完 heartbeat 就有了)来进行健康检查。</p><p>所幸的是 keepalived 后来也加入了高可用的功能，而且配置起来也相当简单。相比于 heartbeat+Ldirectord，keepalived 的检查速度极快，故障转移也极快，布置也简单的多。所以一般来说，要管理 ipvs，都会选择使用 keepalived。</p><p>keepalived 实现故障转移的功能是通过 VRRP(virtual router redundancy protocol 虚拟路由器冗余协议) 协议来实现的。</p><ul><li>在 keepalived 正常工作的时候，主节点(master)会不断的发送心跳信息给备节点(backup)，当备节点不能在一定时间内收到主节点的心跳信息时，备节点会认为主节点宕了，然后会接管主节点上的资源，并继续向外提供服务保证其可用性。</li><li>当主节点恢复的时候，备节点会自动让出资源并再次自动成为备节点。</li></ul><p><em>注意：使用 keepalived 监控、高可用 LVS 集群时(即常说的 keepalived+lvs)，并不需要在 Director 上使用 ipvsadm 等管理工具额外配置 ipvs 规则。因为 keepalived 中集合了管理 ipvs 规则的组件(即稍后模型图中的 ipvs wrapper)，可以直接在 keepalived 的配置文件中配置 ipvs 相关规则，在解析配置文件时会通过特定的组件将规则发送到内核中的 ipvs 模块。</em></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="101vrrp-协议">10.1、VRRP 协议<a class="hash-link" href="#101vrrp-协议" title="标题的直接链接">​</a></h2><p>VRRP 协议的出现是为了解决<strong>静态路由</strong>的单点故障，它是通过一种竞选机制来将路由任务交给某个 vrrp 路由器的。</p><p>在 VRRP 物理结构中，有多个物理的 VRRP 路由器，其中有一台称为 &quot;master&quot; 即主节点路由器，其他的都是 &quot;backup&quot; 备节点路由器，谁是 master 谁是 backup，这是通过他们的优先级来定义竞选的。</p><p>在 VRRP 虚拟结构中，虚拟路由器是通过 &quot;MAC+VRID&quot; 的形式来标识的，如 &quot;00-00-5E-00-01-{VRID}&quot;。在 VRRP 虚拟结构中，不管是 master 还是 backup，VRID 必须一致。它们对外都是相同的 VIP，客户端并不需要因为 master 的切换而修改自己的路由配置。</p><p>VRRP 结构中路由器之间的通信是通过 IP 多播的方式实现的(也可以配置为其它通信方式)。但是，只有 master 节点才会发送 VRRP 广告包(vrrp advertisement message)。当 master 节点宕掉的时候，backup 中优先级最高的 VRRP 设备会抢占并升级为 master。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="102keepalived-架构模型">10.2、keepalived 架构模型<a class="hash-link" href="#102keepalived-架构模型" title="标题的直接链接">​</a></h2><p>Keepalived 服务启动的时候，将产生三个相关进程，一个父进程和两个子进程。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">PID    </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">     Keepalived  </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">-- Parent process fork and monitor children</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">112</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">_ Keepalived   </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">-- VRRP child</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">113</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">_ Keepalived   </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">-- Healthchecking child</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>父进程负责 fork 和监控子进程，因此父进程也称为 WatchDog。两个子进程都会开启本地套接字 Unix Domain Socket。</li><li>当 keepalived 服务启动后，父进程会通过 unxi domain socket 每隔 5 秒发送一个 &quot;Hello&quot; 消息给子进程，如果父进程无法发送消息给子进程，将认为子进程出现问题，于是会重启子进程。</li></ul><p>下图是 keepalived 设计架构图：</p><p><img loading="lazy" alt="keepalived" src="/assets/images/keepalived-db3b76d1070d54376c7a50e4f5db19d7.png" width="1001" height="709" class="img_ev3q"></p><ul><li><code>Checkers 组件</code>：负责 RealServer 的健康状况检查，并在 LVS 的拓扑中移除、添加 RealServer。它支持 layer4/5/7 层的协议检查。该组件使用独立的子进程负责，但被父进程监控。</li><li><code>VRRP 组件</code>：提供 Director 的故障转移功能从而实现 Director 的高可用。该组件可独立提供功能，无需 LVS 的支持。该组件使用独立的子进程负责，但被父进程监控。</li><li><code>System Call 组件</code>：提供读取自定义脚本的功能。该组件在使用时，将临时产生一个子进程来执行任务。</li><li><code>IPVS wrapper 组件</code>：负责将配置文件中 IPVS 相关规则发送到内核的 ipvs 模块。</li><li><code>Netlink Reflector</code>：用来设定、监控 vrrp 的 vip 地址。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="103安装-keepalived">10.3、安装 keepalived<a class="hash-link" href="#103安装-keepalived" title="标题的直接链接">​</a></h2><p>使用 keepalived，完全可以 yum 安装。本文仅给出编译安装的方法，后文的所有配置都使用 yum 安装的 keepalived。</p><p>官方各版本源码下载地址：<a href="http://www.keepalived.org/download.html%E3%80%82%E4%BB%A5%E4%B8%8B%E6%98%AF%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85" target="_blank" rel="noopener noreferrer">http://www.keepalived.org/download.html。以下是编译安装</a> keepalived-2.2.4 版本的过程：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># wget --no-check-certificate https://www.keepalived.org/software/keepalived-2.2.4.tar.gz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install gcc libnl3-devel openssl-devel -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf keepalived-2.2.4.tar.gz </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd keepalived-2.2.4/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director keepalived-2.2.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./configure --prefix=/usr/local/keepalived-2.2.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director keepalived-2.2.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># make &amp;&amp; make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其中 <code>./configure</code> 的 <code>--with-kernel-dir</code> 是在管理 LVS 时需要使用的，如果不用配合 LVS，则可以不用此选项。</li></ul><p>再做一下编译安装的规范行为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ln -sv /usr/local/keepalived-2.2.4/ /usr/local/keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">‘/usr/local/keepalived’ -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> ‘/usr/local/keepalived-2.2.4/’</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;MANPATH /usr/local/keepalived/share/man&quot; &gt;&gt;/etc/man.config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;export PATH=/usr/local/keepalived/sbin:$PATH&quot; &gt; /etc/profile.d/keepalived.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod +x /etc/profile.d/keepalived.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># . /etc/profile.d/keepalived.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>编译安装后，在安装目录下生成以下一些目录，其中 keepalived 程序在 sbin 目录下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tree /usr/local/keepalived -d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/local/keepalived</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── etc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── keepalived</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   │   └── samples</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   └── sysconfig</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── sbin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└── share</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ├── doc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    │   └── keepalived</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ├── </span><span class="token function" style="color:rgb(0, 0, 255)">man</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    │   ├── man1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    │   ├── man5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    │   └── man8</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    └── snmp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        └── mibs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> directories</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 etc 目录下，有配置文件和大量配置文件示例，而且自动生成了 keepalived systemd 服务文件，可以直接启动 keepalived 服务：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mkdir /etc/keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl start keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl status keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">● keepalived.service - LVS and VRRP High Availability Monitor</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   Loaded: loaded </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">/usr/lib/systemd/system/keepalived.service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> disabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> vendor preset: disabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   Active: active </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">running</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> since Thu </span><span class="token number" style="color:rgb(9, 134, 88)">2022</span><span class="token plain">-01-06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:19 CST</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> 5s ago</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     Docs: man:keepalived</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           man:keepalived.conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           man:genhash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           https://keepalived.org</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Process: </span><span class="token number" style="color:rgb(9, 134, 88)">13858</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ExecStart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/keepalived-2.2.4/sbin/keepalived </span><span class="token variable" style="color:rgb(9, 134, 88)">$KEEPALIVED_OPTIONS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">code</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">exited, </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">status</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">/SUCCESS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Main PID: </span><span class="token number" style="color:rgb(9, 134, 88)">13859</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">keepalived</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   CGroup: /system.slice/keepalived.service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           ├─13859 /usr/local/keepalived-2.2.4/sbin/keepalived -D</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           ├─13860 /usr/local/keepalived-2.2.4/sbin/keepalived -D</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           └─13861 /usr/local/keepalived-2.2.4/sbin/keepalived -D</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jan 06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:23 director Keepalived_vrrp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">13861</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: Sending gratuitous ARP on eth0 </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.200.16</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jan 06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:23 director Keepalived_vrrp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">13861</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: Sending gratuitous ARP on eth0 </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.200.17</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jan 06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:23 director Keepalived_vrrp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">13861</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: Sending gratuitous ARP on eth0 </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.200.18</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jan 06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:24 director Keepalived_healthcheckers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">13860</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: HTTP_CHECK on </span><span class="token function" style="color:rgb(0, 0, 255)">service</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.200.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:t</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.s.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jan 06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:24 director Keepalived_healthcheckers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">13860</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: Removing </span><span class="token function" style="color:rgb(0, 0, 255)">service</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.200.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:tcp:13</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.58</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jan 06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:24 director Keepalived_healthcheckers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">13860</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: Remote SMTP server </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.200.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:25 c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.d.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jan 06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:25 director Keepalived_healthcheckers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">13860</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: HTTP_CHECK on </span><span class="token function" style="color:rgb(0, 0, 255)">service</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.201.100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.s.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jan 06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:25 director Keepalived_healthcheckers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">13860</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: Removing </span><span class="token function" style="color:rgb(0, 0, 255)">service</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.201.100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:tcp:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.43</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jan 06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:25 director Keepalived_healthcheckers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">13860</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: Lost quorum </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">-0</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> VS </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.43</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jan 06 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain">:31:25 director Keepalived_healthcheckers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">13860</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: Remote SMTP server </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.200.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:25 c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.d.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Hint: Some lines were ellipsized, use -l to show </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> full.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>注意，启动 keepalived 服务需要 keepalived.conf 配置文件，手动拷贝过去即可。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="104配置-keepalived-日志">10.4、配置 keepalived 日志<a class="hash-link" href="#104配置-keepalived-日志" title="标题的直接链接">​</a></h2><p>默认 keeepalived 的日志会记录到 /var/log/messages 中。可以配置 keepalived 使其记录到其它文件中。</p><p>先将编译安装生成的 /usr/local/keepalived-2.2.4/etc/sysconfig/keepalived 修改一下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 这是原内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /usr/local/keepalived-2.2.4/etc/sysconfig/keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Options for keepalived. See `keepalived --help&#x27; output and keepalived(8) and</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># keepalived.conf(5) man pages for a list of all options. Here are the most</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># common ones :</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># --vrrp               -P    Only run with VRRP subsystem.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># --check              -C    Only run with Health-checker subsystem.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># --dont-release-vrrp  -V    Dont remove VRRP VIPs &amp; VROUTEs on daemon stop.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># --dont-release-ipvs  -I    Dont remove IPVS topology on daemon stop.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># --dump-conf          -d    Dump the configuration data.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># --log-detail         -D    Detailed log messages.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># --log-facility       -S    0-7 Set local syslog facility (default=LOG_DAEMON)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">KEEPALIVED_OPTIONS</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-D&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 修改后的内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /usr/local/keepalived-2.2.4/etc/sysconfig/keepalived | grep -v &quot;^#&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">KEEPALIVED_OPTIONS</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-D -S 0&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面配置使用 local0 这个设备来记录日志，因此去修改 rsyslog 的配置文件 /etc/rsyslog.conf，添加该设备记录日志的级别和路径：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Keepalived log config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">local0.*                           /var/log/keepalived.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再重启 rsyslog：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@director ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart rsyslog</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="105keepalived-配置文件详解">10.5、keepalived 配置文件详解<a class="hash-link" href="#105keepalived-配置文件详解" title="标题的直接链接">​</a></h2><p>keepalived 配置文件按<strong>层级</strong>和<strong>模块</strong>划分的，每层由 &quot;{ }&quot; 来界定。 在主配置文件中可以通过 <strong>include</strong> 来涵盖多个子配置文件。配置文件包括以下几个模块：</p><ul><li><strong>GLOBAL CONFIGURATION</strong></li><li><strong>VRRPD CONFIGURATION</strong></li><li><strong>LVS CONFIGURATION</strong></li><li>BFD CONFIGURATION(从未用过)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1051全局配置模块">10.5.1、全局配置模块<a class="hash-link" href="#1051全局配置模块" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"> Configuration File </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> keepalived</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">global_defs </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                                   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 全局定义部分</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    notification_email </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置报警邮件地址，可设置多个</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        acassen@firewall.loc                    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 接收通知的邮件地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        failover@firewall.loc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                      </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    notification_email_from test0@163.com       </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置 发送邮件通知的地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    smtp_server smtp.163.com                    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置 smtp server 地址，可是ip或域名.可选端口号（默认25）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    smtp_connect_timeout </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain">                     </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置 连接 smtp server的超时时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    router_id LVS_DEVEL                         </span><span class="token comment" style="color:rgb(0, 128, 0)"># 主机标识，用于邮件通知</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    vrrp_strict                                 </span><span class="token comment" style="color:rgb(0, 128, 0)"># 严格执行VRRP协议规范，此模式不支持节点单播</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    script_user keepalived_script               </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定运行脚本的用户名和组。默认使用用户的默认组。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                </span><span class="token comment" style="color:rgb(0, 128, 0)"># 如未指定，默认为keepalived_script 用户，如无此用户，则使用root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    enable_script_security                      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 如过路径为非root可写，不要配置脚本为root用户执行。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>可用参数说明</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">default_interface eth0:   设置静态地址默认绑定的端口。默认是eth0。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置LVS同步服务的相关内容。可以同步LVS的状态信息。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lvs_sync_daemon   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">id </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">maxlen </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">port </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ttl </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">group </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INTERFACE:          指定同步服务绑定的接口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  VRRP_INSTANCE:    指定同步服务绑定的VRRP实例。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain">     指定同步服务所使用的SYNCID，只有相同的SYNCID才会同步。范围是0-255.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  maxlen:           指定数据包的最大长度。范围是1-65507</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  port:             指定同步所使用的UDP端口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  group:            指定组播IP地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lvs_flush:                                在keepalived启动时，刷新所有已经存在的LVS配置。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_garp_master_delay </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">:                当转换为MASTER状态时，延迟多少秒发送第二组的免费ARP。默认为5s，0表示不发送第二组免的免费ARP。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_garp_master_repeat </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">:                当转换为MASTER状态时，在一组中一次发送的免费ARP数量。默认是5.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_garp_lower_prio_delay </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">:            当MASTER收到更低优先级的通告时，延迟多少秒发送第二组的免费ARP。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_garp_lower_prio_repeat </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">:            当MASTER收到更低优先级的通告时，在一组中一次发送的免费ARP数量。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_garp_master_refresh </span><span class="token number" style="color:rgb(9, 134, 88)">60</span><span class="token plain">:              当keepalived成为MASTER以后，刷新免费ARP的最小时间间隔</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">会再次发送免费ARP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">。默认是0，表示不会刷新。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_garp_master_refresh_repeat </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">:        当keepalived成为MASTER以后，每次刷新会发送多少个免费ARP。默认是1.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_garp_interval </span><span class="token number" style="color:rgb(9, 134, 88)">0.001</span><span class="token plain">:                 在一个接口发送的两个免费ARP之间的延迟。可以精确到毫秒级。默认是0.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_lower_prio_no_advert </span><span class="token boolean">true</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">false:     默认是false。如果收到低优先级的通告，不发送任何通告。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_version </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">:                         设置默认的VRRP版本。默认是2.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_check_unicast_src:                   在单播模式中，开启对VRRP数据包的源地址做检查，源地址必须是单播邻居之一。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_skip_check_adv_addr:                 默认是不跳过检查。检查收到的VRRP通告中的所有地址可能会比较耗时。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                        设置此命令的意思是，如果通告与接收的上一个通告来自相同的master路由器，则不执行检查</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">跳过检查</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_strict:                              严格遵守VRRP协议。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                        下列情况将会阻止启动Keepalived：1. 没有VIP地址。2. 单播邻居。3. 在VRRP版本2中有IPv6地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_iptables:                            不添加任何iptables规则。默认是添加iptables规则的。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 如果vrrp进程或check进程超时，可以用下面的4个选项。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 可以使处于BACKUP状态的VRRP实例变成MASTER状态，即使MASTER实例依然在运行。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 因为MASTER或BACKUP系统比较慢，不能及时处理VRRP数据包。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_priority </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">-20 -- </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">9</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:                设置VRRP进程的优先级。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">checker_priority </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">-20 -- </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">9</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:             设置checker进程的优先级。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_no_swap:                             vrrp进程不能够被交换。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">checker_no_swap:                          checker进程不能够被交换。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">script_user  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">groupname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:       设置运行脚本默认用户和组。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                        如果没有指定，则默认用户为keepalived_script</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">需要该用户存在</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">，否则为root用户。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                        默认groupname同username。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">enable_script_security:                   如果脚本路径的任一部分对于非root用户来说，都具有可写权限，则不会以root身份运行脚本。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nopreempt:                                默认是抢占模式 要是用非抢占式的就加上nopreempt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1052vrrpd-配置模块">10.5.2、VRRPD 配置模块<a class="hash-link" href="#1052vrrpd-配置模块" title="标题的直接链接">​</a></h3><p>VRRPD 的配置包括如下子块：</p><ol><li>vrrp<!-- -->_<!-- -->script</li><li>vrrp<!-- -->_<!-- -->sync<!-- -->_<!-- -->group</li><li>garp<!-- -->_<!-- -->group</li><li>vrrp<!-- -->_<!-- -->instance</li></ol><blockquote><p>vrrp<!-- -->_<!-- -->script 配置</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 添加一个周期性执行的脚本。脚本的退出状态码会被调用它的所有的VRRP Instance记录。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 至少有一个VRRP实例调用它并且优先级不能为0.优先级范围是1-254.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_script </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">SCRIPT_NAME</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选项说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">script </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/path/to/somewhere&quot;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain">  指定要执行的脚本的路径。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">interval </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INTEGER</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:               指定脚本执行的间隔。单位是秒。默认为1s。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">timeout</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INTEGER</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:                指定在多少秒后，脚本被认为执行失败。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">weight </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">-254 --- </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:            调整优先级。默认为2.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rise </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INTEGER</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:                   执行成功多少次才认为是成功。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fall </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INTEGER</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:                   执行失败多少次才认为失败。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">user </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">USERNAME</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">GROUPNAME</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:  运行脚本的用户和组。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">init_fail:                      假设脚本初始状态是失败状态。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">解释 weight： </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">. 如果脚本执行成功</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">退出状态码为0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">，weight大于0，则priority增加。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">. 如果脚本执行失败</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">退出状态码为非0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">，weight小于0，则priority减少。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">. 其他情况下，priority不变。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>vrrp<!-- -->_<!-- -->instance</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">命令说明：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">state MASTER</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">BACKUP:            指定该keepalived节点的初始状态。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">interface eth0:                 vrrp实例绑定的接口，用于发送VRRP包。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">use_vmac </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VMAC_INTERFACE</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:  在指定的接口产生一个子接口，如vrrp.51，该接口的MAC地址为组播地址，通过该接口向外发送和接收VRRP包。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vmac_xmit_base:                 通过基本接口向外发送和接收VRRP数据包，而不是通过VMAC接口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">native_ipv6:                    强制VRRP实例使用IPV6.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">当同时配置了IPV4和IPV6的时候</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dont_track_primary:             忽略VRRP接口的错误，默认是没有配置的。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 如果track的接口有任何一个出现故障，都会进入FAULT状态。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">track_interface </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  eth0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  eth1 weight </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">-254-25</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 添加一个track脚本(vrrp_script配置的脚本。)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">track_script </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">SCRIPT_NAME</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">SCRIPT_NAME</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> weight </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">-254-25</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mcast_src_ip </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IPADDR</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:            指定发送组播数据包的源IP地址。默认是绑定VRRP实例的接口的主IP地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">unicast_src_ip </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IPADDR</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      指定发送单薄数据包的源IP地址。默认是绑定VRRP实例的接口的主IP地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">:                    指定该实例所使用的VRRP版本。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 采用单播的方式发送VRRP通告，指定单播邻居的IP地址。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">unicast_peer </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IPADDR</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">virtual_router_id </span><span class="token number" style="color:rgb(9, 134, 88)">51</span><span class="token plain">:           指定VRRP实例ID，范围是0-255.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">priority </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain">:                   指定优先级，优先级高的将成为MASTER。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">advert_int </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">:                   指定发送VRRP通告的间隔。单位是秒。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">authentication </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  auth_type PASS</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">AH:            指定认证方式。PASS简单密码认证</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">推荐</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">,AH:IPSEC认证</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">不推荐</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  auth_pass </span><span class="token number" style="color:rgb(9, 134, 88)">1234</span><span class="token plain">:               指定认证所使用的密码。最多8位。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定VIP地址。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">virtual_ipaddress </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IPADDR</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">MASK</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> brd </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IPADDR</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> dev </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> scope </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">SCOPE</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> label </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">LABEL</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.200.17/24 dev eth1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.200.18/24 dev eth2 label eth2:1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nopreempt:      设置为不抢占。默认是抢占的，当高优先级的机器恢复后，会抢占低优先级的机器成为MASTER。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                而不抢占，则允许低优先级的机器继续成为MASTER，即使高优先级的机器已经上线。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                如果要使用这个功能，则初始化状态必须为BACKUP。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">preempt_delay:  设置抢占延迟。单位是秒，范围是0---1000，默认是0.发现低优先级的MASTER后多少秒开始抢占。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">通知脚本：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">notify_master </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;|</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">QUOTED-STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">username </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">groupname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">notify_backup </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;|</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">QUOTED-STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">username </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">groupname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">notify_fault </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;|</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">QUOTED-STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">username </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">groupname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">notify </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;|</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">QUOTED-STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">username </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">groupname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 当停止VRRP时执行的脚本。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">notify_stop </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;|</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">QUOTED-STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">username </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">groupname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">smtp_alert</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>vrrp<!-- -->_<!-- -->sync<!-- -->_<!-- -->group</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 作用：将所有相关的VRRP实例定义在一起，作为一个VRRP Group，如果组内的任意一个实例出现问题，都可以实现Failover。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> vrrp_sync_group VG_1 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    group </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     inside_network     </span><span class="token comment" style="color:rgb(0, 128, 0)"># vrrp instance name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     outside_network    </span><span class="token comment" style="color:rgb(0, 128, 0)"># vrrp instance name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 注意：脚本文件要加上x权限，同时指令最好写绝对路径。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 说明：如果username和groupname没有指定，则以默认的script_user所指定的用户和组。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 作用：当成为MASTER时，以指定的用户和组执行脚本。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">. notify_master /path/to_master.sh </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">username </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">groupname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 作用：当成为BACKUP时，以指定的用户和组执行脚本。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">. notify_backup /path/to_backup.sh </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">username </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">groupname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 作用：当该同步组Fault时，以指定的用户和组执行脚本。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">. notify_fault </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/path/fault.sh VG_1&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">username </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">groupname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 作用：在任何状态都会以指定的用户和组执行脚本。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 说明：该脚本会在notify_*脚本后执行。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">. notify /path/notify.sh </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">username </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">groupname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    notify 可以使用3个参数，如下：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token variable" style="color:rgb(9, 134, 88)">$1</span><span class="token plain">：可以是GROUP或INTANCE，表明后面是组还是实例。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token variable" style="color:rgb(9, 134, 88)">$2</span><span class="token plain">：组名或实例名。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token variable" style="color:rgb(9, 134, 88)">$3</span><span class="token plain">：转换后的目标状态。有：MASTER、BACKUP、FAULT。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">. smtp_alert:          当状态发生改变时，发送邮件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">. global_tracking:     所有的VRRP实例共享相同的tracking配置。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1053lvs-配置">10.5.3、LVS 配置<a class="hash-link" href="#1053lvs-配置" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">LVS模块结构：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">virtual_server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    … </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    real_server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        … </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>virtual<!-- -->_<!-- -->server</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">virtual_server IP Port </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> virtual_server fwmark int </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> virtual_server group string </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  delay_loop </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:                   健康检查的时间间隔。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  lb_argo rr</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">wrr</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">lc</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">wlc</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">lblc</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token function" style="color:rgb(0, 0, 255)">sh</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">dh: LVS调度算法。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  lb_kind NAT</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">DR</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">TUN:               LVS模式。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  persistence_timeout </span><span class="token number" style="color:rgb(9, 134, 88)">360</span><span class="token plain">:          持久化超时时间，单位是秒。默认是6分钟。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  persistence_granularity:          持久化连接的颗粒度。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  protocol TCP</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">UDP</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">SCTP:            </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">层协议。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ha_suspend:                       如果virtual server的IP地址没有设置，则不进行后端服务器的健康检查。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  virtualhost </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:               为HTTP_GET和SSL_GET执行要检查的虚拟主机。如virtualhost www.felix.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sorry_server </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IPADDR</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">PORT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:     添加一个备用服务器。当所有的RS都故障时。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sorry_server_inhibit:             将inhibit_on_failure指令应用于sorry_server指令。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  alpha:                            在keepalived启动时，假设所有的RS都是down，以及健康检查是失败的。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                    有助于防止启动时的误报。默认是禁用的。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  omega:                            在keepalived终止时，会执行quorum_down指令所定义的脚本。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  quorum </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:                       默认值1. 所有的存活的服务器的总的最小权重。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  quorum_up </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:             当quorum增长到满足quorum所定义的值时，执行该脚本。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  quorum_down </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:               当quorum减少到不满足quorum所定义的值时，执行该脚本。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>real<!-- -->_<!-- -->server</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">real_server IP Port </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  weight </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:           给服务器指定权重。默认是1.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  inhibit_on_failure:   当服务器健康检查失败时，将其weight设置为0，而不是从Virtual Server中移除。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  notify_up </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">: 当服务器健康检查成功时，执行的脚本。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  notify_down </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:   当服务器健康检查失败时，执行的脚本。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  uthreshold </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:       到这台服务器的最大连接数。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  lthreshold </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:       到这台服务器的最小连接数。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>real<!-- -->_<!-- -->server 监控检查</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">HTTP_GET </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> SSL_GET </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">url </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  path </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:          指定要检查的URL的路径。如path / or path /mrtg2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  digest </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:            摘要。计算方式：genhash -s </span><span class="token number" style="color:rgb(9, 134, 88)">172.17</span><span class="token plain">.100.1 -p </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> -u /index.html</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  status_code </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      状态码。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nb_get_retry </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:           get尝试次数。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">delay_before_retry </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">: 在尝试之前延迟多长时间。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_ip </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IP ADDRESS</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:  连接的IP地址。默认是real server的ip地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_port </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">PORT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      连接的端口。默认是real server的端口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bindto </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IP ADDRESS</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      发起连接的接口的地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bind_port </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">PORT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:         发起连接的源端口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_timeout </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:        连接超时时间。默认是5s。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fwmark </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INTEGER</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:         使用fwmark对所有出去的检查数据包进行标记。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">warmup </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:             指定一个随机延迟，最大为N秒。可防止网络阻塞。如果为0，则关闭该功能。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TCP_CHECK </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_ip </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IP ADDRESS</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:  连接的IP地址。默认是real server的ip地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_port </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">PORT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      连接的端口。默认是real server的端口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bindto </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IP ADDRESS</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      发起连接的接口的地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bind_port </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">PORT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:         发起连接的源端口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_timeout </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:        连接超时时间。默认是5s。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fwmark </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INTEGER</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:         使用fwmark对所有出去的检查数据包进行标记。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">warmup </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:             指定一个随机延迟，最大为N秒。可防止网络阻塞。如果为0，则关闭该功能。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">retry </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INIT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:             重试次数。默认是1次。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">delay_before_retry </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">: 默认是1秒。在重试之前延迟多少秒。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SMTP_CHECK </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_ip </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IP ADDRESS</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:  连接的IP地址。默认是real server的ip地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_port </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">PORT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      连接的端口。默认是real server的端口。 默认是25端口</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bindto </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IP ADDRESS</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      发起连接的接口的地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bind_port </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">PORT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:         发起连接的源端口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_timeout </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:        连接超时时间。默认是5s。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fwmark </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INTEGER</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:         使用fwmark对所有出去的检查数据包进行标记。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">warmup </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:             指定一个随机延迟，最大为N秒。可防止网络阻塞。如果为0，则关闭该功能。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">retry </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:              重试次数。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">delay_before_retry </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">: 在重试之前延迟多少秒。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helo_name </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:           用于SMTP HELO请求的字符串。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">DNS_CHECK </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_ip </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IP ADDRESS</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:  连接的IP地址。默认是real server的ip地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_port </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">PORT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      连接的端口。默认是real server的端口。 默认是25端口</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bindto </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IP ADDRESS</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      发起连接的接口的地址。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bind_port </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">PORT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:         发起连接的源端口。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">connect_timeout </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:        连接超时时间。默认是5s。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fwmark </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INTEGER</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:         使用fwmark对所有出去的检查数据包进行标记。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">warmup </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:             指定一个随机延迟，最大为N秒。可防止网络阻塞。如果为0，则关闭该功能。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">retry </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:              重试次数。默认是3次。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:                DNS query type。A/NS/CNAME/SOA/MX/TXT/AAAA</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">name </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:                DNS查询的域名。默认是</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">MISC_CHECK </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> misc_path </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">STRING</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      外部的脚本或程序路径。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> misc_timeout </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:      脚本执行超时时间。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> user USERNAME </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">GROUPNAME</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: 指定运行该脚本的用户和组。如果没有指定GROUPNAME，则GROUPNAME同USERNAME。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> misc_dynamic:              根据退出状态码动态调整权重。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">，健康检查成功，权重不变。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">，健康检查失败。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">-255，健康检查成功。权重设置为退出状态码减去2.如退出状态码是250，则权重调整为248</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   warmup </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">INT</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">:          指定一个随机延迟，最大为N秒。可防止网络阻塞。如果为0，则关闭该功能。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1054示例">10.5.4、示例<a class="hash-link" href="#1054示例" title="标题的直接链接">​</a></h3><p>网上抄的示例，仅供参考：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"> Configuration File </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> keepalived</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">global_defs </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                                     </span><span class="token comment" style="color:rgb(0, 128, 0)"># 全局定义部分</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    notification_email </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                          </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置报警邮件地址，可设置多个</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        acassen@firewall.loc                      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 接收通知的邮件地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                      </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    notification_email_from test0@163.com         </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置 发送邮件通知的地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    smtp_server smtp.163.com                      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置 smtp server 地址，可是ip或域名.可选端口号（默认25）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    smtp_connect_timeout </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain">                       </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置 连接 smtp server的超时时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    router_id LVS_DEVEL                           </span><span class="token comment" style="color:rgb(0, 128, 0)"># 主机标识，用于邮件通知</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    vrrp_skip_check_adv_addr                 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    vrrp_strict                                   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 严格执行VRRP协议规范，此模式不支持节点单播</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    vrrp_garp_interval </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">                     </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    vrrp_gna_interval </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    script_user keepalived_script                 </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定运行脚本的用户名和组。默认使用用户的默认组。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 如未指定，默认为keepalived_script 用户，如无此用户，则使用root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    enable_script_security                        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 如过路径为非root可写，不要配置脚本为root用户执行。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">     </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_script chk_nginx_service </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                   </span><span class="token comment" style="color:rgb(0, 128, 0)"># VRRP 脚本声明</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    script </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/keepalived/chk_nginx.sh&quot;</span><span class="token plain">         </span><span class="token comment" style="color:rgb(0, 128, 0)"># 周期性执行的脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    interval </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">                                    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 运行脚本的间隔时间，秒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    weight -20                                    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 权重，priority值减去此值要小于备服务的priority值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fall </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">                                        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 检测几次失败才为失败，整数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    rise </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">                                        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 检测几次状态为正常的，才确认正常，整数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    user keepalived_script                        </span><span class="token comment" style="color:rgb(0, 128, 0)"># 执行脚本的用户或组</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                           </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_instance VI_1 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                              </span><span class="token comment" style="color:rgb(0, 128, 0)"># vrrp 实例部分定义，VI_1自定义名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    state MASTER                                  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定 keepalived 的角色，必须大写 可选值：MASTER|BACKUP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    interface ens33                               </span><span class="token comment" style="color:rgb(0, 128, 0)"># 网卡设置，lvs需要绑定在网卡上，realserver绑定在回环口。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 区别：lvs对访问为外，realserver为内不易暴露本机信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    virtual_router_id </span><span class="token number" style="color:rgb(9, 134, 88)">51</span><span class="token plain">                          </span><span class="token comment" style="color:rgb(0, 128, 0)"># 虚拟路由标识，是一个数字，同一个vrrp 实例使用唯一的标识，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                  </span><span class="token comment" style="color:rgb(0, 128, 0)"># MASTER和BACKUP 的同一个 vrrp_instance 下 这个标识必须保持一致</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    priority </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain">                                  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 定义优先级，数字越大，优先级越高。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    advert_int </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">                                  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设定 MASTER 与 BACKUP 负载均衡之间同步检查的时间间隔，单位为秒，两个节点设置必须一样</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    authentication </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置验证类型和密码，两个节点必须一致</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        auth_type PASS                      </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        auth_pass </span><span class="token number" style="color:rgb(9, 134, 88)">1111</span><span class="token plain">                      </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                       </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    virtual_ipaddress </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                           </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置虚拟IP地址，可以设置多个虚拟IP地址，每行一个</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.119.130                     </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    track_script </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                                </span><span class="token comment" style="color:rgb(0, 128, 0)"># 脚本监控状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        chk_nginx_service                         </span><span class="token comment" style="color:rgb(0, 128, 0)"># 可加权重，但会覆盖声明的脚本权重值。chk_nginx_service weight -20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        notify_master </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/keepalived/start_haproxy.sh start&quot;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 当前节点成为master时，通知脚本执行任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        notify_backup </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/keepalived/start_haproxy.sh stop&quot;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 当前节点成为backup时，通知脚本执行任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        notify_fault  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/keepalived/start_haproxy.sh stop&quot;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 当当前节点出现故障，执行的任务; </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                           </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">virtual_server </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.119.130 </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># 定义RealServer对应的VIP及服务端口，IP和端口之间用空格隔开</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    delay_loop </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">                              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 每隔6秒查询realserver状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    lb_algo rr                                </span><span class="token comment" style="color:rgb(0, 128, 0)"># 后端调试算法（load balancing algorithm）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    lb_kind DR                                </span><span class="token comment" style="color:rgb(0, 128, 0)"># LVS调度类型NAT/DR/TUN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># persistence_timeout 60                  # 同一IP的连接60秒内被分配到同一台realserver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    protocol TCP                              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 用TCP协议检查realserver状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    real_server </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.119.120 </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        weight </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">                              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 权重，最大越高，lvs就越优先访问</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        TCP_CHECK </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                           </span><span class="token comment" style="color:rgb(0, 128, 0)"># keepalived的健康检查方式HTTP_GET | SSL_GET | TCP_CHECK | SMTP_CHECK | MISC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            connect_timeout </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">                </span><span class="token comment" style="color:rgb(0, 128, 0)"># 10秒无响应超时</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            retry </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">                           </span><span class="token comment" style="color:rgb(0, 128, 0)"># 重连次数3次</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            delay_before_retry </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 重连间隔时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            connect_port </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain">                   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 健康检查realserver的端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                       </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    real_server </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.119.121 </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        weight </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">                              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 权重，最大越高，lvs就越优先访问</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        TCP_CHECK </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                           </span><span class="token comment" style="color:rgb(0, 128, 0)"># keepalived的健康检查方式HTTP_GET | SSL_GET | TCP_CHECK | SMTP_CHECK | MISC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            connect_timeout </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">                </span><span class="token comment" style="color:rgb(0, 128, 0)"># 10秒无响应超时</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            retry </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">                           </span><span class="token comment" style="color:rgb(0, 128, 0)"># 重连次数3次</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            delay_before_retry </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain">              </span><span class="token comment" style="color:rgb(0, 128, 0)"># 重连间隔时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            connect_port </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain">                   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 健康检查realserver的端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                       </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="106综合生产实例">10.6、综合生产实例<a class="hash-link" href="#106综合生产实例" title="标题的直接链接">​</a></h2><p>实验环境如下拓扑，一张图胜过千言万语：</p><p><img loading="lazy" alt="keepalived_lvs" src="/assets/images/keepalived_lvs-a9fa57dd614425060608bc1be54a4b80.png" width="988" height="608" class="img_ev3q"></p><p>这张图是我生产环境的架构设计，我当时建设的是云平台环境，比这个要复杂得多，每个环节都使用高可用部署，可供生产借鉴。</p><p>下面我们要实现的是 keepalived 双主多实例高可用模型，也就是两个 Director 互为主备；另外 VIP(192.168.122.9) 对应 172.16.4.203/204 这两个主机，VIP(192.168.122.10) 对应 172.16.4.205/206 这两个主机。</p><p>两台 Directors 配置：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># director1 上的 keepalived 配置                   |# director2 上的 keepalived 配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"> Configuration File </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> keepalived                </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"> Configuration File </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> keepalived</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">global_defs </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                                      </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">global_defs </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   router_id LVS_1                                 </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">   router_id LVS_2         </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                                   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_instance VI_1 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                               </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">vrrp_instance VI_1 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">       </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    state MASTER                                   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    state BACKUP           </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    interface eth0                                 </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    interface eth0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    virtual_router_id </span><span class="token number" style="color:rgb(9, 134, 88)">51</span><span class="token plain">                           </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    virtual_router_id </span><span class="token number" style="color:rgb(9, 134, 88)">51</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    priority </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain">                                   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    priority </span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token plain">            </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    advert_int </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">                                   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    advert_int </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    authentication </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                               </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    authentication </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        auth_type PASS                             </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">        auth_type PASS     </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        auth_pass </span><span class="token number" style="color:rgb(9, 134, 88)">12345678</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">        auth_pass </span><span class="token number" style="color:rgb(9, 134, 88)">12345678</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                              </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    virtual_ipaddress </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                            </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    virtual_ipaddress </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.9/32 dev eth0 label eth0:0     </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.9/32 dev eth0 label eth0:0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                              </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 不同vrrp实例绑定在同一接口上，vrid必须不能相同    |# 不同vrrp实例绑定在同一接口上，vrid必须不能相同</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vrrp_instance VI_2 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                               </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">vrrp_instance VI_2 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">       </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    state BACKUP                                   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    state MASTER           </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    interface eth0                                 </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    interface eth0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    virtual_router_id </span><span class="token number" style="color:rgb(9, 134, 88)">55</span><span class="token plain">                           </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    virtual_router_id </span><span class="token number" style="color:rgb(9, 134, 88)">55</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    priority </span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token plain">                                    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    priority </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain">            </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    advert_int </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">                                   </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    advert_int </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    authentication </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                               </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    authentication </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        auth_type PASS                             </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">        auth_type PASS     </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        auth_pass </span><span class="token number" style="color:rgb(9, 134, 88)">12345678</span><span class="token plain">                         </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">        auth_pass </span><span class="token number" style="color:rgb(9, 134, 88)">12345678</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                              </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    virtual_ipaddress </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">                            </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    virtual_ipaddress </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.10/32 dev eth0 label eth0:1    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.10/32 dev eth0 label eth0:1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                              </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">                                                  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#########################################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 以下是两台 Director 上相同部分的内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">virtual_server </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.9 </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        delay_loop </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        lb_algo wrr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        lb_kind DR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        protocol TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        real_server </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.4.203 </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                weight </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                TCP_CHECK </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        connect_port </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        connect_timeout </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        nb_get_retry </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        delay_before_retry </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        real_server </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.4.204 </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                weight </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                TCP_CHECK </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        connect_port </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        connect_timeout </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        nb_get_retry </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        delay_before_retry </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">virtual_server </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.10 </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        delay_loop </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        lb_algo wrr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        lb_kind DR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        protocol TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        real_server </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.4.205 </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                weight </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                TCP_CHECK </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        connect_port </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        connect_timeout </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        nb_get_retry </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        delay_before_retry </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        real_server </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.4.206 </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                weight </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                TCP_CHECK </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        connect_port </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        connect_timeout </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        nb_get_retry </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        delay_before_retry </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>四台 RealServers 的配置：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 1.提供web服务和测试页面</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">yum -y </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> httpd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;VIP(192.168.122.9): This is page from RS1:172.16.4.203&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /var/www/html/index.html   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 在RS1上操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;VIP(192.168.122.9): This is page from RS2:172.16.4.204&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /var/www/html/index.html   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 在RS2上操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;VIP(192.168.122.10): This is page from RS3:172.16.4.205&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /var/www/html/index.html      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 在RS3上操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;VIP(192.168.122.10): This is page from RS4:172.16.4.206&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /var/www/html/index.html      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 在RS4上操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">service</span><span class="token plain"> httpd start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 2.设置arp参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">/proc/sys/net/ipv4/conf/all/arp_ignore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">/proc/sys/net/ipv4/conf/all/arp_announce</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 3.设置VIP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># RS1和RS2设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ifconfig</span><span class="token plain"> lo:0 </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.9 netmask </span><span class="token number" style="color:rgb(9, 134, 88)">255.255</span><span class="token plain">.255.255 up</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">route </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> -host </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.9 dev lo:0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># RS3和RS4设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ifconfig</span><span class="token plain"> lo:0 </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.10 netmask </span><span class="token number" style="color:rgb(9, 134, 88)">255.255</span><span class="token plain">.255.255 up</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">route </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> -host </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.10 dev lo:0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 4.一定要注意，网关不能指向director，而是要指向router，我在网络配置文件中写好了，按照上面拓扑去设置</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>两台 Routers 设置，我实验中用的是一台 linux 主机，生产环境上我会使用两台华为 S6857 进行堆叠，相当于一个 linux 主机。只不过路由器不用设置 rp<!-- -->_<!-- -->filter，但是这里的 linux 主机必须设置，否则无法实现该环境。关于 rp<!-- -->_<!-- -->filter 可以参见 <a href="https://www.brinnatt.com/high/%e7%ac%ac-10-%e7%ab%a0-linux-lvs-%e6%9c%8d%e5%8a%a1%e9%85%8d%e7%bd%ae/" target="_blank" rel="noopener noreferrer">Linux LVS Service</a>。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@router ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@router ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo 2 &gt; /proc/sys/net/ipv4/conf/all/rp_filter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上配置完成后，就可以实现拓扑中的环境，下面找一个客户端测试一下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.122.9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">VIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.9</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">: This is page from RS1:172.16.4.20</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">3</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.122.9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">VIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.9</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">: This is page from RS2:172.16.4.20</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.122.9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">VIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.9</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">: This is page from RS1:172.16.4.20</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">3</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.122.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">VIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">: This is page from RS3:172.16.4.20</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">5</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.122.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">VIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">: This is page from RS3:172.16.4.20</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">5</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.122.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">VIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.122.10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">: This is page from RS4:172.16.4.20</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">6</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@yidam ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/linux-advanced-15"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">第 15 章 Linux LVS 服务配置</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/linux测试"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Linux测试</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#101vrrp-协议" class="table-of-contents__link toc-highlight">10.1、VRRP 协议</a></li><li><a href="#102keepalived-架构模型" class="table-of-contents__link toc-highlight">10.2、keepalived 架构模型</a></li><li><a href="#103安装-keepalived" class="table-of-contents__link toc-highlight">10.3、安装 keepalived</a></li><li><a href="#104配置-keepalived-日志" class="table-of-contents__link toc-highlight">10.4、配置 keepalived 日志</a></li><li><a href="#105keepalived-配置文件详解" class="table-of-contents__link toc-highlight">10.5、keepalived 配置文件详解</a><ul><li><a href="#1051全局配置模块" class="table-of-contents__link toc-highlight">10.5.1、全局配置模块</a></li><li><a href="#1052vrrpd-配置模块" class="table-of-contents__link toc-highlight">10.5.2、VRRPD 配置模块</a></li><li><a href="#1053lvs-配置" class="table-of-contents__link toc-highlight">10.5.3、LVS 配置</a></li><li><a href="#1054示例" class="table-of-contents__link toc-highlight">10.5.4、示例</a></li></ul></li><li><a href="#106综合生产实例" class="table-of-contents__link toc-highlight">10.6、综合生产实例</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">学习</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/skill">技术笔记</a></li><li class="footer__item"><a class="footer__link-item" href="/project">实战项目</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/linux">Linux</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/zqingfa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/website">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">浙ICP备20024502号-1</a></p><p>Copyright © 2022 - PRESENT zhangqf Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.9b8cde08.js"></script>
<script src="/assets/js/main.98aacc98.js"></script>
</body>
</html>