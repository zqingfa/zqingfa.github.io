<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-linux/advanced/linux-advanced-8">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">第 8 章 Linux httpd 服务高级配置 - Linux技术分享</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://zhangqf.com/docs/linux-advanced-8"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="第 8 章 Linux httpd 服务高级配置 - Linux技术分享"><meta data-rh="true" name="description" content="本文主要针对 httpd 在 ARM64 架构下进行编译配置，然后搭建一套经久不衰的 LAMP 架构环境。"><meta data-rh="true" property="og:description" content="本文主要针对 httpd 在 ARM64 架构下进行编译配置，然后搭建一套经久不衰的 LAMP 架构环境。"><meta data-rh="true" name="keywords" content="linux,httpd"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhangqf.com/docs/linux-advanced-8"><link data-rh="true" rel="alternate" href="https://zhangqf.com/en/docs/linux-advanced-8" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-8" hreflang="zh"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-8" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9B0V5WT2X8-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Linux技术分享" href="/opensearch.xml">
<link rel="preconnect" href="https://zhangqf.com/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://zhangqf.com/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c9a3849aa75f9c4a4e65f846cd1a5155",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="zhangqf RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="zhangqf Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="zhangqf JSON Feed">

<link rel="icon" href="/img/logo.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><link rel="stylesheet" href="/assets/css/styles.86c9ae18.css">
<link rel="preload" href="/assets/js/runtime~main.9b8cde08.js" as="script">
<link rel="preload" href="/assets/js/main.98aacc98.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>更新 <a href="/website">网址导航</a> 带你发现感兴趣的技术</span></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">zhangqf</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/linux">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/category/Linux基础">Linux 基础</a></li><li><a class="dropdown__link" href="/docs/category/Linux进阶">Linux 进阶</a></li><li><a class="dropdown__link" href="/docs/category/Linux测试">Linux 测试</a></li><li><a class="dropdown__link" href="/docs/category/LinuxCICD">Linux CICD研发</a></li><li><a class="dropdown__link" href="/docs/skill/">笔记</a></li><li><a class="dropdown__link" href="/docs/tools/">工具推荐</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Blog</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags">标签</a></li><li><a class="dropdown__link" href="/archive">归档</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">工具</a><ul class="dropdown__menu"><li><a href="https://api.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">API服务</a></li><li><a href="https://js-de-obfuscator.vercel.app" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS代码还原</a></li><li><a href="https://cipher.kuizuo.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">CyberChef加密</a></li></ul></div><a class="navbar__item navbar__link" href="/website">导航</a><a class="navbar__item navbar__link" href="/project">项目</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"><b>zhangqf</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux基础">Linux基础</a><button aria-label="打开/收起侧边栏菜单「Linux基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/linux进阶">Linux进阶</a><button aria-label="打开/收起侧边栏菜单「Linux进阶」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-1">第 1 章 Linux 进阶命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-2">第 2 章 Linux 防火墙</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-3">第 3 章 Linux NFS 网络文件系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-4">第 4 章 Linux DHCP 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-5">第 5 章 Linux DNS 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-6">第 6 章 Linux httpd 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-7">第 7 章 Linux httpd 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/linux-advanced-8">第 8 章 Linux httpd 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-9">第 9 章 Linux Nginx 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-10">第 10 章 Linux Tomcat 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-11">第 11 章 Linux Tomcat 服务实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-12">第 12 章 Linux haproxy 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-13">第 13 章 Linux haproxy 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-14">第 14 章 Linux haproxy 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-15">第 15 章 Linux LVS 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-16">第 16 章 Linux Keepalived 服务配置</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux测试">Linux测试</a><button aria-label="打开/收起侧边栏菜单「Linux测试」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linuxcicd">Linux CICD研发</a><button aria-label="打开/收起侧边栏菜单「Linux CICD研发」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/linux进阶"><span itemprop="name">Linux进阶</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第 8 章 Linux httpd 服务高级配置</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>第 8 章 Linux httpd 服务高级配置</h1></header><p>本文主要针对 httpd 在 ARM64 架构下进行编译配置，然后搭建一套经久不衰的 LAMP 架构环境。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61解决-httpd-编译依赖">6.1、解决 httpd 编译依赖<a class="hash-link" href="#61解决-httpd-编译依赖" title="标题的直接链接">​</a></h2><p>本文以 httpd 2.4.51 版本为例。</p><p>apache 自己的站点提供了基金会下所有的(包括所有版本)资源，包括 httpd。</p><p>地址：<a href="https://dlcdn.apache.org/" target="_blank" rel="noopener noreferrer">https://dlcdn.apache.org/</a></p><p>httpd 下载地址：<a href="https://dlcdn.apache.org/httpd/" target="_blank" rel="noopener noreferrer">https://dlcdn.apache.org/httpd/</a></p><p>httpd 同样使用 <code>&quot;./configure&quot;</code>、<code>&quot;make &amp;&amp; make install&quot;</code> 的编译流程编译。但是它有一些依赖包需要提前装好。官方上指定的依赖环境有：apr、apr-util、pcre、pcre-devle，此外还需要 expat-devel 包。其中 pcre、pcre-devel 和 expat.devel 可以直接使用 yum 安装，apr 和 apr-util 需要编译安装。</p><p>apr 和 apr-util 下载地址：<a href="https://apr.apache.org/" target="_blank" rel="noopener noreferrer">https://apr.apache.org/</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install pcre pcre-devel expat-devel</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>编译 apr：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar -xf apr-1.7.0.tar.bz2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd apr-1.7.0/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 apr-1.7.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./configure --prefix=/usr/local/apr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 apr-1.7.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># make &amp;&amp; make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>问题1：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">rm: cannot remove </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;libtoolT&#x27;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> No such </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> or directory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>解决方法：</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 apr-1.7.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim configure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">将 </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RM</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;$RM&#x27;</span><span class="token plain"> 改成 </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RM</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;$RM -f&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p>编译 apr-util：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf apr-util-1.6.1.tar.bz2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd apr-util-1.6.1/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 apr-util-1.6.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 apr-util-1.6.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># make &amp;&amp; make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后是编译 httpd，httpd 编译对刚接触的人来说可能有些麻烦，因为编译选项太多，其中的一些 &quot;潜规则&quot; 也不太熟悉。所以下面详细地说明。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62httpd-编译选项">6.2、httpd 编译选项<a class="hash-link" href="#62httpd-编译选项" title="标题的直接链接">​</a></h2><p>httpd 的编译选项非常多。以下是截取 <code>./configure -h</code> 中的一部分，使用 &quot;......&quot; 表示省略了一堆信息。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Configuration:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -h, --help              display this </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">help</span><span class="token plain"> and </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      --help</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">short        display options specific to this package</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      --help</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">recursive    display the short </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">help</span><span class="token plain"> of all the included packages</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -V, --version           display version information and </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -q, --quiet, --silent   </span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"> not print </span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token variable" style="color:rgb(9, 134, 88)">checking </span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token variable" style="color:rgb(9, 134, 88)">.&#x27; messages</span><br></span><span class="token-line" style="color:#000000"><span class="token variable" style="color:rgb(9, 134, 88)">      --cache-file</span><span class="token variable operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">FILE   cache </span><span class="token variable builtin class-name" style="color:rgb(38, 127, 153)">test</span><span class="token variable" style="color:rgb(9, 134, 88)"> results </span><span class="token variable keyword" style="color:rgb(0, 0, 255)">in</span><span class="token variable" style="color:rgb(9, 134, 88)"> FILE </span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token variable" style="color:rgb(9, 134, 88)">disabled</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token variable" style="color:rgb(9, 134, 88)"></span><br></span><span class="token-line" style="color:#000000"><span class="token variable" style="color:rgb(9, 134, 88)">  -C, --config-cache      </span><span class="token variable builtin class-name" style="color:rgb(38, 127, 153)">alias</span><span class="token variable" style="color:rgb(9, 134, 88)"> </span><span class="token variable keyword" style="color:rgb(0, 0, 255)">for</span><span class="token variable" style="color:rgb(9, 134, 88)"> </span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token plain">--cache-file</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">config.cache</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  -n, --no-create         do not create output files</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">      --srcdir=DIR        find the sources in DIR [configure dir or `..&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Installation directories:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">PREFIX         </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> architecture-independent files </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> PREFIX</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">/usr/local/apache2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --exec-prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">EPREFIX   </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> architecture-dependent files </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> EPREFIX</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">PREFIX</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">By default, </span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token variable function" style="color:rgb(0, 0, 255)">make</span><span class="token variable" style="color:rgb(9, 134, 88)"> install&#x27; will </span><span class="token variable function" style="color:rgb(0, 0, 255)">install</span><span class="token variable" style="color:rgb(9, 134, 88)"> all the files </span><span class="token variable keyword" style="color:rgb(0, 0, 255)">in</span><span class="token variable" style="color:rgb(9, 134, 88)"></span><br></span><span class="token-line" style="color:#000000"><span class="token variable" style="color:rgb(9, 134, 88)"></span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token plain">/usr/local/apache2/bin</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;, `/usr/local/apache2/lib&#x27;</span><span class="token plain"> etc.  You can specify</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">an installation prefix other than </span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token variable" style="color:rgb(9, 134, 88)">/usr/local/apache2&#x27; using </span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token plain">--prefix</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">for instance `--prefix=$HOME&#x27;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">For better control, use the options below.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Fine tuning of the installation directories:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --bindir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR            user executables </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">EPREFIX/bin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --sbindir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR           system admin executables </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">EPREFIX/sbin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --libexecdir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR        program executables </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">EPREFIX/libexec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --sysconfdir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR        read-only single-machine data </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">PREFIX/etc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --sharedstatedir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR    modifiable architecture-independent data </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">PREFIX/com</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --localstatedir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR     modifiable single-machine data </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">PREFIX/var</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --libdir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR            object code libraries </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">EPREFIX/lib</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">System types:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --build</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">BUILD     configure </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> building on BUILD </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">guessed</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --host</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">HOST       cross-compile to build programs to run on HOST </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">BUILD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --target</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">TARGET   configure </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> building compilers </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> TARGET </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">HOST</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Optional Features:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --disable-option-checking  ignore unrecognized --enable/--with options</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --disable-FEATURE       </span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"> not include FEATURE </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">same as --enable-FEATURE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">no</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-FEATURE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ARG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">  include FEATURE </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ARG</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">yes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-layout</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">LAYOUT</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-dtrace         Enable DTrace probes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-hook-probes    Enable APR hook probes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-exception-hook Enable fatal exception hook</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-load-all-modules</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          Load all modules</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-maintainer-mode</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          Turn on debugging and compile </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> warnings and load</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          all compiled modules</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-debugger-mode  Turn on debugging and compile </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> warnings and turn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          off optimization</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-pie            Build httpd as a Position Independent Executable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-modules</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">MODULE-LIST</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          Space-separated list of modules to </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">enable</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;all&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;most&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;few&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;none&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;reallyall&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-mods-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">MODULE-LIST</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          Space-separated list of shared modules to </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">enable</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;all&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;most&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;few&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;reallyall&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --enable-mods-static</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">MODULE-LIST</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          Space-separated list of static modules to </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">enable</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;all&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;most&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;few&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;reallyall&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Optional Packages:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --with-PACKAGE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ARG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">    use PACKAGE </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ARG</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">yes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --without-PACKAGE       </span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"> not use PACKAGE </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">same as --with-PACKAGE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">no</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --with-included-apr     Use bundled copies of APR/APR-Util</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --with-apr</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token plain">         prefix </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> installed APR or the full path to</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                             apr-config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --with-apr-util</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token plain">    prefix </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> installed APU or the full path to</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                             apu-config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --with-pcre</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token plain">        Use external PCRE library</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以下是一个编译配置：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apache --sysconfdir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/apache --enable-so --enable-ssl --enable-cgi --enable-rewrite --enable-modules</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">most --enable-mpms-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">all --with-z --with-pcre --with-apr</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apr --with-apr-util</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apr-util --with-mpm</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">event</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但这个配置中有些项是多余的，以下是等价编译配置：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apache --sysconfdir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/apache --enable-mpms-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">all --with-z --with-pcre --with-apr</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apr --with-apr-util</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apr-util --with-mpm</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">event</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为什么说有些项多余呢，可以继续往下看。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="63模块动静态编译">6.3、模块动静态编译<a class="hash-link" href="#63模块动静态编译" title="标题的直接链接">​</a></h2><p>httpd 是高度模块化的程序，各个功能通过加载各个模块来实现。但前提是将功能对应的模块先编译好，以供 httpd 加载。</p><p>httpd 对模块有两种编译方式：静态编译和动态编译。</p><ul><li>静态编译：将模块直接编译进 httpd 的核心中。静态编译的所有模块都会随着 httpd 的启动而启动。</li><li>动态编译：将模块编译好，但不编译到 httpd 的核心中。要启动动态编译的模块，需要在 httpd 的配置文件中使用 LoadModule 指令加载。</li></ul><p>httpd 的一个优点是可以实现动态模块的热插拔。因为 httpd 是独立于终端的守护进程，可以通过发送 HUP 信号给 httpd 让其重读配置文件。</p><p>而是否加载动态编译模块正是由 httpd 配置文件中的 LoadModule 指令决定的。</p><p>当想要加载某个模块 A 时(即模块热插)，使用 LoadModule 指定 A 模块的链接地址，再发送 HUP 信号重读配置文件即可。而想要停止某个模块 A 时(即模块热拔)，只需将对应模块的 LoadModule 指令行给注释，再重读配置文件即可。</p><p>甚至，可以随时动态编译某个外部模块到 httpd 中，然后再热插。因为何时编译需要动态加载的模块对 httpd 来说是无关紧要的，它只需 LoadModule 和重读配置文件两个过程对模块进行控制。</p><p>在编译选项中，有几种类型的选项：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--disable-FEATURE:              禁用某特性，等价于--enable-FEATURE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">no</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-FEATURE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ARG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:         启用某特性，默认参数值为YES</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-Module_Name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">shared:    指定的模块Module_Name以动态编译方式安装</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-Module_Name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">static:    指定的模块Module_Name以静态编译方式安装</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于 <code>./configure --help</code> 中给定的选项，如果该选项是 --disable 的，那么表示该选项默认是启用的，需要显式使用 --disable 选项禁用；如果该选项是 --enable 的，那么表示该选项默认是禁用的，需要使用 --enable 选项来启用。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--disable-authz-user    :表示authz-user特性默认启用，编译时无需指定该项。如果要禁用，编译时需显式指定--disable-authz-user</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-echo           :表示echo特性默认是禁用的，如果要启用，则编译时需显式指定--enable-echo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>模块名的书写是有规则的，一般模块的全称类似于 &quot;mod<!-- -->_<!-- -->BASENAME.so&quot; 格式，例如 &quot;mod<!-- -->_<!-- -->charset<!-- -->_<!-- -->lite.so&quot;，但在编译选项中指定模块时，只需指定 BASENAME，且如果 basename 中包含下划线时，需要转换为短横线。例如 &quot;--enable-echo&quot; 表示编译的模块是 &quot;mod<!-- -->_<!-- -->echo.so&quot;。</p><p>此外，还支持 3 种列表方式的动静态编译选项：列表项之间使用空格分隔，但要使用单引号包围。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--enable-modules</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;Module_Name1 Moduel_Name2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mods-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;Module_Name1 Module_Name2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mods-statics</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;Module_Name1 Module_Name2&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>列表部分还可以使用关键字 &quot;all/few/most/reallyall&quot;。分别表示编译所有、少量、大多数、真正的所有模块。</p><p>&quot;--enable-modules&quot; 基本等价于 &quot;--enable-mods-shared&quot;，都是动态编译给定列表中的模块，但 &quot;--enable-modules&quot; 可以额外使用一个关键字 &quot;none&quot;，表示不编译所有模块。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="64动静态编译的优先级规则">6.4、动静态编译的优先级规则<a class="hash-link" href="#64动静态编译的优先级规则" title="标题的直接链接">​</a></h2><p>httpd 动静态模块编译有一套规则，各种动静态编译选项之间有优先级的存在。例如，某个非核心模块既指定了动态编译，同时又指定了静态编译，那到底是静态还是动态编译？</p><p>可以参照以下优先级规则：</p><ol><li><p>不指定任何模块编译选项时，默认的选项为 &quot;--enable-mods-shared&quot;，而该选项的默认值又是 most，所以等价于 &quot;--enable-mods-shared=most&quot;。</p></li><li><p>显式指定要动态或静态编译的优先级最高。有以下几种方式显式指定：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--enable-Module_Name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">shared </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-Module_Name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">static </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mods-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;Module_Name1 Module_Name2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mods-statics</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;Module_Name1 Module_Name2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-modules</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;Module_Name1 Moduel_Name2&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果某个模块既显式指定了动态，又显式指定了静态编译，则静态编译优先级更高。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--enable-echo</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">shared</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-echo</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">static</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>那么，mod<!-- -->_<!-- -->echo 模块将被静态编译。</p></li><li><p>指定了关键字(all/most/few/reallyall)的 &quot;--enable-mods-static&quot; 选项，优先级高于指定或未指定关键字的 &quot;--enable-mods-shared&quot; 和 &quot;--enable-modules&quot; 选项，即静态关键字规则强于动态关键字规则。</p><p>例如，下面两个编译配置中，都是 &quot;--enable-mods-static=few&quot; 生效。第二个编译配置语句中将忽略 &quot;--enable-mods-shared=all&quot;。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/tmp/apache --enable-mods-static</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">few</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/tmp/apache --enable-mods-static</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">few --enable-mods-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于下面的例子，authn-file 和 echo 这两个模块既指定了动态编译又指定了静态编译，静态优先级高于动态，所以这两个模块被静态编译。由于没有使用关键字，所以会使用默认的 &quot;--enable-mods-shared=most&quot; 配置。即动态编译大部分，但指定的这两个模块被静态编译。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/tmp/apache </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mods-static</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;authn-file echo&#x27;</span><span class="token plain"> --enable-mods-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;authn-file echo&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>而下面这个例子由于额外指定了使用 &quot;--enable-mods-static=few&quot; 选项，其优先级高于默认的 &quot;--enable-mods-shared=most&quot;，所以结果是静态编译 few，且显式指定的两个模块也被静态编译。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/tmp/apache </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mods-static</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;authn-file echo&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mods-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;authn-file echo&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mods-static</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">few</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>使用了关键字的 &quot;--enable-mods-static&quot;、&quot;--enable-mods-shared &quot; 和 &quot;--enable-modules&quot; 的选项，隐含了 &quot;没有指定何种编译方式的模块&quot; 的默认编译方式。</p><p>例如下面的编译配置，&quot;--enable-mods-static&quot; 指定了关键字 few，它将优先于默认的配置规则 &quot;--enable-mods-shared=most&quot;，所以没有指定编译方式的模块 &quot;data&quot; 将以静态的方式编译。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/tmp/apache --enable-mods-static</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">few --enable-data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面的配置如何编译的？由于默认的是 &quot;--enable-mods-shared=most&quot; 编译方式，所以模块 &quot;data&quot; 将以动态的方式编译。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/tmp/apache --enable-data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再看下面的例子，配置中出现了 &quot;--enable-mods-static=few&quot; 和 &quot;--enable-mods-shared&quot;(未给定值时也是默认为 most)，static 的优先级高于 shared，所以没有指定编译方式的模块 &quot;data&quot; 使用静态编译方式编译，而显式指定了编译方式的模块 &quot;echo&quot; 其优先级最强，所以动态编译 &quot;echo&quot;。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/tmp/apache </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mods-static</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">few --enable-mods-shared --enable-data --enable-echo</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">shared</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="65mpm-的安装">6.5、MPM 的安装<a class="hash-link" href="#65mpm-的安装" title="标题的直接链接">​</a></h2><p>编译 mpm 模块(prefork/worker/event)和其他模块差不多，唯一的区别是必须至少编译一个 mpm 模块，且必须有且仅有一个被 httpd 加载。</p><p>编译安装时默认的 mpm 是 event 模式(和发行版有关)。但可以通过 &quot;--with-mpm=MPM<!-- -->_<!-- -->NAME&quot; 来指定被加载的 mpm 模块。以下是几个相关编译选项：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--with-mpm</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">MPM_Name：            用于指定默认的mpm模块，它所指定的模块会被静态编译，并在httpd启动时加载。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mpms-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">MPM-LIST：  指定动态编译安装的MPM列表，动态编译的MPM必须使用LoadModule指令加载才能使用。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果定 &quot;--with-mpm&quot; 选项指定了某个 mpm，则默认该模块被静态编译，但如果同时使用 &quot;--enable-mpms-shared&quot; 指定了该 mpm，则该 mpm 模块被动态编译。</p><p>如果某个 mpm 模块被静态编译，在 httpd 启动时会加载它，如果想要切换到其他 mpm 模块，只有一种方法：重新编译 httpd。</p><p>而动态编译 mpm 模块时，则可以通过 LoadModule 来切换到其他 mpm 模块。由于编译时自带默认 mpm 模块，还可以使用 &quot;--with-mpm&quot; 指定默认 mpm 模块，所以动态编译 mpm 模块无疑比静态编译要好。</p><p>&quot;--enable-mpms-shared&quot; 可以指定动态编译的 mpm 列表，使用空格分隔，但需要使用单引号包围。还可以使用关键字 &quot;all&quot; 表示动态编译所有 mpm 模块。 例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--enable-mpms-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;prefork worker&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mpms-shared</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="66关于---enable-so">6.6、关于 &quot;--enable-so&quot;<a class="hash-link" href="#66关于---enable-so" title="标题的直接链接">​</a></h2><p>一个模块被动态编译，在需要加载的时候使用 LoadModule 指令指定该模块，并重读配置文件即可。但 httpd 为什么能加载该动态模块？这就是 mod<!-- -->_<!-- -->so 的能力。实际上，LoadModule 和 LoadFile 指令就是该模块提供的。</p><p>该选项使得 httpd 有加载某动态模块的能力(DSO,Dynamic Shared Object)，也因此它只能使用静态编译方式随 httpd 启动被加载。只要不显式指定 &quot;--enable-so=shared&quot; 或者将其加入显式编译列表，它都会默认以静态方式编译。实际上，只要显式指定了动态方式编译该选项，编译时会报错。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="67开始编译-httpd">6.7、开始编译 httpd<a class="hash-link" href="#67开始编译-httpd" title="标题的直接链接">​</a></h2><p>至此，就可以开始编译 httpd 了。过程如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf httpd-2.4.51.tar.bz2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd httpd-2.4.51/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 httpd-2.4.51</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./configure --prefix=/usr/local/apache --sysconfdir=/etc/apache --with-z --with-pcre --with-apr=/usr/local/apr --with-apr-util=/usr/local/apr-util --with-mpm=event --enable-mpms-shared=all</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 httpd-2.4.51</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># make &amp;&amp; make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中安装路径为 /usr/local/apache，配置文件路径为 /etc/apache。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls /usr/local/apache/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bin  build  cgi-bin  error  htdocs  icons  include  logs  </span><span class="token function" style="color:rgb(0, 0, 255)">man</span><span class="token plain">  manual  modules</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>bin 目录为二进制程序存放位置，如启动脚本apachectl、httpd、htpasswd、ab（压力测试工具）等；</li><li>htdocs 目录存放网页文件，默认里面有 index.html；logs 目录存放了日志文件，除了日志文件，默认还有 httpd 运行的 pid 文件 httpd.pid，这个建议修改到 /var/run 目录下(方便判断)；modules 存放了编译后的模块；</li><li>man 目录为帮助文档路径。</li></ul><p>使用 httpd 的启动脚本 bin/apahcectl 启动 httpd，然后测试其是否正常。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd /usr/local/apache/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 apache</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># bin/apachectl start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 apache</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># netstat -tnlp | grep httpd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcp6       </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> :::80                   :::*                    LISTEN      </span><span class="token number" style="color:rgb(9, 134, 88)">3996</span><span class="token plain">/httpd        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 apache</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在浏览器中输入 IP 地址即可访问。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="68编译后的规范化操作">6.8、编译后的规范化操作<a class="hash-link" href="#68编译后的规范化操作" title="标题的直接链接">​</a></h2><ol><li><p>设置 man 路径。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;MANPATH /usr/local/apache/man&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain">/etc/man.config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>设置 PATH 环境变量。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;PATH=/usr/local/apache/bin:$PATH&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">/etc/profile.d/apache.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">source</span><span class="token plain"> /etc/profile.d/apache.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>输出头文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">ln</span><span class="token plain"> -s /usr/include /usr/local/apache/include</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>提供服务启动脚本。</p></li></ol><p>提供不提供没多大所谓，因为 apachectl 或 httpd 命令自身可以管理进程的启停，但自身管理启停时不提供 lock 文件。</p><p>如果要提供的话，从 yum 安装的 httpd 提供的 /usr/lib/systemd/system/httpd.service(systemd) 或 /etc/init.d/httpd(sysV) 拷贝后稍作修改就可以了。</p><p>以下是根据我当前的编译环境提供的 httpd sysV 服务管理脚本 /etc/rc.d/init.d/httpd。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># httpd        Startup script for the Apache HTTP Server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># chkconfig: - 85 15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># description: The Apache HTTP Server is an efficient and extensible  \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#           server implementing the current HTTP standards.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#  若httpd配置文件中指定了PidFile，则修改此脚本中的pidfile变量            #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"> /etc/rc.d/init.d/functions</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -f /etc/sysconfig/httpd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"> /etc/sysconfig/httpd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Start httpd in the C locale by default.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">HTTPD_LANG</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">${HTTPD_LANG-&quot;C&quot;}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># This will prevent initlog from swallowing up a pass-phrase prompt if</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># mod_ssl needs a pass-phrase from the user.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">INITLOG_ARGS</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Set HTTPD=/usr/sbin/httpd.worker in /etc/sysconfig/httpd to use a server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># with the thread-based &quot;worker&quot; MPM; BE WARNED that some modules may not</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># work correctly with a thread-based MPM; notably PHP will refuse to start.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Path to the apachectl script, server binary, and short-form for messages.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">apachectl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apache/bin/apachectl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">httpd</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apache/bin/apachectl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">prog</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">httpd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">pidfile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apache/logs/httpd.pid</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">lockfile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/var/lock/subsys/httpd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">STOP_TIMEOUT</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">${STOP_TIMEOUT-10}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">config</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/apache/httpd.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># The semantics of these two functions differ from the way apachectl does</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># things -- attempting to start while running is a failure, and shutdown</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># when not running is also a failure.  So we just do it the way init scripts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># are expected to behave here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function-name function" style="color:rgb(0, 0, 255)">start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> -n $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Starting </span><span class="token string variable" style="color:rgb(9, 134, 88)">$prog</span><span class="token string" style="color:rgb(163, 21, 21)">: &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">LANG</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$HTTPD_LANG</span><span class="token plain"> daemon --pidfile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"> -f </span><span class="token variable" style="color:rgb(9, 134, 88)">$config</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$OPTIONS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$RETVAL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">touch</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">${lockfile}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">return</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$RETVAL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># When stopping httpd, a delay (of default 10 second) is required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># before SIGKILLing the httpd parent; this gives enough time for the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># httpd parent to SIGKILL any errant children.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function-name function" style="color:rgb(0, 0, 255)">stop</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    status -p </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> -n $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Stopping </span><span class="token string variable" style="color:rgb(9, 134, 88)">$prog</span><span class="token string" style="color:rgb(163, 21, 21)">: &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        killproc -p </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> -d </span><span class="token variable" style="color:rgb(9, 134, 88)">${STOP_TIMEOUT}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> -n $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Stopping </span><span class="token string variable" style="color:rgb(9, 134, 88)">$prog</span><span class="token string" style="color:rgb(163, 21, 21)">: &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        success</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$RETVAL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">rm</span><span class="token plain"> -f </span><span class="token variable" style="color:rgb(9, 134, 88)">${lockfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function-name function" style="color:rgb(0, 0, 255)">reload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> -n $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Reloading </span><span class="token string variable" style="color:rgb(9, 134, 88)">$prog</span><span class="token string" style="color:rgb(163, 21, 21)">: &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">LANG</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$HTTPD_LANG</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$OPTIONS</span><span class="token plain"> -t </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&amp;</span><span class="token plain">/dev/null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;not reloading due to configuration syntax error&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        failure $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;not reloading </span><span class="token string variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token string" style="color:rgb(163, 21, 21)"> due to configuration syntax error&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># Force LSB behaviour from killproc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">LSB</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> killproc -p </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"> -HUP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$RETVAL</span><span class="token plain"> -eq </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            failure $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;httpd shutdown&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See how we were called.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token string variable" style="color:rgb(9, 134, 88)">$1</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  stop</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    stop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        status -p </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    stop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  condrestart</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">try-restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> status -p </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&amp;</span><span class="token plain">/dev/null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        stop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  force-reload</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">reload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        reload</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  graceful</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">help</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">configtest</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">fullstatus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token variable" style="color:rgb(9, 134, 88)">$apachectl</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$@</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  *</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Usage: </span><span class="token string variable" style="color:rgb(9, 134, 88)">$prog</span><span class="token string" style="color:rgb(163, 21, 21)"> {start|stop|restart|condrestart|try-restart|force-reload|reload|status|fullstatus|graceful|help|configtest}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">esac</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$RETVAL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="69搭建-lamp-环境">6.9、搭建 LAMP 环境<a class="hash-link" href="#69搭建-lamp-环境" title="标题的直接链接">​</a></h2><p>本文给出搭建 LAMP 的步骤，其中 php 使用的是 php-fpm 管理方式，php 和 MySQL(MariaDB) 交互使用的是 mysqlnd 方式(另一种是 libmysql)。最后给出一个 php+mysql 的论坛程序 discuz 的布置过程。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="691编译-httpd">6.9.1、编译 httpd<a class="hash-link" href="#691编译-httpd" title="标题的直接链接">​</a></h3><p>前文针对 httpd 编译做了详细地描述，这里不再赘述，下面只给出关键步骤。</p><ol><li><p>解决 httpd 编译依赖</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install pcre pcre-devel expat-devel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf apr-1.7.0.tar.bz2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd apr-1.7.0/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 apr-1.7.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./configure --prefix=/usr/local/apr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 apr-1.7.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># make &amp;&amp; make install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf apr-util-1.6.1.tar.bz2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd apr-util-1.6.1/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 apr-util-1.6.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 apr-util-1.6.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># make &amp;&amp; make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>编译 httpd</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf httpd-2.4.47.tar.gz </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd httpd-2.4.47/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 httpd-2.4.47</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./configure --prefix=/usr/local/apache --sysconfdir=/etc/apache --with-z --with-pcre --with-apr=/usr/local/apr --with-apr-util=/usr/local/apr-util --with-mpm=event --enable-mpms-shared=all</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 httpd-2.4.47</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># make &amp;&amp; make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>编译后的规范化操作</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &quot;MANPATH /usr/local/apache/man&quot; &gt;&gt;/etc/man.config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># echo &#x27;PATH=/usr/local/apache/bin:$PATH&#x27; &gt;/etc/profile.d/apache.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># source /etc/profile.d/apache.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ln -sv /usr/include /usr/local/apache/include</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">‘/usr/local/apache/include/include’ -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> ‘/usr/include’</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>提供 httpd 服务脚本，编辑 /etc/rc.d/init.d/httpd 输入如下脚本</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># httpd        Startup script for the Apache HTTP Server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># chkconfig: - 85 15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># description: The Apache HTTP Server is an efficient and extensible  \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#           server implementing the current HTTP standards.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#  若httpd配置文件中指定了PidFile，则修改此脚本中的pidfile变量           #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"> /etc/rc.d/init.d/functions</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -f /etc/sysconfig/httpd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"> /etc/sysconfig/httpd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Start httpd in the C locale by default.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">HTTPD_LANG</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">${HTTPD_LANG-&quot;C&quot;}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># This will prevent initlog from swallowing up a pass-phrase prompt if</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># mod_ssl needs a pass-phrase from the user.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">INITLOG_ARGS</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Set HTTPD=/usr/sbin/httpd.worker in /etc/sysconfig/httpd to use a server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># with the thread-based &quot;worker&quot; MPM; BE WARNED that some modules may not</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># work correctly with a thread-based MPM; notably PHP will refuse to start.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Path to the apachectl script, server binary, and short-form for messages.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">apachectl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apache/bin/apachectl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">httpd</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apache/bin/apachectl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">prog</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">httpd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">pidfile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/apache/logs/httpd.pid</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">lockfile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/var/lock/subsys/httpd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">STOP_TIMEOUT</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">${STOP_TIMEOUT-10}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">config</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/apache/httpd.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># The semantics of these two functions differ from the way apachectl does</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># things -- attempting to start while running is a failure, and shutdown</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># when not running is also a failure.  So we just do it the way init scripts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># are expected to behave here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function-name function" style="color:rgb(0, 0, 255)">start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> -n $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Starting </span><span class="token string variable" style="color:rgb(9, 134, 88)">$prog</span><span class="token string" style="color:rgb(163, 21, 21)">: &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">LANG</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$HTTPD_LANG</span><span class="token plain"> daemon --pidfile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"> -f </span><span class="token variable" style="color:rgb(9, 134, 88)">$config</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$OPTIONS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$RETVAL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">touch</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">${lockfile}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">return</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$RETVAL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># When stopping httpd, a delay (of default 10 second) is required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># before SIGKILLing the httpd parent; this gives enough time for the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># httpd parent to SIGKILL any errant children.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function-name function" style="color:rgb(0, 0, 255)">stop</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   status -p </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> -n $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Stopping </span><span class="token string variable" style="color:rgb(9, 134, 88)">$prog</span><span class="token string" style="color:rgb(163, 21, 21)">: &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       killproc -p </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> -d </span><span class="token variable" style="color:rgb(9, 134, 88)">${STOP_TIMEOUT}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> -n $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Stopping </span><span class="token string variable" style="color:rgb(9, 134, 88)">$prog</span><span class="token string" style="color:rgb(163, 21, 21)">: &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       success</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$RETVAL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">rm</span><span class="token plain"> -f </span><span class="token variable" style="color:rgb(9, 134, 88)">${lockfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function-name function" style="color:rgb(0, 0, 255)">reload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> -n $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Reloading </span><span class="token string variable" style="color:rgb(9, 134, 88)">$prog</span><span class="token string" style="color:rgb(163, 21, 21)">: &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">LANG</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$HTTPD_LANG</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$OPTIONS</span><span class="token plain"> -t </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&amp;</span><span class="token plain">/dev/null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;not reloading due to configuration syntax error&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       failure $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;not reloading </span><span class="token string variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token string" style="color:rgb(163, 21, 21)"> due to configuration syntax error&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token comment" style="color:rgb(0, 128, 0)"># Force LSB behaviour from killproc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">LSB</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> killproc -p </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"> -HUP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$RETVAL</span><span class="token plain"> -eq </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           failure $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;httpd shutdown&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># See how we were called.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token string variable" style="color:rgb(9, 134, 88)">$1</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> stop</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   stop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       status -p </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   stop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> condrestart</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">try-restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> status -p </span><span class="token variable" style="color:rgb(9, 134, 88)">${pidfile}</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$httpd</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&amp;</span><span class="token plain">/dev/null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> force-reload</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">reload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       reload</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> graceful</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">help</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">configtest</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">fullstatus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token variable" style="color:rgb(9, 134, 88)">$apachectl</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$@</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> *</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> $</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Usage: </span><span class="token string variable" style="color:rgb(9, 134, 88)">$prog</span><span class="token string" style="color:rgb(163, 21, 21)"> {start|stop|restart|condrestart|try-restart|force-reload|reload|status|fullstatus|graceful|help|configtest}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">RETVAL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">esac</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$RETVAL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>启动 httpd 服务</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod +x /etc/rc.d/init.d/httpd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># service httpd start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Reloading systemd:                                         </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">  OK  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Starting httpd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">via systemctl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">:                            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">  OK  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># lsof -i :80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COMMAND  PID   </span><span class="token environment constant" style="color:rgb(129, 31, 63)">USER</span><span class="token plain">   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">httpd   </span><span class="token number" style="color:rgb(9, 134, 88)">1684</span><span class="token plain">   root    4u  IPv6  </span><span class="token number" style="color:rgb(9, 134, 88)">24292</span><span class="token plain">      0t0  TCP *:http </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">httpd   </span><span class="token number" style="color:rgb(9, 134, 88)">1688</span><span class="token plain"> daemon    4u  IPv6  </span><span class="token number" style="color:rgb(9, 134, 88)">24292</span><span class="token plain">      0t0  TCP *:http </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">httpd   </span><span class="token number" style="color:rgb(9, 134, 88)">1689</span><span class="token plain"> daemon    4u  IPv6  </span><span class="token number" style="color:rgb(9, 134, 88)">24292</span><span class="token plain">      0t0  TCP *:http </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">httpd   </span><span class="token number" style="color:rgb(9, 134, 88)">1690</span><span class="token plain"> daemon    4u  IPv6  </span><span class="token number" style="color:rgb(9, 134, 88)">24292</span><span class="token plain">      0t0  TCP *:http </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="692编译-php">6.9.2、编译 php<a class="hash-link" href="#692编译-php" title="标题的直接链接">​</a></h3><p>三种工作模式：CGI、作为模块加入到 apache、fastcgi。最简单的是以模块方式加入到 apache，此处演示的是 php-fpm 管理 php-cgi 方式。请参见 <a href="https://www.brinnatt.com/addons/%e7%ac%ac-b-%e7%ab%a0-cgi-%e5%8a%a8%e6%80%81%e8%af%b7%e6%b1%82/" target="_blank" rel="noopener noreferrer">CGI 原理</a>。</p><p>fastcgi 模式的 php-cgi，由 php-fpm 提供服务管理，它会根据配置文件启动一定数量的 cgi 进程，其默认监听的端口为 9000，该服务正常工作需要配置文件。也就是说 fastcgi 模式的 php 有两个配置文件，一个是 php 的配置文件，一个是 php-fpm 的配置文件。</p><p>虽然此处演示的是 php-fpm 管理方式，但有必要说明下，在 Linux 中如果模块化安装 php，不推荐在使用 Apache 2.x 中使用线程化 MPM(worker 和 event)，而是使用 prefork 模式的 mpm，因为 Linux 系统的线程设计并不那么完美。</p><ul><li>所以，如果 php 和 apache 在同一台主机上(cgi 或者模块化方式安装 php 的时候)，建议 httpd 使用 prefork 模型，而不在同一台主机中，建议将 php 设计为 fastcgi 的工作模式。</li><li>而在 windows 平台中则无需考虑这些问题，因为 windows 系统是真正意义上的多线程系统。</li></ul><p>下载相关文件地址：</p><ul><li>php 下载地址：<a href="http://php.net/downloads" target="_blank" rel="noopener noreferrer">http://php.net/downloads</a></li><li>php 手册地址：<a href="http://php.net/manual/zh/" target="_blank" rel="noopener noreferrer">http://php.net/manual/zh/</a></li><li>手册下载地址：<a href="http://php.net/download-docs.php" target="_blank" rel="noopener noreferrer">http://php.net/download-docs.php</a></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6921php-编译选项说明">6.9.2.1、php 编译选项说明<a class="hash-link" href="#6921php-编译选项说明" title="标题的直接链接">​</a></h4><p>编译安装 php 有非常多的选项，比 httpd 还多。可以在解压 php 后的目录下使用 <code>./configure --help</code> 查看。以下是部分选项，其中给出 &quot;--enable-XXXX&quot; 的选项表示默认是 disable 的，若要开启，需要在此处手动 enable，如果给出的是 &quot;--disable-XXXX&quot; 表示默认是 enable 的。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">--prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">PREFIX</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">【SAPI modules:】</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-apxs2</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">FILE       Build shared Apache </span><span class="token number" style="color:rgb(9, 134, 88)">2.0</span><span class="token plain"> Handler module. FILE is the optional</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          pathname to the Apache apxs tool apxs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-fpm            Enable building of the fpm SAPI executable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">【General settings:】</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-config-file-path</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token plain">      Set the path </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">which</span><span class="token plain"> to </span><span class="token function" style="color:rgb(0, 0, 255)">look</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> php.ini </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">PREFIX/lib</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-config-file-scan-dir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token plain">  Set the path where to scan </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> configuration files</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">【Extensions:】</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">#######################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># --with-EXTENSION=shared[,PATH]                      #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># NOTE: Not all extensions can be build as &#x27;shared&#x27;.  #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># Example: --with-foobar=shared,/usr/local/foobar/    #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">#######################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-openssl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR      Include OpenSSL support </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">requires OpenSSL </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0.9</span><span class="token plain">.6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mbstring       Enable multibyte string support</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-zlib</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR         Include ZLIB support</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-bz2</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR          Include BZip2 support</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-mhash</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR        Include mhash support</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-mcrypt</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR       Include mcrypt support</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-freetype-dir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR  GD: Set the path to FreeType </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> prefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-jpeg-dir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR     GD: Set the path to libjpeg </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> prefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-png-dir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR      GD: Set the path to libpng </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> prefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-libxml-dir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR   SimpleXML: libxml2 </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> prefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-sockets        Enable sockets support</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--disable-xml           Disable XML support </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">不写时默认--enable-xml</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">【连接数据库:】</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-mysql</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR        Include MySQL support.  DIR is the MySQL base</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          directory, </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> no DIR is passed or the value is</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          mysqlnd the MySQL native driver will be used</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-mysqli</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">FILE      Include MySQLi support.  FILE is the path</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          to mysql_config.  If no value or mysqlnd is passed</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          as FILE, the MySQL native driver will be used</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-pdo-mysql</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">DIR    PDO: MySQL support. DIR is the MySQL base directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          If no value or mysqlnd is passed as DIR, the</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          MySQL native driver will be used</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-mysqlnd        Enable mysqlnd explicitly, will be </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"> implicitly</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          when required by other extensions</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">【Zend:】</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--enable-maintainer-zts    Enable thread safety - </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> code maintainers only</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>部分选项说明：</p><ol><li><p>在【zend】扩展部分的选项 &quot;--enable-maintainer-zts&quot; 是为了让 php 支持多线程 MPM 的，即 php 以模块化方式或 cgi 模式安装时且 httpd 配置为 worker 或 event 时需要启用该项。而如果 php 以 fastcgi 模式安装时，由于 php 有独立的服务和进程，所以该项是多余的。</p></li><li><p>&quot;--with-apxs2&quot; 是让 php 以模块化的方式安装到其他程序中，&quot;--enable-fpm&quot; 是让 php 以 fastcgi 模式工作的选项。所以此处采用后者，而以模块方式和 httpd 交互时采用前者。</p></li><li><p>&quot;--with-config-file-path&quot; 和 &quot;--with-config-file-scan-dir&quot; 分别是 php 配置文件 php.ini 的存放位置以及其他加载的配置文件路径，scan-dir 类的目录就像 /etc/profile.d、/etc/httpd/conf.d 这样的目录路径。</p></li><li><p>&quot;--with-openssl&quot; 选项让 php 支持 ssl；&quot;--enable-mbstring&quot; 选项是让 php 支持多字节字符的，例如中文一个字符两个字节，也就是说让 php 支持国际化的；&quot;--with-zlib&quot;、&quot;--with-bz2&quot;、&quot;--with-mhash&quot; 和 &quot;--with-mcrypt&quot; 选项让 php 支持这些压缩和加密机制。</p></li><li><p>&quot;--with-freetype-dir&quot;、&quot;--with-jpeg-dir&quot; 和 &quot;--with-png-dir&quot; 分别是让 php 支持多种文字样式、支持 jpeg、支持 png 的选项。</p></li><li><p>php 连接 mysql 有两种方式，一种是以 libmysql 的驱动方式连接 mysql，一种是以 mysqlnd 驱动方式连接 mysql。以下列出了 libmysql 和 mysqlnd 这两种驱动方式的编译模式。</p><ul><li><p>以 libmysql 驱动方式连接 mysql(Mariadb)，需要提前安装 mysql(Mariadb) 和 mysql-devel(mariadb-devel)，并使用 &quot;--with-mysql&quot; 选项指定 mysql 安装路径，&quot;--with-mysqli&quot; 选项指定 mysql<!-- -->_<!-- -->config 脚本的路径，&quot;--with-pdo-mysql&quot; 选项也指定 mysql 安装路径。假如 mysql 安装在 /usr/local/mysql 下。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/php </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-mysql</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/mysql </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-mysqli</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/mysql/bin/mysql_config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>以 mysqlnd 驱动方式连接 mysql，不需要提前安装 mysql 和 mysql-devel，--with-mysql、--with-mysqli 和 --with-pdo-mysql 选项都不需要指定具体路径，只需使用 mysqlnd 作为这些选项的值即可。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/php </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-mysql</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">mysqlnd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-mysqli</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">mysqlnd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--with-pdo-mysql</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">mysqlnd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p>在 php 5.3 的时候已经支持 mysqlnd 驱动方式了，在 php 5.4 的时候 mysqlnd 已经是默认的配置选项了。建议使用 mysqlnd 的驱动方式。</p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6922php-编译过程">6.9.2.2、php 编译过程<a class="hash-link" href="#6922php-编译过程" title="标题的直接链接">​</a></h4><p>由于是配置 fastcgi 的模式，所以在 <code>./configure</code> 的时候将 apxs2 功能换为 &quot;--enable-fpm&quot;，并且由于此模式下的 php 由自己独立的服务来控制进程的生成，所以对于为了支持 httpd 线程的选项 &quot;--enable-maintainer-zts&quot; 也去掉。以下是编译安装过程：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install -y bzip2-devel libmcrypt-devel openssl-devel libxml2-devel libsqlite3x-devel oniguruma-devel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf php-5.5.38.tar.bz2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd php-5.5.38/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 php-5.5.38</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./configure --prefix=/usr/local/php --with-openssl --enable-mbstring --enable-sockets --with-freetype-dir --with-jpeg-dir --with-png-dir --with-libxml-dir=/usr --enable-xml --with-zlib --with-mcrypt --with-bz2 --with-mhash --with-config-file-path=/etc --with-config-file-scan-dir=/etc/php.d --with-mysql=mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --enable-fpm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 php-5.5.38</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># make &amp;&amp; make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 提供php配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 php-5.5.38</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp php.ini-production /etc/php.ini</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 提供php-fpm服务管理脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 php-5.5.38</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 php-5.5.38</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod +x /etc/init.d/php-fpmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 提供php-fpm配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 php-5.5.38</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd /usr/local/php/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 php</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp etc/php-fpm.conf.default etc/php-fpm.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 修改php-fpm配置文件(做实验的话改不改随意)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 php</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim etc/php-fpm.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pm.max_children </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pm.start_servers </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pm.min_spare_servers </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pm.max_spare_servers </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 启动php-fpm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># service php-fpmd start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Starting php-fpm  </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6923配置-httpd-使其转发动态请求给-php-fpm">6.9.2.3、配置 httpd 使其转发动态请求给 php-fpm<a class="hash-link" href="#6923配置-httpd-使其转发动态请求给-php-fpm" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 启用fcgi的支持模块。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LoadModule proxy_module modules/mod_proxy.so</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 添加php后缀格式文件的识别功能。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IfModule mime_module</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    TypesConfig /etc/apache/mime.types</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    AddType application/x-compress .Z</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    AddType application/x-gzip .gz .tgz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    AddType application/x-httpd-php .php            </span><span class="token comment" style="color:rgb(0, 128, 0)"># 新增</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    AddType application/x-httpd-php-source .phps    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 新增</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/IfModule</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 添加php后缀的主页</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">IfModule dir_module</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DirectoryIndex index.php index.html</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/IfModule</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 启用虚拟主机模块，Include虚拟主机配置文件，并注释中心主机DocumentRoot。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Include /etc/apache/extra/httpd-vhosts.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#DocumentRoot &quot;/usr/local/apache/htdocs&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置虚拟主机。注意主机中需要添加下面两行，第一行表示关闭正向代理功能，第二行表示反向代理时进行正则匹配。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 对主机的.php(不区分大小写)文件的访问都通过fcgi协议交给php，由于此处测试，php正好和httpd在同一服务器上，# 且php-fpm默认监听的端口为9000，所以为fcgi://127.0.0.1:9000，在此之后还需要写上/DocumentRoot/$1，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># &quot;$1&quot;是正则的反向引用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep -Ev &quot;^#|^$&quot; /etc/apache/extra/httpd-vhosts.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost *:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/www/a.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ErrorLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;logs/dummy-host.example.com-error_log&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;logs/dummy-host.example.com-access_log&quot;</span><span class="token plain"> common</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ProxyRequests off</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ProxyPassMatch </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;(?i)^/(.*\.php)$&quot;</span><span class="token plain"> fcgi://127.0.0.1:9000/var/www/a.com/</span><span class="token variable" style="color:rgb(9, 134, 88)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/www/a.com&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            AllowOverride None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Options None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Require all granted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/Directory</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>提供主页测试文件 index.php。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mkdir -p /var/www/a.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim /var/www/a.com/index.php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">a.com</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/h</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">?php</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    phpinfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">?</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启 httpd，浏览器中进行站点访问测试，已测试成功。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="693为-php-安装-xcache">6.9.3、为 php 安装 xcache<a class="hash-link" href="#693为-php-安装-xcache" title="标题的直接链接">​</a></h3><p>php 是一种解释型语言，意味着 php 脚本在执行时不需要事先编译，而是像 shell 脚本一样直接执行。但事实上它还是会编译的，只不过是执行时编译，它会将代码编译成字节码(opcode)然后运行。</p><p>编译是一个很消耗时间的操作，因此需要为编译好的 opcode 提供缓存以提高性能，降低负载。目前最流行的 opcode 缓存工具是 XCache，它是一个开源的工具。</p><p>安装 xcache。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf xcache-3.2.0.tar.gz </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd xcache-3.2.0/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 添加扩展前，先运行phpize</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 xcache-3.2.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># /usr/local/php/bin/phpize </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Configuring for:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PHP Api Version:         </span><span class="token number" style="color:rgb(9, 134, 88)">20121113</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Zend Module Api No:      </span><span class="token number" style="color:rgb(9, 134, 88)">20121212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Zend Extension Api No:   </span><span class="token number" style="color:rgb(9, 134, 88)">220121212</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 xcache-3.2.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./configure --enable-xcache --with-php-config=/usr/local/php/bin/php-config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 xcache-3.2.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># make &amp;&amp; make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在解压 xcache 的目录下，有 xcache 的配置文件 xcache.ini，将其追加到 php 的配置文件中，或者将其复制到 php 的配置文件扫描目录 /etc/php.d 下(该目录是之前编译 php 时 <code>./configure</code> 配置选项 &quot;--with-config-file-scan-dir&quot; 指定的项)。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 xcache-3.2.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mkdir /etc/php.d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@aarch64 xcache-3.2.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp xcache.ini /etc/php.d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将 xcache 源码目录下的 htdocs 目录拷贝到虚拟主机的根目录下</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 xcache-3.2.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp -a htdocs/ /var/www/a.com/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>关闭 xcache 认证，然后重启 php-fpmd 服务，重启 httpd 服务。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim /etc/php.d/xcache.ini</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">xcache.admin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xcache.admin.enable_auth </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Off</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># service php-fpmd restart </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Gracefully shutting down php-fpm </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Starting php-fpm  </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># service httpd restart </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Restarting httpd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">via systemctl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">:                          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">  OK  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>浏览器中输入 <a href="http://192.168.0.88/htdocs" target="_blank" rel="noopener noreferrer">http://192.168.0.88/htdocs</a> 可以看到 xcache 界面：</p><p><img loading="lazy" alt="xcache" src="/assets/images/xcache-d8d562b235da22473ac385f087710819.png" width="954" height="483" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="694安装-mysqlmariadb">6.9.4、安装 MySQL(MariaDB)<a class="hash-link" href="#694安装-mysqlmariadb" title="标题的直接链接">​</a></h3><p>在 x86 架构下，安装 mysql/mariadb 有三个选择，第一种是通过源码编译安装，第二种是通过通用二进制方式安装，第三种是通过 Linux 发行版包管理器安装。</p><p>在 arm64 架构下，安装 mysql/mariadb 要么自己通过源码编译，要么通过 Linux 发行版包管理器安装。这里的实验我们选择使用后者，即 rpm 包进行安装。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/yum.repos.d/mariadb.repo </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># MariaDB 10.3 CentOS repository list - created 2021-10-29 03:23 UTC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># https://mariadb.org/download/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">mariadb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">name </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> MariaDB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">baseurl </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> https://ftp.ubuntu-tw.org/mirror/mariadb/yum/10.3/centos7-aarch64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https://ftp.ubuntu-tw.org/mirror/mariadb/yum/RPM-GPG-KEY-MariaDB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install MariaDB-server MariaDB-client -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>初始化 mariadb</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl start mariadb.service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mysql_secure_installation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 按照步骤完成初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mysql -uroot -p</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Enter password: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Welcome to the MariaDB monitor.  Commands end with </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> or </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">g.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Your MariaDB connection </span><span class="token function" style="color:rgb(0, 0, 255)">id</span><span class="token plain"> is </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Server version: </span><span class="token number" style="color:rgb(9, 134, 88)">10.3</span><span class="token plain">.31-MariaDB MariaDB Server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Copyright </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2000</span><span class="token plain">, </span><span class="token number" style="color:rgb(9, 134, 88)">2018</span><span class="token plain">, Oracle, MariaDB Corporation Ab and others.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Type </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;help;&#x27;</span><span class="token plain"> or </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;\h&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> help. Type </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;\c&#x27;</span><span class="token plain"> to </span><span class="token function" style="color:rgb(0, 0, 255)">clear</span><span class="token plain"> the current input statement.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">MariaDB </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">none</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="695测试-lamp搭建-discuz-论坛">6.9.5、测试 LAMP——搭建 discuz 论坛<a class="hash-link" href="#695测试-lamp搭建-discuz-论坛" title="标题的直接链接">​</a></h3><p>discuz 是论坛软件系统，基于 php+MySQL 平台。基本配置很简单，更多的配置和个性化定制在官方主页查看教程。</p><p>官方主页：<a href="http://www.discuz.net/forum.php" target="_blank" rel="noopener noreferrer">http://www.discuz.net/forum.php</a></p><p>discuz 下载地址：<a href="http://www.discuz.net/thread-3570835-1-1.html" target="_blank" rel="noopener noreferrer">http://www.discuz.net/thread-3570835-1-1.html</a></p><p>简单布置它们的过程很简单，只需复制相关文件到对应的网站根目录下，然后在浏览器中输入对应的目录名即可打开程序。中间测试过程中如果出现问题，再对应修改即可。</p><p>首先配置 httpd，提供一个虚拟主机。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># grep -vE &quot;^#|^$&quot; /etc/apache/extra/httpd-vhosts.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">VirtualHost *:8</span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">0</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ServerName www.a.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DocumentRoot </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/www/a.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ErrorLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;logs/dummy-host.example.com-error_log&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CustomLog </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;logs/dummy-host.example.com-access_log&quot;</span><span class="token plain"> common</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ProxyRequests off</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ProxyPassMatch </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;(?i)^/(.*\.php)$&quot;</span><span class="token plain"> fcgi://127.0.0.1:9000/var/www/a.com/</span><span class="token variable" style="color:rgb(9, 134, 88)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/www/a.com&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            AllowOverride None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Options None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Require all granted</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/Directory</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">/VirtualHost</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将解压后 discuz 中的 upload 目录复制到对应虚拟主机的 DocumentRoot 目录下。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># unzip -q Discuz_X3.2_SC_UTF8.zip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp -a upload/ /var/www/a.com/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启 httpd 服务。测试 discuz。不过得先在客户端的 hosts 文件中添加解析记录，例如此处为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token number" style="color:rgb(9, 134, 88)">10.47</span><span class="token plain">.76.25     www.a.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># service php-fpmd restart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Gracefully shutting down php-fpm </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Starting php-fpm  </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># service httpd restart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Restarting httpd </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">via systemctl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">:                          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">  OK  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在浏览器中输入 <a href="http://www.a.com/upload" target="_blank" rel="noopener noreferrer">http://www.a.com/upload</a>：</p><p><img loading="lazy" alt="discuz_intall" src="/assets/images/discuz_install-ec643749c04f8abe80986d893458a440.png" width="708" height="496" class="img_ev3q"></p><p>然后在安装前会自动检查是否符合安装条件。将以下所有不符合条件的全部修改成符合条件：</p><p><img loading="lazy" alt="discuz_problem" src="/assets/images/discuz_problem-443be162bb86b95aefffe3412ed092e6.png" width="708" height="753" class="img_ev3q"></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd /var/www/a.com/upload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 upload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># touch config/config_{global,ucenter}.php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 upload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod a+w config/config_{global,ucenter}.php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 upload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod a+w  data config data/{cache,avatar,plugindata,download,addonmd5,template,threadcache,attachment,log} data/attachment/{album,forum,group}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 upload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod a+w uc_client/data/cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 upload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod a+w uc_server/data uc_server/data/{cache,avatar,backup,logs,tmp,view}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 upload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>刷新下，条件满足：</p><p><img loading="lazy" alt="discuz_envok" src="/assets/images/discuz_envok-8af4dedfb0678ff4aef3c2fc06a3a593.png" width="709" height="753" class="img_ev3q"></p><p>继续下一步，配置数据库和管理员信息，按照提示很容易配置：</p><p><img loading="lazy" alt="discuz_envset" src="/assets/images/discuz_envset-d9491d51e4a5e54a0d8b7d3540071707.png" width="708" height="736" class="img_ev3q"></p><p>点击下一步继续，出现如下问题：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">数据库连接错误</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">No such </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> or directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">您必须解决以上问题，安装才可以继续</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>解决方法：将 localhost 改成 mysql 服务器的 IP 地址即可。</li></ul><p>继续下一步安装完成：</p><p><img loading="lazy" alt="discuz_finished" src="/assets/images/discuz_finished-b2b3521cc8ae3e8bf9f361a50157b5ab.png" width="709" height="725" class="img_ev3q"></p><p>至此，Discuz 论坛已经完成安装，LAMP 测试结束。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/linux-advanced-7"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">第 7 章 Linux httpd 服务进阶配置</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux-advanced-9"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">第 9 章 Linux Nginx 服务配置</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#61解决-httpd-编译依赖" class="table-of-contents__link toc-highlight">6.1、解决 httpd 编译依赖</a></li><li><a href="#62httpd-编译选项" class="table-of-contents__link toc-highlight">6.2、httpd 编译选项</a></li><li><a href="#63模块动静态编译" class="table-of-contents__link toc-highlight">6.3、模块动静态编译</a></li><li><a href="#64动静态编译的优先级规则" class="table-of-contents__link toc-highlight">6.4、动静态编译的优先级规则</a></li><li><a href="#65mpm-的安装" class="table-of-contents__link toc-highlight">6.5、MPM 的安装</a></li><li><a href="#66关于---enable-so" class="table-of-contents__link toc-highlight">6.6、关于 &quot;--enable-so&quot;</a></li><li><a href="#67开始编译-httpd" class="table-of-contents__link toc-highlight">6.7、开始编译 httpd</a></li><li><a href="#68编译后的规范化操作" class="table-of-contents__link toc-highlight">6.8、编译后的规范化操作</a></li><li><a href="#69搭建-lamp-环境" class="table-of-contents__link toc-highlight">6.9、搭建 LAMP 环境</a><ul><li><a href="#691编译-httpd" class="table-of-contents__link toc-highlight">6.9.1、编译 httpd</a></li><li><a href="#692编译-php" class="table-of-contents__link toc-highlight">6.9.2、编译 php</a><ul><li><a href="#6921php-编译选项说明" class="table-of-contents__link toc-highlight">6.9.2.1、php 编译选项说明</a></li><li><a href="#6922php-编译过程" class="table-of-contents__link toc-highlight">6.9.2.2、php 编译过程</a></li><li><a href="#6923配置-httpd-使其转发动态请求给-php-fpm" class="table-of-contents__link toc-highlight">6.9.2.3、配置 httpd 使其转发动态请求给 php-fpm</a></li></ul></li><li><a href="#693为-php-安装-xcache" class="table-of-contents__link toc-highlight">6.9.3、为 php 安装 xcache</a></li><li><a href="#694安装-mysqlmariadb" class="table-of-contents__link toc-highlight">6.9.4、安装 MySQL(MariaDB)</a></li><li><a href="#695测试-lamp搭建-discuz-论坛" class="table-of-contents__link toc-highlight">6.9.5、测试 LAMP——搭建 discuz 论坛</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">学习</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/skill">技术笔记</a></li><li class="footer__item"><a class="footer__link-item" href="/project">实战项目</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/linux">Linux</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/zqingfa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/website">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">浙ICP备20024502号-1</a></p><p>Copyright © 2022 - PRESENT zhangqf Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.9b8cde08.js"></script>
<script src="/assets/js/main.98aacc98.js"></script>
</body>
</html>