<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-linux/cicd/linux-cicd-6">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">第 6 章 DevOps 实践 - Linux技术分享</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://zhangqf.com/docs/linux-cicd-6"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="第 6 章 DevOps 实践 - Linux技术分享"><meta data-rh="true" name="description" content="前面几个章节介绍了跟 DevOps 生态圈相关的一些应用工具，下面借助这些应用工具来实现 DevOps 生产作业。另外，以下实践中会直接使用 kubernetes 和 docker 应用工具，而不会过多地介绍其原理，可自行查阅相关资料。"><meta data-rh="true" property="og:description" content="前面几个章节介绍了跟 DevOps 生态圈相关的一些应用工具，下面借助这些应用工具来实现 DevOps 生产作业。另外，以下实践中会直接使用 kubernetes 和 docker 应用工具，而不会过多地介绍其原理，可自行查阅相关资料。"><meta data-rh="true" name="keywords" content="linux,devops"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhangqf.com/docs/linux-cicd-6"><link data-rh="true" rel="alternate" href="https://zhangqf.com/en/docs/linux-cicd-6" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-cicd-6" hreflang="zh"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-cicd-6" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9B0V5WT2X8-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Linux技术分享" href="/opensearch.xml">
<link rel="preconnect" href="https://zhangqf.com/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://zhangqf.com/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?77dc6b24cf1d939292e9fe13be271a96",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="zhangqf RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="zhangqf Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="zhangqf JSON Feed">

<link rel="icon" href="/img/logo.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><link rel="stylesheet" href="/assets/css/styles.bf38107f.css">
<link rel="preload" href="/assets/js/runtime~main.7dd3723b.js" as="script">
<link rel="preload" href="/assets/js/main.389df9ef.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>更新 <a href="/website">网址导航</a> 带你发现感兴趣的技术</span></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">zhangqf</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/linux">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/category/Linux基础">Linux 基础</a></li><li><a class="dropdown__link" href="/docs/category/Linux进阶">Linux 进阶</a></li><li><a class="dropdown__link" href="/docs/category/Linux测试">Linux 测试</a></li><li><a class="dropdown__link" href="/docs/category/LinuxCICD">Linux CICD研发</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/skill/">笔记</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags">标签</a></li><li><a class="dropdown__link" href="/archive">归档</a></li><li><a class="dropdown__link" href="/docs/category/存储">存储</a></li></ul></div><a class="navbar__item navbar__link" href="/website">导航</a><a class="navbar__item navbar__link" href="/project">项目</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/en/docs/linux-cicd-6" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-GB">English</a></li><li><a href="/docs/linux-cicd-6" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"><b>zhangqf</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux基础">Linux基础</a><button aria-label="打开/收起侧边栏菜单「Linux基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux进阶">Linux进阶</a><button aria-label="打开/收起侧边栏菜单「Linux进阶」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux测试">Linux测试</a><button aria-label="打开/收起侧边栏菜单「Linux测试」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/linuxcicd">Linux CICD研发</a><button aria-label="打开/收起侧边栏菜单「Linux CICD研发」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-cicd-1">第 1 章 Git 版本控制系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-cicd-2">第 2 章 Maven 代码构建系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux/cicd/第 3 章 Jenkins 自动化系统">第 3 章 Jenkins 自动化系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-cicd-4">第 4 章 Linux Ansible 入门知识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-cicd-5">第 5 章 Linux Ansible 进阶知识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/linux-cicd-6">第 6 章 DevOps 实践</a></li></ul></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/linuxcicd"><span itemprop="name">Linux CICD研发</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第 6 章 DevOps 实践</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>第 6 章 DevOps 实践</h1></header><p>前面几个章节介绍了跟 DevOps 生态圈相关的一些应用工具，下面借助这些应用工具来实现 DevOps 生产作业。另外，以下实践中会直接使用 kubernetes 和 docker 应用工具，而不会过多地介绍其原理，可自行查阅相关资料。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51devops-概念">5.1、DevOps 概念<a href="#51devops-概念" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>软件开发最初是由两个团队组成：</p><ol><li>开发者组成的团队，专门负责软件的设计和代码编写，并且不断迭代更新代码。</li><li>运维者组成的团队，测试人员包括在运维团队中，专门负责将开发团队研发的软件进行测试部署和反馈迭代。</li></ol><p>看似两个目标不同的团队需要协同完成一个软件的开发。在开发团队指定好计划并完成 coding 后，需要提供到运维团队。运维团队向开发团队反馈需要修复的 BUG 以及一些需要返工的任务。这时开发团队需要经常等待运维团队的反馈。这无疑延长了整个软件开发的周期。</p><p>基于现在的互联网现状，更推崇敏捷式开发，这样就导致项目的迭代速度更快，但是由于开发团队与运维团队的沟通问题，会导致新版本上线的时间成本很高。这又违背了敏捷式开发的最初目的。</p><p>实际上这种现状在历史上维持了很长一段时间，包括现在依然有很多传统企业保持着这种工作模式。</p><p>随着 IT 生态圈的不断发展，引领 IT 行业的一些高科技公司迫切需要打通开发团队与运维团队，降低二者之间的时间成本，DevOps 开发运维模式应运而生，并且随着 Docker 和 Kubernetes 的出现，可以将 DevOps 理念很好地执行落地。</p><p>DevOps 字面意思是 Development &amp; Operations 的缩写，也就是开发 &amp; 运维。当然这个 DevOps 里面隐含测试。</p><p><img loading="lazy" alt="devops_log" src="/assets/images/devops_logo-6cdcd9d0ed2cf6a5d3097a4a5d6e298d.png" width="846" height="397" class="img_ev3q"></p><p>这表明 DevOps 是一个不断提高效率并且持续不断工作的过程。DevOps 的方式可以让公司能够更快地应对更新和市场发展变化，开发可以快速交付，部署也更加稳定。核心就在于简化 Dev 和 Ops 团队之间的流程，使整体软件开发过程更快速。</p><p>整体的软件开发流程包括：</p><ul><li>PLAN：开发团队根据客户的需求制定开发计划。</li><li>CODE：根据 PLAN 将业务流程转化成代码逻辑，需要将不同版本的代码存储在一个库中。</li><li>BUILD：编码完成后，需要将代码构建并且运行。</li><li>TEST：成功构建项目后，需要测试代码是否存在 BUG 或错误。</li><li>DEPLOY：代码经过手动测试和自动化测试后，认定代码已经准备好部署并且交给运维团队。</li><li>OPERATE：运维团队将代码部署到生产环境中。</li><li>MONITOR：项目部署上线后，需要持续的监控产品。</li><li>INTEGRATE：然后将监控阶段收到的反馈发送回 PLAN 阶段，整体循环的流程就是 DevOps 的核心，即持续集成、持续部署。</li></ul><p>为了保证整体流程可以高效的完成，各个阶段都有比较常见的工具，如下图：</p><p><img loading="lazy" alt="devops_tools" src="/assets/images/devops_tools-27994a706b3e8e1573da4c039622f295.png" width="1734" height="883" class="img_ev3q"></p><p>最后我们给 DevOps 下一个定义：DevOps 强调的是通过自动化的工具贯穿开发、测试和运维之间的协同工作来完成软件的生命周期管理，从而更快、更高效地交付更稳定的软件。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52coding-阶段">5.2、Coding 阶段<a href="#52coding-阶段" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>在 coding 阶段，我们需要将不同版本的代码存储到一个仓库中，常见的版本控制工具有 SVN 或者 Git，这里我们采用 Git 作为版本控制工具，GitLab 作为远程仓库。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="521git-安装">5.2.1、Git 安装<a href="#521git-安装" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># step 1：删除centos自带yum源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rm -rf /etc/yum.repos.d/*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># step 2：添加aliyun的Base源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -i -e &#x27;/mirrors.cloud.aliyuncs.com/d&#x27; -e &#x27;/mirrors.aliyuncs.com/d&#x27; /etc/yum.repos.d/CentOS-Base.repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># step 3：添加aliyun的epel源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># wget -O /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># step 4：安装git</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install git -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="522gitlab-安装">5.2.2、GitLab 安装<a href="#522gitlab-安装" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>准备好服务器，采用 Docker 安装容器化的 GitLab。</p><ol><li><p>安装 docker-ce</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># step 1: 安装必要的一些系统工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install -y yum-utils device-mapper-persistent-data lvm2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Step 2: 添加软件源信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Step 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sed -i &#x27;s+download.docker.com+mirrors.aliyun.com/docker-ce+&#x27; /etc/yum.repos.d/docker-ce.repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Step 4: 更新并安装Docker-CE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum makecache fast</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum -y install docker-ce</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Step 5: 开启Docker服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># service docker start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>国内 docker 镜像加速</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim /etc/docker/daemon.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;registry-mirrors&quot;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://hub-mirror.c.163.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://mirror.baidubce.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://registry.docker-cn.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://reg-mirror.qiniu.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://dockerhub.azk8s.cn&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl daemon-reload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>拉取 GitLab 镜像</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker pull gitlab/gitlab-ce</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>安装 docker-compose 工具</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl -L &quot;https://github.com/docker/compose/releases/download/1.29.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>启动 gitlab 服务</p><p>我们使用的是容器化安装 gitlab，参见 gitlab 官方文档：<a href="https://docs.gitlab.cn/jh/install/docker.html" target="_blank" rel="noopener noreferrer">https://docs.gitlab.cn/jh/install/docker.html</a></p><p>文档介绍有 Docker Engine，Docker Compose，Docker Swarn 三种方式都可以安装，我们这里使用 docker-compose 方式安装。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 创建gitlab家目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mkdir /usr/local/gitlab_home</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># export GITLAB_HOME=/usr/local/gitlab_home</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>GitLab 容器使用主机装载的卷来存储持久数据：</p><table><thead><tr><th>本地位置</th><th>容器位置</th><th>使用</th></tr></thead><tbody><tr><td><code>$GITLAB_HOME/data</code></td><td><code>/var/opt/gitlab</code></td><td>用于存储应用程序数据。</td></tr><tr><td><code>$GITLAB_HOME/logs</code></td><td><code>/var/log/gitlab</code></td><td>用于存储日志。</td></tr><tr><td><code>$GITLAB_HOME/config</code></td><td><code>/etc/gitlab</code></td><td>用于存储极狐 GitLab 配置文件。</td></tr></tbody></table></li><li><p>编写 docker-compose.yml 文件</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins gitlab_home</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/local/gitlab_home</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins gitlab_home</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim docker-compose.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version: </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;3.6&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> web:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   image: </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;gitlab/gitlab-ce:latest&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   restart: always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   container_name: gitlab</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   environment:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     GITLAB_OMNIBUS_CONFIG: </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       external_url </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;http://192.168.95.165:8929&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       gitlab_rails</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;gitlab_shell_ssh_port&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2224</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;8929:8929&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;2224:22&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   volumes:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;$GITLAB_HOME/config:/etc/gitlab&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;$GITLAB_HOME/logs:/var/log/gitlab&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;$GITLAB_HOME/data:/var/opt/gitlab&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   shm_size: </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;256m&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>启动容器 gitlab</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins gitlab_home</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose up -d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 生成相应目录和文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins gitlab_home</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ll</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">drwxrwxr-x  </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> root root  </span><span class="token number" style="color:rgb(9, 134, 88)">268</span><span class="token plain"> Aug </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> 05:25 config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">drwxr-xr-x </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"> root root </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"> Aug </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> 05:30 data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root root  </span><span class="token number" style="color:rgb(9, 134, 88)">480</span><span class="token plain"> Aug </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> 05:24 docker-compose.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">drwxr-xr-x </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain"> root root  </span><span class="token number" style="color:rgb(9, 134, 88)">326</span><span class="token plain"> Aug </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> 05:27 logs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>访问 gitlab 首页</p><p>先查看初始用户名和密码</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins gitlab_home</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker exec -it gitlab bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@ff87dc0665e0:/</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/gitlab/initial_root_password | grep Password:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Password: </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">4FLDE1usK2WqFnbGQe3wJBAhYrjvChDzSvSDSGGnMh8</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p><img loading="lazy" alt="gitlab_page" src="/assets/images/gitlab_page-5e14fdc4d58566dda967bb8d1effd833.jpg" width="918" height="477" class="img_ev3q"></p><ol start="10"><li>修改密码</li></ol><p><img loading="lazy" alt="gitlab_repassword" src="/assets/images/gitlab_repassword-ca08537b43054c2da23f47329866454d.jpg" width="912" height="674" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="53build-阶段">5.3、Build 阶段<a href="#53build-阶段" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>当下应用最广泛的开发语言依然是 Java，所以我们还是以 java 项目为例进行 DevOps 实践。在 Build 阶段，常用的构建工具有两种，一个是 Maven，一个是 Gradle。这里我们选择 Maven 作为项目的构建工具。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="531安装-java-jdk-环境">5.3.1、安装 Java JDK 环境<a href="#531安装-java-jdk-环境" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>下载地址：<a href="https://www.oracle.com/java/technologies/downloads/" target="_blank" rel="noopener noreferrer">https://www.oracle.com/java/technologies/downloads/</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># wget https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.rpm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jdk-17_linux-x64_bin.rpm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpm -ivh jdk-17_linux-x64_bin.rpm </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">warning: jdk-17_linux-x64_bin.rpm: Header V3 RSA/SHA256 Signature, key ID ec551f03: NOKEY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Preparing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.                          </span><span class="token comment" style="color:rgb(0, 128, 0)">################################# [100%]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Updating / installing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">:jdk-17-2000:17.0.4-ga            </span><span class="token comment" style="color:rgb(0, 128, 0)">################################# [100%]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># java -version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">java version </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;17.0.4&quot;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2022</span><span class="token plain">-07-19 LTS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Java</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">TM</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> SE Runtime Environment </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">build </span><span class="token number" style="color:rgb(9, 134, 88)">17.0</span><span class="token plain">.4+11-LTS-179</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Java HotSpot</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">TM</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain">-Bit Server VM </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">build </span><span class="token number" style="color:rgb(9, 134, 88)">17.0</span><span class="token plain">.4+11-LTS-179, mixed mode, sharing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="532maven-安装">5.3.2、Maven 安装<a href="#532maven-安装" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>下载地址：<a href="https://maven.apache.org/download.cgi" target="_blank" rel="noopener noreferrer">https://maven.apache.org/download.cgi</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 下载安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># wget https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz --no-check-certificate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf apache-maven-3.8.6-bin.tar.gz -C /usr/local/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ln -svf /usr/local/apache-maven-3.8.6/ /usr/local/maven</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">‘/usr/local/maven’ -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> ‘/usr/local/apache-maven-3.8.6/’</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置环境</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim /etc/profile.d/maven.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">MAVEN_HOME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/maven</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token environment constant" style="color:rgb(129, 31, 63)">$PATH</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token variable" style="color:rgb(9, 134, 88)">$MAVEN_HOME</span><span class="token plain">/bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># source /etc/profile.d/maven.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 最后验证是否安装成功，出现如下信息，说明安装成功</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mvn --version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Apache Maven </span><span class="token number" style="color:rgb(9, 134, 88)">3.8</span><span class="token plain">.6 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">84538c9988a25aec085021c365c560670ad80f63</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Maven home: /usr/local/maven</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Java version: </span><span class="token number" style="color:rgb(9, 134, 88)">17.0</span><span class="token plain">.4, vendor: Oracle Corporation, runtime: /usr/java/jdk-17.0.4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Default locale: en_US, platform encoding: UTF-8</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OS name: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;linux&quot;</span><span class="token plain">, version: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3.10.0-1160.el7.x86_64&quot;</span><span class="token plain">, arch: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;amd64&quot;</span><span class="token plain">, family: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;unix&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="54integrate-工具">5.4、Integrate 工具<a href="#54integrate-工具" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="541jenkins-介绍">5.4.1、Jenkins 介绍<a href="#541jenkins-介绍" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>我们这里使用 jenkins 进行项目集成，前面章节对 jenkins 进行了详细的讲解，请参考 <a href="https://www.brinnatt.com/projects/cicd/%E7%AC%AC-3-%E7%AB%A0-jenkins-%E8%87%AA%E5%8A%A8%E5%8C%96%E7%B3%BB%E7%BB%9F/" target="_blank" rel="noopener noreferrer">https://www.brinnatt.com/projects/cicd/第-3-章-jenkins-自动化系统/</a>。</p><p>Jenkins 最强大的就在于插件，Jenkins 官方提供了大量的插件库，来自动化 CI/CD 过程中的各种琐碎功能。</p><p>Jenkins 最主要的工作就是将 GitLab 上的工程代码拉取下来进行构建，再根据流程可以选择发布到测试环境或者生产环境。一般是 GitLab 上的代码经过大量的测试后，确定发行版本，再发布到生产环境。</p><p>CI/CD 可以理解为：</p><ul><li>CI 过程即是通过 Jenkins 将代码拉取、构建、制作镜像交给测试人员测试。<ul><li>持续集成：让软件代码可以持续地集成到主干上，并自动构建和测试。</li></ul></li><li>CD 过程即是通过 Jenkins 将打好标签的发行版本代码自动推送到服务器上，并且进行脚本自动化部署。<ul><li>持续交付：让经过持续集成的代码可以进行手动部署。</li><li>持续部署：让可以持续交付的代码随时随地的自动化部署。</li></ul></li></ul><p><img loading="lazy" alt="devops_cicd" src="/assets/images/devops_cicd-2ae65749f8a667367159cc0c95513d9e.png" width="1276" height="716" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="542jenkins-安装">5.4.2、Jenkins 安装<a href="#542jenkins-安装" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><ol><li><p>拉取 jenkins 镜像</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker pull  jenkins/jenkins</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>编写 docker-compose.yml</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mkdir /usr/local/jenkins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># export JENKINS_HOME=/usr/local/jenkins/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd /usr/local/jenkins/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim docker-compose.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3.6&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> jenkins:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   image: jenkins/jenkins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   container_name: jenkins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain">:8080</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token number" style="color:rgb(9, 134, 88)">50000</span><span class="token plain">:50000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   volumes:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token variable" style="color:rgb(9, 134, 88)">$JENKINS_HOME</span><span class="token plain">/data/:/var/jenkins_home/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>启动 jenkins 容器</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose up -d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose logs -f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Attaching to jenkins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> touch: cannot </span><span class="token function" style="color:rgb(0, 0, 255)">touch</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;/var/jenkins_home/copy_reference_file.log&#x27;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> Permission denied</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> Can not </span><span class="token function" style="color:rgb(0, 0, 255)">write</span><span class="token plain"> to /var/jenkins_home/copy_reference_file.log. Wrong volume permissions?</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins exited with code </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>第 3 步启动 jenkins 失败，因为生成的 data 目录是 root 属主属组，jenkins 容器以 jenkins 身份对 data 没有写的权限，增加 data 其它用户写权限，再启动。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod o+w data/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose down</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Removing jenkins </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Removing network jenkins_default</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose up -d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Creating network </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;jenkins_default&quot;</span><span class="token plain"> with the default driver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Creating jenkins </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>浏览器输入 <a href="http://192.168.95.165:8080/" target="_blank" rel="noopener noreferrer">http://192.168.95.165:8080/</a> 地址，输入密码进入 jenkins，初始化密码使用下面方式查看。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose logs -f | grep -A 2 &quot;following password to proceed&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> Please use the following password to proceed to installation:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> c020872b3591419c89fcd419b072c3d2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>在以下界面点击选择插件来安装。</p><p><img loading="lazy" alt="jenkins_select_plugin" src="/assets/images/jenkins_select_plugin-d0d6006bfb6c2e5eb840430a09cdbeda.jpg" width="983" height="910" class="img_ev3q"></p></li><li><p>取消所有插件，如下所示，点击安装，按要求顺利进入 jenkins。这里不安装插件是因为国内网络原因，下载很慢，以后按需安装，缺什么补什么。</p><p><img loading="lazy" alt="jenkins_none_plugin" src="/assets/images/jenkins_none_plugin-568b36a6fcf6a26d73f37741e80cb4bf.jpg" width="986" height="913" class="img_ev3q"></p></li><li><p>代理配置，Dashboard --&gt; Manage Jenkins --&gt; Plugin Manager --&gt; Advanced，科学上网，安装插件有保障。</p><p><img loading="lazy" alt="jenkins_proxy" src="/assets/images/jenkins_proxy-42459909fba9a02bd04b167718d5f99f.jpg" width="646" height="818" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="543jenkins-入门配置">5.4.3、Jenkins 入门配置<a href="#543jenkins-入门配置" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>由于 Jenkins 需要从 Gitlab 拉取代码、需要本地构建、甚至需要直接发布自定义镜像到 Docker 仓库，所以 Jenkins 需要配置大量内容。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5431创建任务">5.4.3.1、创建任务<a href="#5431创建任务" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><ol><li><p>创建一个简单的 spring web 小程序上传到 gitlab，结果如下：</p><p><img loading="lazy" alt="jenkins_spring_app" src="/assets/images/jenkins_spring_app-713cf60e7d053bf7fde94876d62af547.jpg" width="977" height="584" class="img_ev3q"></p></li><li><p>Dashboard --&gt; Manage Jenkins --&gt; Plugin Manager --&gt; Available，安装 <code>Localization: Chinese (Simplified)</code>，<code>Git</code>。后面直接指定安装的插件名，不再引导安装。</p><p>Dashboard --&gt; 新建任务 --&gt; 选择构建一个自由风格的软件项目，取名 mytest，点击确定。</p><p><img loading="lazy" alt="jenkins_freestyle" src="/assets/images/jenkins_freestyle-df326c27969e1ed25f00be73c779d203.jpg" width="732" height="397" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5432配置源码拉取地址">5.4.3.2、配置源码拉取地址<a href="#5432配置源码拉取地址" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>Jenkins 在任务构建的时候，需要将 Git 服务器上的源码拉取下来存储到 jenkins 服务所在的本地磁盘上。</p><ol><li><p>配置任务源码拉取的地址。</p><p><img loading="lazy" alt="gitlab_git" src="/assets/images/gitlab_git-ebc9899dbdf0dff0dd4e083271845130.jpg" width="692" height="662" class="img_ev3q"></p></li><li><p>立即构建</p><p><img loading="lazy" alt="gitlab_build" src="/assets/images/gitlab_build-cb93ee63fe93d5fc6ffcc13708308dfe.jpg" width="780" height="541" class="img_ev3q"></p></li><li><p>查看构建工程的日志，点击上述 2 的任务条即可。</p><p><img loading="lazy" alt="jenkins_log" src="/assets/images/jenkins_log-784c2c555048dd697391053952943b40.jpg" width="1299" height="546" class="img_ev3q"></p><p>可以看到源码已经拉取到 Jenkins 本地，可以根据第三行日志信息，查看 Jenkins 本地拉取到的源码。</p><p><em>注意：如果安装插件时配置了代理，最好是取消代理或者本地网段不走代理，避免出错。</em></p></li><li><p>查看 Jenkins 容器中 /var/jenkins<!-- -->_<!-- -->home/workspace/mytest 的源码。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker exec -it jenkins bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins@a46a36c57e16:/$ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins@a46a36c57e16:/$ </span><span class="token function" style="color:rgb(0, 0, 255)">ls</span><span class="token plain"> -l /var/jenkins_home/workspace/mytest/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r-- </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> jenkins jenkins </span><span class="token number" style="color:rgb(9, 134, 88)">2922</span><span class="token plain"> Aug </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 00:11 pom.xml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">drwxr-xr-x </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> jenkins jenkins   </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> Aug </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 00:11 src</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5433配置-maven-构建代码">5.4.3.3、配置 Maven 构建代码<a href="#5433配置-maven-构建代码" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>代码拉取到 Jenkins 本地后，需要在 Jenkins 中对代码进行构建，这里需要 Maven 的环境，而 Maven 需要 Java 的环境，接下来需要在 Jenkins 中安装 JDK 和 Maven，并且配置到 Jenkins 服务。</p><ol><li><p>因为容器和主机环境是隔离的，最简单的方式是准备 JDK、Maven 二进制压缩包解压出来，通过数据卷映射到 Jenkins 容器内部。但是我们前面安装了 jdk rpm 包和 maven 二进制包，所以我们复用这个环境，如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 映射 maven 到容器卷</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ln -sv /usr/local/maven/ /usr/local/jenkins/data/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">‘/usr/local/jenkins/data/maven’ -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> ‘/usr/local/maven/’</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls -l /usr/local/jenkins/data/maven</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lrwxrwxrwx </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root root </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> Aug </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 09:11 /usr/local/jenkins/data/maven -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /usr/local/maven/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 映射 jdk 到容器卷</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ln -sv /usr/java/jdk-17.0.4/ /usr/local/jenkins/data/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">‘/usr/local/jenkins/data/jdk-17.0.4’ -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> ‘/usr/java/jdk-17.0.4/’</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls -l /usr/local/jenkins/data/jdk-17.0.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lrwxrwxrwx </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root root </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"> Aug </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 09:15 /usr/local/jenkins/data/jdk-17.0.4 -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /usr/java/jdk-17.0.4/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose.yaml 修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose down</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim docker-compose.yml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3.6&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> jenkins:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   image: jenkins/jenkins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   container_name: jenkins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain">:8080</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token number" style="color:rgb(9, 134, 88)">50000</span><span class="token plain">:50000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   volumes:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token variable" style="color:rgb(9, 134, 88)">$JENKINS_HOME</span><span class="token plain">/data/:/var/jenkins_home/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token variable" style="color:rgb(9, 134, 88)">$JENKINS_HOME</span><span class="token plain">/data/maven:/var/jenkins_home/maven         </span><span class="token comment" style="color:rgb(0, 128, 0)"># 显示指定挂载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token variable" style="color:rgb(9, 134, 88)">$JENKINS_HOME</span><span class="token plain">/data/jdk-17.0.4:/var/jenkins_home/jdk-17.0.4   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 显示指定挂载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins jenkins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>注意，在 5.4.2 小节安装 jenkins 时将宿主机的 /usr/local/jenkins/data/ 目录映射到了 jenkins 容器的 /var/jenkins<!-- -->_<!-- -->home/ 目录，正因为如此，jenkins 容器才可以使用宿主机的目录，从而链接 jdk 和 maven 环境。</li><li>注意，宿主机的目录软链接必须要通过卷映射显示配置才能生效，否则容器只会识别成一个软链接字符文件，而非想要的目录数据结构。</li><li>生产环境不要这么干，最好把二进制文件放进容器映射目录，然后直接使用。</li></ul></li><li><p>配置 Maven 的 settings.xml。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins maven</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/local/jenkins/data/maven</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins maven</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins maven</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim conf/settings.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   alimaven</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   aliyun maven</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   http://maven.aliyun.com/nexus/content/groups/public/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   central</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   jdk-17</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Jenkins 配置 JDK&amp;Maven 并保存。</p><p>Dashboard --&gt; 系统配置 --&gt; 全局工具配置。</p><p><img loading="lazy" alt="jenkins_jdk_maven" src="/assets/images/jenkins_jdk_maven-8b5e30f412a86c2a91e246b84e0c58fc.jpg" width="641" height="1214" class="img_ev3q"></p></li><li><p>配置 Jenkins 任务构建代码。</p><p>Dashboard --&gt; mytest --&gt; 配置。</p><p><img loading="lazy" alt="jenkins_build" src="/assets/images/jenkins_build-486fce6e67164094d2019f854accd30f.jpg" width="637" height="426" class="img_ev3q"></p></li><li><p>立即构建测试，查看 target 下的 jar 包。</p><p><img loading="lazy" alt="jenkins_mvn_pkg" src="/assets/images/jenkins_mvn_pkg-4208af9e6600dd12568942439a4d068f.jpg" width="891" height="671" class="img_ev3q"></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker exec -it jenkins bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins@700688700a33:/$ </span><span class="token function" style="color:rgb(0, 0, 255)">ls</span><span class="token plain"> /var/jenkins_home/workspace/mytest/target/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">classes          maven-archiver         mytest-0.0.1-SNAPSHOT.jar.original</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">generated-sources    maven-status           test-classes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">generated-test-sources   mytest-0.0.1-SNAPSHOT.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="544远程发布">5.4.4、远程发布<a href="#544远程发布" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>jar 包构建好之后，就可以根据情况发布到测试或生产环境，需要安装插件 Publish Over SSH。</p><ol><li><p>配置 Publish Over SSH 连接测试、生产环境。</p><p>Dashboard --&gt; 系统管理 --&gt; 系统配置。</p><p><img loading="lazy" alt="jenkins_remote_server" src="/assets/images/jenkins_remote_server-439b81e67706db74e60cb1ec074a771f.jpg" width="652" height="669" class="img_ev3q"></p></li><li><p>配置任务的构建后操作，发布 jar 包到目标服务。</p><p>Dashboard --&gt; mytest --&gt; 配置 --&gt; 构建后操作 --&gt; Send build artifacts over SSH。</p><p><img loading="lazy" alt="jenkins_remote_server_deploy" src="/assets/images/jenkins_remote_server_deploy-d3ea8e17d2c43c72414506cfc0bd21d9.jpg" width="647" height="668" class="img_ev3q"></p></li><li><p>立即构建任务，并去目标服务查看。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ssh 192.168.95.166</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@192.168.95.166&#x27;s password: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Last login: Mon Aug </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">19</span><span class="token plain">:30:13 </span><span class="token number" style="color:rgb(9, 134, 88)">2022</span><span class="token plain"> from </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.95.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls /opt/target/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mytest-0.0.1-SNAPSHOT.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="55cicd-入门操作">5.5、CICD 入门操作<a href="#55cicd-入门操作" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>基于 Jenkins 拉取 GitLab 上指定版本的 SpringBoot 代码进行构建，实现 CI 持续集成；然后发布到生产环境实现 CD 持续部署。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="551持续集成">5.5.1、持续集成<a href="#551持续集成" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>为了让程序代码可以自动推送到测试环境基于 Docker 服务运行，需要添加 Docker 配置和脚本文件让程序可以在集成到主干的同时运行起来。</p><ol><li><p>添加 Dockerfile 文件。</p><p><img loading="lazy" alt="jenkins_dockerfile" src="/assets/images/jenkins_dockerfile-e4155b771baa0ab634faebbd3fd25314.jpg" width="700" height="296" class="img_ev3q"></p></li><li><p>添加 docker-compose.yml 文件。</p><p><img loading="lazy" alt="jenkins_docker-compose" src="/assets/images/jenkins_docker-compose-6959d8aa92dcbae0ee08aaaef59cd9c6.png" width="769" height="327" class="img_ev3q"></p></li><li><p>前提条件：远程 webserver 安装 docker 和 docker-compose-plugin 环境；git commit and push 源码中新创建的 docker 文件至 gitlab；另外，为了方便操作，maven 构建出来的 jar 包名字很长，自定义为 mytest.jar，需要在 pom.xml 中添加嵌套字段 <code>&lt;build&gt; &lt;finalName&gt;mytest&lt;/finalName&gt;&lt;/build&gt;</code>。</p><p>追加 Jenkins 构建后操作脚本命令。</p><p><img loading="lazy" alt="jenkins_maven_postscript" src="/assets/images/jenkins_maven_postscript-d0fdb1089b36f3d5ef2dd368d933bd1e.png" width="661" height="928" class="img_ev3q"></p></li><li><p>Jenkins 立即构建并推送到目标服务器，使用上面自定义脚本将 jar 包容器化并运行起来。下面验证一下 webserver 上的应用是否成功运行。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 验证webserver环境是否符合预期</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/opt/docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker-compose.yml  Dockerfile  mytest.jar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker ps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CONTAINER ID   IMAGE           COMMAND                  CREATED          STATUS          PORTS                                       NAMES</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">15f5dd263596   mytest:v1.0.0   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/bin/sh -c &#x27;java -j…&quot;</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"> minutes ago   Up </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"> minutes   </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">.0.0:8888-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain">/tcp, :::8888-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain">/tcp   mytest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 请求一下页面</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.95.166:8888/test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Hello Jenkins</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="552持续交付">5.5.2、持续交付<a href="#552持续交付" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>程序代码在经过多次集成操作后，达到最终可交付的目标。持续交付整体流程和持续集成类似，不过需要选取指定的发行版本。</p><ol><li><p>给项目添加 tag 版本。注意，应该是源代码有更新并合并到 master 分支，然后想添加新的 tag 或 branch，才手动操作 gitlab web 界面。另外，在 IDE 工具中可以直接分出 tag 或者 branch，然后上传到 gitlab，避免手动操作分支。</p><p>Gitlab --&gt; 项目 btest --&gt; Repository --&gt; Tags --&gt; New Tag。</p><p><img loading="lazy" alt="gitlab_release_v100" src="/assets/images/gitlab_release_v100-3e4dce77b77bb391fd3a9f7bba6360d8.png" width="874" height="757" class="img_ev3q"></p></li><li><p>下载 Git Parameter 插件，设置项目参数化构建。</p><p>Dashboard --&gt; mytest --&gt; 配置 --&gt; 参数化构建过程 --&gt; 添加参数 --&gt; Git 参数。</p><p><img loading="lazy" alt="jenkins_git_para" src="/assets/images/jenkins_git_para-583104ee65cb2bf5ae229ba7727032a7.png" width="645" height="736" class="img_ev3q"></p></li><li><p>在 gitlab 中创建的 tag 或者 branch 版本，根据第 2 步中的参数类型选择，都会反映到 jenkins 的 Build with Parameters 工程项目当中，然后选择 tag 或者 branch 进行参数化构建。</p><p><img loading="lazy" alt="jenkins_para_tag_or_branch" src="/assets/images/jenkins_para_tag_or_branch-a8a83b937686bc2453587f1ec2d76643.png" width="608" height="432" class="img_ev3q"></p></li><li><p>任务构建时，采用 Shell 方式构建，拉取指定 tag 版本代码。</p><p>Dashboard --&gt; mytest --&gt; 配置 --&gt; Build Steps --&gt; 增加构建步骤 --&gt; 执行 shell。</p><p><img loading="lazy" alt="jenkins_shell_para_build" src="/assets/images/jenkins_shell_para_build-18d18db2499975343a7297e41b2f5324.png" width="638" height="507" class="img_ev3q"></p></li><li><p>基于 Parameter 构建任务，任务发布到目标服务器上。我们把测试源码稍微修改一下，反映出 v2.0.0 版本。</p><p><img loading="lazy" alt="jenkins_test_git_para" src="/assets/images/jenkins_test_git_para-f32a3ba36c081197144240752093a3cd.png" width="822" height="466" class="img_ev3q"></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 构建v2.0.0版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.95.166:8888/test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Hello Jenkins -- v2.0.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 构建v1.0.0版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># curl 192.168.95.166:8888/test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Hello Jenkins -- v1.0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="56集成-sonar-qube">5.6、集成 Sonar Qube<a href="#56集成-sonar-qube" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="561sonar-qube-介绍">5.6.1、Sonar Qube 介绍<a href="#561sonar-qube-介绍" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Sonar Qube 是一个开源的代码分析平台，支持 Java、Python、PHP、JavaScript、CSS 等 25 种以上的语言，可以检测出重复代码、代码漏洞、代码规范和安全性漏洞的问题。</p><p>Sonar Qube 可以与多种软件整合进行代码扫描，比如 Maven，Gradle，Git，Jenkins 等，并且会将代码检测结果推送回 Sonar Qube，并且在系统提供的 UI 界面上显示出来。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="562sonar-qube-环境搭建">5.6.2、Sonar Qube 环境搭建<a href="#562sonar-qube-环境搭建" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5621sonar-qube-安装">5.6.2.1、Sonar Qube 安装<a href="#5621sonar-qube-安装" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>Sonar Qube 在 7.9 版本中已经放弃了对 MySQL 的支持，并且建议在商业环境中采用 PostgreSQL，那么安装 Sonar Qube 时需要依赖 PostgreSQL。</p><p>这里会安装 Sonar Qube 的长期支持版本 v8.9。</p><ol><li><p>拉取镜像。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker pull postgres</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker pull sonarqube:8.9.3-community</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>编写 docker-compoe.yml。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mkdir /usr/local/sonarqube</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd /usr/local/sonarqube</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins sonarqube</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim docker-compose.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3.6&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> db:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   image: postgres</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   container_name: db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token number" style="color:rgb(9, 134, 88)">5432</span><span class="token plain">:5432</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - sonarnet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   environment:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     POSTGRES_USER: sonar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     POSTGRES_PASSWORD: sonar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> sonarqube:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   image: sonarqube:8.9.3-community</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   container_name: sonarqube</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   depends_on:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;9000:9000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - sonarnet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   environment:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     SONAR_JDBC_URL: jdbc:postgresql://db:5432/sonar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     SONAR_JDBC_USERNAME: sonar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     SONAR_JDBC_PASSWORD: sonar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">networks:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> sonarnet:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   driver: bridge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>启动容器。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins sonarqube</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose up -d</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Creating network </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;sonarqube_sonarnet&quot;</span><span class="token plain"> with driver </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;bridge&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Creating db </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Creating sonarqube </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. </span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>查看 sonarqube 启动日志，发现启动失败，需要设置 sysctl.conf 文件配置信息。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins sonarqube</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose logs -f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> ERROR: </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> bootstrap checks failed. You must address the points described </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> the following </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> lines before starting Elasticsearch.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> bootstrap check failure </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> of </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: max virtual memory areas vm.max_map_count </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">65530</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> is too low, increase to at least </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">262144</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> ERROR: Elasticsearch did not </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"> normally - check the logs at /opt/sonarqube/logs/sonarqube.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2022.08</span><span class="token plain">.17 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:07:48 INFO  es</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">o.e.n.Node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> stopping </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2022.08</span><span class="token plain">.17 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:07:48 INFO  es</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">o.e.n.Node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> stopped</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2022.08</span><span class="token plain">.17 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:07:48 INFO  es</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">o.e.n.Node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> closing </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2022.08</span><span class="token plain">.17 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:07:48 INFO  es</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">o.e.n.Node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> closed</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2022.08</span><span class="token plain">.17 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:07:49 WARN  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">o.s.a.p.AbstractManagedProcess</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Process exited with </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"> value </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">es</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: </span><span class="token number" style="color:rgb(9, 134, 88)">78</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2022.08</span><span class="token plain">.17 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:07:49 INFO  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">o.s.a.SchedulerImpl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Process</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">es</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> is stopped</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2022.08</span><span class="token plain">.17 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:07:49 INFO  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">o.s.a.SchedulerImpl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> SonarQube is stopped</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim /etc/sysctl.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vm.max_map_count</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">262144</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># sysctl -p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>重新启动需要一定时间，可以查看容器日志，看到如下内容代表启动成功。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2022.08</span><span class="token plain">.17 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:15:18 INFO  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">o.s.a.SchedulerImpl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Process</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> is up</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonarqube    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2022.08</span><span class="token plain">.17 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:15:18 INFO  app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">o.s.a.SchedulerImpl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> SonarQube is up</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>访问 Sonar Qube 首页。</p><p><img loading="lazy" alt="sonarqube_page" src="data:image/png;base64,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" width="413" height="253" class="img_ev3q"></p></li><li><p>重新设置密码，然后进入首页。</p><p><img loading="lazy" alt="sonarqube_repass" src="/assets/images/sonarqube_repass-4d223cf6191fb2fe54a4a62b9ae5e09e.png" width="502" height="515" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5622安装中文插件">5.6.2.2、安装中文插件<a href="#5622安装中文插件" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>Administration --&gt; Marketplace --&gt; I understand the risk --&gt; search &quot;chinese&quot; --&gt; Chinese Pack <code>LOCALIZATION</code> --&gt; Install --&gt; Restart Server。</p><p><img loading="lazy" alt="sonarqube_localization" src="/assets/images/sonarqube_localization-f0bafbe3e8a9657368025b27ab6e6507.png" width="1302" height="771" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="563sonar-qube-基本使用">5.6.3、Sonar Qube 基本使用<a href="#563sonar-qube-基本使用" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Sonar Qube 的使用方式很多，Maven 可以整合，也可以采用 sonar-scanner 的方式，再查看 Sonar Qube 的检测效果。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5631maven-实现代码检测">5.6.3.1、Maven 实现代码检测<a href="#5631maven-实现代码检测" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><ol><li><p>修改 Maven 的 settings.xml 文件配置 Sonar Qube 信息。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   sonar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       admin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       helloworld</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       http://192.168.95.165:9000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>在源代码位置执行命令：mvn sonar:sonar。直接进入 jenkins 容器操作即可，jenkins 在前面集成测试的时候里面环境很齐全。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker exec -it jenkins bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins@1c9970622799:/$ </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">cd</span><span class="token plain"> /var/jenkins_home/workspace/mytest/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins@1c9970622799:~/workspace/mytest$ /var/jenkins_home/maven/bin/mvn sonar:sonar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Analysis report generated </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> 47ms, </span><span class="token function" style="color:rgb(0, 0, 255)">dir</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">size</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">106</span><span class="token plain"> KB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Analysis report compressed </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> 26ms, </span><span class="token function" style="color:rgb(0, 0, 255)">zip</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">size</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> KB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Analysis report uploaded </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> 524ms</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> ANALYSIS SUCCESSFUL, you can browse http://192.168.95.165:9000/dashboard?id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">com.brinnatt%3Amytest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Note that you will be able to access the updated dashboard once the server has processed the submitted analysis report</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> More about the report processing at http://192.168.95.165:9000/api/ce/task?id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">AYKshoFNitn0n-6-mh3_</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Analysis total time: </span><span class="token number" style="color:rgb(9, 134, 88)">9.476</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> BUILD SUCCESS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Total time:  </span><span class="token number" style="color:rgb(9, 134, 88)">15.545</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Finished at: </span><span class="token number" style="color:rgb(9, 134, 88)">2022</span><span class="token plain">-08-17T15:57:52Z</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> ------------------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>查看 Sonar Qube 界面检测结果。</p><p><img loading="lazy" alt="sonarqube_analyze" src="/assets/images/sonarqube_analyze-f30d6aed8bb9412d93c632a607518599.png" width="992" height="253" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5632sonar-scanner-实现代码检测">5.6.3.2、Sonar-scanner 实现代码检测<a href="#5632sonar-scanner-实现代码检测" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><ol><li><p>下载Sonar-scanner：<a href="https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/%EF%BC%8C%E4%B8%8B%E8%BD%BD" target="_blank" rel="noopener noreferrer">https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/，下载</a> 4.6.x 版本即可，要求 Linux 版本。</p></li><li><p>解压并配置 sonar 服务端信息。将 sonar-scanner 解压到 jenkins 容器映射的目录以便直接在容器中使用。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install unzip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># unzip sonar-scanner-cli-4.6.2.2472-linux.zip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># mv sonar-scanner-4.6.2.2472-linux/ /usr/local/jenkins/data/sonar-scanner462</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>配置 sonarQube 服务端地址，修改 conf 下的 sonar-scanner.properties。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd /usr/local/jenkins/data/sonar-scanner462/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins sonar-scanner462</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins sonar-scanner462</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim conf/sonar-scanner.properties</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonar.host.url</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://192.168.95.165:9000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sonar.sourceEncoding</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">UTF-8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>执行命令检测代码。执行之前需要登陆 sonarqube 界面，生成 token 供命令使用。</p><p>我的账号 --&gt; 安全 --&gt; 取一个名字生成令牌，记住令牌。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker exec -it jenkins bash </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins@1c9970622799:/$ </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">cd</span><span class="token plain"> /var/jenkins_home/workspace/mytest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">jenkins@1c9970622799:~/workspace/mytest$ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">/sonar-scanner462/bin/sonar-scanner -Dsonar.sources</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">./ -Dsonar.projectname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">casually_name -Dsonar.projectKey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">casually_key -Dsonar.java.binaries</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">target/ -Dsonar.login</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ac155e09db5f2b0017acc5b1c8456a017f009664</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: ANALYSIS SUCCESSFUL, you can browse http://192.168.95.165:9000/dashboard?id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">casually_key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: Note that you will be able to access the updated dashboard once the server has processed the submitted analysis report</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: More about the report processing at http://192.168.95.165:9000/api/ce/task?id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">AYKsviZoitn0n-6-mh4O</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: Analysis total time: </span><span class="token number" style="color:rgb(9, 134, 88)">5.050</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: EXECUTION SUCCESS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: Total time: </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">.995s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: Final Memory: 9M/30M</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: ------------------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>查看 SonarQube 界面检测结果。</p><p><img loading="lazy" alt="sonarqube_analyze1" src="/assets/images/sonarqube_analyze1-994f6a68738970bbaa23e9a88676e148.png" width="986" height="453" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="564jenkins-集成-sonar-qube">5.6.4、Jenkins 集成 Sonar Qube<a href="#564jenkins-集成-sonar-qube" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5641jenkins-配置-sonar-qube">5.6.4.1、Jenkins 配置 Sonar Qube<a href="#5641jenkins-配置-sonar-qube" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>首先要安装 SonarQube Scanner 插件，安装插件的方法前面已介绍。</p><ol><li><p>开启 Sonar Qube 权限验证。</p><p><img loading="lazy" alt="sonarqube_jenkins_allow" src="/assets/images/sonarqube_jenkins_allow-e2a000bf63e1cf1ed857acd724bb9917.png" width="643" height="857" class="img_ev3q"></p></li><li><p>获取 Sonar Qube 的令牌。复用上一个实验的令牌。</p></li><li><p>配置 Jenkins 的 Sonar Qube 信息。</p><p>Dashboard --&gt; 系统管理 --&gt; 系统配置 --&gt; SonarQube servers。</p><p><img loading="lazy" alt="jenkins_sonarqube_conf" src="/assets/images/jenkins_sonarqube_conf-b4dcbb3495f55906a56151b2efdb5ddc.png" width="646" height="732" class="img_ev3q"></p><p><img loading="lazy" alt="jenkins_sonarqube_proof" src="/assets/images/jenkins_sonarqube_proof-b38cbb89503a4648f7214004c4794f47.png" width="702" height="692" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5642配置-sonar-scanner">5.6.4.2、配置 Sonar-scanner<a href="#5642配置-sonar-scanner" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><ol><li><p>将 Sonar-scaner 添加到 Jenkins 数据卷中并配置全局配置。</p><p><img loading="lazy" alt="jenkins_sonar-scanner_conf" src="/assets/images/jenkins_sonar-scanner_conf-ac78ccc56c14228f53880b5184e10971.png" width="640" height="514" class="img_ev3q"></p></li><li><p>配置任务的 Sonar-scanner。</p><p><img loading="lazy" alt="jenkins_sonar-scanner_exec" src="/assets/images/jenkins_sonar-scanner_exec-1eef98aa40ff159050969be5283de956.png" width="641" height="598" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5643构建任务">5.6.4.3、构建任务<a href="#5643构建任务" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>构建项目时，控制台输出信息如下，省略部分次要内容。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Started by user brinnatt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Running as SYSTEM</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Building </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> workspace /var/jenkins_home/workspace/mytest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> BUILD SUCCESS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Total time:  </span><span class="token number" style="color:rgb(9, 134, 88)">3.804</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Finished at: </span><span class="token number" style="color:rgb(9, 134, 88)">2022</span><span class="token plain">-08-17T19:32:15Z</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">mytest</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> $ /var/jenkins_home/sonar-scanner462/bin/sonar-scanner -Dsonar.host.url</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://192.168.95.165:9000 ******** -Dsonar.projectKey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">mytest -Dsonar.projectname</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">mytest -Dsonar.sources</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">./ -Dsonar.java.binaries</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">target/ -Dsonar.projectBaseDir</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/var/jenkins_home/workspace/mytest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: Scanner configuration file: /var/jenkins_home/sonar-scanner462/conf/sonar-scanner.properties</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: ------------- Run sensors on module mytest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: Load metrics repository</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: ------------- Run sensors on project</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: ANALYSIS SUCCESSFUL, you can browse http://192.168.95.165:9000/dashboard?id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">mytest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: Note that you will be able to access the updated dashboard once the server has processed the submitted analysis report</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: More about the report processing at http://192.168.95.165:9000/api/ce/task?id</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">AYKtSuBXitn0n-6-mh4a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: Analysis total time: </span><span class="token number" style="color:rgb(9, 134, 88)">5.291</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: EXECUTION SUCCESS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: Total time: </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain">.377s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: Final Memory: 9M/34M</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO: ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WARN: Found multiple </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;report-task.txt&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> the workspace. Taking the first one.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/var/jenkins_home/workspace/mytest/.scannerwork/report-task.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/var/jenkins_home/workspace/mytest/target/sonar/report-task.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SSH: Connecting from </span><span class="token function" style="color:rgb(0, 0, 255)">host</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">1c9970622799</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SSH: Connecting with configuration </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">webserver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SSH: EXEC: completed after </span><span class="token number" style="color:rgb(9, 134, 88)">2,408</span><span class="token plain"> ms</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SSH: Disconnecting configuration </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">webserver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SSH: Transferred </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Finished: SUCCESS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="jenkins_sonar-scanner_result" src="/assets/images/jenkins_sonar-scanner_result-1129e86e0975511d94c5b98ab5325b6b.png" width="987" height="589" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="57集成-harbor">5.7、集成 Harbor<a href="#57集成-harbor" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="571harbor-介绍">5.7.1、Harbor 介绍<a href="#571harbor-介绍" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>前面在部署项目时，我们主要采用 Jenkins 推送 jar 包到指定服务器，再通过脚本命令让目标服务器对当前 jar 包进行部署。</p><p>这种方式在项目较多时，每个目标服务器都需要将 jar 包制作成自定义镜像再通过 docker 进行启动，重复操作比较多，会降低项目部署效率。</p><p>我们可以通过 Harbor 作为私有的 Docker 镜像仓库。让 Jenkins 统一将项目打包并制作成 Docker 镜像发布到 Harbor 仓库中，只需要通知目标服务器，让目标服务器统一去 Harbor 仓库上拉取镜像并在本地部署即可。</p><p>Docker 官方提供了 Registry 镜像仓库，但是 Registry 的功能相对简陋。Harbor 是 VMware 公司提供的一款镜像仓库，提供了权限控制、分布式发布、强大的安全扫描与审查机制等功能。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="572harbor-安装">5.7.2、Harbor 安装<a href="#572harbor-安装" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>这里采用原生的方式安装 Harbor。</p><ol><li><p>下载 Harbor 安装包：<a href="https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz" target="_blank" rel="noopener noreferrer">https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz</a> 上传到 linux 服务器并解压。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># wget https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tar xf harbor-offline-installer-v2.3.4.tgz -C /usr/local/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>修改 Harbor 配置文件：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cd /usr/local/harbor/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver harbor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver harbor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">common.sh  harbor.v2.3.4.tar.gz  harbor.yml.tmpl  install.sh  LICENSE  prepare</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver harbor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver harbor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp harbor.yml.tmpl harbor.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver harbor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim harbor.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hostname: </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.95.166</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 不需要https，注释掉</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># https:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># port: 443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># certificate: /your/certificate/path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># private_key: /your/private/key/path</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>启动 Harbor。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 要提前安装docker和docker-compose</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver harbor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ./install.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>登陆 Harbor，yaml 文件中默认的用户名密码。</p><p><img loading="lazy" alt="harbor_login" src="data:image/png;base64,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" width="493" height="494" class="img_ev3q"></p></li><li><p>首页信息。</p><p><img loading="lazy" alt="harbor_page" src="/assets/images/harbor_page-0dc2807dac077c6e337e36042c073e90.png" width="955" height="935" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="573harbor-使用">5.7.3、Harbor 使用<a href="#573harbor-使用" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Harbor 作为镜像仓库，主要的交互方式就是将镜像上传到 Harbor 上，以及从 Harbor 上下载指定镜像。</p><p>在传输镜像前，可以先使用 Harbor 提供的权限管理，将项目设置为私有项目，并对不同用户设置不同角色，从而更方便管理镜像。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5731添加用户构建项目">5.7.3.1、添加用户构建项目<a href="#5731添加用户构建项目" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><ol><li><p>创建用户。</p><p><img loading="lazy" alt="harbor_user" src="/assets/images/harbor_user-113f5c87af126b3141cbbaa836c159c5.png" width="952" height="782" class="img_ev3q"></p></li><li><p>构建项目，设为私有。</p><p><img loading="lazy" alt="harbor_new_project" src="/assets/images/harbor_new_project-fea60a68b3c248a8e3594cd554b1bd99.png" width="950" height="689" class="img_ev3q"></p></li><li><p>给项目追加用户。</p><p><img loading="lazy" alt="harbor_adduser_project" src="/assets/images/harbor_adduser_project-930f619333d0326625b6225f5c6242b9.png" width="953" height="678" class="img_ev3q"></p></li><li><p>切换测试用户。</p><p><img loading="lazy" alt="harbor_normal_user" src="data:image/png;base64,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" width="471" height="480" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5732发布镜像到-harbor">5.7.3.2、发布镜像到 Harbor<a href="#5732发布镜像到-harbor" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><ol><li><p>修改镜像名称，名称要求：harbor地址:端口/项目名/镜像名:版本。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker images mytest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mytest       v1.0.0    0f5295fa48a4   </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> hours ago    488MB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mytest       v2.0.0    3065ccb0b778   </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> hours ago   488MB</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker tag mytest:v1.0.0 192.168.95.166:80/btest/mytest:v1.0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker images 192.168.95.166:80/btest/mytest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">REPOSITORY                       TAG       IMAGE ID       CREATED       SIZE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.95.166:80/btest/mytest   v1.0.0    0f5295fa48a4   </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> hours ago   488MB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>修改 daemon.json，支持 Docker 仓库，并重启 Docker。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim /etc/docker/daemon.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;registry-mirrors&quot;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://hub-mirror.c.163.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://mirror.baidubce.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://registry.docker-cn.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://reg-mirror.qiniu.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://dockerhub.azk8s.cn&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;insecure-registries&quot;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;192.168.95.166:80&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart docker.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>设置登录仓库信息。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker login -uBrinnatt -p&quot;helloworld&quot; 192.168.95.166:80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>推送镜像到 Harbor。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker push 192.168.95.166:80/btest/mytest:v1.0.0 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The push refers to repository </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.95.166:80/btest/mytest</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">5f70bf18a086: Pushed </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2e12daf62b02: Pushed </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dc9fa3d8b576: Pushed </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">27ee19dc88f2: Pushed </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">c8dd97366670: Pushed </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">v1.0.0: digest: sha256:7632bcead9a3ab0cce360e887eb3c0ecf3f262f9c5da4c42646f8efda225b605 size: </span><span class="token number" style="color:rgb(9, 134, 88)">1372</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="harbor_push_image" src="/assets/images/harbor_push_image-5b38bd24add67d4f13c1c15baa9ed02c.png" width="952" height="471" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5733从-harbor-拉取镜像">5.7.3.3、从 Harbor 拉取镜像<a href="#5733从-harbor-拉取镜像" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>跟传统方式一样，不过需要先配置 /etc/docker/daemon.json 文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim /etc/docker/daemon.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;registry-mirrors&quot;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://hub-mirror.c.163.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://mirror.baidubce.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://registry.docker-cn.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://reg-mirror.qiniu.com&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://dockerhub.azk8s.cn&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;insecure-registries&quot;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;192.168.95.166:80&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart docker.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>直接通过镜像的命名方式进行拉取。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker pull 192.168.95.166:80/btest/mytest:v1.0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">v1.0.0: Pulling from btest/mytest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Digest: sha256:7632bcead9a3ab0cce360e887eb3c0ecf3f262f9c5da4c42646f8efda225b605</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Status: Downloaded newer image </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.95.166:80/btest/mytest:v1.0.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.95.166:80/btest/mytest:v1.0.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># docker images 192.168.95.166:80/btest/mytest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">REPOSITORY                       TAG       IMAGE ID       CREATED       SIZE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">.95.166:80/btest/mytest   v1.0.0    0f5295fa48a4   </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> hours ago   488MB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5734jenkins-容器使用宿主机-docker">5.7.3.4、Jenkins 容器使用宿主机 Docker<a href="#5734jenkins-容器使用宿主机-docker" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>Jenkins 构建镜像和发布镜像到 harbor 都需要使用到 docker 命令。而在 Jenkins 容器内部安装 Docker，官方推荐直接采用宿主机带的 Docker 即可。</p><p>注意：Docker 实际上有客户端和服务器端之分，只不过一般同时安装在一台 linux 主机上的。Docker 与 Docker Server 使用 Unix Domain Socket 进行本地进程通信。网络 Socket 是绑定 IP:PORT 通信，Unix Domain Socket 是绑定本地 socket 文件通信。</p><p>所以想让 Jenkins 使用宿主机 Docker，只需要将 /usr/bin/docker 和 /var/run/docker.sock 映射进 Jenkins 容器即可，当然，也可以将 /etc/docker/daemon.json 配置文件映射进去。</p><ol><li><p>设置宿主机 docker.sock 权限：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># useradd -M -s /sbin/nologin -c &quot;for docker jenkins&quot; jenkins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># setfacl -m u:jenkins:rw /var/run/docker.sock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>添加数据卷。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jenkins ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># vim /usr/local/jenkins/docker-compose.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version: </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;3.6&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> jenkins:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   image: jenkins/jenkins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   container_name: jenkins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   ports:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain">:8080</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - </span><span class="token number" style="color:rgb(9, 134, 88)">50000</span><span class="token plain">:50000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   volumes:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - /usr/local/jenkins/data/:/var/jenkins_home/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - /usr/local/jenkins/data/maven:/var/jenkins_home/maven</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - /usr/local/jenkins/data/jdk-17.0.4:/var/jenkins_home/jdk-17.0.4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - /usr/bin/docker:/usr/bin/docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - /var/run/docker.sock:/var/run/docker.sock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     - /etc/docker/daemon.json:/etc/docker/daemon.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5735添加构建后操作">5.7.3.5、添加构建后操作<a href="#5735添加构建后操作" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p><img loading="lazy" alt="jenkins_post_push_harbor" src="/assets/images/jenkins_post_push_harbor-d8c6d4d38411abbc03e2935ac714ace1.png" width="635" height="880" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5736编写部署脚本">5.7.3.6、编写部署脚本<a href="#5736编写部署脚本" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>部署项目需要通过 Publish Over SSH 插件，让目标服务器执行命令。为了方便一次性实现拉取镜像和启动服务，推荐采用脚本文件的方式执行。</p><p>添加脚本文件到目标服务器，再通过 Publish Over SSH 插件让目标服务器执行脚本即可。</p><ol><li><p>编写脚本文件，添加到目标服务器。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 这个脚本只是解决远程服务器从harbor下载镜像并运行，没有检查和异常处理机制，传参时一定要准确；</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">harbor_socket</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">harbor_project_name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">project_name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">tag</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">port</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">imageName</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$harbor_socket</span><span class="token plain">/</span><span class="token variable" style="color:rgb(9, 134, 88)">$harbor_project_name</span><span class="token plain">/</span><span class="token variable" style="color:rgb(9, 134, 88)">$project_name</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token variable" style="color:rgb(9, 134, 88)">$tag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function-name function" style="color:rgb(0, 0, 255)">msg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;==================================================&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;==================================================&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function-name function" style="color:rgb(0, 0, 255)">clear_ifexists</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">DOCKERNAME</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">docker </span><span class="token function" style="color:rgb(0, 0, 255)">ps</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">${project_name}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;{print $NF}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">IMAGEID</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">docker images -q -f </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">reference</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">${imageName}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -n </span><span class="token variable" style="color:rgb(9, 134, 88)">$DOCKERNAME</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">rm</span><span class="token plain"> -f </span><span class="token variable" style="color:rgb(9, 134, 88)">$DOCKERNAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       msg </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Deleting existed container finished!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       msg </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;This Docker does not exist!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -n </span><span class="token variable" style="color:rgb(9, 134, 88)">$IMAGEID</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> rmi -f </span><span class="token variable" style="color:rgb(9, 134, 88)">${imageName}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       msg </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Deleting existed image finished!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       msg </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;This Image does not exist!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function-name function" style="color:rgb(0, 0, 255)">run_container</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> login -u Brinnatt -p </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;HelloWorld123&quot;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$harbor_socket</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> pull </span><span class="token variable" style="color:rgb(9, 134, 88)">$imageName</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> run -d -p </span><span class="token variable" style="color:rgb(9, 134, 88)">$port</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token variable" style="color:rgb(9, 134, 88)">$port</span><span class="token plain"> --name </span><span class="token variable" style="color:rgb(9, 134, 88)">$project_name</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$imageName</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">clear_ifexists</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">run_container</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">msg </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Start Container Success&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">msg </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Project&#x27;s name is </span><span class="token string variable" style="color:rgb(9, 134, 88)">$project_name</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>设置脚本可执行权限。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@webserver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod +x /usr/local/bin/deploy.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5737配置构建后操作">5.7.3.7、配置构建后操作<a href="#5737配置构建后操作" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p><img loading="lazy" alt="jenkins_script_dist" src="/assets/images/jenkins_script_dist-5308ac9b7890aa3d67a3592bcf0b883b.png" width="605" height="717" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="58jenkins-流水线">5.8、Jenkins 流水线<a href="#58jenkins-流水线" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="581jenkins-流水线介绍">5.8.1、Jenkins 流水线介绍<a href="#581jenkins-流水线介绍" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>前面采用 Jenkins 的自由风格构建项目，每个步骤流程都要通过不同的方式设置，并且构建过程中整体流程是不可见的，无法确认每个流程花费的时间，并且不方便定位问题。</p><p>Jenkins 的 Pipeline 可以让项目的发布流程可视化，明确执行的阶段，可以快速的定位问题。并且整个项目的生命周期可以通过一个 Jenkinsfile 文件管理，而且 Jenkinsfile 文件是可以放在项目中维护。</p><p>所以 Pipeline 相对自由风格或者其他的项目风格更容易操作。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="582jenkins-流水线任务">5.8.2、Jenkins 流水线任务<a href="#582jenkins-流水线任务" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5821创建-jenkins-流水线">5.8.2.1、创建 Jenkins 流水线<a href="#5821创建-jenkins-流水线" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>首先安装 <code>Pipeline</code>、<code>Pipeline: Stage View</code>、<code>Pipeline: Groovy Libraries</code> 插件。</p><ol><li><p>构建任务。</p><p><img loading="lazy" alt="pipeline_create" src="/assets/images/pipeline_create-fd764d60e13e400a3a5edcd8c66acb5c.png" width="730" height="819" class="img_ev3q"></p></li><li><p>生成 Groovy 脚本。</p><p><img loading="lazy" alt="pipeline_groovy" src="/assets/images/pipeline_groovy-231b136cd11103b9fb770e41001b2ca3.png" width="641" height="635" class="img_ev3q"></p></li><li><p>构建后查看视图。</p><p><img loading="lazy" alt="pipeline_run" src="/assets/images/pipeline_run-692983451ca2dfe523a70b265e9c6f46.png" width="749" height="544" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5822groovy-脚本">5.8.2.2、Groovy 脚本<a href="#5822groovy-脚本" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><ol><li><p>Groovy 脚本基础语法。</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">// 所有脚本命令包含在pipeline{}中</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pipeline {  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">// 指定任务在哪个节点执行（Jenkins支持分布式）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   agent any</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   // 配置全局环境，指定变量名=变量值</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   environment{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    host = &#x27;192.168.11.11&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   // 存放所有任务的集合</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   stages {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 单个任务</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;任务1&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        // 实现任务的具体流程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               echo &#x27;do something&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 单个任务</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;任务2&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        // 实现任务的具体流程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               echo &#x27;do something&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       // ……</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>编写测试用例。</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   agent any</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   // 存放所有任务的集合</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   stages {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;拉取Git代码&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               echo &#x27;拉取Git代码&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;检测代码质量&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               echo &#x27;检测代码质量&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;构建代码&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               echo &#x27;构建代码&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;制作自定义镜像并发布到Harbor&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               echo &#x27;制作自定义镜像并发布到Harbor&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;基于Harbor部署工程&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               echo &#x27;基于Harbor部署工程&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>查看效果。</p><p><img loading="lazy" alt="pipeline_stages" src="/assets/images/pipeline_stages-7088fc7706ec212536c0dfdf6b8d1b25.png" width="893" height="298" class="img_ev3q"></p></li><li><p>利用 Jenkins 自带的流水线语法快速生成 Groovy 语句。配置流水线脚本的时候，有一个流水线语法链接，点进去，根据自己的需求生成 Groovy 脚本。</p><p><img loading="lazy" alt="pipeline_generate_groovy" src="/assets/images/pipeline_generate_groovy-08cb81a8fb209c78e9b6e0fb71b628f3.png" width="893" height="618" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5823jenkinsfile-实现">5.8.2.3、Jenkinsfile 实现<a href="#5823jenkinsfile-实现" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>Jenkinsfile 方式需要将脚本内容编写到项目中的 Jenkinsfile 文件中，每次构建会自动拉取项目并且获取项目中的Jenkinsfile 文件，然后根据其中的脚本对项目进行构建。</p><ol><li><p>配置 pipeline 流水线。</p><p><img loading="lazy" alt="pipeline_configure" src="/assets/images/pipeline_configure-830f70dbdf6593c5a0d13dd51bc11485.png" width="641" height="898" class="img_ev3q"></p></li><li><p>准备 Jenkinsfile。在项目根目录下创建一个 Jenkinsfile 文件，编写脚本。然后上传到 gitlab。</p><p><img loading="lazy" alt="pipeline_Jenkinsfile" src="/assets/images/pipeline_Jenkinsfile-48621a4cc272fad141884892fb0aae1b.png" width="704" height="596" class="img_ev3q"></p><p><img loading="lazy" alt="gitlab_Jenkinsfile" src="/assets/images/gitlab_Jenkinsfile-f494e77e55760dc94c1575d8e0386a7b.png" width="867" height="663" class="img_ev3q"></p></li><li><p>立即构建，查看效果。</p><p><img loading="lazy" alt="pipeline_Jenkinsfile_finished" src="/assets/images/pipeline_Jenkinsfile_finished-145af3e318303147e5572193ba4a0009.png" width="897" height="371" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="583jenkins-流水线实现">5.8.3、Jenkins 流水线实现<a href="#583jenkins-流水线实现" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5831参数化构建">5.8.3.1、参数化构建<a href="#5831参数化构建" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>添加参数化构建，方便选择不同项目版本。</p><p><img loading="lazy" alt="pipeline_git_param" src="/assets/images/pipeline_git_param-f3bceabc658a256e5dea7f53484fe38d.png" width="643" height="683" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5832拉取-git-代码">5.8.3.2、拉取 Git 代码<a href="#5832拉取-git-代码" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>通过流水线语法生成 Checkout 代码的脚本。</p><p><img loading="lazy" alt="pipeline_checkout_generate_groovy" src="/assets/images/pipeline_checkout_generate_groovy-8aeb0ae11895e8a0dc16d1037acdb747.png" width="707" height="924" class="img_ev3q"></p><p>将 <code>*/master</code> 更改为标签 <code>${tag}</code>。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">pipeline </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    agent any</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    stages </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        stage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;拉取Git代码&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            steps </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                checkout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token variable" style="color:rgb(9, 134, 88)">$class</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;GitSCM&#x27;</span><span class="token plain">, branches: </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">name: </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;${tag}&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, extensions: </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, userRemoteConfigs: </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">url: </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;http://192.168.95.165:8929/root/btest.git&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5833完善后面步骤">5.8.3.3、完善后面步骤<a href="#5833完善后面步骤" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h4><p>按照上面这个思路，可以生成如下代码：</p><ul><li>mvn 构建代码<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">stage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;构建代码&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          steps </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token function" style="color:rgb(0, 0, 255)">sh</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>sonar-scanner 代码质量检测<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">stage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;检测代码质量&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          steps </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token function" style="color:rgb(0, 0, 255)">sh</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;/var/jenkins_home/sonar-scanner462/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=ac155e09db5f2b0017acc5b1c8456a017f009664&#x27;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>生成自定义镜像脚本<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  agent any</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  environment{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      harborSocket = &#x27;192.168.95.166:80&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      harborRepo = &#x27;btest&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      harborUser = &#x27;Brinnatt&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      harborPasswd = &#x27;helloworld&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  // 存放所有任务的合集</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  stages {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      stage(&#x27;制作自定义镜像并发布Harbor&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              sh &#x27;&#x27;&#x27;cp ./target/*.jar ./docker/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              cd ./docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              docker build -t ${JOB_NAME}:${tag} ./&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              sh &#x27;&#x27;&#x27;docker login -u ${harborUser} -p ${harborPasswd} ${harborSocket}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              docker tag ${JOB_NAME}:${tag} ${harborSocket}/${harborRepo}/${JOB_NAME}:${tag}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              docker push ${harborSocket}/${harborRepo}/${JOB_NAME}:${tag}&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>生成 Publish Over SSH 脚本<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  agent any</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  environment{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      harborSocket = &#x27;192.168.95.166:80&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      harborRepo = &#x27;btest&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      harborUser = &#x27;Brinnatt&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      harborPasswd = &#x27;helloworld&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  // 存放所有任务的合集</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  stages {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      stage(&#x27;目标服务器拉取镜像并运行&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              sshPublisher(publishers: [sshPublisherDesc(configName: &#x27;webserver&#x27;, transfers: [sshTransfer(cleanRemote: false, excludes: &#x27;&#x27;, execCommand: &quot;deploy.sh $harborSocket $harborRepo $JOB_NAME $tag $servicePort&quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#x27;[, ]+&#x27;, remoteDirectory: &#x27;&#x27;, remoteDirectorySDF: false, removePrefix: &#x27;&#x27;, sourceFiles: &#x27;&#x27;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p>最终合版如下：</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    agent any</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    environment{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        harborSocket = &#x27;192.168.95.166:80&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        harborRepo = &#x27;btest&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        harborUser = &#x27;Brinnatt&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        harborPasswd = &#x27;HelloWorld123&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        servicePort = &#x27;8080&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 存放所有任务的合集</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    stages {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        stage(&#x27;拉取Git代码&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                checkout([$class: &#x27;GitSCM&#x27;, branches: [[name: &#x27;${tag}&#x27;]], extensions: [], userRemoteConfigs: [[url: &#x27;http://192.168.95.165:8929/root/btest.git&#x27;]]])</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        stage(&#x27;构建代码&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                sh &#x27;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        stage(&#x27;检测代码质量&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                sh &#x27;/var/jenkins_home/sonar-scanner462/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=4787dbf134aaaf08ec56208dce768114d8eed7d8&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        stage(&#x27;制作自定义镜像并发布Harbor&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                sh &#x27;&#x27;&#x27;cp ./target/*.jar ./docker/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                cd ./docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                docker build -t ${JOB_NAME}:${tag} ./&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                sh &#x27;&#x27;&#x27;docker login -u ${harborUser} -p ${harborPasswd} ${harborSocket}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                docker tag ${JOB_NAME}:${tag} ${harborSocket}/${harborRepo}/${JOB_NAME}:${tag}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                docker push ${harborSocket}/${harborRepo}/${JOB_NAME}:${tag}&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        stage(&#x27;目标服务器拉取镜像并运行&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                sshPublisher(publishers: [sshPublisherDesc(configName: &#x27;webserver&#x27;, transfers: [sshTransfer(cleanRemote: false, excludes: &#x27;&#x27;, execCommand: &quot;deploy.sh $harborSocket $harborRepo $JOB_NAME $tag $servicePort&quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#x27;[, ]+&#x27;, remoteDirectory: &#x27;&#x27;, remoteDirectorySDF: false, removePrefix: &#x27;&#x27;, sourceFiles: &#x27;&#x27;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>注意：一定要检查脚本中的单双引号问题，如果是单引号引用 bash 变量，则属于强引用，变量不生效。</em></p><p>至此，流水线已经定制完成，只需要将该脚本替换到 gitlab 上的 Jenkinsfile 即可。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="584jenkins-流水线整合钉钉">5.8.4、Jenkins 流水线整合钉钉<a href="#584jenkins-流水线整合钉钉" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>在程序部署成功后，可以通过钉钉的机器人及时向群众发送部署的最终结果通知。</p><ol><li><p>安装插件 DingTalk。</p></li><li><p>钉钉内部创建群组并构建机器人。</p><p>通讯录 --&gt; 我的群组 --&gt; 进群 --&gt; 群设置 --&gt; 智能群助手 --&gt; 添加机器人 --&gt; 自定义。</p><p><img loading="lazy" alt="dingtalk_define" src="/assets/images/dingtalk_define-9c3d00cd35f7b45e9f346f6ab53d7dbe.png" width="666" height="531" class="img_ev3q"></p><p>最终获取 webhook 信息如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">https://oapi.dingtalk.com/robot/send?access_token</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">0cba3354e2fd2e9438707d28c6031170084ffba2929154f663622768504adf9c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>系统配置添加钉钉通知。</p><p>Dashboard --&gt; 系统管理 --&gt; 系统配置 --&gt; 钉钉。</p><p><img loading="lazy" alt="jenkins_dingding" src="/assets/images/jenkins_dingding-6636f3e57b0040f09fabbb46cb72bf37.png" width="642" height="819" class="img_ev3q"></p></li><li><p>pipeline<!-- -->_<!-- -->test 流水线项目中添加钉钉通知。</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   agent any</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   environment{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       harborSocket = &#x27;192.168.95.166:80&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       harborRepo = &#x27;btest&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       harborUser = &#x27;Brinnatt&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       harborPasswd = &#x27;HelloWorld123&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       servicePort = &#x27;8080&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   // 存放所有任务的合集</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   stages {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;拉取Git代码&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               checkout([$class: &#x27;GitSCM&#x27;, branches: [[name: &#x27;${tag}&#x27;]], extensions: [], userRemoteConfigs: [[url: &#x27;http://192.168.95.165:8929/root/btest.git&#x27;]]])</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;构建代码&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               sh &#x27;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;检测代码质量&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               sh &#x27;/var/jenkins_home/sonar-scanner462/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=4787dbf134aaaf08ec56208dce768114d8eed7d8&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;制作自定义镜像并发布Harbor&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               sh &#x27;&#x27;&#x27;cp ./target/*.jar ./docker/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               cd ./docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               docker build -t ${JOB_NAME}:${tag} ./&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               sh &#x27;&#x27;&#x27;docker login -u ${harborUser} -p ${harborPasswd} ${harborSocket}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               docker tag ${JOB_NAME}:${tag} ${harborSocket}/${harborRepo}/${JOB_NAME}:${tag}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               docker push ${harborSocket}/${harborRepo}/${JOB_NAME}:${tag}&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       stage(&#x27;目标服务器拉取镜像并运行&#x27;) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           steps {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               sshPublisher(publishers: [sshPublisherDesc(configName: &#x27;webserver&#x27;, transfers: [sshTransfer(cleanRemote: false, excludes: &#x27;&#x27;, execCommand: &quot;deploy.sh $harborSocket $harborRepo $JOB_NAME $tag $servicePort&quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#x27;[, ]+&#x27;, remoteDirectory: &#x27;&#x27;, remoteDirectorySDF: false, removePrefix: &#x27;&#x27;, sourceFiles: &#x27;&#x27;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   post {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       success {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           dingtalk (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               robot: &#x27;Jenkins_DingDing&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               type:&#x27;MARKDOWN&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               title: &quot;success: ${JOB_NAME}&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               text: [&quot;- 成功构建:${JOB_NAME}项目!\n- 版本:${tag}\n- 持续时间:${currentBuild.durationString}\n- 任务:#${JOB_NAME}&quot;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       failure {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           dingtalk (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               robot: &#x27;Jenkins_DingDing&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               type:&#x27;MARKDOWN&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               title: &quot;fail: ${JOB_NAME}&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">               text: [&quot;- 失败构建:${JOB_NAME}项目!\n- 版本:${tag}\n- 持续时间:${currentBuild.durationString}\n- 任务:#${JOB_NAME}&quot;]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           )</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>验证可以成功发出通知。</p></li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/linux-cicd-5"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">第 5 章 Linux Ansible 进阶知识</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#51devops-概念" class="table-of-contents__link toc-highlight">5.1、DevOps 概念</a></li><li><a href="#52coding-阶段" class="table-of-contents__link toc-highlight">5.2、Coding 阶段</a><ul><li><a href="#521git-安装" class="table-of-contents__link toc-highlight">5.2.1、Git 安装</a></li><li><a href="#522gitlab-安装" class="table-of-contents__link toc-highlight">5.2.2、GitLab 安装</a></li></ul></li><li><a href="#53build-阶段" class="table-of-contents__link toc-highlight">5.3、Build 阶段</a><ul><li><a href="#531安装-java-jdk-环境" class="table-of-contents__link toc-highlight">5.3.1、安装 Java JDK 环境</a></li><li><a href="#532maven-安装" class="table-of-contents__link toc-highlight">5.3.2、Maven 安装</a></li></ul></li><li><a href="#54integrate-工具" class="table-of-contents__link toc-highlight">5.4、Integrate 工具</a><ul><li><a href="#541jenkins-介绍" class="table-of-contents__link toc-highlight">5.4.1、Jenkins 介绍</a></li><li><a href="#542jenkins-安装" class="table-of-contents__link toc-highlight">5.4.2、Jenkins 安装</a></li><li><a href="#543jenkins-入门配置" class="table-of-contents__link toc-highlight">5.4.3、Jenkins 入门配置</a><ul><li><a href="#5431创建任务" class="table-of-contents__link toc-highlight">5.4.3.1、创建任务</a></li><li><a href="#5432配置源码拉取地址" class="table-of-contents__link toc-highlight">5.4.3.2、配置源码拉取地址</a></li><li><a href="#5433配置-maven-构建代码" class="table-of-contents__link toc-highlight">5.4.3.3、配置 Maven 构建代码</a></li></ul></li><li><a href="#544远程发布" class="table-of-contents__link toc-highlight">5.4.4、远程发布</a></li></ul></li><li><a href="#55cicd-入门操作" class="table-of-contents__link toc-highlight">5.5、CICD 入门操作</a><ul><li><a href="#551持续集成" class="table-of-contents__link toc-highlight">5.5.1、持续集成</a></li><li><a href="#552持续交付" class="table-of-contents__link toc-highlight">5.5.2、持续交付</a></li></ul></li><li><a href="#56集成-sonar-qube" class="table-of-contents__link toc-highlight">5.6、集成 Sonar Qube</a><ul><li><a href="#561sonar-qube-介绍" class="table-of-contents__link toc-highlight">5.6.1、Sonar Qube 介绍</a></li><li><a href="#562sonar-qube-环境搭建" class="table-of-contents__link toc-highlight">5.6.2、Sonar Qube 环境搭建</a><ul><li><a href="#5621sonar-qube-安装" class="table-of-contents__link toc-highlight">5.6.2.1、Sonar Qube 安装</a></li><li><a href="#5622安装中文插件" class="table-of-contents__link toc-highlight">5.6.2.2、安装中文插件</a></li></ul></li><li><a href="#563sonar-qube-基本使用" class="table-of-contents__link toc-highlight">5.6.3、Sonar Qube 基本使用</a><ul><li><a href="#5631maven-实现代码检测" class="table-of-contents__link toc-highlight">5.6.3.1、Maven 实现代码检测</a></li><li><a href="#5632sonar-scanner-实现代码检测" class="table-of-contents__link toc-highlight">5.6.3.2、Sonar-scanner 实现代码检测</a></li></ul></li><li><a href="#564jenkins-集成-sonar-qube" class="table-of-contents__link toc-highlight">5.6.4、Jenkins 集成 Sonar Qube</a><ul><li><a href="#5641jenkins-配置-sonar-qube" class="table-of-contents__link toc-highlight">5.6.4.1、Jenkins 配置 Sonar Qube</a></li><li><a href="#5642配置-sonar-scanner" class="table-of-contents__link toc-highlight">5.6.4.2、配置 Sonar-scanner</a></li><li><a href="#5643构建任务" class="table-of-contents__link toc-highlight">5.6.4.3、构建任务</a></li></ul></li></ul></li><li><a href="#57集成-harbor" class="table-of-contents__link toc-highlight">5.7、集成 Harbor</a><ul><li><a href="#571harbor-介绍" class="table-of-contents__link toc-highlight">5.7.1、Harbor 介绍</a></li><li><a href="#572harbor-安装" class="table-of-contents__link toc-highlight">5.7.2、Harbor 安装</a></li><li><a href="#573harbor-使用" class="table-of-contents__link toc-highlight">5.7.3、Harbor 使用</a><ul><li><a href="#5731添加用户构建项目" class="table-of-contents__link toc-highlight">5.7.3.1、添加用户构建项目</a></li><li><a href="#5732发布镜像到-harbor" class="table-of-contents__link toc-highlight">5.7.3.2、发布镜像到 Harbor</a></li><li><a href="#5733从-harbor-拉取镜像" class="table-of-contents__link toc-highlight">5.7.3.3、从 Harbor 拉取镜像</a></li><li><a href="#5734jenkins-容器使用宿主机-docker" class="table-of-contents__link toc-highlight">5.7.3.4、Jenkins 容器使用宿主机 Docker</a></li><li><a href="#5735添加构建后操作" class="table-of-contents__link toc-highlight">5.7.3.5、添加构建后操作</a></li><li><a href="#5736编写部署脚本" class="table-of-contents__link toc-highlight">5.7.3.6、编写部署脚本</a></li><li><a href="#5737配置构建后操作" class="table-of-contents__link toc-highlight">5.7.3.7、配置构建后操作</a></li></ul></li></ul></li><li><a href="#58jenkins-流水线" class="table-of-contents__link toc-highlight">5.8、Jenkins 流水线</a><ul><li><a href="#581jenkins-流水线介绍" class="table-of-contents__link toc-highlight">5.8.1、Jenkins 流水线介绍</a></li><li><a href="#582jenkins-流水线任务" class="table-of-contents__link toc-highlight">5.8.2、Jenkins 流水线任务</a><ul><li><a href="#5821创建-jenkins-流水线" class="table-of-contents__link toc-highlight">5.8.2.1、创建 Jenkins 流水线</a></li><li><a href="#5822groovy-脚本" class="table-of-contents__link toc-highlight">5.8.2.2、Groovy 脚本</a></li><li><a href="#5823jenkinsfile-实现" class="table-of-contents__link toc-highlight">5.8.2.3、Jenkinsfile 实现</a></li></ul></li><li><a href="#583jenkins-流水线实现" class="table-of-contents__link toc-highlight">5.8.3、Jenkins 流水线实现</a><ul><li><a href="#5831参数化构建" class="table-of-contents__link toc-highlight">5.8.3.1、参数化构建</a></li><li><a href="#5832拉取-git-代码" class="table-of-contents__link toc-highlight">5.8.3.2、拉取 Git 代码</a></li><li><a href="#5833完善后面步骤" class="table-of-contents__link toc-highlight">5.8.3.3、完善后面步骤</a></li></ul></li><li><a href="#584jenkins-流水线整合钉钉" class="table-of-contents__link toc-highlight">5.8.4、Jenkins 流水线整合钉钉</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">笔记</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/存储">存储</a></li><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li><li class="footer__item"><a class="footer__link-item" href="/project">实战项目</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/linux">Linux</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/zqingfa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/website">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">浙ICP备20024502号-1</a></p><p>Copyright © 2023 - PRESENT zhangqf Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.7dd3723b.js"></script>
<script src="/assets/js/main.389df9ef.js"></script>
</body>
</html>