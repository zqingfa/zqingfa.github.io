<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-linux/advanced/linux-advanced-5">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">第 5 章 Linux DNS 服务 - Linux技术分享</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://zhangqf.com/img/logo.png"><meta data-rh="true" property="og:url" content="https://zhangqf.com/docs/linux-advanced-5"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="第 5 章 Linux DNS 服务 - Linux技术分享"><meta data-rh="true" name="description" content="5.1、DNS 基础"><meta data-rh="true" property="og:description" content="5.1、DNS 基础"><meta data-rh="true" name="keywords" content="linux,Firewall"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhangqf.com/docs/linux-advanced-5"><link data-rh="true" rel="alternate" href="https://zhangqf.com/en/docs/linux-advanced-5" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-5" hreflang="zh"><link data-rh="true" rel="alternate" href="https://zhangqf.com/docs/linux-advanced-5" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9B0V5WT2X8-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Linux技术分享" href="/opensearch.xml">
<link rel="preconnect" href="https://zhangqf.com/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://zhangqf.com/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?77dc6b24cf1d939292e9fe13be271a96",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="zhangqf RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="zhangqf Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="zhangqf JSON Feed">

<link rel="icon" href="/img/logo.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><link rel="stylesheet" href="/assets/css/styles.86c9ae18.css">
<link rel="preload" href="/assets/js/runtime~main.6d616132.js" as="script">
<link rel="preload" href="/assets/js/main.26bbf6d2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><span>更新 <a href="/website">网址导航</a> 带你发现感兴趣的技术</span></div><button type="button" aria-label="关闭" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">zhangqf</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/linux">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/category/Linux基础">Linux 基础</a></li><li><a class="dropdown__link" href="/docs/category/Linux进阶">Linux 进阶</a></li><li><a class="dropdown__link" href="/docs/category/Linux测试">Linux 测试</a></li><li><a class="dropdown__link" href="/docs/category/LinuxCICD">Linux CICD研发</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Blog</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tags">标签</a></li><li><a class="dropdown__link" href="/archive">归档</a></li></ul></div><a class="navbar__item navbar__link" href="/website">导航</a><a class="navbar__item navbar__link" href="/project">项目</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/en/docs/linux-advanced-5" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-GB">English</a></li><li><a href="/docs/linux-advanced-5" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="zhangqf" class="themedImage_ToTc themedImage--dark_i4oU"><b>zhangqf</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux">linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux基础">Linux基础</a><button aria-label="打开/收起侧边栏菜单「Linux基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/linux进阶">Linux进阶</a><button aria-label="打开/收起侧边栏菜单「Linux进阶」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-1">第 1 章 Linux 进阶命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-2">第 2 章 Linux 防火墙</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-3">第 3 章 Linux NFS 网络文件系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-4">第 4 章 Linux DHCP 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/linux-advanced-5">第 5 章 Linux DNS 服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-6">第 6 章 Linux httpd 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-7">第 7 章 Linux httpd 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-8">第 8 章 Linux httpd 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-9">第 9 章 Linux Nginx 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-10">第 10 章 Linux Tomcat 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-11">第 11 章 Linux Tomcat 服务实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-12">第 12 章 Linux haproxy 服务基础配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-13">第 13 章 Linux haproxy 服务进阶配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-14">第 14 章 Linux haproxy 服务高级配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-15">第 15 章 Linux LVS 服务配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-advanced-16">第 16 章 Linux Keepalived 服务配置</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux测试">Linux测试</a><button aria-label="打开/收起侧边栏菜单「Linux测试」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linuxcicd">Linux CICD研发</a><button aria-label="打开/收起侧边栏菜单「Linux CICD研发」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/linux进阶"><span itemprop="name">Linux进阶</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第 5 章 Linux DNS 服务</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>第 5 章 Linux DNS 服务</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51dns-基础">5.1、DNS 基础<a class="hash-link" href="#51dns-基础" title="标题的直接链接">​</a></h2><p>DNS 主要是用于将域名解析为 IP 地址的协议，有时候也用于将 IP 地址反向解析成域名，所以 DNS 可以实现双向解析。</p><p>DNS 可以使用 TCP 和 UDP 的 53 端口，基本使用 UDP 协议的 53 端口。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="511域的分类">5.1.1、域的分类<a class="hash-link" href="#511域的分类" title="标题的直接链接">​</a></h3><p>域是分层管理的，就像中国的行政级别。</p><p>最高层的域是根域(root) <code>&quot;.&quot;</code>，就是一个点，它就像国家主席一样。全球只有 13 个根域服务器，基本上都在美国，中国一台根域服务器都没有。</p><p>根域的下一层就是第二层次的顶级域（TLD）了，那么它就是各省省长了。顶级域一般两种划分方法：按国家划分和按组织性质划分。</p><ul><li>按国家划分：.cn(中国)、.uk(英国)、.us(美国)。基本都是两个字母的。</li><li>按组织性质划分：.org、.net、.com、.edu、.gov、.cc等。</li><li>反向域：arpa。这是反向解析的特殊顶级域。</li></ul><p>顶级域下来就是普通的域，公司或个人在互联网上注册的域名一般都是这些普通的域，如 baidu.com。</p><p><img loading="lazy" alt="dns" src="/assets/images/dns-1c9337cc1345de1fd5aa3b7724b4a66d.png" width="1067" height="726" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="512主机名域名fqdn">5.1.2、主机名、域名、FQDN<a class="hash-link" href="#512主机名域名fqdn" title="标题的直接链接">​</a></h3><p>以百度(<a href="http://www.baidu.com)%E5%92%8C%E7%99%BE%E5%BA%A6%E8%B4%B4%E5%90%A7(tieba.baidu.com)%E6%9D%A5%E4%B8%BE%E4%BE%8B%E3%80%82" target="_blank" rel="noopener noreferrer">www.baidu.com)和百度贴吧(tieba.baidu.com)来举例。</a></p><ul><li>域名<!-- -->  不论是 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 还是 tieba.baidu.com，它们的域名都是 baidu.com，严格地说是 &quot;baidu.com.&quot;。这是百度所购买的 com 域下的一个子域名。
</li><li>主机名<!-- -->  对于 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 来说，主机名是 www，对于 tieba.baidu.com 来说，主机名是 tieba。其实严格来说，<a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 和 tieba.baidu.com 才是主机名，它们都是 baidu.com 域下的主机。一个域下可以定义很多主机，只需配置好它的主机名和对应主机的 IP 地址即可。
</li><li>FQDN<!-- -->  FQDN 是 Fully Qualified Domain Name 的缩写，称为完全合格域名，是指包含了所有域的主机名，其中包括根域。FQDN 可以说是主机名的一种完全表示形式，它从逻辑上准确地表示出主机在什么地方。<!-- -->  例如 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 的 FQDN 是 &quot;<a href="http://www.baidu.com.%22%EF%BC%8Ccom" target="_blank" rel="noopener noreferrer">www.baidu.com.&quot;，com</a> 后面还有个点，这是根域；tieba.baidu.com 的 FQDN 是 &quot;tieba.baidu.com.&quot;。
</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="513域的分层授权">5.1.3、域的分层授权<a class="hash-link" href="#513域的分层授权" title="标题的直接链接">​</a></h3><p>域是从上到下授权的，每一层都只负责自己的直辖下层，而不负责下下层。例如根域给顶级域授权，顶级域给普通域授权，但是根域不会给普通域授权。和现实中的行政管理不一样，域的授权和管理绝对不会向下越级，因为它根本不知道下下级的域名是否存在。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="514dns-解析流程">5.1.4、DNS 解析流程<a class="hash-link" href="#514dns-解析流程" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="dns search" src="/assets/images/dns search-2daa923a305c4471393c4d60b0b081bf.png" width="700" height="560" class="img_ev3q"></p><p>以访问 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 为例。</p><ol><li>客户端要访问 <a href="http://www.baidu.com%EF%BC%8C%E9%A6%96%E5%85%88%E4%BC%9A%E6%9F%A5%E6%89%BE%E6%9C%AC%E6%9C%BA" target="_blank" rel="noopener noreferrer">www.baidu.com，首先会查找本机</a> DNS 缓存，再查找自己的 hosts 文件，还没有的话就找 DNS 服务器（这个 DNS 服务器就是计算机里设置指向的 DNS）。</li><li>DNS 服务器收到询问请求，首先查看自己是否有 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 的缓存，如果有就直接返回给客户端，没有就越级上访到根域 &quot;.&quot;，并询问根域。</li><li>根域看到是找 .com 域的，把到 .com 域的路(地址)告诉 DNS 服务器，让 DNS 服务器去找 .com 询问。</li><li>DNS 服务器去找 .com，&quot;.com&quot; 一看是自己辖下的 baidu.com，就把 baidu.com 的 IP 地址给 DNS 服务器，让它去找 baidu.com。</li><li>DNS 找到 baidu.com，baidu.com 发现 DNS 服务器要找的是自己区域里的 www 主机，就把这个主机 IP 地址给了 DNS 服务器。</li><li>DNS 服务器把得到的 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 的 IP 结果告诉客户端，并缓存一份结果在自己机器中(默认会缓存，因为该服务器允许为客户端递归，否则不会缓存非权威数据)。</li><li>客户端得到回答的 IP 地址后缓存下来，并去访问 <a href="http://www.baidu.com%EF%BC%8C%E7%84%B6%E5%90%8E" target="_blank" rel="noopener noreferrer">www.baidu.com，然后</a> <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 就把页面内容发送给客户端，也就是百度页面。</li></ol><p><em>注意：</em></p><ol><li><em>本机查找完缓存后如果没有结果，会先查找 hosts 文件，如果没有找到再把查询发送给 DNS 服务器，但这仅仅是默认情况，这个默认顺序是可以改变的。在 /etc/nsswitch.conf 中有一行 &quot;hosts: files dns&quot; 就是定义先查找 hosts 文件还是先提交给 DNS 服务器的，如果修改该行为 &quot;hosts: dns files&quot; 则先提交给 DNS 服务器，这种情况下 hosts 文件几乎就不怎么用的上了。</em></li><li><em>由于缓存是多层次缓存的，所以真正的查询可能并没有那么多步骤，上图的步骤是完全没有所需缓存的查询情况。假如某主机曾经向 DNS 服务器提交了 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 的查询，那么在 DNS 服务器上除了缓存了 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 的记录，还缓存了 &quot;.com&quot; 和 &quot;baidu.com&quot; 的记录，如果再有主机向该 DNS 服务器提交 ftp.baidu.com 的查询，那么将跳过 &quot;.&quot; 和 &quot;.com&quot; 的查询过程直接向 baidu.com 发出查询请求。</em></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="515etcresolvconf-文件">5.1.5、/etc/resolv.conf 文件<a class="hash-link" href="#515etcresolvconf-文件" title="标题的直接链接">​</a></h3><p>这个文件主要用于定义 dns 指向，即查询主机名时明确指定使用哪个 dns 服务器。</p><p>例如文件中指定了 &quot;nameserver 8.8.8.8&quot;，则每当要查询主机名时，都会向 8.8.8.8 这台 dns 服务器发起递归查询，这台 dns 服务器会帮忙查找到最终结果并返回给你。</p><p>当然，在后文的实验测试过程中，使用了另一种方式指定要使用的 dns 服务器：dig 命令中使用 &quot;@dns<!-- -->_<!-- -->server&quot;。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52dns-术语">5.2、DNS 术语<a class="hash-link" href="#52dns-术语" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="521递归查询和迭代查询">5.2.1、递归查询和迭代查询<a class="hash-link" href="#521递归查询和迭代查询" title="标题的直接链接">​</a></h3><p>例如 A 主机要查询 C 域中的一个主机，A 所指向的 DNS 服务器为 B，递归和迭代查询的方式是这样的：</p><p>递归查询：A --&gt; B --&gt; C --&gt; B --&gt; A</p><p>迭代查询：A --&gt; B A --&gt; C --&gt; A</p><p>将递归查询和迭代查询的方式放到查询流程中，就如下图所示。</p><p><img loading="lazy" alt="dns recursive" src="/assets/images/dns recursive-5b4dab4c1718f9db24ec18fbe026bc1a.png" width="846" height="400" class="img_ev3q"></p><p><strong>递归</strong>的意思是找了谁谁就一定要给出答案，那么允许递归的意思就是帮忙去找位置；<strong>迭代</strong>就是我只有下一级的地址给你，你问他去，看下下一级怎么找。</p><ul><li>如 A 对 B 允许递归，那么 B 询问 A 时，A 就去帮忙找答案，即递归查询；如果 A 不允许对 B 递归，那么 A 就会告诉 B 的下一层域的地址让 B 自己去找，即迭代查询。</li></ul><p>可以想象，如果整个域系统都使用递归查询，那些公共的根域和顶级域会忙到死，因此更好的方案就是把这些压力分散到每个个人定制的 DNS 服务器。</p><p>所以 DNS 的解析流程才会如下图。并且在客户端到 DNS 服务器端的这一阶段是递归查询，从 DNS 服务器之后的是迭代查询。也就是说，顶级域和根域出于性能的考虑，是不允许给其他任何机器递归的。</p><p><img loading="lazy" alt="dns search1" src="/assets/images/dns search1-1b28fff03ed832a3925920b3fb5b0e4c.png" width="703" height="566" class="img_ev3q"></p><p>为什么客户端到 DNS 服务器阶段是递归查询？</p><ul><li>因为客户端本身不是 DNS 服务器，它自己是找不到互联网上的域名地址的，所以只能询问 DNS 服务器，最后一定由 DNS 服务器来返回答案；</li><li>因此 <strong>DNS 服务器需要对这个客户端允许递归。因此，dns 解析器(nslookup、host、dig 等) 所发出的查询都是递归查询。</strong></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="522权威服务器和非权威应答">5.2.2、权威服务器和<!-- -->[<!-- -->非<!-- -->]<!-- -->权威应答<a class="hash-link" href="#522权威服务器和非权威应答" title="标题的直接链接">​</a></h3><p><strong>权威服务器（权威者）可以理解为直接上层域的 DNS 服务器。</strong></p><p>例如 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 这台主机的上层域是 baidu.com，那么对 www 来说，它的权威服务器就是 baidu.com 这个域内负责解析的 DNS 服务器，而对于 baidu.com 这个主机来说，它的权威服务器是 .com 这个域负责解析的 DNS 服务器。</p><p>更具体的说，某域的权威服务器是可以直接查看该域数据(即区域数据文件)的 DNS 服务器，主、从 DNS 服务器都是权威服务器。</p><p>只有权威服务器给出的应答才是权威应答，否则就是非权威应答。为什么呢？因为一个域中所有的主机都是在 DNS 服务器中的区域数据文件中记录的，对于主机来说，它们的位置只有直接上层才知道在哪里。</p><p>因此如果解析 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 时要获得权威应答，应该将 DNS 指向 baidu.com 这个域内负责解析的 DNS 服务器。</p><p>只有权威服务器直接给出的答案才是永远正确的，通过缓存得到的答案基本都是非权威应答。当然这不是一定的，因为权威服务器给的答案也是缓存中的结果，但是这是权威答案。DNS 服务器缓存解析的数据库时间长度是由权威服务器决定的。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="523dns-缓存">5.2.3、DNS 缓存<a class="hash-link" href="#523dns-缓存" title="标题的直接链接">​</a></h3><p>在 Client 和 DNS 服务器这些个人订制的 DNS 解析系统中都会使用缓存来加速解析以减少网络流量和查询压力，就算是解析不到的否定答案也会缓存。</p><p>但是要访问的主机 IP 可能会改变，所有使用缓存得到的答案不一定是对的，因此缓存给的答案是非权威的，只有对方主机的上一级给的答案才是权威答案。缓存给的非权威答案应该设定缓存时间，这个缓存时间的长短由权威者指定。</p><p>另外访问某个域下根本不存在的主机，这个域的 DNS 服务器也会给出答案，但是这是否定答案，否定答案也会缓存，并且有缓存时间。</p><ul><li>例如某个 Client 请求 51cto.com 域下的 ftp 主机，但是实际上 51cto.com 下面可能根本没有这个 ftp 主机，那么 51cto.com 就会给否定答案，为了防止 Client 不死心的访问 ftp 搞破坏，51cto.com 这个域负责解析的 DNS 服务器有必要给 Client 指定否定答案的缓存时间。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="524主从-dns-服务器">5.2.4、主、从 dns 服务器<a class="hash-link" href="#524主从-dns-服务器" title="标题的直接链接">​</a></h3><p>dns 服务器也称为 name server，每个域都必须有 dns 服务器负责该域相关数据的解析。</p><p>但 dns 服务器要负责整个域的数据解析，压力相对来说是比较大的，且一旦出现问题，整个域都崩溃无法向外提供服务，这是非常严重的事。</p><p>所以，无论是出于负载均衡还是域数据安全可用的考虑，两台 dns 服务器已经是最低要求了，多数时候应该配置多台 dns 服务器。</p><p>多台 dns 服务器之间有主次之分，主 dns 服务器称为 master，从 dns 服务器称为 slave。slave 上的域数据都是从 master 上获取的，这样 slave 和 master 就都能向外提供名称解析服务。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="525资源记录">5.2.5、资源记录<a class="hash-link" href="#525资源记录" title="标题的直接链接">​</a></h3><p>对于提供 DNS 服务的系统(DNS 服务器)，域名相关的数据都需要存储在文件(区域数据文件)中。这些数据分为多种类别，每种类别存储在对应的资源记录(resource record，RR)中。也就是说，资源记录既用来区分域数据的类型，也用来存储对应的域数据。</p><p>DNS 的 internet 类中有非常多的资源记录类型。常用的是 SOA 记录、NS 记录、A 记录(IPV6 则为 AAAA 记录)、PTR 记录、CNAME 记录、MX 记录等。</p><ol><li><p><strong>SOA 记录：start of authority，起始授权机构。该记录存储了一系列数据，若不明白 SOA 记录，请结合下面的 NS 记录，SOA 更多的信息见 &quot;子域&quot; 部分的内容。格式如下：</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.      IN  SOA dnsserver.brinnatt.com.    mail.brinnatt.com. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                               </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                               3h    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                               1h    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                               1w    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                               1h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>第四列指定了 &quot;dnsserver.brinnatt.com.&quot; 为该域的 master DNS 服务器。
</li><li>第五列是该域的管理员邮箱地址，但注意不能使用 <code>@</code> 格式的邮箱，而是要将 <code>@</code> 符号替换为点 &quot;.&quot;，正如上面的例子 &quot;mail.brinnatt.com.&quot;，其实际表示的是 &quot;<a href="mailto:mail@brinnatt.com" target="_blank" rel="noopener noreferrer">mail@brinnatt.com</a>&quot;。
</li><li>第六列使用括号将几个值包围起来。<ul><li><p>第一个值是区域数据文件的序列编号 serial，每次修改此区域数据文件都需要修改该编号值以便让 slave dns 服务器同步该区域数据文件。
</p></li><li><p>第二个值是刷新 refresh 时间间隔，表示 slave dns 服务器找 master dns 服务器更新区域数据文件的时间间隔。
</p></li><li><p>第三个值是重试 retry 时间间隔，表示 slave dns 服务器找 master dns 服务器更新区域数据文件时，如果联系不上 master，则等待多久再重试联系，该值一般比 refresh 时间短，否则该值表示的重试就失去了意义。
</p></li><li><p>第四个值是过期 expire 时间值，表示 slave dns 服务器上的区域数据文件多久过期。
</p></li><li><p>第五个值是 negative ttl，表示客户端找 dns 服务器解析时，否定答案的缓存时间长度。
</p></li><li><p>这几个值可以分行写，也可以直接写在同一行中使用空格分开，所以，上面的 SOA 记录可以写成如下格式：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.   IN  SOA dnsserver.brinnatt.com.   mail.brinnatt.com. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> 3h 1h 1w 1h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li>前三列是声明性的语句，表示 &quot;brinnatt.com.&quot; 这个域内的起始授权机构为第四列的值 &quot;dnsserver.brinnatt.com.&quot; 所表示的主机。第五列和第六列是 SOA 的附加属性数据。
</li><li>每个区域数据文件中都有且仅能有一个 SOA 记录，且一般都定义为区域数据文件中的资源记录。
</li><li><em>注意：资源记录的作用之一是存储域相关的对应数据，所以第 4、5、6 列表示的是该 SOA 记录所存储的相关值。</em></li></ul></li><li><p><strong>NS 记录：name server，存储的是该域内的 dns 服务器相关信息。即 NS 记录标识了哪台服务器是 DNS 服务器。格式如下：</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.    IN  NS  dnsserver.brinnatt.com.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>前三列仍然是声明性语句，表示 &quot;brinnatt.com.&quot; 域内的 DNS 服务器(name server)为第四列值所表示的 &quot;dnsserver.brinnatt.com.&quot; 主机。
</li><li>如果一个域内有多个 dns 服务器，则必然有主次之分，即 master 和 slave 之分。但在 NS 记录上并不能体现主次关系。例如：<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.    IN  NS  dnsserver1.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.    IN  NS  dnsserver2.brinnatt.com.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>表示主机 &quot;dnsserver1.brinnatt.com.&quot; 和主机 &quot;dnsserver2.brinnatt.com.&quot; 都是域 &quot;brinnatt.com.&quot; 内的 dns 服务器，但没有区分出主次 dns 服务器。</li></ul></li></ul><p>不少朋友搞不懂 SOA 记录，也很容易混淆 SOA 和 NS 记录。其实，仅就它们的主要作用而言，NS 记录仅仅只是声明该域内哪台主机是 dns 服务器，用来提供名称解析服务，NS 记录不会区分哪台 dns 服务器是 master 哪台 dns 服务器是 slave。</p><p>而 SOA 记录则用于指定哪个 NS 记录对应的主机是 master dns 服务器，也就是从多个 dns 服务器中挑选一台任命其为该域内的 master dns 服务器，其他的都是 slave，都需要从 master 上获取域相关数据。由此，SOA 的名称 &quot;起始授权机构&quot; 所表示的意思也就容易理解了。</p></li><li><p><strong>A 记录：address，存储的是域内主机名所对应的 ip 地址。格式如下：</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dnsserver.brinnatt.com.    IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.100.11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>客户端之所以能够解析到主机名对应的 ip 地址，就是因为 dns 服务器中的有 A 记录存储了主机名和 ip 的对应关系。</li><li>AAAA 记录存储的是主机名和 ipv6 地址的对应关系。</li></ul></li><li><p><strong>PTR 记录：pointer，和 A 记录相反，存储的是 ip 地址对应的主机名，该记录只存在于反向解析的区域数据文件中(并非一定)。格式如下：</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token number" style="color:rgb(9, 134, 88)">12.100</span><span class="token plain">.16.172.in-addr.arpa.  IN  PTR  www.brinnatt.com.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>表示解析 172.16.100.12 地址时得到主机名 &quot;<a href="http://www.brinnatt.com.%22" target="_blank" rel="noopener noreferrer">www.brinnatt.com.&quot;</a> 的结果。</li></ul></li><li><p><strong>CNAME 记录：canonical name，表示规范名的意思，其所代表的记录常称为别名记录。之所以如此称呼，就是因为为规范名起了一个别名。什么是规范名？可以简单认为是 fqdn。格式如下：</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">www1.brinnatt.com.     IN  CNAME  www.brinnatt.com.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>最后一列就是规范名，而第一列是规范名即最后一列的别名。当查询 &quot;www1.brinnatt.com.&quot;，dns 服务器会找到它的规范名 &quot;<a href="http://www.brinnatt.com.%22%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E6%9F%A5%E8%AF%A2%E8%A7%84%E8%8C%83%E5%90%8D%E7%9A%84" target="_blank" rel="noopener noreferrer">www.brinnatt.com.&quot;，然后再查询规范名的</a> A 记录，也就获得了对应的 IP 地址并返回给客户端。</li><li>CNAME 记录非常重要，很多时候使用 CNAME 可以解决很复杂的问题。而且目前常用的 CDN 技术有一个步骤就是在 dns 服务器上设置 CNAME 记录，将客户端对资源的请求引导到与它同网络环境(电信、网通)以及地理位置近的缓存服务器上。</li></ul></li><li><p>MX 记录：mail exchanger，邮件交换记录。负责转发或处理该域名内的邮件。</p></li></ol><p>关于资源记录，最需要明确的概念就是它不仅仅用来区分和标识区域数据的类型，还用来存储对应的域数据。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="53安装-dns">5.3、安装 DNS<a class="hash-link" href="#53安装-dns" title="标题的直接链接">​</a></h2><p>Linux 上搭建 DNS 服务的软件有 bind9、NSD(Name server domain) 和 unbound，其中 bind9 是市场占有率最高的软件。本文也以此软件来介绍 DNS 服务。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># yum install bind -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以下是 bind 生成的命令程序。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpm -ql bind | grep sbin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/arpaname</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/ddns-confgen</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-checkds</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-coverage</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-dsfromkey</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-importkey</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-keyfromlabel</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-keygen</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-keymgr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-revoke</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-settime</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-signzone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/dnssec-verify</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/genrandom</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/isc-hmac-fixup</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/lwresd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/named</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/named-checkconf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/named-checkzone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/named-compilezone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/named-journalprint</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/nsec3hash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/rndc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/sbin/rndc-confgen</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其中 named 是提供 DNS 服务的主程序，它默认会读取配置文件 /etc/named.conf。</li></ul><p>安装 bind 后生成了以下几个配置文件：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rpm -ql bind | grep etc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/logrotate.d/named</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/named</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/named.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/named.iscdlv.key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/named.rfc1912.zones</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/named.root.key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/rndc.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/rndc.key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/rwtab.d/named</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/sysconfig/named</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/share/doc/bind-9.9.4/sample/etc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/share/doc/bind-9.9.4/sample/etc/named.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/share/doc/bind-9.9.4/sample/etc/named.rfc1912.zones</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其中 named.conf 是 named 工具默认的配置文件，它的配置指令项非常多。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="54配置和使用-dns">5.4、配置和使用 DNS<a class="hash-link" href="#54配置和使用-dns" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="541namedconf-配置">5.4.1、named.conf 配置<a class="hash-link" href="#541namedconf-配置" title="标题的直接链接">​</a></h3><p>下文将以 brinnatt.com 域以及这个域中的主机的定义来说明相关配置方法。</p><p>named.conf 是 named 默认加载的配置文件，该配置文件中使用 <code>#</code> 或 <code>/**/</code> 或 <code>//</code> 作为注释符号，每个非注释语句都必须使用分号 <code>;</code> 结束。</p><p>该配置文件中只能有一个 options，在这里面用于配置全局项。其中下例中的 directory 指令定义区域数据文件的存放目录。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>除了 option，还必需有区域的配置。zone 关键字后面接的是域和类，域是自定义的域名，IN 是 internet 的简称，是 bind 9 中的默认类，所以可以省略。</p><p>type 定义该域的类型是 &quot;master | slave | stub | hint | forward&quot; 中的哪种，file 定义该域的区域数据文件(区域数据文件的说明见下文)，因为这里是相对路径 db.brinnatt.com，它的相对路径是相对于 /var/named 的，也可以指定绝对路径 /var/named/db.brinnatt.com。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;brinnatt.com&quot;</span><span class="token plain"> IN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;db.brinnatt.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>除此外，在每个 named.conf 中还应该配置几个必须的区域：</p><ol><li><p>根域名 &quot;.&quot; 的区域配置。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;.&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> hint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> named.ca</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>type hint 表示该区域 &quot;.&quot; 类型为 hint。回顾 dns 解析流程，在客户端让 dns 服务器迭代查询时，迭代查询的第一步就是让 dns 服务器去找根域名服务器。</li><li>但是 dns 服务器如何知道根域名服务器在哪里？这就是 hint 类型的作用，它提示 dns 服务器根据其区域数据文件 named.ca 中的内容去获取根域名地址，并将这些数据缓存起来，下次需要根域名地址时直接查找缓存即可。</li><li>由于根域名地址也是会改变的，有了根区域的提示，就可以永远能获取到最新的根区域地址。其实也可以手动下载这些数据，地址为：<a href="https://www.internic.net/domain/named.root%E3%80%82%E5%9B%A0%E6%AD%A4%EF%BC%8C%E5%8F%AA%E6%9C%89%E6%A0%B9%E5%8C%BA%E5%9F%9F" target="_blank" rel="noopener noreferrer">https://www.internic.net/domain/named.root。因此，只有根区域</a> &quot;.&quot; 才会设置为 hint 类型。</li></ul></li><li><p>&quot;localhost&quot; 域名(用于解析 localhost 为 127.0.0.1) 和 127.0.0.1 的方向查找区域。这两个没有定义在 named.conf 中，而是定义在 /etc/named.rfc1912.zones 中，然后在 named.conf 中使用 include 指令将其包含进来。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">include </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/named.rfc1912.zones&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 named.rfc1912.zones 中部分内容：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;localhost&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.localhost&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       allow-update </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> none</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1.0.0.127.in-addr.arpa&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.loopback&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       allow-update </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> none</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然，反向查找区域可以定义为域而不是直接定义成主机。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;0.0.127.in-addr.arpa&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.loopback&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       allow-update </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> none</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但这样的话，就需要相对应地修改 /var/named/named.loopback 文件。</p><p>其实根域名 &quot;.&quot; 和 &quot;localhost&quot; 以及 &quot;1.0.0.127.in-addr.arpa&quot; 完全没必要去改变，照搬就是了。</p><p>所以，/etc/named.conf 的内容如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/named.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;brinnatt.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;db.brinnatt.com&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;.&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> hint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.ca&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/named.rfc1912.zones&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>到此并没有结束，因为 /etc/named<!-- -->*<!-- --> 的属组都是 named，且权限要为 640。如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># ls -l /etc/named*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r-- </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root root   </span><span class="token number" style="color:rgb(9, 134, 88)">206</span><span class="token plain"> Oct </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> 09:27 /etc/named.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r----- </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root root  </span><span class="token number" style="color:rgb(9, 134, 88)">1808</span><span class="token plain"> Oct </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> 09:18 /etc/named.conf.backup </span><span class="token comment" style="color:rgb(0, 128, 0)"># 原文件备份</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r-- </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root named </span><span class="token number" style="color:rgb(9, 134, 88)">3923</span><span class="token plain"> Jun  </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">2019</span><span class="token plain"> /etc/named.iscdlv.key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r----- </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root named  </span><span class="token number" style="color:rgb(9, 134, 88)">931</span><span class="token plain"> Jun </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">2007</span><span class="token plain"> /etc/named.rfc1912.zones</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r-- </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> root named </span><span class="token number" style="color:rgb(9, 134, 88)">1587</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">2017</span><span class="token plain"> /etc/named.root.key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/etc/named:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所以，对于新建的 /etc/named.conf 应该要改变属组和权限。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chown root:named /etc/named.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod 640 /etc/named.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后使用 /usr/sbin/named-checkconf 命令来检查下 /etc/named.conf 文件的配置是否正确，如果不返回任何信息，则表示配置正确。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># named-checkconf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置好配置文件后，接下来要书写域相关数据库——区域数据文件。</p></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="542区域数据文件配置">5.4.2、区域数据文件配置<a class="hash-link" href="#542区域数据文件配置" title="标题的直接链接">​</a></h3><p>区域数据文件即 named.conf 中 zone 关键字定义的域的数据文件，由 zone 中的 file 指令指定文件名，例如上面定义的 &quot;db.brinnatt.com&quot;，说明 brinnatt.com 这个 zone 的区域数据文件为 /var/named/db.brinnatt.com。</p><p>区域数据文件中很多地方都可以使用缩写，如果不使用缩写的书写方式，那么每一条记录中的域名或主机名都要写全，即要写到根域 &quot;.&quot;。</p><p>假设 brinnatt.com 域内有 3 台主机 www、ftp 和 mydb，它们的 ip 分别为 10.1.1.{116,117,118}，还有一台 DNS 服务器主机名为 dnsserver，其 ip 为 10.1.1.2。</p><p>于是，brinnatt.com 这个区域的数据文件可以如下书写：区域数据文件中使用分号 &quot;;&quot; 来注释。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 6h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.              IN  SOA dnsserver.brinnatt.com.   xyz.brinnatt.com. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                       </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> serial num</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                       3h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> refresh </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                       1h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> retry </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                       1w    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expire </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                       1h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> negative </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.              IN  NS  dnsserver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver.brinnatt.com.    IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www.brinnatt.com.          IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ftp.brinnatt.com.          IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.117</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mydb.brinnatt.com.         IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.118</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www1.brinnatt.com.         IN  CNAME  www.brinnatt.com.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其中第一行的 <code>$TTL 6h</code> 表示缓存周期，即查询该域中记录时肯定答案的缓存时间长度。例如本地查询 <a href="http://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a> 时，本地将缓存 baidu.com 域的相关查询结果，缓存时间长度由 baidu.com 这个域的区域数据文件中定义的 <code>$TTL</code> 的值决定。
</li><li>在区域数据文件中，<code>$TTL</code> 的定义表示其后的记录都以此 TTL 为准，直到遇到下一个 <code>$TTL</code>。也就是说，两个 <code>$TTL</code> 之间的所有记录都以前面的 <code>$TTL</code> 为准。不过大多数时候，一个区域数据文件中只会在第一行定义一个 <code>$TTL</code> 值，表示该文件中所有记录都使用该缓存周期值。
</li><li>第二行定义的是 SOA 记录，每个区域文件中的第一个资源记录定义行都要是 SOA 记录。在该行中除了指定了 master dns 服务器，还指定了一些附加属性，包括序列号为 1，还有各种时长等信息。
</li><li>第二个资源记录行定义的是 NS 记录，NS 记录行表示该行定义的主机 &quot;dnsserver.brinnatt.com.&quot; 是这个域 &quot;brinnatt.com.&quot; 内的 dns 服务器。
</li><li>接下来的几个资源记录行定义的都是 A 记录，分别定义了 &quot;{dnsserver,www,ftp,mydb}.brinnatt.com.&quot; 这几个主机对应的 ip 地址为 10.1.1.{2,116,117,118}。A 记录中存储的是主机名和 IP 地址之间的映射关系，在为外界主机提供主机名查询服务时，就是从 A 记录中获取对应的 ip 地址。
</li><li>最后一个资源记录行定义的是 CNAME 记录，它存储的是 canonical name 所对应的别名。例如此处定义的是 &quot;<a href="http://www.brinnatt.com.%22" target="_blank" rel="noopener noreferrer">www.brinnatt.com.&quot;</a> 的别名为 &quot;www1.brinnatt.com.&quot;。
</li><li>然后修改 /var/named/db.brinnatt.com 文件的属组和权限。<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod 640 /var/named/db.brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chown root:named /var/named/db.brinnatt.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>然后使用 named-checkzone 命令检查区域数据文件是否书写正确。例如，要检查 &quot;brinnatt.com&quot; 区域，其区域数据文件为 /var/named/named.conf。<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># named-checkzone brinnatt.com /var/named/db.brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone brinnatt.com/IN: loaded serial </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p>回到区域数据文件的配置说明上。在上面的配置过程中，完全没有使用缩写，但其实很多地方都能使用缩写的书写方式。以下是区域数据文件中的一些书写规则，包括缩写规则：</p><ol><li><p><code>$</code> 符号：定义宏。最常见的是 <code>$TTL</code>、<code>$ORIGIN</code>。origin 的意思是起点，可以自行定义 <code>$ORIGIN</code> 的值。</p><p>例如：<code>$ORIGIN .</code> 表示定义的 <code>$ORIGIN</code> 的起点值为根域符号，<code>$ORIGIN brinnatt.com.</code> 表示 <code>$ORIGIN</code> 的值为 <code>brinnatt.com.</code>，未定义 <code>$ORIGIN</code> 时，值为 zone &quot;domain&quot; 的 domain 部分。</p></li><li><p>fqdn 自动补齐：在区域数据文件中，没有使用点号 &quot;.&quot; 结尾的，在实际使用的时候都会自动补上域名，使其变为 fqdn。</p><p>例如区域 &quot;brinnatt.com.&quot;，以下是完全格式的资源记录：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dnsserver.brinnatt.com.    IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10.15</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以缩写为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dnsserver    IN    A   </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10.15</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为 dnsserver 后没有点，所以会补齐整个域名 &quot;brinnatt.com.&quot;。</p><p>实际上，自动补齐的部分是 <code>$ORIGIN</code> 的值，只不过默认没定义 <code>$ORIGIN</code> 时，<code>$ORIGIN</code> 的值为 zone 定义的域名，所以默认是自动补齐域名。</p></li><li><p><code>@</code> 符号：可以使用 <code>@</code> 符号来缩写 <code>$ORIGIN</code> 的值。</p><p>由于自定义的区域数据文件中，一般不会主动定义 <code>$ORIGIN</code> 的值，而第一个资源记录一般都是 SOA 记录，所以此时 SOA 记录中的第一列就可以使用 <code>@</code> 符号，其它地方只要值为 <code>$ORIGIN</code>，都可以使用 <code>@</code> 符号缩写。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">@     IN  SOA  dnsserver  xyz. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> 3h 1h 1w 1h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@     IN  NS   dnsserver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>重复最近一个名称：区域数据文件中的第一列可以使用空格或制表符使该列继承上一行的第一列的值。</p><p>例如第一行定义的是 SOA 记录，第一列是 &quot;brinnatt.com.&quot;，那么第二行定义的 NS 记录中，其第一列就可以留空来继承第一行第一列的 &quot;brinnatt.com.&quot;。不止第一行和第二行，第三行也可以继承第二行的第一列，第 n+1 行也可以继承第 n 行的第一列，只要它们的值一样即可。</p><p>所以，/var/named/db.brinnatt.com 这个文件完全缩写后的结果如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/db.brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 6h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@            IN  SOA dnsserver   xyz </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> serial num</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            3h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> refresh </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            1h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> retry </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            1w    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expire </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            1h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> negative </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@            IN  NS  dnsserver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver    IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www          IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ftp</span><span class="token plain">          IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.117</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mydb     IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.118</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www1     IN  CNAME   www</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>是否缩写正确，可以使用 named-checkzone 来检查下，还可以使用 named-compilezone 命令对区域数据文件进行编译，并输出编译后的结果。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># named-checkzone brinnatt.com /var/named/db.brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone brinnatt.com/IN: loaded serial </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># named-compilezone -o - brinnatt.com /var/named/db.brinnatt.com </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone brinnatt.com/IN: loaded serial </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.                      </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN SOA  dnsserver.brinnatt.com. xyz.brinnatt.com. </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10800</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3600</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">604800</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.                      </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN NS   dnsserver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver.brinnatt.com.            </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN A    </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ftp.brinnatt.com.                  </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN A    </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.117</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mydb.brinnatt.com.                 </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN A    </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.118</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www.brinnatt.com.                  </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN A    </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www1.brinnatt.com.                 </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN CNAME    www.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>&quot;-o&quot; 选项表示将编译后的结果输出到指定文件中，&quot;-&quot; 表示输出到标准输出。</li><li>由上面编译的结果可以看出，缩写后的结果并没有任何错误。</li></ul></li></ol><p>在 /etc/named.conf 中，还定义了 3 个区域，分别是 &quot;.&quot;、&quot;localhost&quot; 和 &quot;1.0.0.127.in-addr.arpa&quot;，它们的区域数据文件分别是 /var/named/{named.ca, named.localhost, loopback}，这几个文件的内容可以自行解读。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/named.ca </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> DiG </span><span class="token number" style="color:rgb(9, 134, 88)">9.9</span><span class="token plain">.4-RedHat-9.9.4-38.el7_3.2 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> +bufsize</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1200</span><span class="token plain"> +norec @a.root-servers.net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> servers found</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> global options: +cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Got answer:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain">HEADER</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;-</span><span class="token plain"> opcode: QUERY, status: NOERROR, id: </span><span class="token number" style="color:rgb(9, 134, 88)">17380</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> flags: qr aa</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUERY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ANSWER: </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain">, AUTHORITY: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, ADDITIONAL: </span><span class="token number" style="color:rgb(9, 134, 88)">27</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> OPT PSEUDOSECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> EDNS: version: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> udp: </span><span class="token number" style="color:rgb(9, 134, 88)">1472</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUESTION SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">              IN  NS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ANSWER SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  a.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  b.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  c.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  d.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  e.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  f.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  g.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  h.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  i.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  j.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  k.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  l.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">518400</span><span class="token plain">  IN  NS  m.root-servers.net.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ADDITIONAL SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">198.41</span><span class="token plain">.0.4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:503:ba3e::2:30</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">b.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">192.228</span><span class="token plain">.79.201</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">b.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:500:84::b</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">c.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">192.33</span><span class="token plain">.4.12</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">c.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:500:2::c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">d.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">199.7</span><span class="token plain">.91.13</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">d.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:500:2d::d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">e.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">192.203</span><span class="token plain">.230.10</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">e.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:500:a8::e</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">f.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">192.5</span><span class="token plain">.5.241</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">f.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:500:2f::f</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">g.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">192.112</span><span class="token plain">.36.4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">g.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:500:12::d0d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">h.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">198.97</span><span class="token plain">.190.53</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">h.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:500:1::53</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">i.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">192.36</span><span class="token plain">.148.17</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">i.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:7fe::53</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">j.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">192.58</span><span class="token plain">.128.30</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">j.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:503:c27::2:30</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">193.0</span><span class="token plain">.14.129</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:7fd::1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">l.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">199.7</span><span class="token plain">.83.42</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">l.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:500:9f::42</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">m.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">202.12</span><span class="token plain">.27.33</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">m.root-servers.net. </span><span class="token number" style="color:rgb(9, 134, 88)">3600000</span><span class="token plain"> IN  AAAA    </span><span class="token number" style="color:rgb(9, 134, 88)">2001</span><span class="token plain">:dc3::35</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Query time: </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> msec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> SERVER: </span><span class="token number" style="color:rgb(9, 134, 88)">198.41</span><span class="token plain">.0.4</span><span class="token comment" style="color:rgb(0, 128, 0)">#53(198.41.0.4)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> WHEN: Po kvě </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">:14:44 CEST </span><span class="token number" style="color:rgb(9, 134, 88)">2017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> MSG SIZE  rcvd: </span><span class="token number" style="color:rgb(9, 134, 88)">811</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>该文件中记录了获取根区域的方法：dig +bufsize=1200 +norec @a.root-servers.net。</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/named.{localhost,loopback}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 1D</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@   IN SOA  @ rname.invalid. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> serial</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    1D  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> refresh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    1H  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> retry</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    1W  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expire</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    3H </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> minimum</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    NS  @</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    A   </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    AAAA    ::1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 1D</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@   IN SOA  @ rname.invalid. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> serial</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    1D  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> refresh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    1H  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> retry</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    1W  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expire</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    3H </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> minimum</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    NS  @</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    A   </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    AAAA    ::1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    PTR localhost.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>至此，配置文件和区域数据文件都已经配置结束了，可以启动 named 服务。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl start named.service </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># netstat -tnlup | grep named</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcp        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1:953           </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">.0.0:*               LISTEN      </span><span class="token number" style="color:rgb(9, 134, 88)">26161</span><span class="token plain">/named         </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcp        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2:53             </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">.0.0:*               LISTEN      </span><span class="token number" style="color:rgb(9, 134, 88)">26161</span><span class="token plain">/named         </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcp        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1:53            </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">.0.0:*               LISTEN      </span><span class="token number" style="color:rgb(9, 134, 88)">26161</span><span class="token plain">/named         </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcp6       </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> ::1:953                 :::*                    LISTEN      </span><span class="token number" style="color:rgb(9, 134, 88)">26161</span><span class="token plain">/named         </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">udp        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2:53             </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">.0.0:*                           </span><span class="token number" style="color:rgb(9, 134, 88)">26161</span><span class="token plain">/named         </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">udp        </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1:53            </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">.0.0:*                           </span><span class="token number" style="color:rgb(9, 134, 88)">26161</span><span class="token plain">/named         </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>从结果中看到，named 默认监听在所有接口的 tcp 和 udp 的 53 端口上，但还监听了环回地址的 tcp 的 953 端口，这是 named 为 rndc 提供的控制端口，rndc 是 named 的远程控制工具，在后文会专门介绍其用法。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="543测试-dns-解析">5.4.3、测试 DNS 解析<a class="hash-link" href="#543测试-dns-解析" title="标题的直接链接">​</a></h3><p>任找一台机器(也可以是 dns 服务器本身)，将其 dns 指向 dns 服务器的监听地址。</p><p>我们使用 10.1.1.3 测试主机指向 10.1.1.2 DNS 服务器：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/resolv.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nameserver </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后使用 nslookup 命令或 host 命令或 bind-utils 包中提供的 dig 命令来测试能否解析 brinnatt.com 这个域相关数据。建议使用 dig 命令，因为 host 太简陋，nslookup 在某些情况下有缺陷，dig 命令则相对更完美些。dig 命令的用法请参见 man 文档。</p><p>例如，解析 brinnatt.com 域中的主机 www 的 A 记录：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -t A www.brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> DiG </span><span class="token number" style="color:rgb(9, 134, 88)">9.11</span><span class="token plain">.4-P2-9.11.4-13.ky10 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> -t A www.brinnatt.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> global options: +cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Got answer:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain">HEADER</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;-</span><span class="token plain"> opcode: QUERY, status: NOERROR, id: </span><span class="token number" style="color:rgb(9, 134, 88)">15013</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> flags: qr aa rd ra</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUERY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ANSWER: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, AUTHORITY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ADDITIONAL: </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> OPT PSEUDOSECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> EDNS: version: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> udp: </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUESTION SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">www.brinnatt.com.              IN  A</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ANSWER SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www.brinnatt.com.       </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> AUTHORITY SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.           </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  NS  dnsserver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ADDITIONAL SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver.brinnatt.com. </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Query time: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> msec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> SERVER: </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token comment" style="color:rgb(0, 128, 0)">#53(10.1.1.2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> WHEN: 六 </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">月 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain">:12:41 CST </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> MSG SIZE  rcvd: </span><span class="token number" style="color:rgb(9, 134, 88)">101</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>&quot;QUESTION SECTION&quot; 表示所发起的查询，表示要查询 &quot;<a href="http://www.brinnatt.com.%22" target="_blank" rel="noopener noreferrer">www.brinnatt.com.&quot;</a> 的 A 记录。</li><li>&quot;ANSWER SECTION&quot; 表示对查询的回复。回复的结果是 &quot;<a href="http://www.brinnatt.com.%22" target="_blank" rel="noopener noreferrer">www.brinnatt.com.&quot;</a> 的 A 记录值为 &quot;10.1.1.116&quot;，这正是 dig 所期望的结果。</li><li>&quot;AUTHORITY SECTION&quot; 表示该查询是权威服务器给的答案，并给出了权威服务器的 ns 记录。在此例中，&quot;<a href="http://www.brinnatt.com%22" target="_blank" rel="noopener noreferrer">www.brinnatt.com&quot;</a> 主机所在的域 &quot;brinnatt.com&quot; 的权威服务器为 &quot;dnsserver.brinnatt.com.&quot;。如果没有该段，表示非权威应答。</li><li>&quot;ADDITIONAL SECTION&quot; 段是额外的回复，回复的内容是权威服务器的 A 记录。</li></ul><p>还可以测试 ns 记录、soa 记录、cname 记录等。</p><p>不过需要注意的是 soa 记录和 ns 记录查询的对象是域名而不是主机名，而 CNAME 记录的对象则必须是主机名。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -t ns brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -t soa brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -t cname www1.brinnatt.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="55配置反向查找区域">5.5、配置反向查找区域<a class="hash-link" href="#55配置反向查找区域" title="标题的直接链接">​</a></h2><p>反向查找是根据 ip 地址查找其对应的主机名。在 /etc/named.conf 中，需要定义 <code>zone *.in-addr.arpa</code>，其中 <code>*</code> 是点分十进制 ip 的反写，可以是反写 ip 后的任意一段长度。</p><p>例如 127.0.0.1 反写后是 1.0.0.127，所以 zone 所定义的可以是 &quot;1.0.0.127&quot;、&quot;0.0.127&quot;、&quot;0.127&quot;，甚至是 &quot;127&quot;，长度位数不同，在区域数据文件中需要补全的数值就不同。</p><p>另外，反向查找区域的各种缓存时间可以都设置长一点，因为用的不多。</p><p>就以 127.0.0.1 解析为 localhost 为例。</p><p>在 /etc/named.rfc1912.zones 中已有这样一段：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1.0.0.127.in-addr.arpa&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.loopback&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       allow-update </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> none</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其区域数据文件 /var/named/named.loopback 内容如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/named.loopback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 1D</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@   IN SOA  @ rname.invalid. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> serial</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    1D  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> refresh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    1H  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> retry</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    1W  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expire</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    3H </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> minimum</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    NS      @</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    A       </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    AAAA    ::1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    PTR     localhost.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例 1：将 DNS 服务器中 /etc/named.rfc1912.zones 中将 1.0.0.127.in-addr.arpa 区域的配置注释掉，改为如下内容：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;0.127.in-addr.arpa&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.loopback.test&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        allow-update </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> none</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后书写其区域数据文件 /var/named/named.loopback.test：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 1D</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@    IN    SOA     </span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token plain">    rname.invalid. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> 1D 1H 1W 3H </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           NS      </span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token plain">.0.127.in-addr.arpa.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token plain">        A       </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token plain">        PTR     arm64v8.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在上述配置中，特意将 1.0 的 ptr 记录写成了 &quot;arm64v8.&quot;，这样查询 1.0.0.127 的主机名时，将得到 arm64v8 而不是 localhost。</li></ul><p>修改属组、权限后重启 named，并使用 dig -x 测试，dig 的 &quot;-x&quot; 选项专门用于反向查找。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chown root:named /var/named/named.loopback.test </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod 640 /var/named/named.loopback.test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart named</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -x 127.0.0.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> DiG </span><span class="token number" style="color:rgb(9, 134, 88)">9.9</span><span class="token plain">.4-RedHat-9.9.4-74.el7_6.1 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> -x </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> global options: +cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Got answer:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain">HEADER</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;-</span><span class="token plain"> opcode: QUERY, status: NOERROR, id: </span><span class="token number" style="color:rgb(9, 134, 88)">57502</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> flags: qr aa rd ra</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUERY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ANSWER: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, AUTHORITY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ADDITIONAL: </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> OPT PSEUDOSECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> EDNS: version: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> udp: </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUESTION SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token plain">.0.127.in-addr.arpa.        IN  PTR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ANSWER SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token plain">.0.127.in-addr.arpa. </span><span class="token number" style="color:rgb(9, 134, 88)">86400</span><span class="token plain">   IN  PTR arm64v8.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> AUTHORITY SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">0.127</span><span class="token plain">.in-addr.arpa.     </span><span class="token number" style="color:rgb(9, 134, 88)">86400</span><span class="token plain">   IN  NS  </span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token plain">.0.127.in-addr.arpa.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ADDITIONAL SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token plain">.0.127.in-addr.arpa. </span><span class="token number" style="color:rgb(9, 134, 88)">86400</span><span class="token plain">   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Query time: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> msec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> SERVER: </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token comment" style="color:rgb(0, 128, 0)">#53(10.1.1.2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> WHEN: Sat Oct </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain"> 08:57:55 EDT </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> MSG SIZE  rcvd: </span><span class="token number" style="color:rgb(9, 134, 88)">102</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例 2：配置 brinnatt.com 中主机的反向解析区域，由于在实验过程中，该域中的主机地址都是 10.1.1.0/24 网段内的主机，所以只需要配置一个 1.1.10.in-addr.arpa 反向查找区域即可，如果域内主机跨了多个网段，例如 10.1.1.0/24 和 192.168.1.0/24，则需要配置两个反向查找区域。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/named.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;brinnatt.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;db.brinnatt.com&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1.1.10.in-addr.arpa&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;db.1.1.10&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;.&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> hint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.ca&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/named.rfc1912.zones&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/db.1.1.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 1D</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@    IN   SOA   </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">   xyz.brinnatt.com. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> 1D 1H 1W 3H </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     IN   NS    dnsserver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">    IN   PTR   dnsserver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">116</span><span class="token plain">  IN   PTR   www.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">117</span><span class="token plain">  IN   PTR   ftp.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">118</span><span class="token plain">  IN   PTR   mydb.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启 named，然后使用 dig -x 测试。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chown root:named /var/named/db.1.1.10 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod 640 /var/named/db.1.1.10 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart named</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -x 10.1.1.118</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> DiG </span><span class="token number" style="color:rgb(9, 134, 88)">9.9</span><span class="token plain">.4-RedHat-9.9.4-74.el7_6.1 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> -x </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.118</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> global options: +cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Got answer:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain">HEADER</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;-</span><span class="token plain"> opcode: QUERY, status: NOERROR, id: </span><span class="token number" style="color:rgb(9, 134, 88)">5472</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> flags: qr aa rd ra</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUERY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ANSWER: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, AUTHORITY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ADDITIONAL: </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> OPT PSEUDOSECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> EDNS: version: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> udp: </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUESTION SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token number" style="color:rgb(9, 134, 88)">118.1</span><span class="token plain">.1.10.in-addr.arpa.   IN  PTR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ANSWER SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">118.1</span><span class="token plain">.1.10.in-addr.arpa. </span><span class="token number" style="color:rgb(9, 134, 88)">86400</span><span class="token plain">  IN  PTR mydb.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> AUTHORITY SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1.1</span><span class="token plain">.10.in-addr.arpa.    </span><span class="token number" style="color:rgb(9, 134, 88)">86400</span><span class="token plain">   IN  NS  dnsserver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ADDITIONAL SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver.brinnatt.com. </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Query time: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> msec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> SERVER: </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token comment" style="color:rgb(0, 128, 0)">#53(10.1.1.2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> WHEN: Sat Oct </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain"> 09:50:52 EDT </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> MSG SIZE  rcvd: </span><span class="token number" style="color:rgb(9, 134, 88)">123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="56配置-仅缓存-dns-服务器">5.6、配置 &quot;仅缓存&quot; DNS 服务器<a class="hash-link" href="#56配置-仅缓存-dns-服务器" title="标题的直接链接">​</a></h2><p>仅用作提供缓存的 dns 服务器，当有客户端请求该 dns 服务器帮忙解析某个地址时，它不会直接为外界主机提供 dns 解析，而是自己去找其他 dns 服务器解析，并将结果缓存在本地，并将缓存结果提供给客户端。</p><p>也就是说，仅缓存 dns 服务器其实扮演的角色和客户端一样，只不过它还未其他客户端提供解析查询而已。</p><p>要配置仅缓存 dns 服务器，只要配置 3 个任何时候都必要的域：根域 &quot;.&quot;、&quot;localhost&quot; 域和 &quot;1.0.0.127.in-addr.arpa&quot;。也就是说，任何一台完整的 dns 服务器，至少都是 &quot;缓存&quot; 服务器。</p><p>所以，仅缓存 dns 服务器配置如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/named.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;brinnatt.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;db.brinnatt.com&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1.1.10.in-addr.arpa&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;db.1.1.10&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;.&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> hint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.ca&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/named.rfc1912.zones&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其他的采用默认即可。dig 测试时，如何区分是否是由缓存给答案还是解析后给答案，有些时候不是很好判断，但如果仅仅是测试仅缓存服务器的缓存效果，方法还是很简单的。</p><p>例如，将上述 dns 服务器指向 8.8.8.8，另找一台机器，执行 dig 命令，并明确指定使用该缓存 dns 服务器来帮忙解析。例如，dig 一下 www1.baidu.com 的别名记录。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -t cname www1.baidu.com @10.1.1.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> DiG </span><span class="token number" style="color:rgb(9, 134, 88)">9.11</span><span class="token plain">.4-P2-9.11.4-13.ky10 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> -t cname www1.baidu.com @10.1.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> global options: +cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Got answer:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain">HEADER</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;-</span><span class="token plain"> opcode: QUERY, status: NOERROR, id: </span><span class="token number" style="color:rgb(9, 134, 88)">57653</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> flags: qr rd ra</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUERY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ANSWER: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, AUTHORITY: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, ADDITIONAL: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> OPT PSEUDOSECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> EDNS: version: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> udp: </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUESTION SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">www1.baidu.com.            IN  CNAME</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ANSWER SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www1.baidu.com.     </span><span class="token number" style="color:rgb(9, 134, 88)">3346</span><span class="token plain">    IN  CNAME   www.baidu.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Query time: </span><span class="token number" style="color:rgb(9, 134, 88)">44</span><span class="token plain"> msec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> SERVER: </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token comment" style="color:rgb(0, 128, 0)">#53(10.1.1.2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> WHEN: 六 </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">月 </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain">:10:26 CST </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> MSG SIZE  rcvd: </span><span class="token number" style="color:rgb(9, 134, 88)">61</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>查询消耗了 44 毫秒。再次执行上面的 dig，发现查询时间一定是 0 毫秒，因为是缓存给的答案。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="57配置-dns-转发服务器">5.7、配置 DNS 转发服务器<a class="hash-link" href="#57配置-dns-转发服务器" title="标题的直接链接">​</a></h2><p>配置成了转发服务器，named.conf 里所有的 zone 都将失效(除非配置转发区和空转发区)，也就是不会再做任何解析（包括对根的查询），收到的解析请求全都提交给转发选项里指定的机器，转发选项所指定的机器称为转发器。转发器还可以指定给上一层。</p><p>例如，新添加一台 dns 服务器 10.1.1.3，设置其为转发者，其转发器为 10.1.1.2，如下图。</p><p><img loading="lazy" alt="dns forward" src="/assets/images/dns forward-d9c71faa158bde7e0c64a1933415a9c8.png" width="869" height="384" class="img_ev3q"></p><p>配置转发器的方式极其简单，只需在 10.1.1.3 这台 dns 服务器上 /etc/named.conf 中的 options 中使用一个 forwarders 指令。其实还需加上 forward 指令，只不过现在采取其默认值，所以省略它。/etc/named.conf 内容如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    forwarders </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/named.rfc1912.zones&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这表示将 10.1.1.3 收到的所有查询请求都交给 10.1.1.2 这台转发器，由这台转发器帮忙查询相关请求，然后回复给转发者，由转发者回复给客户端。</li><li>如果要指定多个转发器，这使用分号分隔各转发器地址，如 &quot;forwarders { 10.1.1.3;10.1.1.4; }&quot;。</li></ul><p>示例：前文在 10.1.1.2 上已经配置了 brinnatt.com 域的域数据，例如 <a href="http://www.brinnatt.com" target="_blank" rel="noopener noreferrer">www.brinnatt.com</a> 主机的 A 记录。此时找台客户端，让其 dns 指向转发者 10.1.1.3，然后发起 <a href="http://www.brinnatt.com" target="_blank" rel="noopener noreferrer">www.brinnatt.com</a> 的 A 记录查询请求，如果能返回得到 10.1.1.2 主机上所配置的域数据，则表明转发成功。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -t A www.brinnatt.com @10.1.1.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> DiG </span><span class="token number" style="color:rgb(9, 134, 88)">9.11</span><span class="token plain">.4-P2-9.11.4-13.ky10 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> -t A www.brinnatt.com @10.1.1.3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> global options: +cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Got answer:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain">HEADER</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;-</span><span class="token plain"> opcode: QUERY, status: NOERROR, id: </span><span class="token number" style="color:rgb(9, 134, 88)">64956</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> flags: qr rd ra</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUERY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ANSWER: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, AUTHORITY: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, ADDITIONAL: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> OPT PSEUDOSECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> EDNS: version: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> udp: </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> COOKIE: d2953fe0c499a1c0458b114d616b7b379c62d458aeeaf7ca </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">good</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUESTION SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">www.brinnatt.com.      IN  A</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ANSWER SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www.brinnatt.com.   </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Query time: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> msec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> SERVER: </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3</span><span class="token comment" style="color:rgb(0, 128, 0)">#53(10.1.1.3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> WHEN: 日 </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">月 </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 09:24:07 CST </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> MSG SIZE  rcvd: </span><span class="token number" style="color:rgb(9, 134, 88)">89</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>注意：考虑一种特殊情况，如果转发器无法查询到结果，也就是说转发者获取不到来自转发器的答案，则转发者自己也会去查询。也就是说，如果转发器无法提供答案时，转发者中间会间隔一段等待时间。</em></p><p>当然，还存在一种限制性极大的 &quot;仅转发&quot; dns 服务器，它只转发，即使获取不到转发器的回复，也不会自己去查询。要配置成 &quot;仅转发&quot; dns 服务器，只需加上 &quot;forward only&quot; 指令即可。而前面所说的情况则是 &quot;forward first&quot;，先转发，转发失败时自行查询，只不过这是默认值，可以省略。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    forwarders </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    forward only</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include /etc/named.rfc1912.zones</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>其实，配置成仅转发 dns 服务器时，除了 forward 和 forwarder 指令，其他的一切指令都可以省略，即使是 direcotry 指令。因为仅转发 dns 服务器根本用不上任何区域，所有的查询请求包括 localhost 这样的请求都会转发。所以上述配置可简化为：<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  forwarders </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  forward only</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>也许你已经感受到了，几乎不会去配置仅转发 dns 服务器。实际上，操作系统中设置 dns 指向的地方，就是在设置仅转发功能，例如 /etc/resolv.conf 文件中所设置的 nameserver，这就是仅转发功能。
</li></ul><p>需要注意的一点是，<strong>转发者转发给转发器的查询是递归查询，转发器必须要亲自回复转发者</strong>，也就是说转发者其实就相当于一个客户端。</p><p>其实，上述所述的情况是传统的转发功能：配置在 options 中的转发指令，只能作用于全局，也就是说无论对哪个域的查询，都全部转发出去。在 bind 9.1 之后，<strong>可以配置新的转发功能——转发区，只有指定的区域的查询请求才会转发出去</strong>。</p><p>转发区的配置方式也很简单，不用在 options 中指定 forward，而是在指定的区域内设置其 type 为 forward。例如在 10.1.1.3 上：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/named.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;brinnatt.com&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> forward</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    forwarders </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;.&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> hint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.ca&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/named.rfc1912.zones&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这样，只有查询 &quot;brinnatt.com&quot; 结尾的记录都将转发到 10.1.1.2 上。</li><li>但要注意，是 brinnatt.com 结尾，而不是限制其域为 &quot;brinnatt.com&quot;，所以如果发出 png.img.brinnatt.com 的查询请求，也会被转发，但实际上这是 brinnatt.com 的子域 img.brinnatt.com 中的主机。</li></ul><p>相对应的，还可以设置 &quot;禁转发区&quot;，即指定特定的区域的查询不转发，其他所有区的查询请求都转发走。设置方法有点特殊，是在 options 中设置 forwarders 和 forward 指令(该指令可省略)，并在想要禁转发的区中设置 forwarders 目标为空。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    forwarders </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;brinnatt.com&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    forwarders </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;.&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> hint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.ca&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/named.rfc1912.zones&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>注意：在 options 中设置了转发目标，在 brinnatt.com 中设置了 type master，也接受 slave、stub 类型的区，最重要的是设置了目标为空的 forwarders 指令。这样 brinnatt.com 结尾的查询请求都不会转发走，包括子域内主机 png.img.brinnatt.com 的查询。</em></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="58acl">5.8、ACL<a class="hash-link" href="#58acl" title="标题的直接链接">​</a></h2><p>DNS 配置文件 /etc/named.conf 中支持使用 ACL(access control list)，但在引用 ACL 的时候，必须在其前面已经定义好 ACL。</p><p>定义 ACL 的格式为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">acl </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;acl_name&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">192.253</span><span class="token plain">.254/24</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">.10/24 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 acl<!-- -->_<!-- -->name 是将来在其他地方引用该 acl 的名称。大括号中的是 ip 地址列表，可以是 IP、IP 前缀或已定义的 acl<!-- -->_<!-- -->name。</p><p>此外，还有 4 个预定义的 acl 值：<strong>any、none、localhost(DNS 服务器的任一 IP 地址)、localnets(DNS 服务器任一 ip 地址所在网段)</strong></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="59递归查询详解">5.9、递归查询详解<a class="hash-link" href="#59递归查询详解" title="标题的直接链接">​</a></h2><p>先回顾下递归查询和迭代查询的概念：dns 服务器接收到递归查询请求时，它需要帮忙去找答案，并亲自回复请求者，如果收到的是迭代查询请求，则将自己知道的消息(一般是自己负责的域信息，所以是权威消息)告诉请求者，让请求者亲自去查询。</p><p>由于<strong>dns 解析器发起的查询都是递归查询，所以一般客户端配置 DNS 指向谁就表示找谁帮忙做递归查询。如果 dns 服务器接受它的递归查询请求，则它会去帮助查询，如果 dns 服务器不接受它的递归查询请求，则会将递归查询当成迭代查询看待，让请求者自己去查询。</strong></p><p><strong>另外，允许递归查询的服务器，由于要帮忙查询，所以在递归查询服务器上总是缓存了一些非权威数据，如果是非递归查询服务器，则不用缓存任何数据，只需返回其负责的域的权威数据即可，这对减轻压力的作用是非常大的。</strong></p><p>正如根域 &quot;.&quot; 服务器，它接受来自世界各地的查询请求，如果允许递归，不仅其压力极大，且缓存也会极大。所以正常情况下，根域名服务器是不允许递归查询的。</p><p>dns 服务器对不是自己负责的域，不应该帮别人递归。例如，远程 client 访问 brinnatt.com 域，因为这就是 dnsserver.brinnatt.com 负责的域，而且又必须给答案，所以应该给递归。但是 client 通过 dnsserver.brinnatt.com 来查询 sohu.com，那就不应该给递归，否则 dns 服务器会产生更多流量和压力。</p><p>默认情况下，/etc/named.conf 中隐含了选项 &quot;recursion yes&quot; 和 &quot;allow-recursion {any;}&quot;，也就是说允许递归查询，且是允许所有人发起的递归查询。可以手动配置如何递归，比如仅允许 172.168.10.0/24 网段的主机进行递归查询：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    recursion </span><span class="token function" style="color:rgb(0, 0, 255)">yes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    allow-recursion </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">172.168</span><span class="token plain">.10.0/24</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>如果不想给所有人递归，则将 recursion 设置为 no，关闭递归功能即可。</li><li><strong>不要将非递归查询 dns 服务器设置为转发器，因为转发者转发给转发器的查询是递归查询</strong>。</li><li>使用 &quot;allow-query {}&quot; 指令可以指定允许查询的主机列表，列表外的主机都不允许查询，不仅不允许为客户端做递归查询，也不允许为客户端做迭代查询。</li><li>实际上 options 选项远不止这些，可以使用 man named.conf 获取更多参数帮助。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="510dns-黑名单">5.10、DNS 黑名单<a class="hash-link" href="#510dns-黑名单" title="标题的直接链接">​</a></h2><p>自建的 dns 服务器帮忙查询答案时，有些远程 dns 服务器会返回一些错误、过时或者蓄意欺骗的信息。对于这些有问题的远程 dns 服务器，自建 dns 服务器不应该去查询它们。</p><p>为了让 dns 服务器明确不查询指定的远程 dns 服务器，可以使用：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">server </span><span class="token number" style="color:rgb(9, 134, 88)">10.0</span><span class="token plain">.0.2 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bogus </span><span class="token function" style="color:rgb(0, 0, 255)">yes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于大量远程 dns 服务器黑名单，可以将这些主机放进 blackhole。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    blackhole </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">/8</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token plain">/12</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token plain">/16</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="511配置主从-dns-服务器">5.11、配置主、从 DNS 服务器<a class="hash-link" href="#511配置主从-dns-服务器" title="标题的直接链接">​</a></h2><p>在配置 /etc/named.conf 的 zone 区域时，会指定 type 是什么类型的，常见的有 master、slave、stub、forward、hint 等。</p><p>forward 和 hint 在前文已经介绍过了，stub 在后文介绍子域的时候介绍，此处先介绍主从 dns 服务器，即 master 和 slave 类型。</p><p>在只有一台 dns 服务器时，所有的 dns 解析过程都由这台 dns 服务器负责，压力极大。而且极不安全，因为这台 dns 服务器一垮掉，所有的解析服务都停止，整个网站也就垮了。</p><p>无论是出于负载均衡考虑，还是数据安全可靠的考虑，至少都应该配置 2 台或 2 台以上的 dns 服务器，其中必须有一台是 master 服务器，其余的是 slave 服务器。</p><p>master 和 slave 服务器都可以配置成向外提供解析服务。但 slave 上的区域数据从何而来？不是自行书写区域数据文件而来，而是从 master 服务器上复制而来。从 master 复制区域数据到 slave 的过程，dns 术语称之为 &quot;区域传送&quot;。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5111dns-主从体验">5.11.1、DNS 主从体验<a class="hash-link" href="#5111dns-主从体验" title="标题的直接链接">​</a></h3><p>配置主从的方式很简单，仅仅只需在待设置为 slave 的服务器上设置 zone 类型为 slave，并给定一个 masters 指令指向其所属 master 即可。例如在 10.1.1.3 上安装好 bind 软件后，配置其 named.conf，如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;brinnatt.com&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> slave</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    masters </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;slaves/db.brinnatt.com.slave&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这表示 10.1.1.3 是 10.1.1.2 上 &quot;brinnatt.com&quot; 的 slave。</li><li>注意，上面的示例中使用 file 指令，但实际上 <strong>slave 是可以不要区域数据文件的</strong>，它从 master 上传送复制区域数据后会将其缓存下来，并从缓存中提供查询解析服务。</li><li><strong>如果在 slave 区域内指定 file 指令，则表示在区域传送时还将备份一份数据到 file 指定的文件中</strong>，所以该文件对 named 组要求有写权限。在安装 bind 后，在 /var/named 目录下自动生成了一个 /var/named/slaves 目录，其属组和权限已经设置好，正适合放置区域传送的<strong>备份文件</strong>。如果自定义存放备份文件的路径，则其存放目录属组要求为 named，且属组有 rwx 权限。</li></ul><p>重启 slave 服务器。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart named</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>slave 每次重启都会自动完成一次区域传送。</strong></li></ul><p>查看 master 和 slave 上的日志信息：</p><p>在 master 上查看日志：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tail /var/log/messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 01:55:31 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">6455</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: client </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3</span><span class="token comment" style="color:rgb(0, 128, 0)">#41813 (brinnatt.com): transfer of &#x27;brinnatt.com/IN&#x27;: AXFR started</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 01:55:31 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">6455</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: client </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3</span><span class="token comment" style="color:rgb(0, 128, 0)">#41813 (brinnatt.com): transfer of &#x27;brinnatt.com/IN&#x27;: AXFR ended</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>AXFR 表示完全区域传送，还有增量区域传送 IXFR。<strong>完全区域传送是传送整个区域数据文件，增量区域传送则只传送区域数据文件中发生改变的部分。</strong></li><li>对于完全区域传送和增量区域传送，在 bind9 上可以完全不用配置，一切都可采用默认值，它会<strong>自动决定何时完全、何时增量传送</strong>。</li></ul><p>在 slave 上查看日志：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tail /var/log/messages </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain">:55:31 localhost named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">47150</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: zone brinnatt.com/IN: Transfer started.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain">:55:31 localhost named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">47150</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: transfer of </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;brinnatt.com/IN&#x27;</span><span class="token plain"> from </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token comment" style="color:rgb(0, 128, 0)">#53: connected using 10.1.1.3#41813</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain">:55:31 localhost named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">47150</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: zone brinnatt.com/IN: transferred serial </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain">:55:31 localhost named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">47150</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: transfer of </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;brinnatt.com/IN&#x27;</span><span class="token plain"> from </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token comment" style="color:rgb(0, 128, 0)">#53: Transfer status: success</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain">:55:31 localhost named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">47150</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: transfer of </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;brinnatt.com/IN&#x27;</span><span class="token plain"> from </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token comment" style="color:rgb(0, 128, 0)">#53: Transfer completed: 1 messages, 8 records, 226 bytes, 0.001 secs (226000 bytes/sec)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain">:55:31 localhost </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">/bin/bash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">systemctl restart named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">return</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">code</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">, execute success by </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">uid</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> from </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">pts/1 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>注意：这样配置的主从服务器只会完全区域传送。原因稍后解释。</em></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5112dns-主从完整配置">5.11.2、DNS 主从完整配置<a class="hash-link" href="#5112dns-主从完整配置" title="标题的直接链接">​</a></h3><p>既然 slave 也是域数据解析的负责人(尽管它是从的)，因此<strong>在 master 上的区域数据文件中应该添加 slave 的 ns 记录，否则外部没法找到 slave 这个不完整的 dns 服务器来帮忙解析，且 master 也无法找到 slave</strong>。</p><p>另外，不在 master 区域数据文件中添加 slave 的 ns 记录，其只能进行完全区域传送，无法增量区域传送。因为不在主服务器的区域文件中添加从服务器的 ns 记录，将不表明这台 slave 是 DNS 服务器。</p><p>之所以不添加 ns 记录时 slave 也会进行完全区域传送，仅仅是因为 slave 服务器做了指向 master 的配置，所以只能每次 slave 上启动 named 时才会实现完全区域传送，master 重启 named 时是不会进行区域传送的(因为 master 找不到 slave)。</p><p>所以，要配置完整的主从服务器，只需在前面的基础上，再在 master 的区域数据文件中加上 slave 的 ns 记录和对应的 A 记录即可，别忘了修改 SOA 记录的序列版本号。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/db.brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 6h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@           IN  SOA dnsserver   xyz </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> serial num</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            3h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> refresh </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            1h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> retry </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            1w    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expire </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            1h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> negative </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@           IN  NS  dnsserver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@           IN  NS  dnsslaver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsslaver   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www         IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ftp</span><span class="token plain">         IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.117</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mydb        IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.118</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www1        IN  CNAME   www</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启 master dns 服务以重新编译区域数据文件。重启 master 时，master 会发送 notify 信息给 slave，通知 slave 来复制区域数据。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart named</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># tail /var/log/messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 06:41:24 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">12105</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: zone </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">.in-addr.arpa/IN: loaded serial </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 06:41:24 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">12105</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: zone localhost.localdomain/IN: loaded serial </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 06:41:24 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">12105</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: zone </span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token plain">.0.127.in-addr.arpa/IN: loaded serial </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 06:41:24 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">12105</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: zone localhost/IN: loaded serial </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 06:41:24 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">12105</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: zone brinnatt.com/IN: loaded serial </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 06:41:24 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">12105</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: all zones loaded</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 06:41:24 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">12105</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: running</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 06:41:24 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">12105</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: zone brinnatt.com/IN: sending notifies </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">serial </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 06:41:24 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">12105</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: client </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3</span><span class="token comment" style="color:rgb(0, 128, 0)">#57645 (brinnatt.com): transfer of &#x27;brinnatt.com/IN&#x27;: AXFR-style IXFR started</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Oct </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> 06:41:24 arm64v8 named</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">12105</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">: client </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3</span><span class="token comment" style="color:rgb(0, 128, 0)">#57645 (brinnatt.com): transfer of &#x27;brinnatt.com/IN&#x27;: AXFR-style IXFR ended</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>由于配置了完整的主从结构，且修改了 master 区域数据文件上的序列号，所以区域传送的类型是增量传送。</li><li><strong><em>注意：主从服务器都应该放行防火墙，或者关闭防火墙，否则很有可能传送失败。</em></strong></li></ul><p>回到 slave 上，查看区域数据文件和日志信息：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/slaves/db.brinnatt.com.slave </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ak󿅔brinnattcom</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">  dnsservebrinnattcomxybrinnattcomo*0 :VTbrinnattcom  dnsservebrinnattcom dnsslavebrinnattcom2T</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token variable" style="color:rgb(9, 134, 88)"> dnsservebrinnattcom </span><br></span><span class="token-line" style="color:#000000"><span class="token variable" style="color:rgb(9, 134, 88)">2T</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token plain">    dnsslavebrinnattcom </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">,T</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token variable" style="color:rgb(9, 134, 88)">ftbrinnattcom </span><br></span><span class="token-line" style="color:#000000"><span class="token variable" style="color:rgb(9, 134, 88)">u-T</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token plain">mydbrinnattcom </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">v,T</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token variable" style="color:rgb(9, 134, 88)">wwbrinnattcom </span><br></span><span class="token-line" style="color:#000000"><span class="token variable" style="color:rgb(9, 134, 88)">t</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token variable" style="color:rgb(9, 134, 88)">T</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token plain">wwwbrinnattcomwwbrinnattcom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># Xshell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-bash: Xshell：未找到命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>我们现在实验的 DNS 软件包版本是 BIND 9.11.4-P2-9.11.4-13.ky10，BIND 9.9.X 后默认 DNS 从服务器同步的文件是二进制文件，即 raw 格式，主要目的是提高加载性能。实际工作中该格式不便于移植，所以官方提供两种方式将 raw 格式转换成我们常用的 text 标准文本格式。<ul><li><p>方式一：使用 named-compilezone 命令</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># named-compilezone -f raw -F text -o newfile brinnatt.com /var/named/slaves/db.brinnatt.com.slave </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone brinnatt.com/IN: loaded serial </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dump zone to newfile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.done</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat newfile </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.                     </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN SOA  dnsserver.brinnatt.com. xyz.brinnatt.com. </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10800</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3600</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">604800</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.                     </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN NS   dnsserver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.                     </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN NS   dnsslaver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver.brinnatt.com.           </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN A    </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsslaver.brinnatt.com.           </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN A    </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ftp.brinnatt.com.                 </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN A    </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.117</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mydb.brinnatt.com.                </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN A    </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.118</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www.brinnatt.com.                 </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN A    </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www1.brinnatt.com.                </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> IN CNAME    www.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>方式二：修改 slave 从服务器相关的配置文件（/etc/named.conf ），添加如下一行：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/named.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    masterfile-format text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)"># slave从服务器上使用该指令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/named.rfc1912.zones&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启从服务器：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart named</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看区域数据文件，已自动转换成 text 格式：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/slaves/db.brinnatt.com.slave </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$ORIGIN</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> hours</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com        IN  SOA     dnsserver.brinnatt.com. xyz.brinnatt.com. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token number" style="color:rgb(9, 134, 88)">111</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> serial</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token number" style="color:rgb(9, 134, 88)">10800</span><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> refresh </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> hours</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token number" style="color:rgb(9, 134, 88)">3600</span><span class="token plain">       </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> retry </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> hour</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token number" style="color:rgb(9, 134, 88)">604800</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expire </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> week</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token number" style="color:rgb(9, 134, 88)">3600</span><span class="token plain">       </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> minimum </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> hour</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        NS      dnsserver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                        NS      dnsslaver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$ORIGIN</span><span class="token plain"> brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver               A       </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsslaver               A       </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ftp</span><span class="token plain">                     A       </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.117</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mydb                    A       </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.118</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www                     A       </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www1                    CNAME   www</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@tarmdns ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ul><p>还可以配置 slave 从另一个 slave 上复制区域数据，这种情况下，master 是 slave1 的主，slave1 是 slave2 的主。如下图：</p><p><img loading="lazy" alt="multi-slaves" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAhQAAACJCAYAAAB0HaFRAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAA3KSURBVHhe7du/iyxZFQfw/QNETA3MzDYzEgRTFzQwUzASRDATNxREMRU2MnNTMXBRREHYQMTAQJYNFBRcRDbQRNDAyKTd77w56/V6q3tmblW9etbnA5fuqbr1o+ucOnOq37yXLgAAkzQUAMA0DQUAME1DAQBM01AAANM0FADANA0FADBNQwEATNNQAADTNBQAwDQNBQAwTUMBAEzTUAAA0zQUAMA0DQUAME1DAQBM01AAANM0FADANA0FADBNQwEATNNQAADTNBQAwDQNBQAwTUMBAEzTUAAA0zQUAMA0DQUAME1DAQBM01AAANM0FADANA0FADBNQwEATNNQAADTNBQAwDQNBQAwTUMBAEzTUAAA0zQUAMA0DQUAME1DAQBM01AAANM0FADANA0FADBNQwEATNNQAADTNBQAwDQNBQAwTUMBAEzTUAAA0zQUAMA0DQUAME1DAQBM01AAANM2bSi++sanjAOO5+bNNy+XV165/2Hggx+8XN5663L58pfvFyx47bX/nfPDH14un/jE5fLuu/cLBvp1r7/+v/vJ8T/ykWevk0bX3nj+47mR/8YBxpY2byg4lifHJMUoBeuhY1QUq+gteek+HT/3uWdjycsvP9tXK8f71rfufxioQpliXPKZcpycUxXbvG/nTJD/xyP/5f+ZbR0TDcXJTMWkCt41faFrPbSgxlJRq33kNYU17zPydNf+PCq6eULMvDyZtV599VlBzeu1Qv5I8v945L/8P7OtY6KhOJlVCmqK3ahwZll9bTtSxTDqyagd2X/7c4piK0UvT1n9sWv5Q2TbKtZtAc7oj58CPEH+H4/8l/9ntnVM7u+QbUio41mloNaTTv8UlSLULytZlwKW7fJ+9PXsraKYr3VzDn1BzTFHXzE/Rs6p3+8k+X888n+B/D+FrWOioTiZVQpqpKimQFYBTTG6VRAzJ4Ur8lSV9zWyn7xmeeSP19onpKzP/nPMOlZtm/ftzzVqbrTLR09eWV7HXon8Px75/96Q/6e1dUw0FCezWkGNFKAUrfzba1u8lrQFNep9tq9/v82cFLy2OFfxzfK8tsfJujz1PVQdM0+IeV+jnhzbMfnUJ/+PR/7fH1P+n9LWMdFQnMyqBTVS0Orp6JZbBTUjT2IpdkvFLNu0BTXbPKbwjc4znyGfLU+Feb8S+X888l/+n9nWMdFQnMzqBTUFME9nGXl/TVtQU7jqqSgFOYUx6/OUln2NvpaNvqBmH5mf5f0Y/XFclvdSkHP8FPLsa+mP6h5J/h+P/H9veU/+n8bWMdFQnMyqBbWKaYpjFchrRbUKagpW/1/XSopr9rkk27cFdSRPWkvn0RfUKqIl+845LBX0R5D/xyP/5f+ZbR0TDcXJrFJQUzzrSSrvS4pQimpfLKuAZpvsI9ulkLXr6ucUs3o/MiqoVfzqvK4V9SqoOWbeZ7SfIbJ9PsdkUZX/xyP/5f+ZbR0TDcXJTBfUeoJZ+vfWFKOsb6Uw1VNTtslrimrmpaDl69YsSzGsIhcpeim4raxrC2rW1zbZZ/azpM69zuNa4a45E+T/8ch/+X9mW8dEQ3Ey0wU1RSaF7pq+CPayvi1WeV8FMe9TfFNk83N/rL6glizL/BTlUSHM8qzPvKV9t3KOmTva1wPJ/+OR//L/zLaOiYbiZKYLagraQ0eK2ENkXlsIq8Dma9e+oOUPyK59FZtiOfqr9/6JK8UyhTuf6dpQUP+vyP978v+Uto7JexmzHQl1PGKyH9f6eMRkP6718WwdEw3FyYjJflzr4xGT/bjWx7N1TDQUJyMm+3le1/p7f37z8tKPP3v3+iJ44y+/vnz0za/cnfPW5P9+5P917/zzr5cvvf3dy4d//sW7883IffCN33//fsb6to6JhuJkxGQ/CuptKahVTDO2Jv/3I/+XpZlI8/CBn37+roHIuWZ8/jffuTv3T//62/cz17V1TDQUK/rYL752VyCPTEHdj4K67Jd/+93730rknqlCujX5vx/5vywNQ5qJ3Ae9r/729bvzzzd3a9s6JhqKFVVxPDIFdT8K6rKcW4pqFdT6pmJr8n8/8n9ZmumlbyHy7cVWv0u2jomGYiVbJsGarsXk7//65+Xtf/zp/idmKagPd4SGQv6vS/4/nYZiYI2Tz0XNPyXkF3a+Fm3/gOWTv/r6+0843/njj+/m1bp0gFk20s/NV0/Z1+grpizLupqb4+c8cj6l1vWjT4gkePaV42V9XtuntFa2zbEiX4HVNrM3ySgmKaTf/MMPLh/62RfuXlnH2jdvcq6+Kq38ae+BslRQa/v+j8D6PM29Ubm3pM6jlfPo95/ze0jO5hwyf2vyfz/y/+H538p5Ztv+vNawdkx6L0xDUSPNQAJUBSjBy7IEt/64JT/Xv8/2wcy6NtDt/OwjwSxJkEramptjZFkSp2R5/btXltfcNtGzXb++PW7fzNTny5z2c7fn9xRtTNpCmmNlKKjrWfvmTa5kVC5U/vTFL+sSy7y2KtfaPwKrPGuLV+Xq0r/hVsFLY10yN/tuczUj907mZp/X1HlsTf7vR/4/PP9bdU5Lx5+xdkx6L0RDkYubQPVq3ejiJ+gJcALayjZJrF5++Wc/aQxKNQn9L/EkR/bdLk/yZG6bmKUak9G67CPn03+++mw5//74MxKTUSGtoaCuZ82bN/md+KRYtSpvk3+lcrFdlnnVfPdGT1v5uS2YrSq4bcM8yuFS+7+Wx5XvW5P/+5H/zzwk/0s1Jv3vrbWsGZORF6ahaJOjVOIsXfwEuO9er+mT4jFFrs5l1DQsNSZl1BHXsR/T2T7EV954ZVhIjfXHx3/0mfurPm9UJJc8Zm6kyPbzR0W29PfJUrEvVfTbZr23V0Mh//cb8v+Zh+R/1MNlfmet+RDZ0lDcKDRZN/olHo8tUkmSNlEqMdOwtN3oSM0dnUv2mURZUtu2CVnn3jYZa6iYvPbOT+723w9PaOtZ8+ZNgUmBSx7dKpSVT7fmldH8pSJZxbFtdCtXrxXBrF964ovH3qtPJf/3I///I+uv5X+Ol8+Wz7h2zW+tGZORUzYUSZx0oAlg1rejbSgiiZMgZ106xyTFKOCVlKNzyT7bYyyNdttbn/up+pj0hVVBXc/aN2/yLjmYOCUnk8Ojp6JRgYwUvDwlJR8rp9vRz8+x+m//kv/ZtlW5emv091Zrq3zvyf/9yP//Hkv5n8+VfeZ4WzYTsXZMeqdrKJKEFdwkV5KoRhqMpaAncZNM1YRkP61sv3Qu2Wd11tdG+y3Irc/9VEsxqcKqoK5nq5s3RSf5kbxKzJJb7dNRcinL81qqaGUkj5PPlXe5D/r5UcvbfafoZftW5Wrtb2lcK5Zb5XtP/u9H/v/3GOV/nVf/GbayVUzKqRqKBO/a/CToUkPRqr95aL/2SsIs7Tv7TCI+xq3P/VS3YuL/4a9n65s3qiC1DW7lYl5LnrQyb1S0RvMjc7M8hTVShPNzXxgrV2/9s+A1W+V7T/7vR/5fV+e+VzMRW8fkVA1F/dwnTskv/Yc0FNEft5JydC7V6T4m4fpzX8seNznP7HWt+0Z4VCDz81JuV4M8ui9SiFPw+vetFMZs3zbYj7VVvvfk/37k/3XZVxqKmUb8sbaOyakaikqcdJq9+qXfJl0CPtp3da5tAlUSj+YnYZI4SciR7CfHbbvUW5/7qRTU/ax5rfM161JBTJ7eekJLszwqhsm5rOvnl/apLK9LRTP7zn5GT1rZNuvzumSrfO/J//3I/2dG+V/5PvpdtKWt8/9UDUWCnV/sCXwSIwmUkWRMwJOwbdLW9nmtuUmApeSpr69qbkbJ8bKv7D/7qPU5dpb3iXrrcz+VgrqfNa91ciX5kKa0cicjP2d5W6xqbl5L5VPyrbZNziWPU6z7+a3MSV4nv0cFM3L80b2V42Z5W/Aj82tORt0H7bL2M61F/u9H/o/zv/09VPNG40XM/9P9UWa+LUhwE9CsS1AzL0HuG4pIciSZMjejkmP0NVUaheyv5vZ/vJMkqRugRt0gvVuf+6kU1P2sfa0fmj/5Oev65X0u17ZL80sV3LYojvT3VkaOl+P2cp/VnKXR34trkP/7kf/j/K/j3RovYv4fvqFgXWKyH9f6eMRkP6718WwdEw3FyYjJflzr4xGT/bjWx7N1TDQUJyMm+3Gtj0dM9uNaH8/WMdFQnIyY7Me1Ph4x2Y9rfTxbx0RDcTJish/X+njEZD+u9fFsHRMNxcmIyX5c6+MRk/241sezdUw0FCcjJvtxrY9HTPbjWh/P1jHRUJyMmOzHtT4eMdmPa308W8dEQ3EyYrIf1/p4xGQ/rvXxbB0TDcXJiMl+XOvjEZP9uNbHs3VMNBQnIyb7ca2PR0z241ofz9Yx0VCcjJjsx7U+HjHZj2t9PFvHRENxMmKyH9f6eMRkP6718WwdEw3FyYjJflzr4xGT/bjWx7N1TDQUJyMm+3Gtj0dM9uNaH8/WMdm8oTCON9jH6Nobz3+wj9G1N57/2NKmDQUAcA4aCgBgmoYCAJimoQAApmkoAIBpGgoAYJqGAgCYpqEAAKZpKACAaRoKAGCahgIAmKahAACmaSgAgGkaCgBgmoYCAJimoQAApmkoAIBpGgoAYJqGAgCYpqEAAKZpKACAaRoKAGCahgIAmKahAACmaSgAgGkaCgBgmoYCAJimoQAApmkoAIBpGgoAYJqGAgCYpqEAAKZpKACAaRoKAGCahgIAmHS5/BsruAg/F499QwAAAABJRU5ErkJggg==" width="532" height="137" class="img_ev3q"></p><p>配置方式一样很简单，只需将 slave2 主机的 named.conf 中的 zone 区域配置成如下格式：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;domain&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> slave</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    masters </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> slave1_ip </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>注意：master 的区域数据文件中应该制定 slave2 的 ns 记录和 A 记录。</em></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5113何时进行区域传送">5.11.3、何时进行区域传送<a class="hash-link" href="#5113何时进行区域传送" title="标题的直接链接">​</a></h3><p>有 3 种情况会进行区域传送动作：</p><ol><li>slave 重启。此时 slave 主动去 master 上获取区域数据。</li><li>master 重启。此时 master 会发送 notify 消息给 slave。但要求区域数据文件中定义了 slave 的 ns 记录及其 A 记录，否则找不到 slave，也就联系不上 slave。</li><li>区域数据文件 SOA 记录中定义的 refresh 时长到了。也就是说正常运行时，每隔一段时间，slave 都会主动去联系 master，并从其上复制区域数据。</li></ol><p>在 named.conf 中可以定义 notify 发送给谁以及接收谁的 notify，这个细节和过程篇幅稍大，下一节说明。此处先说明 &quot;allow-transfer&quot; 指令的用法。例如：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;movie.edu&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;db.movie.edu&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     allow-transfer </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">192.249</span><span class="token plain">.249.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">192.253</span><span class="token plain">.253.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">192.249</span><span class="token plain">.249.9</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">192.253</span><span class="token plain">.253.9</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认情况下，allow-transfer 的值为 any，表示允许任何人都可以从此主机上执行区域传送。实际上，<strong>应该设置主 dns 服务器只允许 slave 服务器来区域传送，并设置 slave 服务器不允许任何人区域传送</strong>，这样就最大程度保证了区域数据不泄漏。</p><p>可以手动使用 dig 命令强制区域传送，只需使用 -t 指定区域传送的类型即可，如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">dig</span><span class="token plain"> -t AXFR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">dig</span><span class="token plain"> -t </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ixfr</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">N</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在指定增量区域传送时，需要指定序列号，只有比 N 大的序列号才会传送。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5114notify-通知">5.11.4、notify 通知<a class="hash-link" href="#5114notify-通知" title="标题的直接链接">​</a></h3><p>主 DNS 服务器可以通知从 DNS 服务器进行区域传送。</p><p>notify 是这样工作的：<strong>当主 DNS 服务器重启了 DNS 服务时，则通知所有 slave DNS 服务器来更新区域数据。</strong></p><ul><li>有些地方模糊地说 SOA 序列号发生改变也会发送 notify，其实不然，因为区域数据文件需要编译加载到内存，不重启 named，即使改变了序列号也无效。</li></ul><p>它是这样判断哪些是主 DNS 服务器哪些是从 DNS 服务器的：<strong>找到区域数据文件中的所有 NS 记录，并排除本机以及 SOA 记录中 MNAME 的那个服务器(SOA 记录的 MNAME 列即 IN 关键字后的一列，一般就是主 DNS 服务器)，剩余的都是从 DNS 服务器。</strong></p><p>主 DNS 为每个自定义的区都发送 notify 声明给所有从服务器，告知其哪些区改变了，slave 服务器接收到 notify 声明后响应主 DNS 服务器告知它已经收到了通知，然后 slave 服务器向主 DNS 服务器发起查询，以确定 notify 声明中所通告的区的 SOA 记录是否真的发生了改变，如果 SOA 发生了改变，则进行区域传送，如果没有改变则不进行传送。</p><p>为什么从 DNS 服务器接收到 notify 声明后还要再次查询主服务器上 SOA 记录来确认呢？第一是因为要比较序列号，决定是否要传送，以及要完全传送还是增量区域传送，第二是因为有些人可能会发送假冒的 notify 声明给从 DNS 服务器，从而导致多余的区域传送。</p><p>在 bind 9 中，<strong>从 DNS 服务器收到 notify 声明后并进行了区域传送后，从 DNS 服务器之间还会各自发送 notify 给对方，因为有些更低层次的从服务器不会接受主 DNS 服务器发送的 notify。</strong></p><p>图例1：movie.edu 的主 DNS 服务器为 terminator.movie.edu，还有两台从服务器分别为 wormhole.movie.edu 和 zardoz.movie.edu，它们都是 movie.edu 域的权威服务器，在该域的区域文件中都有 NS 记录。</p><p><img loading="lazy" alt="dns notify" src="/assets/images/dns notify-d36e030b7645fb724c63a82170524c36.png" width="413" height="334" class="img_ev3q"></p><p>当 terminator.movie.edu 重启了 named 服务时，该机器会发送 notify 声明给 wormhole.movie.edu 和 zardoz.movie.edu，当这两台从服务器进行了区域传送后，它们还会互发 notify 声明给对方，但是由于它们都不是对方的主 DNS 服务器，所以会忽略对方发送的 notify 声明。</p><p>图例2：a 是某个区域的主 DNS 服务器，b 和 c 都是该区域的从 DNS 服务器，但是 b 是 a 的从，c 是 b 的从，所以在这里，SOA 记录中 mname 列代表的机器是 a。</p><p><img loading="lazy" alt="dns notify1" src="/assets/images/dns notify1-49a7564b4974d6ad262faeaec9038be7.png" width="433" height="375" class="img_ev3q"></p><p>当 a 重启 named 时，发送 notify 声明给除了本机和 SOA 中的 mname 代表的机器外的 b 和 c， b 和 c 都会收到notify，但是 c 会忽略 a 的 notify 信息，因为 a 不是它的主 DNS 服务器，它只会接受 b 发送的 notify。</p><p>而 b 收到 a 的 notify 后会从 a 上进行区域传送，传送完毕后发送 notify 给除了本机和 a(因为它是 SOA 记录中 mname 列的值)之外的机器，即只发送 notify 给 c，c 收到 b 的 notify 后向 b 发起查询确认是否需要进行传送，传送完毕后继续发送 notify 给除了本机和 a 之外的机器即 b 机器，b 收到 c 的 notify 信息后对其忽略，因为 c 不是它的主 DNS 服务器。</p><p>bind 9 中，notify 默认是打开的，注意 notify 是写在主 DNS 服务器的 named.conf 中的，它的作用对象默认是所有的从服务器。使用下面的语句可以关闭：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    notify no</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也可以将 notify 的开和关字句写在某个区域中，这样该设置会覆盖全局配置。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;fx.movie.edu&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;db.fx.movie.edu&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    notify no</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>还可以使用 also-notify 来定义 notify 列表，这样除了会发送 notify 通知给从服务器还会发送给列表中定义的机器。also-notify 字句可以写在某个区中，也可以写在全局配置 options 字句中。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;fx.movie.edu&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> slave</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;bak.fx.movie.edu&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    notify </span><span class="token function" style="color:rgb(0, 0, 255)">yes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    also-notify </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15.255</span><span class="token plain">.152.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认从服务器只接受来自其主 DNS 服务器的 notify 信息，非主 DNS 服务器的信息都会忽略，但是可以使用 allow-notify 字句定义可以接受其他从服务器的 notify 信息。例如 a 是 b 和 c 的主，如果在 c 上定义 <code>allow-notify { b_IP; };</code>，那么它也会接受 b 的 notify 信息。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5115区域文件备份的重要性">5.11.5、区域文件备份的重要性<a class="hash-link" href="#5115区域文件备份的重要性" title="标题的直接链接">​</a></h3><p>在前面定义 slave 时说过，其实 zone 中的 file 指令是可以省略的，因为 slave 从 master 复制的区域数据是存放在缓存中的。如果明确指定了 file 指令，则表示复制区域数据时，还将其备份到指定文件中。</p><p>这个区域数据备份文件非常重要，其重要性体现在 slave 联系不上 master 时。当 slave 重启了 named 服务或者 refresh 时间到了，但又联系不上 master 时，slave 就缺少了区域数据，也就没法向外提供解析服务。这意味着，dns 服务完全垮了。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="512-rndc-控制-dns-服务器">5.12、 rndc 控制 dns 服务器<a class="hash-link" href="#512-rndc-控制-dns-服务器" title="标题的直接链接">​</a></h2><p>rndc 是远程控制 DNS 服务器的工具，默认在装 bind 时已经装好。</p><p>控制 dns 服务器实际上是通过特殊的通道给 dns 服务程序发送控制消息，在 bind9 上只支持 tcp 端口号类型的控制通道，所以待控制的 dns 服务器上需要开启好一个端口号。这个端口号是通过 /etc/named.conf 中的 controls 指令来设置的。</p><p>rndc 有几个很好的命令工具，如清空 DNS 缓存的命令 rndc flush，该命令还可以指定清空哪个域的缓存。此外还有 rndc dumpdb 可以查询缓存等功能，这些功能无需配置就可直接使用。但有些 rndc 的功能需要配置后才能使用，例如控制 dns 服务器。</p><p><img loading="lazy" alt="rndc" src="/assets/images/rndc-93692995b4138bde33fb96399f35a485.png" width="422" height="320" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5121controls-指令">5.12.1、controls 指令<a class="hash-link" href="#5121controls-指令" title="标题的直接链接">​</a></h3><p>在 /etc/named.conf 中，可以使用 controls 指令来设置接收控制消息的通道，以及允许控制本机的控制者。定义方式如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">controls </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    inet local_ip port PORT_NUM  allow </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> control_ip_list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> keys </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rndc-key&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上述格式中：</p><ol><li>local<!-- -->_<!-- -->ip 和 PORT<!-- -->_<!-- -->NUM 设置的是 dns 服务器开启的 tcp 通道，表示监听在本机某个 IP 地址 local<!-- -->_<!-- -->ip 上的 PORT<!-- -->_<!-- -->NUM 端口上。</li><li>allow 关键字定义允许连接本通道的主机列表，也就是限定谁能控制本机 dns 服务器。</li><li>keys 关键字定义的是连接本通道时需要进行密钥认证，只有认证通过的才能成功连接通道。这个 key 在后面介绍 rndc 时会说明。</li></ol><p>其中 local<!-- -->_<!-- -->ip 可以使用 <code>*</code> 表示监听在本机所有地址上，port 可以省略，默认监听端口为 953。另外，key 可以放在某个文件中，然后使用 include 指令导入到 /etc/named.conf 中。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5122控制端生成-rndcconf">5.12.2、控制端生成 rndc.conf<a class="hash-link" href="#5122控制端生成-rndcconf" title="标题的直接链接">​</a></h3><p>使用工具 rndc-confgen 可以生成 rndc 的配置文件 rndc.conf，同时也会生成一个 md5 的 key。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rndc-confgen &gt; /etc/rndc.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个命令在远程连接工具上执行可能会很慢，在 Linux 机器本身执行会很快。解决办法是创建一个随机数文件，然后使用 rndc-confgen -r 指定随机数文件。</p><p>可以使用安装 bind 时生成的 genrandom 工具创建随机数文件：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 其中 2 表示 b.ran 的大小为 2kB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># genrandom 2 /tmp/random.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后再生成 rndc.conf 就很快了：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rndc-confgen -r /tmp/random.txt &gt; /etc/rndc.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看 rndc.conf 里的内容：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/rndc.conf </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Start of rndc.conf                    # rndc.conf开始</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">key </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rndc-key&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    algorithm hmac-md5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    secret </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;QDCyDaU8El7quzv3vB3z9A==&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># rndc-confgen生成的密钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default-key </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rndc-key&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default-server </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default-port </span><span class="token number" style="color:rgb(9, 134, 88)">953</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># End of rndc.conf                      # rndc.conf结束</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 上面一段是/etc/rndc.conf的配置。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 下面一段是复制段，需要复制到待控制的dns服务器的named.conf中，并按需修改controls指令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Use with the following in named.conf, adjusting the allow list as needed:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># key &quot;rndc-key&quot; {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   algorithm hmac-md5;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   secret &quot;QDCyDaU8El7quzv3vB3z9A==&quot;;    #这个和上面的密钥是相同的，能够配对</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># };</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># controls {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   inet 127.0.0.1 port 953</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       allow { 127.0.0.1; } keys { &quot;rndc-key&quot;; };</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># };</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># End of named.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的 /etc/rndc.conf 文件中分为两段，一段是保留在 rndc.conf 中的，另一段是需要复制到待控制机器的 named.conf 中的。为了方便称呼，下文将以 &quot;复制段&quot; 来表示需要复制的段。</p><p>以下是 /etc/rndc.conf 的配置说明：</p><ol><li>options 段用于配置默认项。可以配置的指令包括 default-server、default-port、default-key，表示当没有任何地方指定这些项的值时将采用这些默认值。</li><li>server 段用于配置待控制的 dns 服务器。server 关键字后接的是 dns 服务器的主机名或 ip 地址。在此段落内，可以配置的指令包括：key、port、addresses。<ul><li>key 表示连接此 server 时将使用该 key 进行配对；</li><li>port 表示要连接的 dns 服务器的 rndc 端口号；</li><li>addresses 指定要连接的 dns 服务器地址，当使用了该指令时将替代 server 关键字后的主机名或 ip 地址，addresses 后可以紧跟着端口号。</li></ul></li><li>key 段定义 key 值。只有两个指令，一个是 algorithm，目前只支持 hmac-md5，另一个指令是 secret，表示该 key 段所使用的 key。secret 段加密的 key 可以使用 rndc-confgen 生成，只需使用不同的随机数即可。</li></ol><p>以下是在 10.1.1.1 上设置的 rndc.conf，用于控制 10.1.1.2 和 10.1.1.3 这两台 dns 服务器。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/rndc.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Start of rndc.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">key </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rndc-key&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    algorithm hmac-md5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    secret </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;QDCyDaU8El7quzv3vB3z9A==&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">server localhost </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    key  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rndc-key&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">server </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    key  </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rndc-key&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    port </span><span class="token number" style="color:rgb(9, 134, 88)">953</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">server </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    key </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rndc-key&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    port </span><span class="token number" style="color:rgb(9, 134, 88)">953</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default-key </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rndc-key&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default-server </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default-port </span><span class="token number" style="color:rgb(9, 134, 88)">953</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># End of rndc.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Use with the following in named.conf, adjusting the allow list as needed:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># key &quot;rndc-key&quot; {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   algorithm hmac-md5;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   secret &quot;QDCyDaU8El7quzv3vB3z9A==&quot;;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># };</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># controls {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   inet 127.0.0.1 port 953</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       allow { 127.0.0.1; } keys { &quot;rndc-key&quot;; };</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># };</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># End of named.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后只需将上述 &quot;复制段&quot; 复制到 10.1.1.2 和 10.1.1.3 主机的 /etc/named.conf 中，并稍作修改，如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">key </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rndc-key&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    algorithm hmac-md5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    secret </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;QDCyDaU8El7quzv3vB3z9A==&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">controls </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    inet * port </span><span class="token number" style="color:rgb(9, 134, 88)">953</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    allow </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> keys </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rndc-key&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后重启待控制端的 named 服务。另外，为了控制本地主机，还应该复制到本机的 /etc/named.conf 中并做修改，然后重启 named，当然，如果不用控制本机则无需配置。</p><p>然后使用 rndc 去测试是否能控制远程 dns 服务器：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rndc -c /etc/rndc.conf -s 10.1.1.2 status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version: </span><span class="token number" style="color:rgb(9, 134, 88)">9.9</span><span class="token plain">.4-RedHat-9.9.4-74.el7_6.1 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">id:8f9657aa</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CPUs found: </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">worker threads: </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">UDP listeners per interface: </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">number of zones: </span><span class="token number" style="color:rgb(9, 134, 88)">102</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">debug level: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xfers running: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xfers deferred: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">soa queries </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> progress: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">query logging is OFF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">recursive clients: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">/0/1000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tcp clients: </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">/150</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">server is up and running</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这表示控制成功。如果控制失败，可以从以下几个方面找原因：<ul><li>版本不一样可能会出问题。</li><li>key 无法配对。</li><li>时间未同步。</li><li>key 已经失效。</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5123rndc-命令">5.12.3、rndc 命令<a class="hash-link" href="#5123rndc-命令" title="标题的直接链接">​</a></h3><p>rndc 命令功能非常强大，有很多很好用的功能。此处只列出几个常用的命令，更多的用法可以自行探索。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rndc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Usage: rndc </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-b address</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-c config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-s server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-p port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-k key-file </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-y key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-r</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">-V</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">command</span><span class="token plain"> is one of the following:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  reload        Reload configuration </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> and zones.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  reload zone </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">class </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Reload a single zone.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  notify zone </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">class </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Resend NOTIFY messages </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the zone.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  reconfig      Reload configuration </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> and new zones only.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  stop          Save pending updates to master files and stop the server.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  flush         Flushes all of the server&#x27;s caches.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  status        Display status of the server.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生产应用环境当中，手动配置 DNS 思路更加清淅，很少会用到 rndc 命令去管理，除非在 DNS 产品服务公司，使用 rndc 管理效率更高。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="513子域">5.13、子域<a class="hash-link" href="#513子域" title="标题的直接链接">​</a></h2><p>顶级域 &quot;.com&quot; 是根域 &quot;.&quot; 的子域，&quot;baidu.com.&quot; 又是 &quot;.com.&quot; 的子域。为何必须要向 isc 申请才能注册顶级域名下的子域如 &quot;brinnatt.com&quot; 呢？当有了 &quot;brinnatt.com&quot; 后，如何创建和设置它的子域 &quot;video.brinnatt.com&quot; 呢？</p><p>不管是不是子域，只要它是一个域，就必须要有 dns 服务器来负责该域的解析。域的灵魂在于其区域数据文件(不是 named.conf，它只是配置 named 程序工作的文件)，只有区域数据文件中才提供了域所需的所有数据，<strong>要让 dns 服务器能够正常工作，域数据必须要完整且正确，完整的域数据至少要存储 SOA 记录，ns 记录以及 ns 对应的 a 记录。</strong></p><ul><li>如果没有 ns 记录，则表示该域缺少 dns 服务器，这显然不可能。而缺少 ns 对应的 a 记录则能知道 dns 服务器的存在以及其主机名，却找不到 dns 服务器，因为没有它的 ip 地址。</li><li>更重要的是缺少了 soa 记录后，它指定不了哪个 dns 服务器是主 dns 服务器，以及一系列的附加属性(序列号、各种重试缓存时间等)；更关键的是 soa 是起始授权机构，<strong>缺少了 soa 记录表明父域没有对该域授权，该域没有自主权，它只是父域下的一部分，所有的解析工作都需要由父域来完成，只有有了 soa 记录，才表明父域授权了该域，该域可以享受起始授权的权利，也就是具有自主权，可以独立完成解析工作。</strong></li><li>子域，同样是域的概念，因此它的区域数据文件也一样要满足这些基本条件。</li></ul><p>再回顾下 dns 解析流程：</p><ol><li>客户端向 dns 服务器发送递归查询后，dns 服务器会查询根域，根域会告诉 dns 服务器负责解析顶级域的服务器地址；</li><li>dns 服务器再向顶级域服务器发起查询，顶级域服务器再告诉 dns 服务器再下一层次域的服务器地址，依次下去，直到找到最终主机地址并返回给客户端。</li></ol><p>在这个解析流程中，父域总是将子域 dns 服务器的地址告诉 dns 服务器。所以，父域是知道子域 dns 服务器的 ip 地址的，因此<strong>在父域的区域数据文件中，必然要指定子域 dns 服务器的 A 记录</strong>。</p><p>另外，父域如何知道域内主机是普通的主机还是子域 dns 服务器？总不能让子域 dns 服务器被父域当成普通主机吧？区分的方法是<strong>在父域的区域数据文件中使用 NS 记录来存储子域 dns 服务器信息</strong>。这样一来，子域 dns 服务器不仅在父域的区域数据文件中有了 NS 记录，还有了 A 记录，父域就能将子域信息返回给查询发起者。</p><p>其实在理论上，父域的区域数据文件中是可以不存储子域 dns 服务器 A 记录的，因为 NS 记录已经区分了它是 dns 服务器，只不过只有 NS 记录没有 A 记录是找不到该子域 dns 服务器的。</p><p>根据上述分析，应该就能明白在互联网上申请域名并向外界提供解析时，实际上是申请机构的区域数据文件中添加 NS 记录和 NS 对应的 A 记录，仅此而已。由此可知，根域名和顶级域名的区域数据文件是无比巨大的，在其中存放了无数的 NS 记录和 A 记录。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5131创建子域">5.13.1、创建子域<a class="hash-link" href="#5131创建子域" title="标题的直接链接">​</a></h3><p>根据上面的分析，在已有 &quot;brinnatt.com&quot; 域时，假设要创建其子域 &quot;video.brinnatt.com&quot;，需要满足以下两个条件：</p><ol><li>&quot;brinnatt.com&quot; 的区域数据文件中，需要添加子域 &quot;video.brinnatt.com&quot; 的 dns 服务器的 NS 记录和 A 记录，如果该子域有多个 dns 服务器，则需要添加多个 NS 记录和对应的 A 记录。</li><li>子域 master dns 服务器上的区域数据文件中，需要书写 SOA 记录，NS 记录和 NS 对应的 A 记录。</li></ol><p>所以，配置子域的过程其实很简单。但实际上，要创建子域是一个比较精细的活，不仅要考虑子域的域名(要让子域名有意义、易读、没有二义性等，而不是随便取的)，还要考虑创建多少个子域，如何划分子域(是按地理位置划分、部门划分、功能划分还是其他方式划分)，当然这几个都不是技术层面的问题。</p><p>就技术层面上考虑，创建子域时，需要考虑父域数据到子域的迁移，还要考虑反向查找区域数据文件的问题(反向查找区域的父域总是 in-addr.arpa，所以根本不需要考虑子域反向查找区域数据文件的特殊性)。</p><p>配置之前重要概念再梳理一遍：</p><ol><li>子域的区域数据文件中是可以没有 SOA 记录的，只不过此时子域没有得到父域授权，也就没有自主权，无法提供解析功能。</li><li>没有 SOA 记录意味着不是一个子域，而是父域的一部分，就相当于在父域的区域数据文件中使用 include 一样。</li><li>有了 soa 记录，才表明父域授权了该域，该域可以享受起始授权的权利，也就是具有自主权，可以独立完成解析工作。</li></ol><p>现在要创建子域 &quot;video.brinnatt.com&quot;，新提供一台负责子域解析的 dns 服务器。先修改父域的区域数据文件，加上子域的 NS 记录和 NS 对应的 A 记录。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/db.brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 6h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@           IN  SOA dnsserver   xyz </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">112</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> serial num</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                3h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> refresh </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                1h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> retry </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                1w    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expire </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                1h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> negative </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@           IN  NS  dnsserver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@           IN  NS  dnsslaver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsslaver   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www         IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ftp</span><span class="token plain">         IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.117</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mydb        IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.118</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">redis       IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.119</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www1        IN  CNAME   www</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">video       IN  NS  ns1.video   </span><span class="token comment" style="color:rgb(0, 128, 0)"># 为子域做准备</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ns1.video   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.6    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 为子域做准备</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启父域 named 服务，或者使用 rndc reload zone 文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># rndc -c /etc/rndc.conf -s 10.1.1.2 reload brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone reload queued</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@jumper ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再配置子域的 named.conf 以及区域数据文件。注意子域的区域数据文件中，要配置 SOA、NS 以及 NS 对应的 A 记录。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@b01test-s2500 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/named.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    directory   </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;.&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> hint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.ca&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;video.brinnatt.com&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;db.video.brinnatt.com&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">include </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/etc/named.rfc1912.zones&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@b01test-s2500 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@b01test-s2500 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/db.video.brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 6h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@       IN    SOA   ns1    xyz    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> 6h 3h 1d 1h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        IN    NS    ns1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ns1     IN    A     </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.6</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@b01test-s2500 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启子域 dns 服务器的 named 服务器：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@b01test-s2500 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart named</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>至此，子域就授权完成了，于是可以测试查询子域中的主机时，是由子域的 dns 服务器而不是父域来解析的。</p><p>测试的方法是查询子域中任意主机，如果在 dig 结果中的 &quot;AUTHORITY SECTION&quot; 段给出的是父域的 dns 服务器，则表明是父域进行解析的，如果给出的是子域的 dns 服务器，则表明是子域进行解析的。</p><p>例如，dig 一个子域中没有的主机：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@dnsslaver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -t a xyz.video.brinnatt.com. @10.1.1.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> DiG </span><span class="token number" style="color:rgb(9, 134, 88)">9.11</span><span class="token plain">.21-9.11.21-4.ky10 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> -t a xyz.video.brinnatt.com. @10.1.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> global options: +cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Got answer:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain">HEADER</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;-</span><span class="token plain"> opcode: QUERY, status: NXDOMAIN, id: </span><span class="token number" style="color:rgb(9, 134, 88)">39359</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> flags: qr rd ra</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUERY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ANSWER: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, AUTHORITY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ADDITIONAL: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> OPT PSEUDOSECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> EDNS: version: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> udp: </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUESTION SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">xyz.video.brinnatt.com.        IN  A</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> AUTHORITY SECTION:       </span><span class="token comment" style="color:rgb(0, 128, 0)"># 权威变成 video.brinnatt.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">video.brinnatt.com. </span><span class="token number" style="color:rgb(9, 134, 88)">3412</span><span class="token plain">    IN  SOA ns1.video.brinnatt.com. xyz.video.brinnatt.com. </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10800</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">86400</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Query time: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> msec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> SERVER: </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token comment" style="color:rgb(0, 128, 0)">#53(10.1.1.2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> WHEN: 一 </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">月 </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain">:16:33 CST </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> MSG SIZE  rcvd: </span><span class="token number" style="color:rgb(9, 134, 88)">91</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@dnsslaver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>上面结果中的权威答案是 video.brinnatt.com 给的，说明子域配置是完整、正确的。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="514智能-dns--视图-view">5.14、智能 DNS —— 视图 view<a class="hash-link" href="#514智能-dns--视图-view" title="标题的直接链接">​</a></h2><p>智能 dns，仅就 bind 来说，其视图特性提供的就是智能 dns 的功能。</p><p>使用 view 可以实现根据客户端来源为不同来源的客户端展现同一个区域的不同配置，不同来源的客户端解析同一个区域也可能得到不同的结果。</p><p>例如，公司两台 web 服务器 web1 和 web2（它们是完全相同的内容），使用电信网的客户端对 web 的请求让其访问到 web1 上，使用联通网的客户端对 web 的请求让其访问到 web2 上。通过判断网络来源，让其选择合适的线路访问可以加快访问速度，这是常用的功能。</p><p>要使用 view 功能，最好配合 acl 来制定什么客户端解析到哪去。acl 指令是仅有的几个不能定义在 view 中的指令之一。</p><p>示例设计：电信的客户只能访问到 web1 10.1.1.116，联通的客户只能访问到 web2 10.1.1.226。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /etc/named.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">acl telecom </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.3/32</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">   //模仿电信用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">acl unicom </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.6/32</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">    //模仿联通用户</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">options </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    directory </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/var/named&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">view telecom </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        match-clients </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">telecom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;brinnatt.com&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;telecom.brinnatt.com.zone&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">view unicom </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        match-clients </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">unicom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        zone </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;brinnatt.com&quot;</span><span class="token plain"> IN </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;unicom.brinnatt.com.zone&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/telecom.brinnatt.com.zone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 6h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@           IN  SOA dnsserver   admin </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> serial num</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                3h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> refresh </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                1h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> retry </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                1w    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expire </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                1h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> negative </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@           IN  NS  dnsserver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www         IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116  //假设 web1 </span><span class="token function" style="color:rgb(0, 0, 255)">ip</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chown root:named /var/named/telecom.brinnatt.com.zone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># chmod 640 /var/named/telecom.brinnatt.com.zone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cp -a /var/named/telecom.brinnatt.com.zone /var/named/unicom.brinnatt.com.zone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># cat /var/named/unicom.brinnatt.com.zone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token variable" style="color:rgb(9, 134, 88)">$TTL</span><span class="token plain"> 6h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@           IN  SOA dnsserver   admin </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> serial num</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                3h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> refresh </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                1h    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> retry </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                1w    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> expire </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                1h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> negative </span><span class="token function" style="color:rgb(0, 0, 255)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">@           IN  NS  dnsserver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www         IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.226  //假设 web2 </span><span class="token function" style="color:rgb(0, 0, 255)">ip</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.226</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@arm64v8 ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># systemctl restart named</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>验证：根据本示例设计，模仿电信用户的 10.1.1.3 应该访问的是代表 web1 服务器的 10.1.1.116；模仿联通用户的 10.1.1.6 应该访问的是代表 web2 服务器的 10.1.1.226。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 从 10.1.1.3 dig www 主机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@dnsslaver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -t A www.brinnatt.com @10.1.1.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> DiG </span><span class="token number" style="color:rgb(9, 134, 88)">9.11</span><span class="token plain">.21-9.11.21-4.ky10 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> -t A www.brinnatt.com @10.1.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> global options: +cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Got answer:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain">HEADER</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;-</span><span class="token plain"> opcode: QUERY, status: NOERROR, id: </span><span class="token number" style="color:rgb(9, 134, 88)">4780</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> flags: qr aa rd ra</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUERY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ANSWER: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, AUTHORITY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ADDITIONAL: </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> OPT PSEUDOSECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> EDNS: version: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> udp: </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUESTION SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">www.brinnatt.com.      IN  A</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ANSWER SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www.brinnatt.com.   </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.116      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 确实是 10.1.1.116</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> AUTHORITY SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.       </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  NS  dnsserver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ADDITIONAL SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver.brinnatt.com. </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Query time: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> msec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> SERVER: </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token comment" style="color:rgb(0, 128, 0)">#53(10.1.1.2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> WHEN: 一 </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">月 </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">:32:48 CST </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> MSG SIZE  rcvd: </span><span class="token number" style="color:rgb(9, 134, 88)">101</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@dnsslaver ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 从 10.1.1.6 dig www 主机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@b01test ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)"># dig -t A www.brinnatt.com @10.1.1.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> DiG </span><span class="token number" style="color:rgb(9, 134, 88)">9.11</span><span class="token plain">.4-P2-9.11.4-13.ky10 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> -t A www.brinnatt.com @10.1.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> global options: +cmd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Got answer:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain">HEADER</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;-</span><span class="token plain"> opcode: QUERY, status: NOERROR, id: </span><span class="token number" style="color:rgb(9, 134, 88)">50487</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> flags: qr aa rd ra</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUERY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ANSWER: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, AUTHORITY: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">, ADDITIONAL: </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> OPT PSEUDOSECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> EDNS: version: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">, flags:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> udp: </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> QUESTION SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">www.brinnatt.com.      IN  A</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ANSWER SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">www.brinnatt.com.   </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.226      </span><span class="token comment" style="color:rgb(0, 128, 0)"># 确实是 10.1.1.226</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> AUTHORITY SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brinnatt.com.       </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  NS  dnsserver.brinnatt.com.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ADDITIONAL SECTION:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dnsserver.brinnatt.com. </span><span class="token number" style="color:rgb(9, 134, 88)">21600</span><span class="token plain">   IN  A   </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> Query time: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> msec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> SERVER: </span><span class="token number" style="color:rgb(9, 134, 88)">10.1</span><span class="token plain">.1.2</span><span class="token comment" style="color:rgb(0, 128, 0)">#53(10.1.1.2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> WHEN: 一 </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain">月 </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain">:33:59 CST </span><span class="token number" style="color:rgb(9, 134, 88)">2021</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> MSG SIZE  rcvd: </span><span class="token number" style="color:rgb(9, 134, 88)">101</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">root@b01test ~</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>注意事项：</em></p><ol><li><em>所有的 zone 都必须要定义在 view 中，尽管默认的 named.conf 根本没有定义 view，但是此时所有的 zone 都定义在了一个隐含的默认的视图中。</em></li><li><em>view 中 match-clients 指令的匹配方式是从前向后匹配的，如果在第一个 view 中匹配了，则后面定义的 view 将不会生效，所以定义的 view 的先后顺序是很重要的。</em></li><li><em>绝大多数 named.conf 中的指令都能写在 view 中，只有很少量的指令不允许，例如 acl 指令。对于本该封装在 options 中的指令，如果想定义在 view 中，则不应该在 view 中使用 options，因为 options 定义的是全局默认值，配置文件中只能出现一次，所以可以直接在 view 中写指令，这样会覆盖全局 options。</em></li><li><em>不同的 view 中定义的相同的 zone，它们使用的区域文件一般不同（并非必须不同），否则就没有自定义 view 的必要。</em></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="515dns-日志系统">5.15、DNS 日志系统<a class="hash-link" href="#515dns-日志系统" title="标题的直接链接">​</a></h2><p>DNS 的日志系统有两个概念：通道(channel)和类别(category)。</p><p>channel 定义日志向哪里发送：是发送到 syslog 日志系统中，还是发送到某个自定义的文件，抑或是发送到 named 的标准输出，还可以发送到位存储桶(bit bucket)。</p><p>category 定义哪些类的信息需要写入日志。</p><p>每种类别的数据可以被发送给一个或多个通道。例如统计类别的信息发送到系统日志通道且发送到自定义日志文件通道，而查询类别只发送到自定义日志文件通道。</p><p><img loading="lazy" alt="dns log" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlUAAADcCAYAAABZJlSLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAButSURBVHhe7d3bqlzZXsfxvEKeIa+Qd8gjBPVCQTYaQegbb4J41V4EwX3jRXSDBzxEhBaRDl5svNgG8aJpCIqtW4wdNu5GmsCGpkUUYel39fqnR/4Z87RqjKo5qr4fGGTNmueqcfhV1UzNO1eSJEk6mKFKkiSpAUOVJElSA4YqSZKkBgxVkiRJDRiqJEmSGjBUSZIkNWCokiRJasBQJUmS1IChSpIkqQFDlSRJUgOGKkmSpAYMVZIkSQ0YqiRJkhowVEmSJDVgqJIkSWrAUCVJktSAoUqSJKkBQ5UkSVIDhipJkqQGDFWSJEkNGKokSZIaMFRJkiQ1YKiSJElqoEuo+uCjBxbLMEVSH7X2ZrHstbTQLVRJI7CuSv3YvjQKQ5XUgHVV6sf2pVEYqqQGrKtSP7YvjcJQJTVgXZX6sX1pFIYqqQHrqtSP7UujMFRJDVhXpX5sXxqFoUpqwLoq9WP70igMVVID1lWpH9uXRmGokhqwrkr92L40CkOV1IB1VerH9qVRGKqkBqyrUj+2L43CUCU1YF2V+rF9aRSGKqkB66rUj+1LozBUdfTmzZubvw736tWrm7+W3bt37+rhw4c3UzoGO32pH8cCjcJQ1dHjx4+vA87Lly9vHnkX8x89enQzNY/t3L9/f3JbpQcPHlw9efLkZup22EYOZgS7np0D5/j06dObqbEYqqR+9tq+6I+fPXt23Y/PvZFtORYcG2MJ48Havp/lWP758+c3j3zzPN25c2dV2Tp2sXztQ4c4jjVjZkuGqo5oRHMNhRf77t271w1qCRWERrum0m0NVXQKBLay0XBM5TaYx/ksNS7m50ZSlhcvXtws+b6l+XtmqJL6OVb74k0dfVBZ6B/pCyn0i/Rx9JfRp0W/SJkawFuOBaAPzse5psz13VM4b85tC86V54bnriYfB8ux/NRzFMG1hsfz+AVeS553zvuYDFWd8ELSSJa+tovGNFX5sqh8c8vTALaEKipjrpjRiYBzYB7LLDXKuX1z3FHB2Q7nUHZC5fzRGKqkfo7Vvgg19EP0yRGUKGWIon+jn1p7SUaPsYBtxvFsKTVLfTrny3OwVYxV+dsHzpPH2S775t+YnjI37rENXp/yGHmM5/IU44mhqhNe4KgkvMA0Vv6tNSxe+FxZ5hoglZJtTSn3vUVZMVmfEg196l1CNrdvGkVZyZkuPyLO80diqJL6OWX7ikGbkvsn+selENRjLGA5+su15pbn2Jh3aKnhXGpjB48zrrDe2vDDOixfe755HXh94rninGIsOzZDVQdUECpKBB+SelSGqIBrym2tCVVUvhzMmI7HWJ/CdK0S83itsW8NVXPTIzFUSf2cqn1FX86lF7m/jDec9Fu1vhC9xgK2W3t8ytblS70CCs9JfDLIc7kGy8fzGc/N2nKskGWoaowXm8RcBgu+160FDR5j3lSDXDJVEaeCDctH42Z+reJtKbV9GKok3ca//+Rfb/5637HbF/1k9JG1/izCUS1shZ5jwYihik+sOIY1ZW4cmHuOeL4JXqdkqGosGltZyncqgYrBvPj6i/lTnwjldWOaip73tVTmKivbpeLHOzO2v7R8tnRM5faWpkdiqJIO8xt//UtXv/U3v3L19z/+25tHvnXM9hV9M4W+kIE6psuSrxXKWo8FJfpJ1llr6/KlraGqfLPPucX5sp0cKDmm3OfXHlsjnkf+LdXGqZ4MVY3xAlIhomLx7qPW+Kik5XfNLE+Dyyk7GkNZosJNVRa2nSvvErZJ50GhUrI+f3NMcQ5bKyfHyjamlOeCPD0SQ5V0GEIV7YiSw9Wx2xf9H8GG/ogS/Tp9IX1a9O8xr6b1WFBiu9FfrikR8OZMnQfPxVSoYp28HvspS2A7eVxiPsdXyo/xd7m98ljYXjmvVqaOvZdWddVQVUFFpiFlPE7DzJWRxkQlmHuXwvxcCbMtoYp3RyzPdst1ygbA8XAe0dDzO4Ep5bFybvwdHQzyuaw5t736zh/95tUv/smvvh0ULBbL4SXCFX+fCv10fIKfQxH9+Nwbx9B6LKCfZP7WMifGga1lqs+OYwxrAlCUqW2yjRyq5kLT0vweWtVVQ1VCI6ER5soR3yvz9RovOIWgwgtPYR1KGT5KcxUusB22O4d9sp84lhyU2Eb57gkRrlgnHx/ny+NLpdwm0+W55OlRfPbF11c/871/vC4/93t/efXLf/ZTbwcFi8Vy+3LKUBWf2NNP0l/m4AP6QebnvrLUYyxgW6y71tblW8j7jHMs1fr82mOB9XluQp7Olub30KquGqoSGgyNJdBAaRy8K+FFjnBCI+LdCn/zL8uw3tS7n7kKF9h+rrwZDZ1jrDXY6CjyuzKw3ty7p+h4+JdjLbcfnUfI57Lm3PbqF/74198GK8of/t1/XP3nf//vzVxJS/bw9R/9Fn0y/S/9EYV+iz41l3IZCuvV9BgL6CdZbq2tyweOleOPfn2LvE/6/jwuMT/3+bXHQg5JTLP8XCmXPwZDVQc0hHgxKQQUpsuQQmUoPw5mflQkKvJUJS6Xm8I+c+XN5rbBPPbDccypBbIQ2yjl48rnsubc9irq6m//4MfvhKuPPv3y+nFJ8/ZyoTohIvqqKFwmQd9EwGE+f5f9I/Ppz3O/3WssYD7LrbV1eQIehf1H+CtxTLU33aW8T86T6TUlzj9jG+Wx5OlsaX4PhqoOykbJpzq18JFf7LmKVFqzXOx7TlmBDylT4qvCUj4u1i/PJU+PpKyrr9/81zvh6vGfv7r6wQ9/cjNXUs2eflIh0I+Voabsw5g39elU6DUWMH+u/82WluccCYDxPxA5Ho4dzKMvj2lwHgTE8rEs75PzLPt/1M517vzzc8U0y8+VcvljMFSdCI2x/EiYF3+qIpXK5ajs0QhK0YhvKxoU/9Y+el6Dc8sNrjwujp3zKDustc/BHtXqKtdaffCn//JOuCJwSdrmFGMBIYg+qeynyz6M+QQL5pf92Fa3GQuYz3JrLS3POML8OI88hkSIKkNhPDY11uR9slxetnautccC63NsIU9nS/N7MFQdCZWERhgIK2UFyxWpVqmo8CwXHwnnbYTcILaIjoT9xz4IR1s6DY6PbeTAt3Rcc41p7+bq6l/9w5ur7/zBP78NV3yK9eVX/3MzV9KSY48FERjyJ1G5D4vl6CfX9pEtxgIei+XWlLhWawp9/FR4DOX5RbiKMFaeT2C/5T55LvPzWZ4rx8g+eawMbyXmlyEpT2dL83swVDVGxaOSUMmoQLyg8W4mQgYVhopTfidfVi6wXlnJEZW0bMjlNgLr5gaxRjS8ct34Tp1SHt8cjjt/9QeOudb4Qn4ORrKmrnJ9VQQrChezS1p2zLEg+tfaV1u1vjXefLJOGQaOMRZsLTUcZ+6b58aQfMy1sIQ4xghjbD/3/+wjnjOeb8aNqf2ynRhb4vlj2fL8aoXX5pgMVY1R0XghqZSElLKRgYpGBa4ldh5jPhWGZfKFgPGuIJadMtcgMioqFZ112G6u9IjKHOfFMrUwBxoGy0WnwDFzLLH9qfXYR7neaNbWVT6hKq+34hMsr7eS5h1rLIhBuhaoMNW30n8xeJdvJnuOBcxjubXmlqdvZx+l+OSK9XKJN9lzOF62yT4psa3biu1RYizhb14Lnvs5S/NbM1QdCY0jggn/5heaRhQVkELFyctEqKoFn9JUww9sl0ZDw4j9MT0VeAKNIip0HGNg3ZhXHh9/x7Icf8ZzEcdBIzl2A2hla13l2iqusYpwxd9cgyXpfccaC+gHc99Jn8RjlBjIa1guB6eaFmMBfTHzlvrswHHVthPycXOMBMTyOKJwzHPnGX0+z2UEMf7mMfp6AlI8XivxXEfYZF+xvRL7iTGHY2Kd2vYo7JPtrXl9DmWoOhJeTCrUUiBasqYRzTX8QGWkUNnWNszAubD9cj0aK5V+6/nReKMj23oce3LbusqnVOXF7F5vJb3v1GMBAYNCXzUVTNZqNRbsVYwFGf07wSaC0FxhmXIMm3uuCE2x3akgGOUYDFVSA4fWVS5mj2BF8Xor6VuOBRqFoUpqoEVd5RfY84+Her2V5FigcRiqpAZa1lWut/ru93/0Nlj546G6dI4FGoWhSmqgR1395POv3rne6sOPX3u9lS6SY4FGYaiSGuhZV2vXW3mzZl0SxwKNwlAlNXCMukqYKsOVN2vWpXAs0CgMVVIDx6qr+WbNfD3o9VY6d44FGoWhSmrg2HWVcOXNmnUpHAs0CkOV1MCp6irXW/njoTp3jgUahaFKauDUddUfD9U5cyzQKAxVUgN7qKverFnnyrFAozBUSQ3sqa7WbtbMb15Jo3Is0CgMVVIDe6yr+WbN/Eq711tpRI4FGoWhSmpgz3XV6600OscCjWL3ocpiGaXsWe1mzYQtaQS19max7LW00CVUSWor/3ioN2uWpP0xVEkDyTdrJlx5vZUk7YOhShpQ7Xorw5UknZahShpYvlmzF7NL0ukYqqTBebNmSdoHQ5V0JrxZsySdlqFKOjPerFmSTsNQJZ0pfzxUko7LUCWdsfzjod6sWZL6MVRJF6B2s2bDlSS1ZaiSLog3a5akfgxV0gXyeitJas9QJV0ob9YsSW0ZqqQL582aJakNQ5Wka96sWZIOY6iS9A5v1ixJt2OoklTlzZolaRtDlaRJ+XorfzxUkqYZqiQt8mbNkrTMUCVpNW/WLEnTDFWSNvPHQyXpfYYqSbfizZol6V2GKkkH8WbNkvQNQ5WkJrxZs6RLZ6iS1JTXW0m6VIYqSc15s2ZJl8hQJakbb9Ys6ZIYqiR199kXX3uzZklnz1Al6Wj4CpCfXohw5c2aJZ0TQ5Wko/vo0y/fBqsIV5I0OkOVpJPwZs2Szo2hStJJ1X481Js1SxqRoUrSLuQfD/VmzZJGY6iStCv+eKikURmqJO2ON2uWNCJDlaTd4tqqDz9+/TZc+eOhkvbMUCVp9/L1VgQtr7eStDeGKknDqF1vxVeFkrQHhipJw8k3a+bHRCXp1AxVkobkzZol7Y2hStLQvFmzpL0wVEk6C96sWdKpGaoknRVv1izpVAxVks4On1D546GSjs1QJels1W7WzDVYktSDoUrS2cs/HurNmiX1YKiSdDG8WbOkngxVki5KvlkzxeutJLVgqJJ0kfzxUEmtGaokXbRPPv/KmzVLasJQJUn/z5s1SzqUoUqSCoSpMlx5s2ZJaxmqJCnJ11vx9aDXW0laYqiSpAmEq3yzZh6TpBpDlSQt4HorfzxU0hJDlSSt5I+HSppjqJKkDbxZs6QphipJuoXazZr5zStJl8tQJUkHyDdr/u73f+T1VtKFMlRJUgNebyXJUCVJjXizZumyGaokqTFv1ixdJkOVJHWSb9ZMuPJ6K+l8GaokqbPa9VaGK+n8GKok6UjyzZq9mF06L4YqSToib9YsnS9DlSSdgDdrls6PoUqSTsibNUvnw1AlSTvgj4dK4zNUSdJO5B8P9WbN0lgMVZK0M7WbNRuupP0zVEnSThGkvFmzNA5DlSTtnNdbSWPoEqo++OiBxTJMkUZQu1kzYWvPau3NYtlraaFbqJJGYF3VaEa6WbPtS6MwVEkNWFc1qhFu1mz70igMVVID1lWNbs83a7Z9aRSGKqkB66rOxR5v1mz70igMVVID1lWdk3y91al/PNT2pVEYqqQGrKs6R3u5WbPtS6MwVEkNWFd1zk59s2bbl0ZhqJIasK7qEpzqx0NtXxqFoUpqwLqqS3GKmzXbvjQKQ5XUgHVVl4Zrqz78+PXbcNXzx0NtXxqFoUpqwLqqS3WMmzXbvjQKQ5XUgHVVl67n9Va2L43CUCU1YF2VvtHjZs22L43CUCU1YF2VvtX6Zs22L43CUHUCT548ubp///7Vmzfb3sG9evXq5q/3PXr06Orhw4ebtznlwYMH19srsf9W26+5d+/e1dOnT2+mxmKnL73vsy++bnKz5nMeC+hrW/SrjAFs71CPHz++LrVjevbs2XU//fLly5tH3sd6nNPz589vHrm6Xv7OnTurytZzYPna2BjHMXesPRiqTiAa0hZRKacq3N27d68r/G2wXg55NKpyX8yjMS11AMzPjaQsL168uFnyfUvz98xQJU3jK0B+eiHC1dabNR+zfdG/0Q9tLXP94pTbjAVT6McZBwhXh2Ab+Q114Dzpp5dwDCw3NSbl54rlWH7q2Jk/NY/Hax9S8AadMYtjPiZDVQdLjWtNQ6olb5J/rdFEY5rbL/Om5vN4rpgcY4QqjoV5LDO3D3BeZRgrlaGJ7XDc5bsIQ5V03j769Mu3wSrCVcbvYGXHbF8RHLaWmqX+smWoAv0pY8FtvgkBYwznUo4/9PvRL8dzs0YEpfztQ/kBAcfIvzE9JbbFvxnb4HzL55HHeB5OMZ4YqjqISnJImWpo0WjKYEUar20jlzLA1JQVk3Og1PY3Z22oAtPlR8R5/kgMVdI6SzdrZt4nn391M/WNU4SqteaWbzEWUAJhYSks0WfTD88tV3vTDj6hKvt6tsH+o5/e+twQgmpjB48zrrCtteFnLlhxzoxfcV4871NjaG+GqiOKF55KRBDi36kAMoftRMWKyrnU0HJDoPLldZiOxzguCtO1SszjtYa5NVTNTY/EUCVtQ7jiGqsIV/wdn2QRtMpPrEYNVUu2Dv6xr0NLrY+ObZd9cHw7EqbONY8la7AOl5mwPca0NVg+xrs4l7XlWCHLUHUkfAQaISoaEhWJx9Z+CpQRalh/zcXdVKoSx5Ar3dZSa5iGKklb5B8PjcKPiAZDVR0hgzfoU2pf503hOPJ5ROhZKmv6bca52rq1Mre9uXPhQwuO+ZQMVZ0RnKishJ/4CLVsSPHpFWVLoCCpx3pTlax8nIq6hG1S8TlWPgbmGOeOqfbuJBrmVCm3tzQ9EkOVdJif//1/ug5TP/073war+BrQUFVHHz/Xb9KfM0Ys4Tjo9/N5ENjKbyrWnGv5qRPHF+ME+6CUasc+dz5z4rnI42FtnOrJUNUJlSKSOf+WL2xuSMzjMZblcSpxWTF5vCwswzqx3FSQYb+B6TkcbxnSOB7+pqHRsPg0bGvlZJ9zDZr5ZePJ0yMxVEm3x1d9P/u7n70NUxGu4mvAU4Qq/l1T6BuX+tepvjOPBSXWWdPnsv7UNtZ8kxGfZuXzYHxhujwGznfpXJlflsC5UkrMZ5ul/FjsM0p5rjFuzpWp56YXQ1VjVMS4cJwXMz6dKhFaytAUeCw+KaLUlqk1QqZzZc0VmOOp4fhYn/nl8uX6cU4cEx+t5ncCU9hmNA7Ohb/LcyrnI0+PpBwMLBZLu/Jrf/FvJwlVW8uc6GO3ljX9YRxvXpZ+mz57LpjRH7NMjClsB6xDn1++MUfsa428LOMJ02vK1HmzjXL8y9PZ0vweDFUdEDyiUmxpTPHiU6FrgQq1SsI0j5eYLh9j+yWOkcbE43zVl4MS28wNqgyM+fg45jiPuZI/PSsbT54eSW0wsFgsh5UPP359/RXgKULVWluX74E+nL65DFC1UJTFtxKxXnkenFfu57eca142j0lgPsuVao8F1i/HvzydLc3vwVDVWS3w1Kx98WvL1fbBdDxWawg0IhpcLbzFu5fax8asR7iqYT/ROPmXfZbbp+GXx5kbz1xj2rtzqKvSKZX/EzDCVDjHUEWgoQ+OPvMQbCu+SQB9N9Nrv1UIcR5TxzR3rnmdvGw5JgXm5z6/9lhg/XL8Y5rl58qacbUlQ1VntcBTkyvLlNpyTNcqU+y31hCmKi1i+aUGWQtkobbP/FwwvzyOPD0SQ5V0GEJVDlPhnEIVwScuo+Ca09yfE06WroOq4c0ux0EfS6Aq+9q14jzinLaUfB75eeF48jpTZWocYBvlfvJ0tjS/B0NVZ7ygtUpTK2te/FolYZrHS0zHY7VGn/d92zIlvios5eNk/bLx5OmRGKqkw/C7VVNGDlWEJD6lj+tr6Qfjaznm5a/p4puCpa/ualiHY5n7D0Jzls57y3OTly3HpMD83OfXHgusX45/TLP8XMnjZW+Gqs5qgacmV5YpteVq+2A6HtvSEMD2aJz8e9vGSSeSO4XyOOlMOK7yI2OOcaox7Z2hSupn5FAV/7su+rrcX0eIKj/5j8dyvz4nwhv7Yt3af5JasnTeW56bvGw5JgXm5z6/9lhgfZ6/kKezpfk9GKo6yw1oytoXv1wuGiHTVMRcItRsaQjxETLr0EgJVWynDD9L+FibbeRGvfRcxH5HZKiS+jlFqOLfNSX/FEFG/0nYCbV+sOxfo1+PMDZ1DWspvkqMcMbXi6zLv1v67rnzAOe7tEzIy8bXniXmsxx4HnleeKwMmKU8TubpbGl+D4aqznhBqSRrypoXPypJvJOhwSw1mrUNIToH9hGisVKi8i+hA8lf/YHjnesg2PfafeyNoUrq5xShamupoW/O/R79d9nHlujX2VZcz1oLIhnbYh9stxwLCGX0w8xjmTXhauo8wtqxBLFs7JfnIPf/HFcEKMInxzv13LCdGFviDTvLso+5cttvW27LUNXZmoq8BZUoGsqadzCYawgcH9uJ8FfbZlRm5rMcy0Sjz2gYLBfhiMrPMcf2p9ZjH+V6ozFUSf2cIlStNbc8/SZ9dSk+uWK9XOIN7BL6S94Ex1gwdWE7y9H/sgyFgMZ+piydN+uueW44HvbHspQ439uK7VFiLOFvzo1znLM0vzVDVWO8gC1exFr4YLs0IirUUqBiWSpchDAqYmAeDZvGG5We6anAE2gUUaEp5TZZN+aVx8bfsWz+OhA0tjgOGkmL5+4UDFVSP6cIVUv9YeCTFvq3qb4rf5UVnyCxj1zoD/PyJeaxTCxPv72mz4zxIIIO62Usw7w5a0JV9Pnsg+Up/M1j9PUEpHi8VmLcik/oOOfaMbOfGHN4Tlintj0K+2R7c89tK4aqxngBeZFblBoq1lKgCixLI6o1VCojhcq2tvMIbIsKXK5Hg9xybIEOhvXy9kZjqJL6sX19i/6cPvM2/SX9dO3NLWLsmtsu606NTSHGgoztEmwiCM0VlmFMCHPjCscd250Kq1GOwVAlNWBdlfqxfWkUhiqpAeuq1I/tS6MwVEkNWFelfmxfGoWhSmrAuir1Y/vSKAxVUgPWVakf25dGYaiSGrCuSv3YvjQKQ5XUgHVV6sf2pVEYqqQGrKtSP7YvjcJQJTVgXZX6sX1pFIYqqQHrqtSP7UujMFRJDVhXpX5sXxqFoUpqwLoq9WP70igMVVID1lWpH9uXRmGokhqwrkr92L40it2HKotllCKpj1p7s1j2WlroEqokSZIujaFKkiSpAUOVJElSA4YqSZKkBgxVkiRJDRiqJEmSGjBUSZIkNWCokiRJasBQJUmS1IChSpIkqQFDlSRJUgOGKkmSpAYMVZIkSQ0YqiRJkhowVEmSJDVgqJIkSWrAUCVJktSAoUqSJKkBQ5UkSVIDhipJkqQGDFWSJEkNGKokSZIaMFRJkiQ1YKiSJElqwFAlSZJ0sKur/wOeEO3O+7eIKwAAAABJRU5ErkJggg==" width="597" height="220" class="img_ev3q"></p><p>通道允许你记录不同级别的日志信息，从严重到不严重有七种级别：critical；error；warring；notice；info；debug<!-- -->[<!-- -->level<!-- -->]<!-- --> 和 dynamic。其中前 5 种级别和系统日志 syslog 系统相同，后两种(debug 和 dynamic) 是 BIND 独有，且 debug 还可以按照 level 进行细分。</p><p>但是写日志是一项非常消耗性能的操作，所以默认都是定义在 info 级别上。在正常使用环境中，除了调试时可能需要记录 debug 或者 dynamic 级别信息，其余至少都记录到 info 级别甚至更严格的级别。</p><p>以下是 named.conf 中的一个日志定义示例。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">logging </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    channel my_syslog </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">             /* 定义日志通道my_syslog */ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        syslog daemon</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">              /* my_syslog通道的日志写入到系统日志syslog，并指定使用daemon工具记录 */ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        severity warning</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">           /* 该通道只记录严重级别为warning及以上的信息 */ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    channel my_file </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">               /* 定义第二个日志通道my_file */ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;log.msgs&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">          /* my_file通道的日志写入到自定义的文件log.msgs中 */ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        severity info</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">              /* 该通道记录日志级别为info 及以上的信息 */ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    category statistics </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">my_syslog</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">my_file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">   /* 统计类别statistics的信息使用my_syslog和my_file通道记录 */ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    category queries </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">my_file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">                /* 查询类别queries的信息记录使用my_file通道记录 */ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    category default </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">                   /* 除了上述两个自定义的类别，其余绝大部分的类别的信息都丢弃 */   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    //category default </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> my_file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">            /* 或者不丢弃，将其记录到my_file通道指定的文件也可以 */ </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上述示例中，有几个关键字：</p><ul><li>logging 是 named.conf 中标记日志系统的关键字。</li><li>channel 是定义通道的关键字。</li><li>severity 是定义记录什么日志级别的关键字。</li><li>category 是定义信息类别使用哪个通道记录的关键字。</li></ul><p>下面是 DNS 日志系统的语法：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">logging </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     category string </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">. </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     channel string </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          buffered boolean</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> quoted_string </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> versions </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;unlimited&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> integer </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> size size </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          print-category boolean</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          print-severity boolean</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          print-time boolean</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          severity log_severity</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          stderr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          syslog </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> syslog_facility </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><p><strong>channel 的解释</strong></p><p>在 channel 字句中，指定通道的路径（即日志记录的位置）和记录的日志级别，还可以指定在日志文件中是否也记录类别信息、日志级别以及该条日志的记录时间。</p><p>通道的有四种位置可选：</p><ul><li>syslog：使用系统日志来记录，同时需要指定使用哪种工具(facility)来记录。<ul><li>有 kern、user、mail、daemon、auth、syslog、lpr、news、uucp、cron、authpriv、ftp、local0、local1、local2、local3、local4、local5、local6 和 local7 这么多种工具可选。默认是 daemon，也建议使用 daemon。</li></ul></li><li>file：使用自定义的文件路径。可以指定该日志文件有几个版本(versions)和多大(size)时就进行轮替，不指定大小限制时日志文件将无限制增长。<ul><li><p>例如以下定义方式：每个日志文件增长到 10M 大小就创建新的文件来记录新的日志，最多记录 3 个版本的日志文件，当第三个日志文件 my<!-- -->_<!-- -->logs2 也到 10M 后将删除最早的日志文件继续记录。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">channel my_file </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> my_logs versions </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> size 10M</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   severity info</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li>null：使用 null 方式的通道将把使用该通道来记录的信息全部丢弃。
</li><li>stderr：使用 stderr 方式的通道将把使用该通道来记录的信息输出到 stderr。
</li></ul></li><li><p><strong>类别的解释</strong></p><p>BIND 9 中有很多种类别：</p><ul><li>default：匹配没有自定义的绝大多数类别。但是还有一些信息是不属于任何类别的信息，这部分信息无法使用 default 来匹配，而是用 general 类别来匹配。</li><li>general：匹配那些不明确属于哪个类别的信息。</li><li>client：客户端请求信息。</li><li>config：配置文件分析和处理信息。</li><li>lame-servers：发现错误授权信息。</li><li>network：网络操作信息。</li><li><strong>notify：</strong>主从 DNS 服务器区数据文件传输通知信息。</li><li><strong>queries：</strong>查询信息。</li><li><strong>resolver：</strong>名称解析信息，包括来自解析器（客户端）的递归查询处理信息。</li><li>security：认可或非认可的请求信息。</li><li>update：动态更新事件信息。</li><li><strong>xfer-in：</strong>远程 DNS 服务器到本地 DNS 服务器的区域传送信息。</li><li><strong>xfer-out：</strong>从本地 DNS 服务器到远程 DNS 服务器的区域传送信息。</li></ul></li><li><p><strong>默认的 channel 和类别</strong></p><p>当没有在 named.conf 中定义任何 logging 字句时，发现在 /var/log/messages 中还是记录了很多 DNS 相关的日志，为什么没定义还是有记录呢？因为有 BIND 默认定义的日志记录方式。</p><p>在 BIND 中默认定义了 4 个 channel，分别使用 4 种通道路径。这些 channel 你无法重定义它们，即使你不想要它们、不书写它们，BIND 还是会自己创建它们。只有一种方法：新添加通道并指定使用该通道的类别，使你想记录的日志不使用默认的定义。</p><p>以下是默认定义的通道：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">channel default_syslog </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   syslog daemon</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   severity info</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">channel default_debug </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">file</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;named.run&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   severity dynamic</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">channel default_stderr </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   stderr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">severity info</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">channel null </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>而同时在 BIND 9 中所指定的默认类别语句如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">category default </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> default_syslog</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">default_debug</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也就是说，对于你没有指定的绝大多数类别的信息都使用通道 default<!-- -->_<!-- -->syslog 和通道 default<!-- -->_<!-- -->debug 来记录。由于默认定义了 null 通道，所以你想把 default 匹配的类别信息全部丢弃的话，可以直接使用 &quot;categroy default { null; };&quot; 来丢弃。</p></li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/linux-advanced-4"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">第 4 章 Linux DHCP 服务</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux-advanced-6"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">第 6 章 Linux httpd 服务基础配置</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#51dns-基础" class="table-of-contents__link toc-highlight">5.1、DNS 基础</a><ul><li><a href="#511域的分类" class="table-of-contents__link toc-highlight">5.1.1、域的分类</a></li><li><a href="#512主机名域名fqdn" class="table-of-contents__link toc-highlight">5.1.2、主机名、域名、FQDN</a></li><li><a href="#513域的分层授权" class="table-of-contents__link toc-highlight">5.1.3、域的分层授权</a></li><li><a href="#514dns-解析流程" class="table-of-contents__link toc-highlight">5.1.4、DNS 解析流程</a></li><li><a href="#515etcresolvconf-文件" class="table-of-contents__link toc-highlight">5.1.5、/etc/resolv.conf 文件</a></li></ul></li><li><a href="#52dns-术语" class="table-of-contents__link toc-highlight">5.2、DNS 术语</a><ul><li><a href="#521递归查询和迭代查询" class="table-of-contents__link toc-highlight">5.2.1、递归查询和迭代查询</a></li><li><a href="#522权威服务器和非权威应答" class="table-of-contents__link toc-highlight">5.2.2、权威服务器和[非]权威应答</a></li><li><a href="#523dns-缓存" class="table-of-contents__link toc-highlight">5.2.3、DNS 缓存</a></li><li><a href="#524主从-dns-服务器" class="table-of-contents__link toc-highlight">5.2.4、主、从 dns 服务器</a></li><li><a href="#525资源记录" class="table-of-contents__link toc-highlight">5.2.5、资源记录</a></li></ul></li><li><a href="#53安装-dns" class="table-of-contents__link toc-highlight">5.3、安装 DNS</a></li><li><a href="#54配置和使用-dns" class="table-of-contents__link toc-highlight">5.4、配置和使用 DNS</a><ul><li><a href="#541namedconf-配置" class="table-of-contents__link toc-highlight">5.4.1、named.conf 配置</a></li><li><a href="#542区域数据文件配置" class="table-of-contents__link toc-highlight">5.4.2、区域数据文件配置</a></li><li><a href="#543测试-dns-解析" class="table-of-contents__link toc-highlight">5.4.3、测试 DNS 解析</a></li></ul></li><li><a href="#55配置反向查找区域" class="table-of-contents__link toc-highlight">5.5、配置反向查找区域</a></li><li><a href="#56配置-仅缓存-dns-服务器" class="table-of-contents__link toc-highlight">5.6、配置 &quot;仅缓存&quot; DNS 服务器</a></li><li><a href="#57配置-dns-转发服务器" class="table-of-contents__link toc-highlight">5.7、配置 DNS 转发服务器</a></li><li><a href="#58acl" class="table-of-contents__link toc-highlight">5.8、ACL</a></li><li><a href="#59递归查询详解" class="table-of-contents__link toc-highlight">5.9、递归查询详解</a></li><li><a href="#510dns-黑名单" class="table-of-contents__link toc-highlight">5.10、DNS 黑名单</a></li><li><a href="#511配置主从-dns-服务器" class="table-of-contents__link toc-highlight">5.11、配置主、从 DNS 服务器</a><ul><li><a href="#5111dns-主从体验" class="table-of-contents__link toc-highlight">5.11.1、DNS 主从体验</a></li><li><a href="#5112dns-主从完整配置" class="table-of-contents__link toc-highlight">5.11.2、DNS 主从完整配置</a></li><li><a href="#5113何时进行区域传送" class="table-of-contents__link toc-highlight">5.11.3、何时进行区域传送</a></li><li><a href="#5114notify-通知" class="table-of-contents__link toc-highlight">5.11.4、notify 通知</a></li><li><a href="#5115区域文件备份的重要性" class="table-of-contents__link toc-highlight">5.11.5、区域文件备份的重要性</a></li></ul></li><li><a href="#512-rndc-控制-dns-服务器" class="table-of-contents__link toc-highlight">5.12、 rndc 控制 dns 服务器</a><ul><li><a href="#5121controls-指令" class="table-of-contents__link toc-highlight">5.12.1、controls 指令</a></li><li><a href="#5122控制端生成-rndcconf" class="table-of-contents__link toc-highlight">5.12.2、控制端生成 rndc.conf</a></li><li><a href="#5123rndc-命令" class="table-of-contents__link toc-highlight">5.12.3、rndc 命令</a></li></ul></li><li><a href="#513子域" class="table-of-contents__link toc-highlight">5.13、子域</a><ul><li><a href="#5131创建子域" class="table-of-contents__link toc-highlight">5.13.1、创建子域</a></li></ul></li><li><a href="#514智能-dns--视图-view" class="table-of-contents__link toc-highlight">5.14、智能 DNS —— 视图 view</a></li><li><a href="#515dns-日志系统" class="table-of-contents__link toc-highlight">5.15、DNS 日志系统</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">学习</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li><li class="footer__item"><a class="footer__link-item" href="/project">实战项目</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/linux">Linux</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/zqingfa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juejin.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/website">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p><a href="http://beian.miit.gov.cn/">浙ICP备20024502号-1</a></p><p>Copyright © 2023 - PRESENT zhangqf Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.6d616132.js"></script>
<script src="/assets/js/main.26bbf6d2.js"></script>
</body>
</html>